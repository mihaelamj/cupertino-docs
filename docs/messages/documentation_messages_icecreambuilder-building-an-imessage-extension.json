{
  "abstract" : "Allow users to collaborate on the design of ice cream sundae stickers.",
  "codeExamples" : [
    {
      "code" : "let controller: UIViewController\nif presentationStyle == .compact {\n    \/\/ Show a list of previously created ice creams.\n    controller = instantiateIceCreamsController()\n} else {\n     \/\/ Parse an `IceCream` from the conversation's `selectedMessage` or create a new `IceCream`.\n    let iceCream = IceCream(message: conversation.selectedMessage) ?? IceCream()\n\n    \/\/ Show either the in process construction process or the completed ice cream.\n    if iceCream.isComplete {\n        controller = instantiateCompletedIceCreamController(with: iceCream)\n    } else {\n        controller = instantiateBuildIceCreamController(with: iceCream)\n    }\n}",
      "language" : "swift"
    },
    {
      "code" : "var queryItems: [URLQueryItem] {\n    var items = [URLQueryItem]()\n    \n    if let part = base {\n        items.append(part.queryItem)\n    }\n    if let part = scoops {\n        items.append(part.queryItem)\n    }\n    if let part = topping {\n        items.append(part.queryItem)\n    }\n    \n    return items\n}",
      "language" : "swift"
    },
    {
      "code" : "fileprivate func composeMessage(with iceCream: IceCream, caption: String, session: MSSession? = nil) -> MSMessage {\n    var components = URLComponents()\n    components.queryItems = iceCream.queryItems\n    \n    let layout = MSMessageTemplateLayout()\n    layout.image = iceCream.renderSticker(opaque: true)\n    layout.caption = caption\n    \n    let message = MSMessage(session: session ?? MSSession())\n    message.url = components.url!\n    message.layout = layout\n    \n    return message\n}",
      "language" : "swift"
    },
    {
      "code" : "\/\/ Add the message to the conversation.\nconversation.insert(message) { error in\n    if let error = error {\n        print(error)\n    }\n}",
      "language" : "swift"
    }
  ],
  "contentHash" : "f63a4c855572c1b59bb775445fd4f6456324d6fdc405f75b086523b153c628c5",
  "crawledAt" : "2025-12-03T09:48:09Z",
  "id" : "D98749C9-ECEF-4D6D-B928-92A78A987034",
  "kind" : "unknown",
  "language" : "swift",
  "module" : "Messages",
  "overview" : "## Overview\n\nIn this sample project, two or more users work together to build ice cream sundae stickers inside an iMessage Extension. Each completed sticker consists of a base, scoops of ice cream, and a topping. The process of building the sundae is collaborative and each step can be completed by any user who has the app installed. The participants can then send the stickers as images or attach them to any sent message.\n\nThe Xcode project consists of two targets:\n\nThe iMessage Extension target uses a [https:\/\/developer.apple.com\/documentation\/messages\/msmessagesappviewcontroller] subclass that presents child view controllers to either show the history of previously created ice cream sundaes or the collaboration interface to build a new sticker.\n\nWhen the iMessage Extension target is first initialized, the [https:\/\/developer.apple.com\/documentation\/messages\/msmessagesappviewcontroller\/willbecomeactive(with:)] method of the `MessagesViewController` configures and displays the appropriate child view controller.\n\n### Use Presentation Styles\n\niMessage Extensions can be required to display in [https:\/\/developer.apple.com\/documentation\/messages\/msmessagesapppresentationstyle]. This sample code demonstrates the [https:\/\/developer.apple.com\/documentation\/messages\/msmessagesapppresentationstyle\/compact] and [https:\/\/developer.apple.com\/documentation\/messages\/msmessagesapppresentationstyle\/expanded] styles.\n\nWhen the Ice Cream Builder app icon is tapped from the Messages app drawer, the extension initially opens in [https:\/\/developer.apple.com\/documentation\/messages\/msmessagesapppresentationstyle\/compact] mode where the initial view controller replaces the system keyboard. In this case, the `MessagesViewController` adds the `IceCreamsViewController` as a child view controller to display the history of previously created ice cream sundaes, along with an “Add” button to start creating a new one.\n\nThe UI for creating a new ice cream sundae sticker benefits from a larger view controller so when the user taps the “Add” button the app requests the [https:\/\/developer.apple.com\/documentation\/messages\/msmessagesapppresentationstyle\/expanded] presentation style by calling [https:\/\/developer.apple.com\/documentation\/messages\/msmessagesappviewcontroller\/requestpresentationstyle(_:)]. The system then calls [https:\/\/developer.apple.com\/documentation\/messages\/msmessagesappviewcontroller\/willtransition(to:)] on the `MessagesViewController` where the sample code instantiates a view controller to either continue building the sundae, or to display the completed sundae.\n\n### Attach Stickers to Messages\n\nThe `IceCreamsViewController` uses a collection view to display all previously created ice cream sundae stickers. Each cell uses a [https:\/\/developer.apple.com\/documentation\/messages\/msstickerview] object that displays a [https:\/\/developer.apple.com\/documentation\/messages\/mssticker] and also implements the standard functionality of dragging and dropping stickers to attach them to messages in the transcript, or sending the sticker as an image.\n\n### Pass Data with Messages\n\nAll data passed between users in a conversation needs to be encoded in a URL; you should use [https:\/\/developer.apple.com\/documentation\/foundation\/urlcomponents] to build and parse these URLs.\n\nThe current state of the ice cream sundae also needs to be represented visually in the Messages transcript using an instance of [https:\/\/developer.apple.com\/documentation\/messages\/msmessagetemplatelayout]. In this sample, the image property contains a rendering of the current state of the ice cream sundae.\n\nOnce the message is ready to be sent, create an [https:\/\/developer.apple.com\/documentation\/messages\/msmessage] encapsulating the message data and layout.\n\nOnce a message has been composed, it can be sent by accessing the [https:\/\/developer.apple.com\/documentation\/messages\/msmessagesappviewcontroller\/activeconversation] property of the [https:\/\/developer.apple.com\/documentation\/messages\/msmessagesappviewcontroller].\n\nThe [https:\/\/developer.apple.com\/documentation\/messages\/msconversation\/insert(_:completionhandler:)-3g248] method used in this code will place the composed message into the conversation field, but will *not* send it immediately, requiring the user to still tap the send button. If you prefer to send the message immediately then use the [https:\/\/developer.apple.com\/documentation\/messages\/msconversation\/send(_:completionhandler:)-9krz] method instead. This method is available on iOS 11 and above.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/messages\/icecreambuilder-building-an-imessage-extension\ncrawled: 2025-12-03T09:48:09Z\n---\n\n# IceCreamBuilder: Building an iMessage Extension\n\n**Sample Code**\n\nAllow users to collaborate on the design of ice cream sundae stickers.\n\n## Overview\n\nIn this sample project, two or more users work together to build ice cream sundae stickers inside an iMessage Extension. Each completed sticker consists of a base, scoops of ice cream, and a topping. The process of building the sundae is collaborative and each step can be completed by any user who has the app installed. The participants can then send the stickers as images or attach them to any sent message.\n\nThe Xcode project consists of two targets:\n\n- An iOS application that in this sample has no functionality, but would usually contain your main application.\n- An iMessage Extension target that contains all logic for building and displaying the stickers.\n\nThe iMessage Extension target uses a [https:\/\/developer.apple.com\/documentation\/messages\/msmessagesappviewcontroller] subclass that presents child view controllers to either show the history of previously created ice cream sundaes or the collaboration interface to build a new sticker.\n\nWhen the iMessage Extension target is first initialized, the [https:\/\/developer.apple.com\/documentation\/messages\/msmessagesappviewcontroller\/willbecomeactive(with:)] method of the `MessagesViewController` configures and displays the appropriate child view controller.\n\n### Use Presentation Styles\n\niMessage Extensions can be required to display in [https:\/\/developer.apple.com\/documentation\/messages\/msmessagesapppresentationstyle]. This sample code demonstrates the [https:\/\/developer.apple.com\/documentation\/messages\/msmessagesapppresentationstyle\/compact] and [https:\/\/developer.apple.com\/documentation\/messages\/msmessagesapppresentationstyle\/expanded] styles.\n\nWhen the Ice Cream Builder app icon is tapped from the Messages app drawer, the extension initially opens in [https:\/\/developer.apple.com\/documentation\/messages\/msmessagesapppresentationstyle\/compact] mode where the initial view controller replaces the system keyboard. In this case, the `MessagesViewController` adds the `IceCreamsViewController` as a child view controller to display the history of previously created ice cream sundaes, along with an “Add” button to start creating a new one.\n\nThe UI for creating a new ice cream sundae sticker benefits from a larger view controller so when the user taps the “Add” button the app requests the [https:\/\/developer.apple.com\/documentation\/messages\/msmessagesapppresentationstyle\/expanded] presentation style by calling [https:\/\/developer.apple.com\/documentation\/messages\/msmessagesappviewcontroller\/requestpresentationstyle(_:)]. The system then calls [https:\/\/developer.apple.com\/documentation\/messages\/msmessagesappviewcontroller\/willtransition(to:)] on the `MessagesViewController` where the sample code instantiates a view controller to either continue building the sundae, or to display the completed sundae.\n\n```swift\nlet controller: UIViewController\nif presentationStyle == .compact {\n    \/\/ Show a list of previously created ice creams.\n    controller = instantiateIceCreamsController()\n} else {\n     \/\/ Parse an `IceCream` from the conversation's `selectedMessage` or create a new `IceCream`.\n    let iceCream = IceCream(message: conversation.selectedMessage) ?? IceCream()\n\n    \/\/ Show either the in process construction process or the completed ice cream.\n    if iceCream.isComplete {\n        controller = instantiateCompletedIceCreamController(with: iceCream)\n    } else {\n        controller = instantiateBuildIceCreamController(with: iceCream)\n    }\n}\n```\n\n### Attach Stickers to Messages\n\nThe `IceCreamsViewController` uses a collection view to display all previously created ice cream sundae stickers. Each cell uses a [https:\/\/developer.apple.com\/documentation\/messages\/msstickerview] object that displays a [https:\/\/developer.apple.com\/documentation\/messages\/mssticker] and also implements the standard functionality of dragging and dropping stickers to attach them to messages in the transcript, or sending the sticker as an image.\n\n### Pass Data with Messages\n\nAll data passed between users in a conversation needs to be encoded in a URL; you should use [https:\/\/developer.apple.com\/documentation\/foundation\/urlcomponents] to build and parse these URLs.\n\n```swift\nvar queryItems: [URLQueryItem] {\n    var items = [URLQueryItem]()\n    \n    if let part = base {\n        items.append(part.queryItem)\n    }\n    if let part = scoops {\n        items.append(part.queryItem)\n    }\n    if let part = topping {\n        items.append(part.queryItem)\n    }\n    \n    return items\n}\n```\n\nThe current state of the ice cream sundae also needs to be represented visually in the Messages transcript using an instance of [https:\/\/developer.apple.com\/documentation\/messages\/msmessagetemplatelayout]. In this sample, the image property contains a rendering of the current state of the ice cream sundae.\n\nOnce the message is ready to be sent, create an [https:\/\/developer.apple.com\/documentation\/messages\/msmessage] encapsulating the message data and layout.\n\n```swift\nfileprivate func composeMessage(with iceCream: IceCream, caption: String, session: MSSession? = nil) -> MSMessage {\n    var components = URLComponents()\n    components.queryItems = iceCream.queryItems\n    \n    let layout = MSMessageTemplateLayout()\n    layout.image = iceCream.renderSticker(opaque: true)\n    layout.caption = caption\n    \n    let message = MSMessage(session: session ?? MSSession())\n    message.url = components.url!\n    message.layout = layout\n    \n    return message\n}\n```\n\nOnce a message has been composed, it can be sent by accessing the [https:\/\/developer.apple.com\/documentation\/messages\/msmessagesappviewcontroller\/activeconversation] property of the [https:\/\/developer.apple.com\/documentation\/messages\/msmessagesappviewcontroller].\n\n```swift\n\/\/ Add the message to the conversation.\nconversation.insert(message) { error in\n    if let error = error {\n        print(error)\n    }\n}\n```\n\nThe [https:\/\/developer.apple.com\/documentation\/messages\/msconversation\/insert(_:completionhandler:)-3g248] method used in this code will place the composed message into the conversation field, but will *not* send it immediately, requiring the user to still tap the send button. If you prefer to send the message immediately then use the [https:\/\/developer.apple.com\/documentation\/messages\/msconversation\/send(_:completionhandler:)-9krz] method instead. This method is available on iOS 11 and above.\n\n## Custom iMessage app interface\n\n- **Creating a Sticker App with a Custom Layout**: Expand on the Messages sticker app template to create an app with a customized user interface.\n- **MSMessagesAppViewController**: The principal view controller for iMessage apps.\n- **MSMessagesAppTranscriptPresentation**: A protocol that provides support for displaying live messages in the transcript of the Messages app.\n- **MSMessagesAppPresentationStyle**: Presentation styles that describe your iMessage app’s appearance.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Expand on the Messages sticker app template to create an app with a customized user interface.",
          "name" : "Creating a Sticker App with a Custom Layout",
          "url" : "https:\/\/developer.apple.com\/documentation\/Messages\/creating-a-sticker-app-with-a-custom-layout"
        },
        {
          "description" : "The principal view controller for iMessage apps.",
          "name" : "MSMessagesAppViewController",
          "url" : "https:\/\/developer.apple.com\/documentation\/Messages\/MSMessagesAppViewController"
        },
        {
          "description" : "A protocol that provides support for displaying live messages in the transcript of the Messages app.",
          "name" : "MSMessagesAppTranscriptPresentation",
          "url" : "https:\/\/developer.apple.com\/documentation\/Messages\/MSMessagesAppTranscriptPresentation"
        },
        {
          "description" : "Presentation styles that describe your iMessage app’s appearance.",
          "name" : "MSMessagesAppPresentationStyle",
          "url" : "https:\/\/developer.apple.com\/documentation\/Messages\/MSMessagesAppPresentationStyle"
        }
      ],
      "title" : "Custom iMessage app interface"
    }
  ],
  "source" : "appleJSON",
  "title" : "IceCreamBuilder: Building an iMessage Extension",
  "url" : "https:\/\/developer.apple.com\/documentation\/messages\/icecreambuilder-building-an-imessage-extension"
}