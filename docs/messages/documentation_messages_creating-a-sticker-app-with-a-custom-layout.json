{
  "abstract" : "Expand on the Messages sticker app template to create an app with a customized user interface.",
  "codeExamples" : [
    {
      "code" : "\/\/ Creates a custom layout using section providers.\nprivate static func createLayout() -> UICollectionViewLayout {\n    let sectionProvider = { (sectionIndex: Int, layoutEnvironment: NSCollectionLayoutEnvironment) -> NSCollectionLayoutSection? in\n        let headerFooterSize = NSCollectionLayoutSize(\n            widthDimension: .fractionalWidth(1.0),\n            heightDimension: sectionIndex < 2 ? .absolute(64) : .estimated(44))\n        \n        switch sectionIndex {\n            \/\/ texts\n            case 0:\n                let textSection = MessagesViewController.oneItemSection\n                let textSectionHeader = NSCollectionLayoutBoundarySupplementaryItem(\n                    layoutSize: headerFooterSize, elementKind: TextSupplementaryView.reuseIdentifier, alignment: .topLeading)\n                textSection.boundarySupplementaryItems = [textSectionHeader]\n                return textSection\n            \/\/ pictures\n            case 1:\n                let pictureSection = MessagesViewController.twoItemSection\n                let pictureSectionHeader = NSCollectionLayoutBoundarySupplementaryItem(\n                    layoutSize: headerFooterSize, elementKind: PictureSupplementaryView.reuseIdentifier, alignment: .topLeading)\n                pictureSection.boundarySupplementaryItems = [pictureSectionHeader]\n                return pictureSection\n            \/\/ animals\n            case 2:\n                let animalSection = MessagesViewController.fiveItemSection\n                let titleSectionHeader = NSCollectionLayoutBoundarySupplementaryItem(\n                    layoutSize: headerFooterSize, elementKind: TitleSupplementaryView.reuseIdentifier, alignment: .topLeading)\n                animalSection.boundarySupplementaryItems = [titleSectionHeader]\n                return animalSection\n            \/\/ trees\n            case 3:\n                let treeSection = MessagesViewController.fiveItemSection\n                let titleSectionHeader = NSCollectionLayoutBoundarySupplementaryItem(\n                    layoutSize: headerFooterSize, elementKind: TitleSupplementaryView.reuseIdentifier, alignment: .topLeading)\n                treeSection.boundarySupplementaryItems = [titleSectionHeader]\n                return treeSection\n            \/\/ days\n            case 4:\n                let daySection = MessagesViewController.oneItemSection\n                let titleSectionHeader = NSCollectionLayoutBoundarySupplementaryItem(\n                    layoutSize: headerFooterSize, elementKind: TitleSupplementaryView.reuseIdentifier, alignment: .topLeading)\n                daySection.boundarySupplementaryItems = [titleSectionHeader]\n                return daySection\n            default: return nil\n        }\n    }\n    return UICollectionViewCompositionalLayout(sectionProvider: sectionProvider)\n}",
      "language" : "swift"
    },
    {
      "code" : "var snapshot = NSDiffableDataSourceSnapshot<SectionType, MSSticker>()\nsnapshot.appendSections(SectionType.allCases)\n\nsnapshot.appendItems([\"animal-1\", \"animal-2\", \"animal-3\", \"animal-4\"].compactMap({ (name) -> MSSticker? in\n    guard let url = Bundle.main.url(forResource: name, withExtension: \"png\") else {\n        return nil\n    }\n    return try? MSSticker(contentsOfFileURL: url, localizedDescription: name)\n}), toSection: .animals)\n\nsnapshot.appendItems([\"tree-1\", \"tree-2\", \"tree-3\", \"tree-4\"].compactMap({ (name) -> MSSticker? in\n    guard let url = Bundle.main.url(forResource: name, withExtension: \"png\") else {\n        return nil\n    }\n    return try? MSSticker(contentsOfFileURL: url, localizedDescription: name)\n}), toSection: .trees)\n\nsnapshot.appendItems([\"Happy \" + formatter.string(from: Date())].compactMap({ (name) -> MSSticker? in\n    let label = UILabel()\n    label.text = name\n    guard let image = label.image(),\n          let data = image.pngData(),\n          let baseURL = FileManager.default.urls(for: .documentDirectory, in: .userDomainMask).last,\n          let url = URL(string: \"\\(baseURL.appendingPathComponent(\"\\(name).png\"))\"),\n          (try? data.write(to: url)) != nil else {\n        print(\"write failed\")\n        return nil\n    }\n    return try? MSSticker(contentsOfFileURL: url, localizedDescription: name)\n}), toSection: .days)\n\ndatasource.apply(snapshot, animatingDifferences: true, completion: nil)",
      "language" : "swift"
    },
    {
      "code" : "let cellRegistration = UICollectionView.CellRegistration<UICollectionViewCell, MSSticker> { (cell, indexPath, item) in\n    cell.contentConfiguration = CustomContentConfiguration(sticker: item)\n}\n\ndatasource = UICollectionViewDiffableDataSource<SectionType, MSSticker>(\n    collectionView: collectionView, cellProvider: { (collectionView, indexPath, item) -> UICollectionViewCell? in\n        return collectionView.dequeueConfiguredReusableCell(using: cellRegistration, for: indexPath, item: item)\n    }\n)\n\nlet titleHeaderRegistration = UICollectionView.SupplementaryRegistration\n<TitleSupplementaryView>(elementKind: TitleSupplementaryView.reuseIdentifier) {\n    (supplementaryView, string, indexPath) in\n    supplementaryView.label.text = SectionType.allCases[indexPath.section].rawValue\n}\n\nlet textHeaderRegistration = UICollectionView.SupplementaryRegistration\n<TextSupplementaryView>(elementKind: TextSupplementaryView.reuseIdentifier) {\n    (supplementaryView, string, indexPath) in\n    supplementaryView.field.delegate = self\n}\n\nlet pictureHeaderRegistration = UICollectionView.SupplementaryRegistration\n<PictureSupplementaryView>(elementKind: PictureSupplementaryView.reuseIdentifier) {\n    (supplementaryView, string, indexPath) in\n    supplementaryView.button.addTarget(self, action: #selector(self.pickImage), for: .touchDown)\n}",
      "language" : "swift"
    },
    {
      "code" : "\/\/ Set up the internal view and apply the custom configuration.\ninit(configuration: CustomContentConfiguration) {\n    super.init(frame: .zero)\n    setupInternalViews()\n    apply(configuration: configuration)\n}\n\nprivate func setupInternalViews() {\n    stickerView.translatesAutoresizingMaskIntoConstraints = false\n    addSubview(stickerView)\n    NSLayoutConstraint.activate([\n        stickerView.leadingAnchor.constraint(equalTo: leadingAnchor),\n        stickerView.trailingAnchor.constraint(equalTo: trailingAnchor),\n        stickerView.topAnchor.constraint(equalTo: topAnchor),\n        stickerView.bottomAnchor.constraint(equalTo: bottomAnchor)\n    ])\n}\n\nprivate var appliedConfiguration = CustomContentConfiguration()\n\n\/\/ Apply the custom configuration.\nprivate func apply(configuration: CustomContentConfiguration) {\n    guard appliedConfiguration != configuration else { return }\n    appliedConfiguration = configuration\n    stickerView.sticker = appliedConfiguration.sticker\n}",
      "language" : "swift"
    }
  ],
  "contentHash" : "79caee86356940988f5da39160636c738b3916114840bb49b05d2befd405b266",
  "crawledAt" : "2025-12-02T15:28:46Z",
  "id" : "160BF4A1-87D7-4F08-97DD-F32E7D744385",
  "kind" : "unknown",
  "language" : "swift",
  "module" : "Messages",
  "overview" : "## Overview\n\nXcode provides a template for creating sticker pack apps, but the template’s presets limit customization. The Stickers sample project demonstrates how to create your own sticker pack app using an application template instead of the Xcode template, and how to customize the app’s layout.\n\nThe Xcode project consists of two targets:\n\nWhen the iMessage Extension target first initializes, the `viewDidAppear` method of the `MessagesViewController` configures and displays the `UICollectionView`, which contains several sections of stickers, as well as actions to create new ones.\n\n### Customize the Sticker Layout\n\nThe Stickers app uses a `UICollectionView` to display its stickers. While the Xcode template only allows for two, three, or four items per row, the sample displays five items per row using a `UICollectionViewCompositionalLayout`.\n\nThe following code shows an example of a custom layout:\n\nThe Stickers app uses `UICollectionViewDiffableDataSource` to populate the `UICollectionView`. The sections are `String` values that denote each section and the values are `MSSticker` instances. The app creates the stickers and applies them to the data source, which displays the stickers to the user.\n\nThe following code shows how the Stickers app populates a data source:\n\n### Create a Custom Cell\n\nThe `UICollectionView` includes a custom `UICollectionViewCell`. The cells use a custom `UIContentConfiguration` to provide an `MSStickerView`, each of which contains an `MSSticker` instance.\n\nThe following code shows how to provide data to a custom cell using `UICollectionView.CellRegistration`:\n\nThe Stickers app creates a cell with a custom `UIContentConfiguration`, as the following code demonstrates:",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/Messages\/creating-a-sticker-app-with-a-custom-layout\ncrawled: 2025-12-02T15:28:46Z\n---\n\n# Creating a Sticker App with a Custom Layout\n\n**Sample Code**\n\nExpand on the Messages sticker app template to create an app with a customized user interface.\n\n## Overview\n\nXcode provides a template for creating sticker pack apps, but the template’s presets limit customization. The Stickers sample project demonstrates how to create your own sticker pack app using an application template instead of the Xcode template, and how to customize the app’s layout.\n\nThe Xcode project consists of two targets:\n\n- An iOS application that has no functionality in this sample, but usually contains your main application.\n- An iMessage Extension target that contains all logic for building and displaying the stickers.\n\nWhen the iMessage Extension target first initializes, the `viewDidAppear` method of the `MessagesViewController` configures and displays the `UICollectionView`, which contains several sections of stickers, as well as actions to create new ones.\n\n### Customize the Sticker Layout\n\nThe Stickers app uses a `UICollectionView` to display its stickers. While the Xcode template only allows for two, three, or four items per row, the sample displays five items per row using a `UICollectionViewCompositionalLayout`.\n\nThe following code shows an example of a custom layout:\n\n```swift\n\/\/ Creates a custom layout using section providers.\nprivate static func createLayout() -> UICollectionViewLayout {\n    let sectionProvider = { (sectionIndex: Int, layoutEnvironment: NSCollectionLayoutEnvironment) -> NSCollectionLayoutSection? in\n        let headerFooterSize = NSCollectionLayoutSize(\n            widthDimension: .fractionalWidth(1.0),\n            heightDimension: sectionIndex < 2 ? .absolute(64) : .estimated(44))\n        \n        switch sectionIndex {\n            \/\/ texts\n            case 0:\n                let textSection = MessagesViewController.oneItemSection\n                let textSectionHeader = NSCollectionLayoutBoundarySupplementaryItem(\n                    layoutSize: headerFooterSize, elementKind: TextSupplementaryView.reuseIdentifier, alignment: .topLeading)\n                textSection.boundarySupplementaryItems = [textSectionHeader]\n                return textSection\n            \/\/ pictures\n            case 1:\n                let pictureSection = MessagesViewController.twoItemSection\n                let pictureSectionHeader = NSCollectionLayoutBoundarySupplementaryItem(\n                    layoutSize: headerFooterSize, elementKind: PictureSupplementaryView.reuseIdentifier, alignment: .topLeading)\n                pictureSection.boundarySupplementaryItems = [pictureSectionHeader]\n                return pictureSection\n            \/\/ animals\n            case 2:\n                let animalSection = MessagesViewController.fiveItemSection\n                let titleSectionHeader = NSCollectionLayoutBoundarySupplementaryItem(\n                    layoutSize: headerFooterSize, elementKind: TitleSupplementaryView.reuseIdentifier, alignment: .topLeading)\n                animalSection.boundarySupplementaryItems = [titleSectionHeader]\n                return animalSection\n            \/\/ trees\n            case 3:\n                let treeSection = MessagesViewController.fiveItemSection\n                let titleSectionHeader = NSCollectionLayoutBoundarySupplementaryItem(\n                    layoutSize: headerFooterSize, elementKind: TitleSupplementaryView.reuseIdentifier, alignment: .topLeading)\n                treeSection.boundarySupplementaryItems = [titleSectionHeader]\n                return treeSection\n            \/\/ days\n            case 4:\n                let daySection = MessagesViewController.oneItemSection\n                let titleSectionHeader = NSCollectionLayoutBoundarySupplementaryItem(\n                    layoutSize: headerFooterSize, elementKind: TitleSupplementaryView.reuseIdentifier, alignment: .topLeading)\n                daySection.boundarySupplementaryItems = [titleSectionHeader]\n                return daySection\n            default: return nil\n        }\n    }\n    return UICollectionViewCompositionalLayout(sectionProvider: sectionProvider)\n}\n```\n\nThe Stickers app uses `UICollectionViewDiffableDataSource` to populate the `UICollectionView`. The sections are `String` values that denote each section and the values are `MSSticker` instances. The app creates the stickers and applies them to the data source, which displays the stickers to the user.\n\nThe following code shows how the Stickers app populates a data source:\n\n```swift\nvar snapshot = NSDiffableDataSourceSnapshot<SectionType, MSSticker>()\nsnapshot.appendSections(SectionType.allCases)\n\nsnapshot.appendItems([\"animal-1\", \"animal-2\", \"animal-3\", \"animal-4\"].compactMap({ (name) -> MSSticker? in\n    guard let url = Bundle.main.url(forResource: name, withExtension: \"png\") else {\n        return nil\n    }\n    return try? MSSticker(contentsOfFileURL: url, localizedDescription: name)\n}), toSection: .animals)\n\nsnapshot.appendItems([\"tree-1\", \"tree-2\", \"tree-3\", \"tree-4\"].compactMap({ (name) -> MSSticker? in\n    guard let url = Bundle.main.url(forResource: name, withExtension: \"png\") else {\n        return nil\n    }\n    return try? MSSticker(contentsOfFileURL: url, localizedDescription: name)\n}), toSection: .trees)\n\nsnapshot.appendItems([\"Happy \" + formatter.string(from: Date())].compactMap({ (name) -> MSSticker? in\n    let label = UILabel()\n    label.text = name\n    guard let image = label.image(),\n          let data = image.pngData(),\n          let baseURL = FileManager.default.urls(for: .documentDirectory, in: .userDomainMask).last,\n          let url = URL(string: \"\\(baseURL.appendingPathComponent(\"\\(name).png\"))\"),\n          (try? data.write(to: url)) != nil else {\n        print(\"write failed\")\n        return nil\n    }\n    return try? MSSticker(contentsOfFileURL: url, localizedDescription: name)\n}), toSection: .days)\n\ndatasource.apply(snapshot, animatingDifferences: true, completion: nil)\n```\n\n### Create a Custom Cell\n\nThe `UICollectionView` includes a custom `UICollectionViewCell`. The cells use a custom `UIContentConfiguration` to provide an `MSStickerView`, each of which contains an `MSSticker` instance.\n\nThe following code shows how to provide data to a custom cell using `UICollectionView.CellRegistration`:\n\n```swift\nlet cellRegistration = UICollectionView.CellRegistration<UICollectionViewCell, MSSticker> { (cell, indexPath, item) in\n    cell.contentConfiguration = CustomContentConfiguration(sticker: item)\n}\n\ndatasource = UICollectionViewDiffableDataSource<SectionType, MSSticker>(\n    collectionView: collectionView, cellProvider: { (collectionView, indexPath, item) -> UICollectionViewCell? in\n        return collectionView.dequeueConfiguredReusableCell(using: cellRegistration, for: indexPath, item: item)\n    }\n)\n\nlet titleHeaderRegistration = UICollectionView.SupplementaryRegistration\n<TitleSupplementaryView>(elementKind: TitleSupplementaryView.reuseIdentifier) {\n    (supplementaryView, string, indexPath) in\n    supplementaryView.label.text = SectionType.allCases[indexPath.section].rawValue\n}\n\nlet textHeaderRegistration = UICollectionView.SupplementaryRegistration\n<TextSupplementaryView>(elementKind: TextSupplementaryView.reuseIdentifier) {\n    (supplementaryView, string, indexPath) in\n    supplementaryView.field.delegate = self\n}\n\nlet pictureHeaderRegistration = UICollectionView.SupplementaryRegistration\n<PictureSupplementaryView>(elementKind: PictureSupplementaryView.reuseIdentifier) {\n    (supplementaryView, string, indexPath) in\n    supplementaryView.button.addTarget(self, action: #selector(self.pickImage), for: .touchDown)\n}\n```\n\nThe Stickers app creates a cell with a custom `UIContentConfiguration`, as the following code demonstrates:\n\n```swift\n\/\/ Set up the internal view and apply the custom configuration.\ninit(configuration: CustomContentConfiguration) {\n    super.init(frame: .zero)\n    setupInternalViews()\n    apply(configuration: configuration)\n}\n\nprivate func setupInternalViews() {\n    stickerView.translatesAutoresizingMaskIntoConstraints = false\n    addSubview(stickerView)\n    NSLayoutConstraint.activate([\n        stickerView.leadingAnchor.constraint(equalTo: leadingAnchor),\n        stickerView.trailingAnchor.constraint(equalTo: trailingAnchor),\n        stickerView.topAnchor.constraint(equalTo: topAnchor),\n        stickerView.bottomAnchor.constraint(equalTo: bottomAnchor)\n    ])\n}\n\nprivate var appliedConfiguration = CustomContentConfiguration()\n\n\/\/ Apply the custom configuration.\nprivate func apply(configuration: CustomContentConfiguration) {\n    guard appliedConfiguration != configuration else { return }\n    appliedConfiguration = configuration\n    stickerView.sticker = appliedConfiguration.sticker\n}\n```\n\n## Custom iMessage app interface\n\n- **IceCreamBuilder: Building an iMessage Extension**: Allow users to collaborate on the design of ice cream sundae stickers.\n- **MSMessagesAppViewController**: The principal view controller for iMessage apps.\n- **MSMessagesAppTranscriptPresentation**: A protocol that provides support for displaying live messages in the transcript of the Messages app.\n- **MSMessagesAppPresentationStyle**: Presentation styles that describe your iMessage app’s appearance.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Allow users to collaborate on the design of ice cream sundae stickers.",
          "name" : "IceCreamBuilder: Building an iMessage Extension",
          "url" : "https:\/\/developer.apple.com\/documentation\/Messages\/icecreambuilder-building-an-imessage-extension"
        },
        {
          "description" : "The principal view controller for iMessage apps.",
          "name" : "MSMessagesAppViewController",
          "url" : "https:\/\/developer.apple.com\/documentation\/Messages\/MSMessagesAppViewController"
        },
        {
          "description" : "A protocol that provides support for displaying live messages in the transcript of the Messages app.",
          "name" : "MSMessagesAppTranscriptPresentation",
          "url" : "https:\/\/developer.apple.com\/documentation\/Messages\/MSMessagesAppTranscriptPresentation"
        },
        {
          "description" : "Presentation styles that describe your iMessage app’s appearance.",
          "name" : "MSMessagesAppPresentationStyle",
          "url" : "https:\/\/developer.apple.com\/documentation\/Messages\/MSMessagesAppPresentationStyle"
        }
      ],
      "title" : "Custom iMessage app interface"
    }
  ],
  "source" : "appleJSON",
  "title" : "Creating a Sticker App with a Custom Layout",
  "url" : "https:\/\/developer.apple.com\/documentation\/Messages\/creating-a-sticker-app-with-a-custom-layout"
}