{
  "abstract" : "Use ActivityKit to receive push tokens and to remotely start, update, and end your Live Activity with ActivityKit notifications.",
  "codeExamples" : [
    {
      "code" : "func startActivity(hero: EmojiRanger) throws {\n    let adventure = AdventureAttributes(hero: hero)\n    let initialState = AdventureAttributes.ContentState(\n        currentHealthLevel: hero.healthLevel,\n        eventDescription: \"Adventure has begun!\"\n    )\n    \n    let activity = try Activity.request(\n        attributes: adventure,\n        content: .init(state: initialState, staleDate: nil),\n        pushType: .token\n    )\n  \n    \/\/ ...\n}",
      "language" : "swift"
    },
    {
      "code" : "Task {\n    for await pushToken in activity.pushTokenUpdates {\n        let pushTokenString = pushToken.reduce(\"\") {\n\t          $0 + String(format: \"%02x\", $1)\n        }\n\n        Logger().log(\"New push token: \\(pushTokenString)\")\n                \n        try await self.sendPushToken(hero: hero, pushTokenString: pushTokenString)\n    }\n}",
      "language" : "swift"
    },
    {
      "code" : "func startLiveActivityWithChannel(string channelId, initialState) {\n    let activity = try Activity.request(\n            attributes: adventure,\n            content: .init(state: initialState, staleDate: nil),\n            \/\/Input your unique channel ID\n            pushType: .channel(channelId)\n}",
      "language" : "swift"
    },
    {
      "code" : "{\n    \"aps\": {\n        \"timestamp\": 1685952000,\n        \"event\": \"update\",\n        \"content-state\": {\n            \"currentHealthLevel\": 0.0,\n            \"eventDescription\": \"Power Panda has been knocked down!\"\n        },\n        \"alert\": {\n            \"title\": {\n                \"loc-key\": \"%@ is knocked down!\",\n                \"loc-args\": [\"Power Panda\"]\n            },\n            \"body\": {\n                \"loc-key\": \"Use a potion to heal %@!\",\n                \"loc-args\": [\"Power Panda\"]\n            },\n            \"sound\": \"HeroDown.mp4\"\n        }\n    }\n}",
      "language" : "json"
    },
    {
      "code" : "{\n    \"aps\": {\n        \"timestamp\": 1234,\n        \"event\": \"start\",\n        \"content-state\": {\n            \"currentHealthLevel\": 100,\n            \"eventDescription\": \"Adventure has begun!\"\n        },\n        \"attributes-type\": \"AdventureAttributes\",\n        \"attributes\": {\n            \"hero\": {\n                \"name\": \"Power Panda\",\n                \"avatar\": \"U+1F43C\",\n                \"healthLevel\": 100,\n                \"heroType\": \"Forest Dweller\",\n                \"healthRecoveryRatePerHour\": 0.25,\n                \"url\": \"game:\/\/\/panda\",\n                \"battleCode\": \"game:\/\/\/panda\/battle\",\n                \"level\": 3,\n                \"exp\": 600,\n                \"bio\": \"Power Panda loves eating bamboo shoots and leaves.\"\n            }\n        },\n        \"alert\": {\n            \"title\": {\n                \"loc-key\": \"%@ is on an adventure!\",\n                \"loc-args\": [\n                    \"Power Panda\"\n                ]\n            },\n            \"body\": {\n                \"loc-key\": \"%@ found a sword!\",\n                \"loc-args\": [\n                    \"Power Panda\"\n                ]\n            },\n            \"sound\": \"chime.aiff\"\n        }\n    }\n}",
      "language" : "swift"
    },
    {
      "code" : "       \"input-push-channel\": \"dHN0LXNyY2gtY2hubA==\",\n       \"attributes-type\": \"AdventureAttributes\",\n       \"attributes\": {\n           \"currentHealthLevel\": 100,\n           \"eventDescription\": \"Adventure has begun!\"\n       }",
      "language" : "swift"
    },
    {
      "code" : "        \"input-push-token\": 1,\n        \"attributes-type\": \"AdventureAttributes\",\n        \"attributes\": {\n            \"currentHealthLevel\": 100,\n            \"eventDescription\": \"Adventure has begun!\"\n        }",
      "language" : "swift"
    },
    {
      "code" : "curl \\\n --header \"apns-topic: com.example.apple-samplecode.Emoji-Rangers.push-type.liveactivity\" \\\n --header \"apns-push-type: liveactivity\" \\\n --header \"apns-priority: 10\" \\\n --header \"authorization: bearer $AUTHENTICATION_TOKEN\" \\\n --data '{\n     \"aps\": {\n         \"timestamp\": '$(date +%s)',\n         \"event\": \"update\",\n         \"content-state\": {\n             \"currentHealthLevel\": 0.941,\n             \"eventDescription\": \"Power Panda found a sword!\"\n         }\n     }\n }' \\\n --http2 https:\/\/api.sandbox.push.apple.com\/3\/device\/$ACTIVITY_PUSH_TOKEN"
    },
    {
      "code" : "{\n    \"aps\": {\n        \"timestamp\": 1685952000,\n        \"event\": \"update\",\n        \"relevance-score\": 100,\n        \"content-state\": {\n            \"currentHealthLevel\": 0.941,\n            \"eventDescription\": \"Power Panda found a sword!\"\n        }\n    }\n}",
      "language" : "json"
    }
  ],
  "contentHash" : "470391591c16c535e5f10edb310875481ad12add6bd785d768d15c1f7007cd20",
  "crawledAt" : "2025-12-03T04:04:31Z",
  "id" : "24ECBB41-5263-4D7B-A2AB-82A2AF027162",
  "kind" : "article",
  "language" : "swift",
  "module" : "ActivityKit",
  "overview" : "## Overview\n\nActivityKit offers functionality to start, update, and end Live Activities from your app. Additionally, it offers functionality to receive push tokens. Use push tokens to send ActivityKit notifications from your server to Apple Push Notification service (APNs). With notifications, you can:\n\n### Start and update Live Activities\n\nTo start and update your Live Activities by sending ActivityKit push notifications to a device:\n\nTo start and update your Live Activities with ActivityKit push notifications on a channel:\n\n### Add the Push Notifications capability\n\nIn your Xcode project, start by adding the Push Notifications capability to your app in Xcode as described in [doc:\/\/com.apple.documentation\/documentation\/UserNotifications\/registering-your-app-with-apns]. Note that you can’t use the User Notifications framework to register your Live Activity for push notifications. Instead, you use ActivityKit to obtain a push token as described below. If you choose to use broadcast push notifications for your app, refer to [doc:\/\/com.apple.documentation\/documentation\/UserNotifications\/setting-up-broadcast-push-notifications] for more details on enabling broadcast capability for your app.\n\n### Create a push notification server\n\nAdditionally, set up a remote notification server or make changes to your existing server and send JSON payloads to APNs as described below. If you’re new to using push notifications, plan to spend time implementing the remote notification server. For more information, refer to [doc:\/\/com.apple.documentation\/documentation\/UserNotifications\/registering-your-app-with-apns]. To use device push notifications, you use the push tokens that you receive from ActivityKit to send push notifications in your remote notification server. For more information about sending push notifcations using push tokens, refer to [doc:\/\/com.apple.documentation\/documentation\/UserNotifications\/sending-notification-requests-to-apns].\n\nFor broadcast push notifications, use the channel you created for the Live Activity and shared with the app to send push notifications in your remote notifications server. For more information on creating channels, refer to [doc:\/\/com.apple.documentation\/documentation\/UserNotifications\/sending-channel-management-requests-to-apns].  For information on how to send a push notification on a channel, refer to [doc:\/\/com.apple.documentation\/documentation\/UserNotifications\/sending-broadcast-push-notification-requests-to-apns].\n\n### Start a Live Activity that supports push updates to push tokens\n\nOn devices that run iOS or iPadOS 17.1 and earlier, you can’t start Live Activities with ActivityKit push notifications. However, you can update and end them with ActivityKit push notifications. In your app, start a Live Activity with the [doc:\/\/com.apple.activitykit\/documentation\/ActivityKit\/Activity\/request(attributes:content:pushType:)] function and pass [doc:\/\/com.apple.activitykit\/documentation\/ActivityKit\/PushType\/token] to its `pushType` parameter. As a result, you receive a push token that’s unique to your Live Activity when you successfully start the Live Activity.\n\nThe following code snippet from the [doc:\/\/com.apple.documentation\/documentation\/WidgetKit\/emoji-rangers-supporting-live-activities-interactivity-and-animations] sample code project starts a Live Activity and requests a push token:\n\nEvery time you start a new Live Activity, you need to send the push token to your server. However, the [doc:\/\/com.apple.activitykit\/documentation\/ActivityKit\/Activity\/pushToken] isn’t available immediately after calling [doc:\/\/com.apple.activitykit\/documentation\/ActivityKit\/Activity\/request(attributes:content:pushType:)], because push token creation happens asynchronously and may take some time. Take this into account before accessing the [doc:\/\/com.apple.activitykit\/documentation\/ActivityKit\/Activity\/pushToken] synchronously. Instead, observe push token updates using the [doc:\/\/com.apple.activitykit\/documentation\/ActivityKit\/Activity\/pushTokenUpdates-swift.property] asynchronous sequence. This makes sure you receive the first push token, and any updates to it.\n\nFor example, the following code snippet from the [doc:\/\/com.apple.documentation\/documentation\/WidgetKit\/emoji-rangers-supporting-live-activities-interactivity-and-animations] sample code project uses an asynchronous [doc:\/\/com.apple.documentation\/documentation\/Swift\/Task] to receive push token updates. In the asynchronous for loop, it logs the updated token to the console for debugging and local testing, and sends it to the server:\n\nThe push token for a Live Activity may change throughout its duration. When your app receives a new token, it receives background runtime to process the updated token. Keep track of the push token for each Live Activity. Additionally, invalidate the previous, now-outdated token on your server when you receive an updated token to successfully send subsequent updates.\n\n### Start a Live Activity that supports push updates on a channel\n\nYou can update or end Live Activities by an ActivityKit push notification sent on a channel. To create a channel for your Live Activity event, refer to [doc:\/\/com.apple.documentation\/documentation\/UserNotifications\/sending-channel-management-requests-to-apns]. The channel you create has a unique identifier, called a channel ID, that devices use to subscribe to Live Activity updates. Your remote server provides the Channel ID to your app before the Live Activity starts.  In your app, start a Live Activity with the `request(attributes:content:pushType:)` function and pass channel to its `pushType` parameter with the channel ID. If the channel ID isn’t a valid channel, the Live Activity fails to start.\n\nThe following code snippet starts a Live Activity and subscribes to receive push notifications on channel ID:\n\n### Start new Live Activities with ActivityKit push notifications\n\nYou can start new Live Activities with ActivityKit push notifications. This option is especially useful for tracking events with Live Activities that occur more than once. For example, if someone starts a Live Activity to track their favorite sports team, the sports app might offer to automatically start a Live Activity for each of the team’s games. In the future, the person doesn’t have to remember to start the Live Activity from the app. Instead, a Live Activity for tracking the game might automatically start from an ActivityKit push notification you sent with your remote notification server and APNs.\n\nTo start Live Activities from ActivityKit push notifications, configure your app to support push notifications. Then obtain the token to for starting a Live Activity:\n\n### Construct the ActivityKit remote push notification payload\n\nTo successfully start, update, or end a Live Activity with an ActivityKit push notification, send an HTTP request to APNs that conforms to the following requirements:\n\nFor more information about request headers, refer to [doc:\/\/com.apple.documentation\/documentation\/UserNotifications\/sending-notification-requests-to-apns].\n\nTo successfully update or end a Live Activity with an ActivityKit push notification to a channel, send an HTTP request to APNs that conforms to the following requirements:\n\nFor more information about request headers, refer to [doc:\/\/com.apple.documentation\/documentation\/UserNotifications\/sending-broadcast-push-notification-requests-to-apns].\n\nIn your request’s  `aps` dictionary:\n\nThe following payload updates the Live Activity of the [doc:\/\/com.apple.documentation\/documentation\/WidgetKit\/emoji-rangers-supporting-live-activities-interactivity-and-animations] example with the latest information. The content of `content-state` must match the properties of the custom [doc:\/\/com.apple.activitykit\/documentation\/ActivityKit\/Activity\/ContentState-swift.typealias] type you declare in your [doc:\/\/com.apple.activitykit\/documentation\/ActivityKit\/ActivityAttributes] implementation. In the example, `content-state` matches the properties of the custom `AdventureAttributes.ContentState` type of the sample code project. Additionally, the example payload includes an alert with a custom sound to let the player know that the hero has been knocked down and requires a healing potion.\n\nIn your alert implementation, consider localizing both strings. For more information on displaying alerts for a remote notification, including localized alert messages and a reference of available keys, refer to [doc:\/\/com.apple.documentation\/documentation\/UserNotifications\/generating-a-remote-notification].\n\nRemember that a person’s device may not receive a push notification — for example, if they’re in an area without a network connection. Similarly, the system ignores an ActivityKit push notification if it arrives after the Live Activity ended. Both cases can cause a Live Activity to display outdated information. To help reduce the chance of showing outdated information, update your Live Activity from your app in addition to push notifications.\n\n### Construct the payload that starts a Live Activity\n\nThe JSON payload for starting a Live Activity with an ActivityKit push notification is similar to the payload you use for updates. However, it comes with the following requirements:\n\nBy including an alert in your JSON payload, you make sure a person gets alerted about the started Live Activity and avoid unexpectedly surprising them. The following sample payload starts a Live Activity for devices that aren’t running iOS 18 and iPadOS 18 or later:\n\nFor devices running iOS 18 and iPadOS or later, you can add `input-push-channel` with the appropriate channel ID to start a Live Activity and listen for updates on a channel. After you send this payload, you can send updates on the channel to update a Live Activity.\n\nCreate a channel ID before you send this payload to a device and ensure that the channel ID is valid. If you send this payload to a device that doesn’t run iOS 18 and later, then the Live Activity will not start.\n\nFor devices running iOS 18 and iPadOS 18 or later, you can add `input-push-token: 1` to your payload to start a Live Activity and receive a new push token. After you receive a new push token, you can use it to send updates to a Live Activity.\n\n### Test Live Activity updates locally\n\nDuring development, verify your JSON payloads and Live Activity updates locally. Using command-line tools and Simulator or a test device, you can send a JSON payload from the command line to APNs and receive Live Activity updates to verify that your payload updates the Live Activity and the Live Activity behaves as expected.\n\nTo locally test Live Activity updates during development:\n\nThe following example shows a curl command that the [doc:\/\/com.apple.documentation\/documentation\/WidgetKit\/emoji-rangers-supporting-live-activities-interactivity-and-animations] sample code project could use to test a Live Activity update.\n\nTo locally test Live Activity updates to a channel during development:\n\nIf you encounter failures while sending an ActivityKit push notification:\n\n### Determine the update frequency\n\nThe system allows for a certain budget of ActivityKit push notifications per hour. As with other push notifications you send with APNs, you can set the HTTP header field  `apns-priority` for your requests to specify the priority of an ActivityKit push notification:\n\nTo avoid throttling, you can send a low-priority ActivityKit push notification that doesn’t count toward the budget by setting the HTTP header field  `apns-priority` to `5`. Consider this lower priority first before using the priority of `10`. In many cases, choosing a mix of priority `5` and `10` for updates prevents your Live Activity updates from being throttled. For example, the Live Activity of the [doc:\/\/com.apple.documentation\/documentation\/WidgetKit\/emoji-rangers-supporting-live-activities-interactivity-and-animations] sample code project could use priority `5` for updates that don’t require a person’s immediate attention, like when the hero heals by a few points. When the hero requires a healing potion, the example would use a priority of `10` to immediately update the Live Activity and let the user know about the important change.\n\nHowever, your app may need to update its Live Activity more frequently, causing you to hit the budget limit for ActivityKit push notifications. For example, if your app allows people to track a sports event like a basketball match that requires many updates per minute, you may not be able to update your Live Activity often enough.\n\nTo allow for use cases like this, you can enable your Live Activities to receive frequent ActivityKit push notifications:\n\nPeople can deactivate frequent ActivityKit push notifications for your app in the Settings app. In your code, use [doc:\/\/com.apple.activitykit\/documentation\/ActivityKit\/ActivityAuthorizationInfo\/frequentPushesEnabled] to detect whether a person deactivated frequent push notifications and display information in your app that asks them to activate frequent ActivityKit push notifications again. Additionally, send the value of this setting to your server and adjust the update frequency accordingly.\n\nSimilar to other asynchronous sequences ActivityKit provides to receive configuration updates, you can subscribe to changes to the frequent Live Activity push notification setting setting with the [doc:\/\/com.apple.activitykit\/documentation\/ActivityKit\/ActivityAuthorizationInfo\/frequentPushEnablementUpdates-swift.property] stream.\n\nFor more information on available HTTPs headers and sending requests to APNs, refer to [doc:\/\/com.apple.documentation\/documentation\/UserNotifications\/sending-notification-requests-to-apns].\n\n### End the Live Activity with a custom dismissal date\n\nWhen you end a Live Activity, by default the Live Activity appears on the Lock Screen for up to four hours after it ends to allow people to glance at their phone to refer to the latest information. To change the time until the system removes a Live Activity from the Lock Screen after it ends, include the `\"dismissal-date\"` entry in the `\"aps\"` dictionary of your JSON payload. If you don’t include the `\"dismissal-date\"`, your Live Activity uses the system’s default dismissal behavior. To dismiss the Live Activity from the Lock Screen immediately after it ends, provide a date for `\"dismissal-date\"` that’s in the past — for example, `\"dismissal-date\": 1663177260`. Alternatively, provide a date within a four-hour window to set a custom dismissal date.\n\n### Mark a Live Activity as outdated by setting a stale date\n\nIn some scenarios — for example,  if a person enters an area without network connectivity — you might not be able update the Live Activity with new information, causing it to display outdated data. To provide the best possible user experience and let the person know that the Live Activity displays outdated information, add a timestamp in the optional `stale-date` field to provide the time when the system will consider the Live Activity to be stale. With each update, you can advance this `stale-date`. When you can’t update the Live Activity for some time until it becomes stale, the [doc:\/\/com.apple.activitykit\/documentation\/ActivityKit\/Activity\/activityState] changes to [doc:\/\/com.apple.activitykit\/documentation\/ActivityKit\/ActivityState\/stale] at the specified date. Use the [doc:\/\/com.apple.activitykit\/documentation\/ActivityKit\/Activity\/activityStateUpdates-swift.property] stream in your app to monitor the activity state and respond to outdated Live Activities that haven’t received updates. For example, while a person has network connectivity, a sports app could update the Live Activity with the latest game information and advance the stale date. When it becomes stale, it displays text to indicate that the displayed information is outdated.\n\n### Display the most important Live Activity in the Dynamic Island\n\nIf your app starts more than one Live Activity, provide a `relevance-score` in your JSON payload to determine the order of your Live Activities on the Lock Screen and which of your Live Activities appears in the Dynamic Island:\n\nThe system expects relative values for the relevance score. Assign a higher value for an important Live Activity content update — for example, a score of `100` — and use lower values for less important Live Activity content updates — for example, `50`.\n\nThe following example payload provides a relevance score of `100` to make sure the Live Activity that receives the update appears in the Dynamic Island and at top of the list on the Lock Screen:",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/activitykit\/starting-and-updating-live-activities-with-activitykit-push-notifications\ncrawled: 2025-12-03T04:04:31Z\n---\n\n# Starting and updating Live Activities with ActivityKit push notifications\n\n**Article**\n\nUse ActivityKit to receive push tokens and to remotely start, update, and end your Live Activity with ActivityKit notifications.\n\n## Overview\n\nActivityKit offers functionality to start, update, and end Live Activities from your app. Additionally, it offers functionality to receive push tokens. Use push tokens to send ActivityKit notifications from your server to Apple Push Notification service (APNs). With notifications, you can:\n\n- Update and end Live Activities\n- Start Live Activities\n- Update or end Live Activities for a large audience with channels and broadcast push notifications\n\n\n\n### Start and update Live Activities\n\nTo start and update your Live Activities by sending ActivityKit push notifications to a device:\n\n1. Use ActivityKit functionality to obtain push tokens.\n2. Set up a remote notification server or make changes to your existing server to support ActivityKit push notifications. If you’re new to using push notifications, plan to spend time implementing your remote notification server. For more information, refer to [doc:\/\/com.apple.documentation\/documentation\/UserNotifications\/registering-your-app-with-apns].\n3. Send the push tokens you receive from ActivityKit to your server and use them establish a token-based connection to APNs, as described in [doc:\/\/com.apple.documentation\/documentation\/UserNotifications\/establishing-a-token-based-connection-to-apns].\n4. Handle updates to the push tokens and update or invalidate them on your server as needed.\n5. Send ActivityKit push notifications from your server with APNs using the push tokens, HTTP header fields, and JSON payloads described in this article to start, update, and end Live Activities.\n6. Test ActivityKit push notifications locally and verify that your Live Activity behaves as expected.\n7. Decide the frequency for your ActivityKit push notifications. For more information, refer to the “Determine the update frequency” section below.\n\nTo start and update your Live Activities with ActivityKit push notifications on a channel:\n\n1. Enable broadcast capabilities for your app as described in [doc:\/\/com.apple.documentation\/documentation\/UserNotifications\/setting-up-broadcast-push-notifications].\n2. Set up a remote notification server or make changes to your existing server to support ActivityKit push notifications. If you’re new to using push notifications, plan to spend time implementing your remote notification server.\n3. Use channel creation request to create a channel for each Live Activity event. For more information, refer to [doc:\/\/com.apple.documentation\/documentation\/UserNotifications\/sending-channel-management-requests-to-apns].\n4. Send the channel ID for the Live Activity event to your app.\n5. When you request a new activity with ActivityKit to subscribe for updates on the channel, use the channel push type with the channel ID.\n6. Send ActivityKit push notifications from your server to APNs using the channel ID, HTTP header fields, and JSON payloads described in this article to update and end Live Activities.\n7. Test ActivityKit push notifications locally and verify that your Live Activity behaves as expected.\n\n### Add the Push Notifications capability\n\nIn your Xcode project, start by adding the Push Notifications capability to your app in Xcode as described in [doc:\/\/com.apple.documentation\/documentation\/UserNotifications\/registering-your-app-with-apns]. Note that you can’t use the User Notifications framework to register your Live Activity for push notifications. Instead, you use ActivityKit to obtain a push token as described below. If you choose to use broadcast push notifications for your app, refer to [doc:\/\/com.apple.documentation\/documentation\/UserNotifications\/setting-up-broadcast-push-notifications] for more details on enabling broadcast capability for your app.\n\n\n\n### Create a push notification server\n\nAdditionally, set up a remote notification server or make changes to your existing server and send JSON payloads to APNs as described below. If you’re new to using push notifications, plan to spend time implementing the remote notification server. For more information, refer to [doc:\/\/com.apple.documentation\/documentation\/UserNotifications\/registering-your-app-with-apns]. To use device push notifications, you use the push tokens that you receive from ActivityKit to send push notifications in your remote notification server. For more information about sending push notifcations using push tokens, refer to [doc:\/\/com.apple.documentation\/documentation\/UserNotifications\/sending-notification-requests-to-apns].\n\nFor broadcast push notifications, use the channel you created for the Live Activity and shared with the app to send push notifications in your remote notifications server. For more information on creating channels, refer to [doc:\/\/com.apple.documentation\/documentation\/UserNotifications\/sending-channel-management-requests-to-apns].  For information on how to send a push notification on a channel, refer to [doc:\/\/com.apple.documentation\/documentation\/UserNotifications\/sending-broadcast-push-notification-requests-to-apns].\n\n### Start a Live Activity that supports push updates to push tokens\n\nOn devices that run iOS or iPadOS 17.1 and earlier, you can’t start Live Activities with ActivityKit push notifications. However, you can update and end them with ActivityKit push notifications. In your app, start a Live Activity with the [doc:\/\/com.apple.activitykit\/documentation\/ActivityKit\/Activity\/request(attributes:content:pushType:)] function and pass [doc:\/\/com.apple.activitykit\/documentation\/ActivityKit\/PushType\/token] to its `pushType` parameter. As a result, you receive a push token that’s unique to your Live Activity when you successfully start the Live Activity.\n\nThe following code snippet from the [doc:\/\/com.apple.documentation\/documentation\/WidgetKit\/emoji-rangers-supporting-live-activities-interactivity-and-animations] sample code project starts a Live Activity and requests a push token:\n\n```swift\nfunc startActivity(hero: EmojiRanger) throws {\n    let adventure = AdventureAttributes(hero: hero)\n    let initialState = AdventureAttributes.ContentState(\n        currentHealthLevel: hero.healthLevel,\n        eventDescription: \"Adventure has begun!\"\n    )\n    \n    let activity = try Activity.request(\n        attributes: adventure,\n        content: .init(state: initialState, staleDate: nil),\n        pushType: .token\n    )\n  \n    \/\/ ...\n}\n```\n\nEvery time you start a new Live Activity, you need to send the push token to your server. However, the [doc:\/\/com.apple.activitykit\/documentation\/ActivityKit\/Activity\/pushToken] isn’t available immediately after calling [doc:\/\/com.apple.activitykit\/documentation\/ActivityKit\/Activity\/request(attributes:content:pushType:)], because push token creation happens asynchronously and may take some time. Take this into account before accessing the [doc:\/\/com.apple.activitykit\/documentation\/ActivityKit\/Activity\/pushToken] synchronously. Instead, observe push token updates using the [doc:\/\/com.apple.activitykit\/documentation\/ActivityKit\/Activity\/pushTokenUpdates-swift.property] asynchronous sequence. This makes sure you receive the first push token, and any updates to it.\n\nFor example, the following code snippet from the [doc:\/\/com.apple.documentation\/documentation\/WidgetKit\/emoji-rangers-supporting-live-activities-interactivity-and-animations] sample code project uses an asynchronous [doc:\/\/com.apple.documentation\/documentation\/Swift\/Task] to receive push token updates. In the asynchronous for loop, it logs the updated token to the console for debugging and local testing, and sends it to the server:\n\n```swift\nTask {\n    for await pushToken in activity.pushTokenUpdates {\n        let pushTokenString = pushToken.reduce(\"\") {\n\t          $0 + String(format: \"%02x\", $1)\n        }\n\n        Logger().log(\"New push token: \\(pushTokenString)\")\n                \n        try await self.sendPushToken(hero: hero, pushTokenString: pushTokenString)\n    }\n}\n```\n\nThe push token for a Live Activity may change throughout its duration. When your app receives a new token, it receives background runtime to process the updated token. Keep track of the push token for each Live Activity. Additionally, invalidate the previous, now-outdated token on your server when you receive an updated token to successfully send subsequent updates.\n\n### Start a Live Activity that supports push updates on a channel\n\nYou can update or end Live Activities by an ActivityKit push notification sent on a channel. To create a channel for your Live Activity event, refer to [doc:\/\/com.apple.documentation\/documentation\/UserNotifications\/sending-channel-management-requests-to-apns]. The channel you create has a unique identifier, called a channel ID, that devices use to subscribe to Live Activity updates. Your remote server provides the Channel ID to your app before the Live Activity starts.  In your app, start a Live Activity with the `request(attributes:content:pushType:)` function and pass channel to its `pushType` parameter with the channel ID. If the channel ID isn’t a valid channel, the Live Activity fails to start.\n\nThe following code snippet starts a Live Activity and subscribes to receive push notifications on channel ID:\n\n```swift\nfunc startLiveActivityWithChannel(string channelId, initialState) {\n    let activity = try Activity.request(\n            attributes: adventure,\n            content: .init(state: initialState, staleDate: nil),\n            \/\/Input your unique channel ID\n            pushType: .channel(channelId)\n}\n```\n\n### Start new Live Activities with ActivityKit push notifications\n\nYou can start new Live Activities with ActivityKit push notifications. This option is especially useful for tracking events with Live Activities that occur more than once. For example, if someone starts a Live Activity to track their favorite sports team, the sports app might offer to automatically start a Live Activity for each of the team’s games. In the future, the person doesn’t have to remember to start the Live Activity from the app. Instead, a Live Activity for tracking the game might automatically start from an ActivityKit push notification you sent with your remote notification server and APNs.\n\nTo start Live Activities from ActivityKit push notifications, configure your app to support push notifications. Then obtain the token to for starting a Live Activity:\n\n- Use the [doc:\/\/com.apple.activitykit\/documentation\/ActivityKit\/Activity\/pushToStartTokenUpdates] asynchronous sequence to retrieve a push-to-start token that allows you to start new Live Activities. You don’t have to start a Live Activity from your app to receive the push-to-start token.\n- Send the push-to-start token to your server and use the [doc:\/\/com.apple.activitykit\/documentation\/ActivityKit\/Activity\/pushToStartTokenUpdates] sequence to receive token updates. Similar to the update token, update it on your server when needed and invalidate the old token.\n- On your push notification server, use the push-to-start token to send JSON payloads to APNs that start a new Live Activity.\n- When the system receives the ActivityKit push notification on a device, it starts a new Live Activity, wakes up your app, and grants it background runtime to allow you to download assets that the Live Activity needs.\n- While the system starts the new Live Activity and wakes up your app, you receive the push token you use for updates. To update and end the Live Activity on devices that aren’t running iOS 18 or iPadOS 18, use this update push token as if you obtained it by starting a Live Activity from within your app.\n- For devices running iOS 18 and iPadOS 18, you can send different APNs payloads to start a Live Activity to listen to updates on a push token or a channel ID. For more information, refer to “Construct the payload that starts a Live Activity” below for more details. If you are using push tokens to send updates, then the system wakes your app and you’ll receive new push tokens to use for updates.\n\n\n\n### Construct the ActivityKit remote push notification payload\n\nTo successfully start, update, or end a Live Activity with an ActivityKit push notification, send an HTTP request to APNs that conforms to the following requirements:\n\n- Set the value for the `apns-push-type` header field to `liveactivity`.\n- Set the `apns-topic` header field using the following format: `<your bundleID>.push-type.liveactivity`.\n- Set the value for the `apns-priority` header field to `5` or `10`. For more information, refer to “Determine the update frequency” below.\n\nFor more information about request headers, refer to [doc:\/\/com.apple.documentation\/documentation\/UserNotifications\/sending-notification-requests-to-apns].\n\nTo successfully update or end a Live Activity with an ActivityKit push notification to a channel, send an HTTP request to APNs that conforms to the following requirements:\n\n- Set the value for the `apns-push-type` header field to `liveactivity`.\n- Set the `apns-channel-id` header field to the channel you’re using.\n- Set the value for the `apns-priority` header field to `5` or `10`. For more information, refer to the “Determine the update frequency” section of this article, below.\n\nFor more information about request headers, refer to [doc:\/\/com.apple.documentation\/documentation\/UserNotifications\/sending-broadcast-push-notification-requests-to-apns].\n\nIn your request’s  `aps` dictionary:\n\n- Set the `timestamp` to the current time in seconds since 1970 to allow the system to always display the most recent ActivityKit push update.\n- To start a Live Activity, refer to “Construct the payload that starts a Live Activity” below.\n- To update a Live Activity, set the value for the `event` key to `update`.\n- To end a Live Activity, set the value for the `event` key to `end`. If you end a Live Activity, include the final content state to make sure the Live Activity displays the latest data after it ends.\n- Set the fields for the `content-state` key to match your custom [doc:\/\/com.apple.activitykit\/documentation\/ActivityKit\/Activity\/ContentState-swift.typealias] type to ensure the system can decode the JSON payload and update or end the Live Activity. Additionally, don’t use any custom JSON encoding strategies to encode your data, because the system always decodes JSON payloads for Live Activity updates using its default encoding strategies. Custom encoding strategies will result in update failures.\n- To mark a Live Activity as outdated with an update, optionally set the `stale-date`. For more information, refer to the “Mark a Live Activity as outdated by setting a stale date” section below.\n- To set a custom dismissal date that tells the system to remove an ended Live Activity from the Lock Screen, refer to the “End the Live Activity with a custom dismissal date” section below.\n- To alert a person about a critical Live Activity update, optionally provide an `alert` to light up their device and display the expanded presentation on devices that support the Dynamic Island or a banner on devices that don’t support it.\n\nThe following payload updates the Live Activity of the [doc:\/\/com.apple.documentation\/documentation\/WidgetKit\/emoji-rangers-supporting-live-activities-interactivity-and-animations] example with the latest information. The content of `content-state` must match the properties of the custom [doc:\/\/com.apple.activitykit\/documentation\/ActivityKit\/Activity\/ContentState-swift.typealias] type you declare in your [doc:\/\/com.apple.activitykit\/documentation\/ActivityKit\/ActivityAttributes] implementation. In the example, `content-state` matches the properties of the custom `AdventureAttributes.ContentState` type of the sample code project. Additionally, the example payload includes an alert with a custom sound to let the player know that the hero has been knocked down and requires a healing potion.\n\n```json\n{\n    \"aps\": {\n        \"timestamp\": 1685952000,\n        \"event\": \"update\",\n        \"content-state\": {\n            \"currentHealthLevel\": 0.0,\n            \"eventDescription\": \"Power Panda has been knocked down!\"\n        },\n        \"alert\": {\n            \"title\": {\n                \"loc-key\": \"%@ is knocked down!\",\n                \"loc-args\": [\"Power Panda\"]\n            },\n            \"body\": {\n                \"loc-key\": \"Use a potion to heal %@!\",\n                \"loc-args\": [\"Power Panda\"]\n            },\n            \"sound\": \"HeroDown.mp4\"\n        }\n    }\n}\n```\n\nIn your alert implementation, consider localizing both strings. For more information on displaying alerts for a remote notification, including localized alert messages and a reference of available keys, refer to [doc:\/\/com.apple.documentation\/documentation\/UserNotifications\/generating-a-remote-notification].\n\nRemember that a person’s device may not receive a push notification — for example, if they’re in an area without a network connection. Similarly, the system ignores an ActivityKit push notification if it arrives after the Live Activity ended. Both cases can cause a Live Activity to display outdated information. To help reduce the chance of showing outdated information, update your Live Activity from your app in addition to push notifications.\n\n\n\n### Construct the payload that starts a Live Activity\n\nThe JSON payload for starting a Live Activity with an ActivityKit push notification is similar to the payload you use for updates. However, it comes with the following requirements:\n\n- Set the value of the `event` field to `start`.\n- Include an `alert` in the JSON payload.\n- Include the `attributes-type` and `attributes` keys.\n\nBy including an alert in your JSON payload, you make sure a person gets alerted about the started Live Activity and avoid unexpectedly surprising them. The following sample payload starts a Live Activity for devices that aren’t running iOS 18 and iPadOS 18 or later:\n\n```swift\n{\n    \"aps\": {\n        \"timestamp\": 1234,\n        \"event\": \"start\",\n        \"content-state\": {\n            \"currentHealthLevel\": 100,\n            \"eventDescription\": \"Adventure has begun!\"\n        },\n        \"attributes-type\": \"AdventureAttributes\",\n        \"attributes\": {\n            \"hero\": {\n                \"name\": \"Power Panda\",\n                \"avatar\": \"U+1F43C\",\n                \"healthLevel\": 100,\n                \"heroType\": \"Forest Dweller\",\n                \"healthRecoveryRatePerHour\": 0.25,\n                \"url\": \"game:\/\/\/panda\",\n                \"battleCode\": \"game:\/\/\/panda\/battle\",\n                \"level\": 3,\n                \"exp\": 600,\n                \"bio\": \"Power Panda loves eating bamboo shoots and leaves.\"\n            }\n        },\n        \"alert\": {\n            \"title\": {\n                \"loc-key\": \"%@ is on an adventure!\",\n                \"loc-args\": [\n                    \"Power Panda\"\n                ]\n            },\n            \"body\": {\n                \"loc-key\": \"%@ found a sword!\",\n                \"loc-args\": [\n                    \"Power Panda\"\n                ]\n            },\n            \"sound\": \"chime.aiff\"\n        }\n    }\n}\n```\n\nFor devices running iOS 18 and iPadOS or later, you can add `input-push-channel` with the appropriate channel ID to start a Live Activity and listen for updates on a channel. After you send this payload, you can send updates on the channel to update a Live Activity.\n\n```swift\n       \"input-push-channel\": \"dHN0LXNyY2gtY2hubA==\",\n       \"attributes-type\": \"AdventureAttributes\",\n       \"attributes\": {\n           \"currentHealthLevel\": 100,\n           \"eventDescription\": \"Adventure has begun!\"\n       }\n```\n\nCreate a channel ID before you send this payload to a device and ensure that the channel ID is valid. If you send this payload to a device that doesn’t run iOS 18 and later, then the Live Activity will not start.\n\nFor devices running iOS 18 and iPadOS 18 or later, you can add `input-push-token: 1` to your payload to start a Live Activity and receive a new push token. After you receive a new push token, you can use it to send updates to a Live Activity.\n\n```swift\n        \"input-push-token\": 1,\n        \"attributes-type\": \"AdventureAttributes\",\n        \"attributes\": {\n            \"currentHealthLevel\": 100,\n            \"eventDescription\": \"Adventure has begun!\"\n        }\n```\n\n### Test Live Activity updates locally\n\nDuring development, verify your JSON payloads and Live Activity updates locally. Using command-line tools and Simulator or a test device, you can send a JSON payload from the command line to APNs and receive Live Activity updates to verify that your payload updates the Live Activity and the Live Activity behaves as expected.\n\nTo locally test Live Activity updates during development:\n\n1. Set up your command line as described in the “Send a Push Notification Using a Token” section of [doc:\/\/com.apple.documentation\/documentation\/UserNotifications\/sending-push-notifications-using-command-line-tools#3694579].\n2. Add code that logs the push token to the console when you start a new Live Activity in your app.\n3. Run your app in Simulator or on a test device and start a Live Activity.\n4. Copy the logged push token from the console and set it as the `$ACTIVITY_PUSH_TOKEN` environment variable in Terminal.\n5. Use a `curl` command to send a Live Activity update using APNs. Set the value of the  `apns-priority` header field to `10` to deliver the update quickly with high priority.\n\nThe following example shows a curl command that the [doc:\/\/com.apple.documentation\/documentation\/WidgetKit\/emoji-rangers-supporting-live-activities-interactivity-and-animations] sample code project could use to test a Live Activity update.\n\n```\ncurl \\\n --header \"apns-topic: com.example.apple-samplecode.Emoji-Rangers.push-type.liveactivity\" \\\n --header \"apns-push-type: liveactivity\" \\\n --header \"apns-priority: 10\" \\\n --header \"authorization: bearer $AUTHENTICATION_TOKEN\" \\\n --data '{\n     \"aps\": {\n         \"timestamp\": '$(date +%s)',\n         \"event\": \"update\",\n         \"content-state\": {\n             \"currentHealthLevel\": 0.941,\n             \"eventDescription\": \"Power Panda found a sword!\"\n         }\n     }\n }' \\\n --http2 https:\/\/api.sandbox.push.apple.com\/3\/device\/$ACTIVITY_PUSH_TOKEN\n```\n\n\n\nTo locally test Live Activity updates to a channel during development:\n\n1. Set up your command line as described in the “Send a Push Notification Using a Token” section of [doc:\/\/com.apple.documentation\/documentation\/UserNotifications\/sending-push-notifications-using-command-line-tools#3694579].\n2. Create a new channel, and set it as `$CHANNEL_ID` variable in your terminal.\n3. Use the newly created channel with ActivityKit when you request a Live Activity.\n4. Run your app in Simulator or on a test device and start a Live Activity.\n5. Use a `curl` command to send a Live Activity update using APNs. Set the value of the `apns-priority` header field to `10` to deliver the update quickly with high priority.\n\n\n\nIf you encounter failures while sending an ActivityKit push notification:\n\n- Ensure the `curl` command succeeded. An error might indicate an incorrect field  for the request, or errors setting up the command-line environment.\n- Use the Console app to view device logs and look for errors that could help you understand the issue. Processes in Console that may contain relevant information are `liveactivitiesd`, `apsd`, and `chronod`.\n\n### Determine the update frequency\n\nThe system allows for a certain budget of ActivityKit push notifications per hour. As with other push notifications you send with APNs, you can set the HTTP header field  `apns-priority` for your requests to specify the priority of an ActivityKit push notification:\n\n- If you don’t specify the `apns-priority` value, APNs delivers the ActivityKit push notification immediately with the default priority of `10` and counts it toward the notification budget that the system imposes.\n- If you exceed the budget, the system may throttle your ActivityKit push notifications.\n\nTo avoid throttling, you can send a low-priority ActivityKit push notification that doesn’t count toward the budget by setting the HTTP header field  `apns-priority` to `5`. Consider this lower priority first before using the priority of `10`. In many cases, choosing a mix of priority `5` and `10` for updates prevents your Live Activity updates from being throttled. For example, the Live Activity of the [doc:\/\/com.apple.documentation\/documentation\/WidgetKit\/emoji-rangers-supporting-live-activities-interactivity-and-animations] sample code project could use priority `5` for updates that don’t require a person’s immediate attention, like when the hero heals by a few points. When the hero requires a healing potion, the example would use a priority of `10` to immediately update the Live Activity and let the user know about the important change.\n\nHowever, your app may need to update its Live Activity more frequently, causing you to hit the budget limit for ActivityKit push notifications. For example, if your app allows people to track a sports event like a basketball match that requires many updates per minute, you may not be able to update your Live Activity often enough.\n\nTo allow for use cases like this, you can enable your Live Activities to receive frequent ActivityKit push notifications:\n\n- If your project includes an `Info.plist` file, add the [doc:\/\/com.apple.documentation\/documentation\/BundleResources\/Information-Property-List\/NSSupportsLiveActivitiesFrequentUpdates] entry to it, and set its Boolean value to `YES`.\n- Alternatively, open the `Info.plist` file as source code, add the key [doc:\/\/com.apple.documentation\/documentation\/BundleResources\/Information-Property-List\/NSSupportsLiveActivitiesFrequentUpdates], then set the type to `Boolean` and its value to `YES`. If your project doesn’t have an `Info.plist` file, add [doc:\/\/com.apple.documentation\/documentation\/BundleResources\/Information-Property-List\/NSSupportsLiveActivitiesFrequentUpdates] to the list of custom iOS target properties for your iOS app target and set its value to `YES`.\n\nPeople can deactivate frequent ActivityKit push notifications for your app in the Settings app. In your code, use [doc:\/\/com.apple.activitykit\/documentation\/ActivityKit\/ActivityAuthorizationInfo\/frequentPushesEnabled] to detect whether a person deactivated frequent push notifications and display information in your app that asks them to activate frequent ActivityKit push notifications again. Additionally, send the value of this setting to your server and adjust the update frequency accordingly.\n\nSimilar to other asynchronous sequences ActivityKit provides to receive configuration updates, you can subscribe to changes to the frequent Live Activity push notification setting setting with the [doc:\/\/com.apple.activitykit\/documentation\/ActivityKit\/ActivityAuthorizationInfo\/frequentPushEnablementUpdates-swift.property] stream.\n\nFor more information on available HTTPs headers and sending requests to APNs, refer to [doc:\/\/com.apple.documentation\/documentation\/UserNotifications\/sending-notification-requests-to-apns].\n\n### End the Live Activity with a custom dismissal date\n\nWhen you end a Live Activity, by default the Live Activity appears on the Lock Screen for up to four hours after it ends to allow people to glance at their phone to refer to the latest information. To change the time until the system removes a Live Activity from the Lock Screen after it ends, include the `\"dismissal-date\"` entry in the `\"aps\"` dictionary of your JSON payload. If you don’t include the `\"dismissal-date\"`, your Live Activity uses the system’s default dismissal behavior. To dismiss the Live Activity from the Lock Screen immediately after it ends, provide a date for `\"dismissal-date\"` that’s in the past — for example, `\"dismissal-date\": 1663177260`. Alternatively, provide a date within a four-hour window to set a custom dismissal date.\n\n### Mark a Live Activity as outdated by setting a stale date\n\nIn some scenarios — for example,  if a person enters an area without network connectivity — you might not be able update the Live Activity with new information, causing it to display outdated data. To provide the best possible user experience and let the person know that the Live Activity displays outdated information, add a timestamp in the optional `stale-date` field to provide the time when the system will consider the Live Activity to be stale. With each update, you can advance this `stale-date`. When you can’t update the Live Activity for some time until it becomes stale, the [doc:\/\/com.apple.activitykit\/documentation\/ActivityKit\/Activity\/activityState] changes to [doc:\/\/com.apple.activitykit\/documentation\/ActivityKit\/ActivityState\/stale] at the specified date. Use the [doc:\/\/com.apple.activitykit\/documentation\/ActivityKit\/Activity\/activityStateUpdates-swift.property] stream in your app to monitor the activity state and respond to outdated Live Activities that haven’t received updates. For example, while a person has network connectivity, a sports app could update the Live Activity with the latest game information and advance the stale date. When it becomes stale, it displays text to indicate that the displayed information is outdated.\n\n### Display the most important Live Activity in the Dynamic Island\n\nIf your app starts more than one Live Activity, provide a `relevance-score` in your JSON payload to determine the order of your Live Activities on the Lock Screen and which of your Live Activities appears in the Dynamic Island:\n\n- If you don’t provide a relevance score or if Live Activities have the same relevance score, the system shows the first Live Activity you started in the Dynamic Island.\n- If you use different relevance scores, the system shows the Live Activity with the highest relevance score in the Dynamic Island.\n\nThe system expects relative values for the relevance score. Assign a higher value for an important Live Activity content update — for example, a score of `100` — and use lower values for less important Live Activity content updates — for example, `50`.\n\n\n\nThe following example payload provides a relevance score of `100` to make sure the Live Activity that receives the update appears in the Dynamic Island and at top of the list on the Lock Screen:\n\n```json\n{\n    \"aps\": {\n        \"timestamp\": 1685952000,\n        \"event\": \"update\",\n        \"relevance-score\": 100,\n        \"content-state\": {\n            \"currentHealthLevel\": 0.941,\n            \"eventDescription\": \"Power Panda found a sword!\"\n        }\n    }\n}\n```\n\n## Starting a Live Activity\n\n- **Displaying live data with Live Activities**: Display up-to-date data and offer quick interactions in the Dynamic Island, on the Lock Screen, in CarPlay, and on a paired Mac or Apple Watch.\n- **Activity**: The object you use to start, update, and end a Live Activity.\n- **Emoji Rangers: Supporting Live Activities, interactivity, and animations**: Offer Live Activities, controls, animate data updates, and add interactivity to widgets.\n- **NSSupportsLiveActivities**: A Boolean value that indicates whether an app supports Live Activities.\n- **NSSupportsLiveActivitiesFrequentUpdates**: A Boolean value that indicates whether an app can update its Live Activities frequently.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Display up-to-date data and offer quick interactions in the Dynamic Island, on the Lock Screen, in CarPlay, and on a paired Mac or Apple Watch.",
          "name" : "Displaying live data with Live Activities",
          "url" : "https:\/\/developer.apple.com\/documentation\/ActivityKit\/displaying-live-data-with-live-activities"
        },
        {
          "description" : "The object you use to start, update, and end a Live Activity.",
          "name" : "Activity",
          "url" : "https:\/\/developer.apple.com\/documentation\/ActivityKit\/Activity"
        },
        {
          "description" : "Offer Live Activities, controls, animate data updates, and add interactivity to widgets.",
          "name" : "Emoji Rangers: Supporting Live Activities, interactivity, and animations",
          "url" : "https:\/\/developer.apple.com\/documentation\/WidgetKit\/emoji-rangers-supporting-live-activities-interactivity-and-animations"
        },
        {
          "description" : "A Boolean value that indicates whether an app supports Live Activities.",
          "name" : "NSSupportsLiveActivities",
          "url" : "https:\/\/developer.apple.com\/documentation\/BundleResources\/Information-Property-List\/NSSupportsLiveActivities"
        },
        {
          "description" : "A Boolean value that indicates whether an app can update its Live Activities frequently.",
          "name" : "NSSupportsLiveActivitiesFrequentUpdates",
          "url" : "https:\/\/developer.apple.com\/documentation\/BundleResources\/Information-Property-List\/NSSupportsLiveActivitiesFrequentUpdates"
        }
      ],
      "title" : "Starting a Live Activity"
    }
  ],
  "source" : "appleJSON",
  "title" : "Starting and updating Live Activities with ActivityKit push notifications",
  "url" : "https:\/\/developer.apple.com\/documentation\/activitykit\/starting-and-updating-live-activities-with-activitykit-push-notifications"
}