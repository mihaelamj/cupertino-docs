{
  "abstract" : "Extend your app’s direction finding capabilities with data from Ultra Wideband devices.",
  "codeExamples" : [
    {
      "code" : "    class MeasurementQualityEstimator {\n\n        \/\/ Define the criteria that qualify a peer with \"good\" characteristics:\n        \/\/ these include:\n\n        \/\/ A time window, in seconds.\n        let freshnessWindow = TimeInterval(floatLiteral: 2.0)\n        \/\/ A minimum number of samples in that time window.\n        let minSamples: Int = 8\n        \/\/ A maximim distance, in meters.\n        let maxDistance: Float = 50\n        \/\/ A minimum distance, in meters.\n        let closeDistance: Float = 10\n    \n        \/\/ A buffer to hold the individual quality measurements.\n        private var measurements: [TimedNIObject] = []\n    \n        \/\/ An enumeration that defines levels of peer quality.\n        enum MeasurementQuality {\n            \/\/ The peer fails to meet any of the measurement quality criteria.\n            case unknown\n\n            \/\/ The extended distance measurements indicate the peer iPhone or device\n            \/\/ satisfies the criteria for \"good\" quality and falls inside the\n            \/\/ minimum and maximum acceptable distance.\n            case good\n\n            \/\/ The extended distance measurements indicate the current device\n            \/\/ satisfies the criteria for being \"close\" to the peer iPhone or device.\n            case close\n        }\n\n        \/\/ A structure that captures the range of a peer at a specific time.\n        struct TimedNIObject {\n            let time: TimeInterval\n            let distance: Float\n        }\n\n        func estimateQuality(update: NINearbyObject?) -> MeasurementQuality {\n            let timeNow = NSDate().timeIntervalSinceReferenceDate\n            if let distance = update?.distance {\n                if let lastMeasureMent = measurements.last {\n                    if lastMeasureMent.distance != distance {\n                        \/\/ Before adding new measurement to the buffer, \n                        \/\/ check if the reported distance is unique.\n                        measurements.append(TimedNIObject(time: timeNow, distance: distance))\n                    }\n                } else {\n                    \/\/ If the buffer is empty, unconditionally add the new measurement.\n                    measurements.append(TimedNIObject(time: timeNow, distance: distance))\n                }\n            }\n            let validTimestamp = timeNow - freshnessWindow\n            measurements.removeAll { $0.time < validTimestamp }\n            if measurements.count > minSamples, let lastDistance = measurements.last?.distance {\n                if lastDistance <= closeDistance { return .close }\n                return lastDistance < maxDistance ? .good : .unknown\n            }\n            return .unknown\n        }\n    }   ",
      "language" : "swift"
    },
    {
      "code" : "    if NISession.deviceCapabilities.supportsExtendedDistanceMeasurement {\n        \/\/ This device supports EDM.\n    } else {\n        \/\/ Implement a fallback strategy.\n    }",
      "language" : "swift"
    },
    {
      "code" : "    if token.deviceCapabilities.supportsExtendedDistanceMeasurement {\n        \/\/ The peer has EDM capability.\n    } else {\n        \/\/ Fall back to first-generation UWB chip capabilities.\n    }",
      "language" : "swift"
    },
    {
      "code" : "    let config = NINearbyPeerConfiguration(peerToken: token)\n    config.isCameraAssistanceEnabled = true\n    if #available(iOS 17.0, watchOS 10.0, *) {\n        guard NISession.deviceCapabilities.supportsExtendedDistanceMeasurement else {\n           NSLog(\"This device isn't capable of finding visitors.\")\n           return\n        }\n        guard token.deviceCapabilities.supportsExtendedDistanceMeasurement else {\n           NSLog(\"Peer device \\(peer.displayName) isn't capable of finding visitors.\")\n           return\n        }                   \n       config.isExtendedDistanceMeasurementEnabled = true\n       NSLog(\"NISession can use extended distance measurement.\")                \n    }",
      "language" : "swift"
    }
  ],
  "contentHash" : "2e5fa9af858d8bddea6ac0be5ed14e97c8ae8efbe112640ae47552dc62e15df3",
  "crawledAt" : "2025-12-05T20:00:08Z",
  "id" : "33C0B442-83D8-4FE6-89B1-A9BBDB0EAA52",
  "kind" : "article",
  "language" : "swift",
  "module" : "Nearby Interaction",
  "overview" : "## Overview\n\nExtended distance measurement (EDM) is a ranging capability available between devices with second-generation Ultra Wideband (UWB) chips. EDM enables measuring precise distance between two Apple devices using UWB technology at significantly farther distances than was possible with the first-generation UWB chip. In iOS 17 and watchOS 10 and later, EDM is available through the Nearby Interaction framework. This article describes the tradeoffs involved in using EDM and getting the best ranging performance for your app.\n\n### Detect devices and their capabilities\n\nA new UWB communication protocol enables the EDM capabilities in second-generation UWB chips. To use this new measurement technology, both sides have to have the second-generation chip; this includes iPhone 15, Apple Watch Series 9, Apple Watch Ultra 2, and later.\n\nDevices with the second-generation UWB chip are backward compatible with the ranging technologies available on the first-generation UWB chip. Second-generation UWB chip-equipped devices can communicate with first-generation devices and Made for iPhone (MFI)-certified third-party chipsets. However, when communicating with first-generation devices, second-generation devices operate at the performance available on the first-generation chip. This article refers to Nearby Interaction peer sessions that don’t have extended distance measurement enabled as “legacy” Nearby Interaction peer sessions.\n\nMeasurement capabilities depend on both the capabilities of a person’s device and of the peer device they’re connecting to. Although someone might have a second-generation UWB chip-equipped device, the peer devices they want to interact with might only support the first-generation UWB chip.\n\nPossible interactions between first-generation and second-generation UWB chips, and third-party MFI devices, include:\n\n*First-generation UWB chip*\n\n*Second-generation UWB chip*\n\nDesign your app with appropriate fallback options for interacting with devices that aren’t capable of EDM. For example, you could choose to show a limited experience that’s backward compatible with first-generation devices or, depending on your app’s intention, restrict interactions with peer devices that aren’t capable of using EDM. To identify a peer device’s measurement capabilities, query the [doc:\/\/com.apple.nearbyinteraction\/documentation\/NearbyInteraction\/NIDiscoveryToken\/deviceCapabilities] property of an [doc:\/\/com.apple.nearbyinteraction\/documentation\/NearbyInteraction\/NIDiscoveryToken]. For an example that demonstrates limiting interactions to compatible devices, see [doc:\/\/com.apple.nearbyinteraction\/documentation\/NearbyInteraction\/finding-devices-with-precision].\n\nBecause EDM uses a new communications protocol, Nearby Interaction only supports one extended distance measurement session on a device at any given time. An EDM session can work concurrently with multiple legacy Nearby Interaction sessions on the same device.\n\nThe system may interrupt and pause an EDM session if required for critical use, such as when an authorized person uses Find My to locate another person’s device that’s in an EDM session. Additionally, the system may suspend EDM sessions when a person launches the Find My app. The app can listen for a [doc:\/\/com.apple.nearbyinteraction\/documentation\/NearbyInteraction\/NISessionDelegate\/sessionSuspensionEnded(_:)] callback to determine when the app can resume the EDM session.\n\n### Locate devices using ranging\n\nThe EDM support that the Nearby Interaction framework provides enables a new communication protocol that measures distances between devices using rapid packet exchanges. As a result, it’s susceptible to various wireless signal propagation effects. Most notably, obstruction between the two devices and reflections from the ground, walls, and parts of the local environment that affect the quality of distance measurements. These effects can significantly affect measurement quality at the longer measurement distances enabled by EDM. By design, Nearby Interaction tunes EDM to output measurements to your app at longer operating ranges. If your app requires high quality direction and distance measurements for the longer measurement distances enabled by EDM, estimate the quality of measurements and provide different user experiences.\n\nThe following example demonstrates a quality estimator for direction measurements is the `MeasurementQualityEstimator`:\n\nThis class is a part of the [doc:\/\/com.apple.nearbyinteraction\/documentation\/NearbyInteraction\/finding-devices-with-precision] sample for iOS 17 that demonstrates measurement quality estimation on devices capable of EDM. This estimator determines measurements are high quality if the framework generates eight or more distinct measurements in the last two seconds, and if the measurements are within a distance threshold of 50 meters. Experiment with different measurement quality metrics to vet the results to meet your app’s intended use cases.\n\niOS 16 and watchOS 9 introduced an API update to Nearby Interaction for locating stationary devices with high precision aided by an [doc:\/\/com.apple.documentation\/documentation\/ARKit\/ARSession]. With the EDM capabilities introduced in iOS 17 and watchOS 10, second-generation UWB equipped devices can locate moving devices that also have the second-generation UWB chip.\n\n### Measure the distance between devices\n\nIn iOS 14 and watchOS 8 and later, devices equipped with the first-generation UWB chip are capable of precise distance measurement through the Nearby Interaction framework. Devices supporting [doc:\/\/com.apple.documentation\/documentation\/ARKit] can locate stationary objects or devices. Devices equipped with the second-generation UWB chip are capable of EDM. Pairs of devices supporting both extended distance measurement and Camera Assistance have the ability to locate moving devices. You can query these capabilities through the [doc:\/\/com.apple.nearbyinteraction\/documentation\/NearbyInteraction\/NISession\/deviceCapabilities] property check.\n\nTo check a device’s EDM capability:\n\nTo determine if a peer device supports EDM, examine the peer’s [doc:\/\/com.apple.nearbyinteraction\/documentation\/NearbyInteraction\/NIDiscoveryToken]:\n\nIf both sides support EDM, they can run [doc:\/\/com.apple.nearbyinteraction\/documentation\/NearbyInteraction\/NISession] with the configuration that has EDM enabled, as shown in the example below:",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/nearbyinteraction\/extending-advanced-direction-finding-and-ranging\ncrawled: 2025-12-05T20:00:08Z\n---\n\n# Extending advanced direction finding and ranging\n\n**Article**\n\nExtend your app’s direction finding capabilities with data from Ultra Wideband devices.\n\n## Overview\n\nExtended distance measurement (EDM) is a ranging capability available between devices with second-generation Ultra Wideband (UWB) chips. EDM enables measuring precise distance between two Apple devices using UWB technology at significantly farther distances than was possible with the first-generation UWB chip. In iOS 17 and watchOS 10 and later, EDM is available through the Nearby Interaction framework. This article describes the tradeoffs involved in using EDM and getting the best ranging performance for your app.\n\n### Detect devices and their capabilities\n\nA new UWB communication protocol enables the EDM capabilities in second-generation UWB chips. To use this new measurement technology, both sides have to have the second-generation chip; this includes iPhone 15, Apple Watch Series 9, Apple Watch Ultra 2, and later.\n\nDevices with the second-generation UWB chip are backward compatible with the ranging technologies available on the first-generation UWB chip. Second-generation UWB chip-equipped devices can communicate with first-generation devices and Made for iPhone (MFI)-certified third-party chipsets. However, when communicating with first-generation devices, second-generation devices operate at the performance available on the first-generation chip. This article refers to Nearby Interaction peer sessions that don’t have extended distance measurement enabled as “legacy” Nearby Interaction peer sessions.\n\nMeasurement capabilities depend on both the capabilities of a person’s device and of the peer device they’re connecting to. Although someone might have a second-generation UWB chip-equipped device, the peer devices they want to interact with might only support the first-generation UWB chip.\n\nPossible interactions between first-generation and second-generation UWB chips, and third-party MFI devices, include:\n\n*First-generation UWB chip*\n\n- Supports multiple Nearby Interaction peer sessions when communicating with first- and second-generation UWB equipped devices\n- Supports multiple Nearby Interaction accessory sessions when communicating with third-party MFI chipsets\n\n*Second-generation UWB chip*\n\n- Supports multiple legacy Nearby Interaction peer sessions when communicating with first-generation UWB equipped devices\n- Supports one Nearby Interaction peer EDM session and multiple Nearby Interaction peer sessions when communicating with second-generation UWB-equipped devices\n- Supports multiple Nearby Interaction accessory sessions when communicating with third-party MFI chipsets\n\n\n\nDesign your app with appropriate fallback options for interacting with devices that aren’t capable of EDM. For example, you could choose to show a limited experience that’s backward compatible with first-generation devices or, depending on your app’s intention, restrict interactions with peer devices that aren’t capable of using EDM. To identify a peer device’s measurement capabilities, query the [doc:\/\/com.apple.nearbyinteraction\/documentation\/NearbyInteraction\/NIDiscoveryToken\/deviceCapabilities] property of an [doc:\/\/com.apple.nearbyinteraction\/documentation\/NearbyInteraction\/NIDiscoveryToken]. For an example that demonstrates limiting interactions to compatible devices, see [doc:\/\/com.apple.nearbyinteraction\/documentation\/NearbyInteraction\/finding-devices-with-precision].\n\nBecause EDM uses a new communications protocol, Nearby Interaction only supports one extended distance measurement session on a device at any given time. An EDM session can work concurrently with multiple legacy Nearby Interaction sessions on the same device.\n\nThe system may interrupt and pause an EDM session if required for critical use, such as when an authorized person uses Find My to locate another person’s device that’s in an EDM session. Additionally, the system may suspend EDM sessions when a person launches the Find My app. The app can listen for a [doc:\/\/com.apple.nearbyinteraction\/documentation\/NearbyInteraction\/NISessionDelegate\/sessionSuspensionEnded(_:)] callback to determine when the app can resume the EDM session.\n\n### Locate devices using ranging\n\nThe EDM support that the Nearby Interaction framework provides enables a new communication protocol that measures distances between devices using rapid packet exchanges. As a result, it’s susceptible to various wireless signal propagation effects. Most notably, obstruction between the two devices and reflections from the ground, walls, and parts of the local environment that affect the quality of distance measurements. These effects can significantly affect measurement quality at the longer measurement distances enabled by EDM. By design, Nearby Interaction tunes EDM to output measurements to your app at longer operating ranges. If your app requires high quality direction and distance measurements for the longer measurement distances enabled by EDM, estimate the quality of measurements and provide different user experiences.\n\nThe following example demonstrates a quality estimator for direction measurements is the `MeasurementQualityEstimator`:\n\n```swift\n    class MeasurementQualityEstimator {\n\n        \/\/ Define the criteria that qualify a peer with \"good\" characteristics:\n        \/\/ these include:\n\n        \/\/ A time window, in seconds.\n        let freshnessWindow = TimeInterval(floatLiteral: 2.0)\n        \/\/ A minimum number of samples in that time window.\n        let minSamples: Int = 8\n        \/\/ A maximim distance, in meters.\n        let maxDistance: Float = 50\n        \/\/ A minimum distance, in meters.\n        let closeDistance: Float = 10\n    \n        \/\/ A buffer to hold the individual quality measurements.\n        private var measurements: [TimedNIObject] = []\n    \n        \/\/ An enumeration that defines levels of peer quality.\n        enum MeasurementQuality {\n            \/\/ The peer fails to meet any of the measurement quality criteria.\n            case unknown\n\n            \/\/ The extended distance measurements indicate the peer iPhone or device\n            \/\/ satisfies the criteria for \"good\" quality and falls inside the\n            \/\/ minimum and maximum acceptable distance.\n            case good\n\n            \/\/ The extended distance measurements indicate the current device\n            \/\/ satisfies the criteria for being \"close\" to the peer iPhone or device.\n            case close\n        }\n\n        \/\/ A structure that captures the range of a peer at a specific time.\n        struct TimedNIObject {\n            let time: TimeInterval\n            let distance: Float\n        }\n\n        func estimateQuality(update: NINearbyObject?) -> MeasurementQuality {\n            let timeNow = NSDate().timeIntervalSinceReferenceDate\n            if let distance = update?.distance {\n                if let lastMeasureMent = measurements.last {\n                    if lastMeasureMent.distance != distance {\n                        \/\/ Before adding new measurement to the buffer, \n                        \/\/ check if the reported distance is unique.\n                        measurements.append(TimedNIObject(time: timeNow, distance: distance))\n                    }\n                } else {\n                    \/\/ If the buffer is empty, unconditionally add the new measurement.\n                    measurements.append(TimedNIObject(time: timeNow, distance: distance))\n                }\n            }\n            let validTimestamp = timeNow - freshnessWindow\n            measurements.removeAll { $0.time < validTimestamp }\n            if measurements.count > minSamples, let lastDistance = measurements.last?.distance {\n                if lastDistance <= closeDistance { return .close }\n                return lastDistance < maxDistance ? .good : .unknown\n            }\n            return .unknown\n        }\n    }   \n```\n\nThis class is a part of the [doc:\/\/com.apple.nearbyinteraction\/documentation\/NearbyInteraction\/finding-devices-with-precision] sample for iOS 17 that demonstrates measurement quality estimation on devices capable of EDM. This estimator determines measurements are high quality if the framework generates eight or more distinct measurements in the last two seconds, and if the measurements are within a distance threshold of 50 meters. Experiment with different measurement quality metrics to vet the results to meet your app’s intended use cases.\n\niOS 16 and watchOS 9 introduced an API update to Nearby Interaction for locating stationary devices with high precision aided by an [doc:\/\/com.apple.documentation\/documentation\/ARKit\/ARSession]. With the EDM capabilities introduced in iOS 17 and watchOS 10, second-generation UWB equipped devices can locate moving devices that also have the second-generation UWB chip.\n\n### Measure the distance between devices\n\nIn iOS 14 and watchOS 8 and later, devices equipped with the first-generation UWB chip are capable of precise distance measurement through the Nearby Interaction framework. Devices supporting [doc:\/\/com.apple.documentation\/documentation\/ARKit] can locate stationary objects or devices. Devices equipped with the second-generation UWB chip are capable of EDM. Pairs of devices supporting both extended distance measurement and Camera Assistance have the ability to locate moving devices. You can query these capabilities through the [doc:\/\/com.apple.nearbyinteraction\/documentation\/NearbyInteraction\/NISession\/deviceCapabilities] property check.\n\nTo check a device’s EDM capability:\n\n```swift\n    if NISession.deviceCapabilities.supportsExtendedDistanceMeasurement {\n        \/\/ This device supports EDM.\n    } else {\n        \/\/ Implement a fallback strategy.\n    }\n```\n\nTo determine if a peer device supports EDM, examine the peer’s [doc:\/\/com.apple.nearbyinteraction\/documentation\/NearbyInteraction\/NIDiscoveryToken]:\n\n```swift\n    if token.deviceCapabilities.supportsExtendedDistanceMeasurement {\n        \/\/ The peer has EDM capability.\n    } else {\n        \/\/ Fall back to first-generation UWB chip capabilities.\n    }\n```\n\nIf both sides support EDM, they can run [doc:\/\/com.apple.nearbyinteraction\/documentation\/NearbyInteraction\/NISession] with the configuration that has EDM enabled, as shown in the example below:\n\n```swift\n    let config = NINearbyPeerConfiguration(peerToken: token)\n    config.isCameraAssistanceEnabled = true\n    if #available(iOS 17.0, watchOS 10.0, *) {\n        guard NISession.deviceCapabilities.supportsExtendedDistanceMeasurement else {\n           NSLog(\"This device isn't capable of finding visitors.\")\n           return\n        }\n        guard token.deviceCapabilities.supportsExtendedDistanceMeasurement else {\n           NSLog(\"Peer device \\(peer.displayName) isn't capable of finding visitors.\")\n           return\n        }                   \n       config.isExtendedDistanceMeasurementEnabled = true\n       NSLog(\"NISession can use extended distance measurement.\")                \n    }\n```\n\n## Related Documentation\n\n- **Initiating and maintaining a session**: Measure the relative position of a nearby device and coach the user to sustain interaction.\n- **Finding devices with precision**: Leverage the spatial awareness of ARKit and Apple Ultra Wideband Chips in your app to guide users to a nearby device.\n\n## Phone interaction\n\n- **Implementing Interactions Between Users in Close Proximity**: Enable devices to access relative positioning information.\n- **Discovering peers with Multipeer Connectivity**: Exchange discovery tokens over the local network.\n- **NINearbyPeerConfiguration**: A configuration that enables interaction between iPhone or Apple Watch devices.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Measure the relative position of a nearby device and coach the user to sustain interaction.",
          "name" : "Initiating and maintaining a session",
          "url" : "https:\/\/developer.apple.com\/documentation\/NearbyInteraction\/initiating-and-maintaining-a-session"
        },
        {
          "description" : "Leverage the spatial awareness of ARKit and Apple Ultra Wideband Chips in your app to guide users to a nearby device.",
          "name" : "Finding devices with precision",
          "url" : "https:\/\/developer.apple.com\/documentation\/NearbyInteraction\/finding-devices-with-precision"
        }
      ],
      "title" : "Related Documentation"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "Enable devices to access relative positioning information.",
          "name" : "Implementing Interactions Between Users in Close Proximity",
          "url" : "https:\/\/developer.apple.com\/documentation\/NearbyInteraction\/implementing-interactions-between-users-in-close-proximity"
        },
        {
          "description" : "Exchange discovery tokens over the local network.",
          "name" : "Discovering peers with Multipeer Connectivity",
          "url" : "https:\/\/developer.apple.com\/documentation\/NearbyInteraction\/discovering-peers-with-multipeer-connectivity"
        },
        {
          "description" : "A configuration that enables interaction between iPhone or Apple Watch devices.",
          "name" : "NINearbyPeerConfiguration",
          "url" : "https:\/\/developer.apple.com\/documentation\/NearbyInteraction\/NINearbyPeerConfiguration"
        }
      ],
      "title" : "Phone interaction"
    }
  ],
  "source" : "appleJSON",
  "title" : "Extending advanced direction finding and ranging",
  "url" : "https:\/\/developer.apple.com\/documentation\/nearbyinteraction\/extending-advanced-direction-finding-and-ranging"
}