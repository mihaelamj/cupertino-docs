{
  "abstract" : "Add controls to your custom player user interface to invoke Picture in Picture (PiP) playback.",
  "codeExamples" : [
    {
      "code" : "import AVKit\n\n@IBOutlet weak var pipButton: UIButton!\n\noverride func viewDidLoad() {\n    super.viewDidLoad()\n    \n    let startImage = AVPictureInPictureController.pictureInPictureButtonStartImage\n    let stopImage = AVPictureInPictureController.pictureInPictureButtonStopImage\n    \n    pipButton.setImage(startImage, for: .normal)\n    pipButton.setImage(stopImage, for: .selected)\n}",
      "language" : "swift"
    },
    {
      "code" : "var pipController: AVPictureInPictureController!\nvar pipPossibleObservation: NSKeyValueObservation?\n\nfunc setupPictureInPicture() {\n    \/\/ Ensure PiP is supported by current device.\n    if AVPictureInPictureController.isPictureInPictureSupported() {\n        \/\/ Create a new controller, passing the reference to the AVPlayerLayer.\n        pipController = AVPictureInPictureController(playerLayer: playerLayer)\n        pipController.delegate = self\n\n        pipPossibleObservation = pipController.observe(\\AVPictureInPictureController.isPictureInPicturePossible,\noptions: [.initial, .new]) { [weak self] _, change in\n            \/\/ Update the PiP button's enabled state.\n            self?.pipButton.isEnabled = change.newValue ?? false\n        }\n    } else {\n        \/\/ PiP isn't supported by the current device. Disable the PiP button.\n        pipButton.isEnabled = false\n    }\n}",
      "language" : "swift"
    },
    {
      "code" : "func publishNowPlayingMetadata() {\n    nowPlayingSession.nowPlayingInfoCenter.nowPlayingInfo = nowPlayingInfo\n    nowPlayingSession.becomeActiveIfPossible()\n}",
      "language" : "swift"
    },
    {
      "code" : "@IBAction func togglePictureInPictureMode(_ sender: UIButton) {\n    if pipController.isPictureInPictureActive {\n        pipController.stopPictureInPicture()\n    } else {\n        pipController.startPictureInPicture()\n    }\n}",
      "language" : "swift"
    },
    {
      "code" : "func pictureInPictureController(_ pictureInPictureController: AVPictureInPictureController,\n                                restoreUserInterfaceForPictureInPictureStopWithCompletionHandler completionHandler: @escaping (Bool) -> Void) {\n    \/\/ Restore the user interface.\n    completionHandler(true)\n}",
      "language" : "swift"
    },
    {
      "code" : "func pictureInPictureControllerWillStartPictureInPicture(_ pictureInPictureController: AVPictureInPictureController) {\n    \/\/ Hide the playback controls.\n    \/\/ Show the placeholder artwork.\n}\n\nfunc pictureInPictureControllerDidStopPictureInPicture(_ pictureInPictureController: AVPictureInPictureController) {\n    \/\/ Hide the placeholder artwork.\n    \/\/ Show the playback controls.\n}",
      "language" : "swift"
    }
  ],
  "contentHash" : "a508bd987f7de8134285f40c2010af2397dba5653524feca35752b1d0ee735df",
  "crawledAt" : "2025-12-02T15:58:18Z",
  "id" : "5F72AED1-33DD-4B86-9687-D501CF8910DA",
  "kind" : "article",
  "language" : "swift",
  "module" : "AVKit",
  "overview" : "## Overview\n\nAdd PiP playback to your custom player by using the AVKit framework’s [doc:\/\/com.apple.avkit\/documentation\/AVKit\/AVPictureInPictureController] class. This class lets you implement the same PiP behavior found in [doc:\/\/com.apple.avkit\/documentation\/AVKit\/AVPlayerViewController] in your custom player.\n\n### Configure Audio Session and Background Modes\n\nTo participate with PiP in iOS and tvOS, customize your app’s audio playback capabilities by configuring its audio session and background modes. For more information, see [doc:\/\/com.apple.documentation\/documentation\/AVFoundation\/configuring-your-app-for-media-playback].\n\n### Update Your Custom Player User Interface\n\nBegin by adding a user interface (UI) to your custom player interface to enable users to begin PiP playback. Make this UI consistent with the system default UI that [doc:\/\/com.apple.avkit\/documentation\/AVKit\/AVPlayerViewController] presents. Access the standard images for controlling PiP playback by using the [doc:\/\/com.apple.avkit\/documentation\/AVKit\/AVPictureInPictureController\/pictureInPictureButtonStartImage] and [doc:\/\/com.apple.avkit\/documentation\/AVKit\/AVPictureInPictureController\/pictureInPictureButtonStopImage] class properties of [doc:\/\/com.apple.avkit\/documentation\/AVKit\/AVPictureInPictureController]. These methods return system default images to present in your UI.\n\nUse key-value observing (KVO) on the controller’s [doc:\/\/com.apple.avkit\/documentation\/AVKit\/AVPictureInPictureController\/canStopPictureInPicture] property to display the appropriate affordances and provide the correct behavior in your playback UI. If `false`, display a start PiP affordance. If `true`, your app stops your custom playback UI and displays UI affordances to swap if you’re creating a tvOS app. For more information about KVO, see [doc:\/\/com.apple.documentation\/documentation\/Swift\/using-key-value-observing-in-swift].\n\n### Create the PiP Controller\n\nCreate an instance of [doc:\/\/com.apple.avkit\/documentation\/AVKit\/AVPictureInPictureController] to control PiP playback in your app. Before attempting to create the controller instance, verify that the current hardware supports PiP playback by calling the [doc:\/\/com.apple.avkit\/documentation\/AVKit\/AVPictureInPictureController\/isPictureInPictureSupported()] method.\n\nThis example creates a new [doc:\/\/com.apple.avkit\/documentation\/AVKit\/AVPictureInPictureController] instance, passing it a reference to the [doc:\/\/com.apple.documentation\/documentation\/AVFoundation\/AVPlayerLayer] that presents the video content. The system supports displaying content from an `AVPlayerLayer` or [doc:\/\/com.apple.documentation\/documentation\/AVFoundation\/AVSampleBufferDisplayLayer] in a PiP window.\n\nFor PiP functionality to work, maintain a strong reference to the controller object.\n\nTo participate in PiP life-cycle events, your code should adopt the [doc:\/\/com.apple.avkit\/documentation\/AVKit\/AVPictureInPictureControllerDelegate] protocol and set itself as the controller’s delegate. Also, use KVO on the controller’s [doc:\/\/com.apple.avkit\/documentation\/AVKit\/AVPictureInPictureController\/isPictureInPicturePossible] property to observe whether using PiP mode is possible in the current context, for example, when the system is displaying an active FaceTime window. By observing this property, you can determine when it’s appropriate to change the enabled state of your PiP button.\n\n### Publish the Now Playing State\n\nOn tvOS, [doc:\/\/com.apple.documentation\/documentation\/MediaPlayer\/MPNowPlayingSession] ties your [doc:\/\/com.apple.documentation\/documentation\/AVFoundation\/AVPlayer] instances to a session. Your app can have many playing sessions, and in the case of PiP, your player must be tied to a session. You can have a Now Playing session for your PiP content and one for your full-screen content. When you update a session, the system ignores updates from the default [doc:\/\/com.apple.documentation\/documentation\/MediaPlayer\/MPNowPlayingInfoCenter], so migrate away from `MPNowPlayingInfoCenter.default()` and switch to [doc:\/\/com.apple.documentation\/documentation\/MediaPlayer\/MPNowPlayingSession] across your whole app.\n\nThe system determines which Now Playing information to display, so publish your information even if the UI isn’t displaying your session — the system might display your session at any moment. For more information about Now Playing metadata, see the Now Playing Metadata Properties topic group at [doc:\/\/com.apple.documentation\/documentation\/MediaPlayer\/MPNowPlayingInfoCenter].\n\n### Handle User-Initiated Requests\n\nWith the `AVPictureInPictureController` setup complete, add an `@IBAction` method to handle user-initiated requests to start or stop PiP playback.\n\n### Restore Control to Your App\n\nA user selects the stop PiP affordance in the PiP window to return control to your app. By default, this action terminates playback when control returns to the app. It’s your responsibility to properly restore your video playback interface.\n\nTo handle the restore process, implement the [doc:\/\/com.apple.avkit\/documentation\/AVKit\/AVPictureInPictureControllerDelegate\/pictureInPictureController(_:restoreUserInterfaceForPictureInPictureStopWithCompletionHandler:)] delegate method and restore your player interface as needed. When the restoration is complete, call the completion handler with a value of `true`.\n\n### Dismiss Playback Controls\n\nWhile PiP is active, dismiss playback controls in your main player, and present artwork in the PiP window to indicate that PiP mode is active. To implement this functionality, use the [doc:\/\/com.apple.avkit\/documentation\/AVKit\/AVPictureInPictureControllerDelegate\/pictureInPictureControllerWillStartPictureInPicture(_:)] and [doc:\/\/com.apple.avkit\/documentation\/AVKit\/AVPictureInPictureControllerDelegate\/pictureInPictureControllerDidStopPictureInPicture(_:)] delegate methods, and take the required actions.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/AVKit\/adopting-picture-in-picture-in-a-custom-player\ncrawled: 2025-12-02T15:58:18Z\n---\n\n# Adopting Picture in Picture in a Custom Player\n\n**Article**\n\nAdd controls to your custom player user interface to invoke Picture in Picture (PiP) playback.\n\n## Overview\n\nAdd PiP playback to your custom player by using the AVKit framework’s [doc:\/\/com.apple.avkit\/documentation\/AVKit\/AVPictureInPictureController] class. This class lets you implement the same PiP behavior found in [doc:\/\/com.apple.avkit\/documentation\/AVKit\/AVPlayerViewController] in your custom player.\n\n### Configure Audio Session and Background Modes\n\nTo participate with PiP in iOS and tvOS, customize your app’s audio playback capabilities by configuring its audio session and background modes. For more information, see [doc:\/\/com.apple.documentation\/documentation\/AVFoundation\/configuring-your-app-for-media-playback].\n\n### Update Your Custom Player User Interface\n\nBegin by adding a user interface (UI) to your custom player interface to enable users to begin PiP playback. Make this UI consistent with the system default UI that [doc:\/\/com.apple.avkit\/documentation\/AVKit\/AVPlayerViewController] presents. Access the standard images for controlling PiP playback by using the [doc:\/\/com.apple.avkit\/documentation\/AVKit\/AVPictureInPictureController\/pictureInPictureButtonStartImage] and [doc:\/\/com.apple.avkit\/documentation\/AVKit\/AVPictureInPictureController\/pictureInPictureButtonStopImage] class properties of [doc:\/\/com.apple.avkit\/documentation\/AVKit\/AVPictureInPictureController]. These methods return system default images to present in your UI.\n\n```swift\nimport AVKit\n\n@IBOutlet weak var pipButton: UIButton!\n\noverride func viewDidLoad() {\n    super.viewDidLoad()\n    \n    let startImage = AVPictureInPictureController.pictureInPictureButtonStartImage\n    let stopImage = AVPictureInPictureController.pictureInPictureButtonStopImage\n    \n    pipButton.setImage(startImage, for: .normal)\n    pipButton.setImage(stopImage, for: .selected)\n}\n```\n\nUse key-value observing (KVO) on the controller’s [doc:\/\/com.apple.avkit\/documentation\/AVKit\/AVPictureInPictureController\/canStopPictureInPicture] property to display the appropriate affordances and provide the correct behavior in your playback UI. If `false`, display a start PiP affordance. If `true`, your app stops your custom playback UI and displays UI affordances to swap if you’re creating a tvOS app. For more information about KVO, see [doc:\/\/com.apple.documentation\/documentation\/Swift\/using-key-value-observing-in-swift].\n\n### Create the PiP Controller\n\nCreate an instance of [doc:\/\/com.apple.avkit\/documentation\/AVKit\/AVPictureInPictureController] to control PiP playback in your app. Before attempting to create the controller instance, verify that the current hardware supports PiP playback by calling the [doc:\/\/com.apple.avkit\/documentation\/AVKit\/AVPictureInPictureController\/isPictureInPictureSupported()] method.\n\n```swift\nvar pipController: AVPictureInPictureController!\nvar pipPossibleObservation: NSKeyValueObservation?\n\nfunc setupPictureInPicture() {\n    \/\/ Ensure PiP is supported by current device.\n    if AVPictureInPictureController.isPictureInPictureSupported() {\n        \/\/ Create a new controller, passing the reference to the AVPlayerLayer.\n        pipController = AVPictureInPictureController(playerLayer: playerLayer)\n        pipController.delegate = self\n\n        pipPossibleObservation = pipController.observe(\\AVPictureInPictureController.isPictureInPicturePossible,\noptions: [.initial, .new]) { [weak self] _, change in\n            \/\/ Update the PiP button's enabled state.\n            self?.pipButton.isEnabled = change.newValue ?? false\n        }\n    } else {\n        \/\/ PiP isn't supported by the current device. Disable the PiP button.\n        pipButton.isEnabled = false\n    }\n}\n```\n\nThis example creates a new [doc:\/\/com.apple.avkit\/documentation\/AVKit\/AVPictureInPictureController] instance, passing it a reference to the [doc:\/\/com.apple.documentation\/documentation\/AVFoundation\/AVPlayerLayer] that presents the video content. The system supports displaying content from an `AVPlayerLayer` or [doc:\/\/com.apple.documentation\/documentation\/AVFoundation\/AVSampleBufferDisplayLayer] in a PiP window.\n\nFor PiP functionality to work, maintain a strong reference to the controller object.\n\n\n\nTo participate in PiP life-cycle events, your code should adopt the [doc:\/\/com.apple.avkit\/documentation\/AVKit\/AVPictureInPictureControllerDelegate] protocol and set itself as the controller’s delegate. Also, use KVO on the controller’s [doc:\/\/com.apple.avkit\/documentation\/AVKit\/AVPictureInPictureController\/isPictureInPicturePossible] property to observe whether using PiP mode is possible in the current context, for example, when the system is displaying an active FaceTime window. By observing this property, you can determine when it’s appropriate to change the enabled state of your PiP button.\n\n### Publish the Now Playing State\n\nOn tvOS, [doc:\/\/com.apple.documentation\/documentation\/MediaPlayer\/MPNowPlayingSession] ties your [doc:\/\/com.apple.documentation\/documentation\/AVFoundation\/AVPlayer] instances to a session. Your app can have many playing sessions, and in the case of PiP, your player must be tied to a session. You can have a Now Playing session for your PiP content and one for your full-screen content. When you update a session, the system ignores updates from the default [doc:\/\/com.apple.documentation\/documentation\/MediaPlayer\/MPNowPlayingInfoCenter], so migrate away from `MPNowPlayingInfoCenter.default()` and switch to [doc:\/\/com.apple.documentation\/documentation\/MediaPlayer\/MPNowPlayingSession] across your whole app.\n\nThe system determines which Now Playing information to display, so publish your information even if the UI isn’t displaying your session — the system might display your session at any moment. For more information about Now Playing metadata, see the Now Playing Metadata Properties topic group at [doc:\/\/com.apple.documentation\/documentation\/MediaPlayer\/MPNowPlayingInfoCenter].\n\n```swift\nfunc publishNowPlayingMetadata() {\n    nowPlayingSession.nowPlayingInfoCenter.nowPlayingInfo = nowPlayingInfo\n    nowPlayingSession.becomeActiveIfPossible()\n}\n```\n\n### Handle User-Initiated Requests\n\nWith the `AVPictureInPictureController` setup complete, add an `@IBAction` method to handle user-initiated requests to start or stop PiP playback.\n\n```swift\n@IBAction func togglePictureInPictureMode(_ sender: UIButton) {\n    if pipController.isPictureInPictureActive {\n        pipController.stopPictureInPicture()\n    } else {\n        pipController.startPictureInPicture()\n    }\n}\n```\n\n\n\n### Restore Control to Your App\n\nA user selects the stop PiP affordance in the PiP window to return control to your app. By default, this action terminates playback when control returns to the app. It’s your responsibility to properly restore your video playback interface.\n\nTo handle the restore process, implement the [doc:\/\/com.apple.avkit\/documentation\/AVKit\/AVPictureInPictureControllerDelegate\/pictureInPictureController(_:restoreUserInterfaceForPictureInPictureStopWithCompletionHandler:)] delegate method and restore your player interface as needed. When the restoration is complete, call the completion handler with a value of `true`.\n\n```swift\nfunc pictureInPictureController(_ pictureInPictureController: AVPictureInPictureController,\n                                restoreUserInterfaceForPictureInPictureStopWithCompletionHandler completionHandler: @escaping (Bool) -> Void) {\n    \/\/ Restore the user interface.\n    completionHandler(true)\n}\n```\n\n### Dismiss Playback Controls\n\nWhile PiP is active, dismiss playback controls in your main player, and present artwork in the PiP window to indicate that PiP mode is active. To implement this functionality, use the [doc:\/\/com.apple.avkit\/documentation\/AVKit\/AVPictureInPictureControllerDelegate\/pictureInPictureControllerWillStartPictureInPicture(_:)] and [doc:\/\/com.apple.avkit\/documentation\/AVKit\/AVPictureInPictureControllerDelegate\/pictureInPictureControllerDidStopPictureInPicture(_:)] delegate methods, and take the required actions.\n\n```swift\nfunc pictureInPictureControllerWillStartPictureInPicture(_ pictureInPictureController: AVPictureInPictureController) {\n    \/\/ Hide the playback controls.\n    \/\/ Show the placeholder artwork.\n}\n\nfunc pictureInPictureControllerDidStopPictureInPicture(_ pictureInPictureController: AVPictureInPictureController) {\n    \/\/ Hide the placeholder artwork.\n    \/\/ Show the playback controls.\n}\n```\n\n## Picture in Picture\n\n- **Adopting Picture in Picture Playback in tvOS**: Add advanced multitasking capabilities to your video apps by using Picture in Picture playback in tvOS.\n- **Adopting Picture in Picture in a Standard Player**: Add Picture in Picture (PiP) playback to your app using a player view controller.\n- **Adopting Picture in Picture for video calls**: Add multitasking capability to your video-call apps by using Picture in Picture (PiP).\n- **Accessing the camera while multitasking on iPad**: Operate the camera in Split View, Slide Over, Picture in Picture, and Stage Manager modes.\n- **AVPictureInPictureController**: A controller that responds to user-initiated Picture in Picture playback of video in a floating, resizable window.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Add advanced multitasking capabilities to your video apps by using Picture in Picture playback in tvOS.",
          "name" : "Adopting Picture in Picture Playback in tvOS",
          "url" : "https:\/\/developer.apple.com\/documentation\/AVKit\/adopting-picture-in-picture-playback-in-tvos"
        },
        {
          "description" : "Add Picture in Picture (PiP) playback to your app using a player view controller.",
          "name" : "Adopting Picture in Picture in a Standard Player",
          "url" : "https:\/\/developer.apple.com\/documentation\/AVKit\/adopting-picture-in-picture-in-a-standard-player"
        },
        {
          "description" : "Add multitasking capability to your video-call apps by using Picture in Picture (PiP).",
          "name" : "Adopting Picture in Picture for video calls",
          "url" : "https:\/\/developer.apple.com\/documentation\/AVKit\/adopting-picture-in-picture-for-video-calls"
        },
        {
          "description" : "Operate the camera in Split View, Slide Over, Picture in Picture, and Stage Manager modes.",
          "name" : "Accessing the camera while multitasking on iPad",
          "url" : "https:\/\/developer.apple.com\/documentation\/AVKit\/accessing-the-camera-while-multitasking-on-ipad"
        },
        {
          "description" : "A controller that responds to user-initiated Picture in Picture playback of video in a floating, resizable window.",
          "name" : "AVPictureInPictureController",
          "url" : "https:\/\/developer.apple.com\/documentation\/AVKit\/AVPictureInPictureController"
        }
      ],
      "title" : "Picture in Picture"
    }
  ],
  "source" : "appleJSON",
  "title" : "Adopting Picture in Picture in a Custom Player",
  "url" : "https:\/\/developer.apple.com\/documentation\/AVKit\/adopting-picture-in-picture-in-a-custom-player"
}