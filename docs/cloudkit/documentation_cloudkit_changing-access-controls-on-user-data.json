{
  "abstract" : "Restrict access to or remove restrictions from a user’s data at their request.",
  "codeExamples" : [
    {
      "code" : "let defaultContainer = CKContainer.default()\nlet documents = CKContainer(identifier: \"iCloud.com.example.myexampleapp.documents\")\nlet settings = CKContainer(identifier: \"iCloud.com.example.myexampleapp.settings\")",
      "language" : "swift"
    },
    {
      "code" : "let containerAPITokens: [CKContainer: String] = [\n    defaultContainer: \"<# Token for the default container #>\",\n    documents: \"<# Token for a custom container #>\",\n    settings: \"<# Token for another custom container #>\"\n]\n\nlet containers = Array(containerAPITokens.keys)",
      "language" : "swift"
    },
    {
      "code" : "for container in containers {\n    guard let apiToken = containerAPITokens[container] else {\n        continue\n    }\n    \n    let fetchAuthorization = CKFetchWebAuthTokenOperation(apiToken: apiToken)\n    \n    fetchAuthorization.fetchWebAuthTokenCompletionBlock = { webToken, error in\n        guard let webToken = webToken, error == nil else { return }\n        \n        restrict(container: container, apiToken: apiToken, webToken: webToken) { error in\n            guard error == nil else {\n                 print(\"Restriction failed. Reason: \", error!)\n                 return\n            }\n            print(\"Restriction succeeded.\")\n        }\n    }\n    \n    container.privateCloudDatabase.add(fetchAuthorization)\n}",
      "language" : "swift"
    },
    {
      "code" : "func requestRestriction(url: URL, completionHandler: @escaping (Error?) -> Void) {\n    let task = URLSession.shared.dataTask(with: url) { data, response, error in\n        if let error = error {\n            completionHandler(error)\n            return\n        }\n        guard let httpResponse = response as? HTTPURLResponse,\n            (200...299).contains(httpResponse.statusCode) else {\n                completionHandler(RestrictError.failure)\n                return\n        }\n        \n        print(\"Restrict result\", httpResponse)\n        \n        \/\/ Other than indicating success or failure, the `restrict` API doesn't return actionable data in its response.\n        if data != nil {\n            completionHandler(nil)\n        } else {\n            completionHandler(RestrictError.failure)\n        }\n    }\n    task.resume()\n}\n\n\/\/\/ A utility function that percent encodes a token for URL requests.\nfunc encodeToken(_ token: String) -> String {\n    return token.addingPercentEncoding(\n        withAllowedCharacters: CharacterSet(charactersIn: \"+\/=\").inverted\n    ) ?? token\n}\n\n\/\/\/ An error type that represents a failure in the `restrict` API call.\nenum RestrictError: Error {\n    case failure\n}\n\nfunc restrict(container: CKContainer, apiToken: String, webToken: String, completionHandler: @escaping (Error?) -> Void) {\n    let webToken = encodeToken(webToken)\n    \n    let identifier = container.containerIdentifier!\n    let env = \"production\" \/\/ Use \"development\" during development.\n    let baseURL = \"https:\/\/api.apple-cloudkit.com\/database\/1\/\"\n    let apiPath = \"\\(identifier)\/\\(env)\/private\/users\/restrict\"\n    let query = \"?ckAPIToken=\\(apiToken)&ckWebAuthToken=\\(webToken)\"\n    \n    let url = URL(string: \"\\(baseURL)\\(apiPath)\\(query)\")!\n    \n    requestRestriction(url: url, completionHandler: completionHandler)\n}",
      "language" : "swift"
    },
    {
      "code" : "func unrestrict(container: CKContainer, apiToken: String, webToken: String, completionHandler: @escaping (Error?) -> Void) {\n    let webToken = encodeToken(webToken)\n    \n    let identifier = container.containerIdentifier!\n    let env = \"production\" \/\/ Use \"development\" during development.\n    let baseURL = \"https:\/\/api.apple-cloudkit.com\/database\/1\/\"\n    let apiPath = \"\\(identifier)\/\\(env)\/private\/users\/unrestrict\"\n    let query = \"?ckAPIToken=\\(apiToken)&ckWebAuthToken=\\(webToken)\"\n    \n    let url = URL(string: \"\\(baseURL)\\(apiPath)\\(query)\")!\n    \n    requestRestriction(url: url, completionHandler: completionHandler)\n}",
      "language" : "swift"
    }
  ],
  "contentHash" : "b2c8d7f855ff633d25c64cc5841eac0a61439451480ca47c34c7bf816752981b",
  "crawledAt" : "2025-12-04T20:44:36Z",
  "id" : "F03D05D8-50ED-4A22-A97A-C892EB9DBB7E",
  "kind" : "article",
  "language" : "swift",
  "module" : "CloudKit",
  "overview" : "## Overview\n\nUsers can ask you to prevent any further changes to their data that your app stores in CloudKit. Use the `restrict` API that CloudKit Web Services provides to honor those requests. You can remove restrictions at the user’s request by calling the `unrestrict` API.\n\n### Identify Containers\n\nTo be sure that you restrict changes and access to all of a user’s data that your app stores, cross-reference the list of containers your app has access to in Xcode and assemble a list of those containers’ identifiers. [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/identifying-an-app-s-containers] describes this process.\n\nThe example below stores containers in constants to use later:\n\n### Create Reusable API Tokens\n\nThe `restrict` API call requires a token each time you call the API. You create an API token once for each container in your app using the CloudKit Dashboard, and reuse it in each API call to a specific container.\n\nGenerate a token in the CloudKit Dashboard by visiting the page for each container, then selecting API Access > New Token > Create Token. Tokens are specific to a deployment environment, so you need separate tokens for the production and development environments.\n\nThe example below stores tokens in a dictionary for each container to use later:\n\n### Create Web Authentication Tokens\n\nThe `restrict` API call requires a new authentication token each time you call the API, in addition to the reusable API token. The example below shows how to create that token using an instance of [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKFetchWebAuthTokenOperation]:\n\nAfter you receive the authentication token, you can immediately call the `restrict` API once for each container.\n\n### Restrict Data Access in Each Container\n\nThe example below defines the `restrict(container:apiToken:webToken:completionHandler:)` and `requestRestriction(url:completionHandler:)` methods for the example above to build the network request for the `restrict` API:\n\n### Remove Restrictions\n\nWhen a user requests that you remove restrictions, you use the `unrestrict` API, which performs the opposite operation that the `restrict` API performs.\n\nThe example below shows a modified version of the `restrict(container:apiToken:webToken:completionHandler:)` method from the previous example that removes restrictions instead of enabling them:\n\nA successful call to the `unrestrict(container:apiToken:webToken: completionHandler:)` function (a `nil` error parameter in the completion handler indicates success) means that your app can access and modify user data.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/CloudKit\/changing-access-controls-on-user-data\ncrawled: 2025-12-04T20:44:36Z\n---\n\n# Changing Access Controls on User Data\n\n**Article**\n\nRestrict access to or remove restrictions from a user’s data at their request.\n\n## Overview\n\nUsers can ask you to prevent any further changes to their data that your app stores in CloudKit. Use the `restrict` API that CloudKit Web Services provides to honor those requests. You can remove restrictions at the user’s request by calling the `unrestrict` API.\n\n### Identify Containers\n\nTo be sure that you restrict changes and access to all of a user’s data that your app stores, cross-reference the list of containers your app has access to in Xcode and assemble a list of those containers’ identifiers. [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/identifying-an-app-s-containers] describes this process.\n\nThe example below stores containers in constants to use later:\n\n```swift\nlet defaultContainer = CKContainer.default()\nlet documents = CKContainer(identifier: \"iCloud.com.example.myexampleapp.documents\")\nlet settings = CKContainer(identifier: \"iCloud.com.example.myexampleapp.settings\")\n```\n\n### Create Reusable API Tokens\n\nThe `restrict` API call requires a token each time you call the API. You create an API token once for each container in your app using the CloudKit Dashboard, and reuse it in each API call to a specific container.\n\nGenerate a token in the CloudKit Dashboard by visiting the page for each container, then selecting API Access > New Token > Create Token. Tokens are specific to a deployment environment, so you need separate tokens for the production and development environments.\n\nThe example below stores tokens in a dictionary for each container to use later:\n\n```swift\nlet containerAPITokens: [CKContainer: String] = [\n    defaultContainer: \"<# Token for the default container #>\",\n    documents: \"<# Token for a custom container #>\",\n    settings: \"<# Token for another custom container #>\"\n]\n\nlet containers = Array(containerAPITokens.keys)\n```\n\n### Create Web Authentication Tokens\n\nThe `restrict` API call requires a new authentication token each time you call the API, in addition to the reusable API token. The example below shows how to create that token using an instance of [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKFetchWebAuthTokenOperation]:\n\n```swift\nfor container in containers {\n    guard let apiToken = containerAPITokens[container] else {\n        continue\n    }\n    \n    let fetchAuthorization = CKFetchWebAuthTokenOperation(apiToken: apiToken)\n    \n    fetchAuthorization.fetchWebAuthTokenCompletionBlock = { webToken, error in\n        guard let webToken = webToken, error == nil else { return }\n        \n        restrict(container: container, apiToken: apiToken, webToken: webToken) { error in\n            guard error == nil else {\n                 print(\"Restriction failed. Reason: \", error!)\n                 return\n            }\n            print(\"Restriction succeeded.\")\n        }\n    }\n    \n    container.privateCloudDatabase.add(fetchAuthorization)\n}\n```\n\nAfter you receive the authentication token, you can immediately call the `restrict` API once for each container.\n\n### Restrict Data Access in Each Container\n\nThe example below defines the `restrict(container:apiToken:webToken:completionHandler:)` and `requestRestriction(url:completionHandler:)` methods for the example above to build the network request for the `restrict` API:\n\n```swift\nfunc requestRestriction(url: URL, completionHandler: @escaping (Error?) -> Void) {\n    let task = URLSession.shared.dataTask(with: url) { data, response, error in\n        if let error = error {\n            completionHandler(error)\n            return\n        }\n        guard let httpResponse = response as? HTTPURLResponse,\n            (200...299).contains(httpResponse.statusCode) else {\n                completionHandler(RestrictError.failure)\n                return\n        }\n        \n        print(\"Restrict result\", httpResponse)\n        \n        \/\/ Other than indicating success or failure, the `restrict` API doesn't return actionable data in its response.\n        if data != nil {\n            completionHandler(nil)\n        } else {\n            completionHandler(RestrictError.failure)\n        }\n    }\n    task.resume()\n}\n\n\/\/\/ A utility function that percent encodes a token for URL requests.\nfunc encodeToken(_ token: String) -> String {\n    return token.addingPercentEncoding(\n        withAllowedCharacters: CharacterSet(charactersIn: \"+\/=\").inverted\n    ) ?? token\n}\n\n\/\/\/ An error type that represents a failure in the `restrict` API call.\nenum RestrictError: Error {\n    case failure\n}\n\nfunc restrict(container: CKContainer, apiToken: String, webToken: String, completionHandler: @escaping (Error?) -> Void) {\n    let webToken = encodeToken(webToken)\n    \n    let identifier = container.containerIdentifier!\n    let env = \"production\" \/\/ Use \"development\" during development.\n    let baseURL = \"https:\/\/api.apple-cloudkit.com\/database\/1\/\"\n    let apiPath = \"\\(identifier)\/\\(env)\/private\/users\/restrict\"\n    let query = \"?ckAPIToken=\\(apiToken)&ckWebAuthToken=\\(webToken)\"\n    \n    let url = URL(string: \"\\(baseURL)\\(apiPath)\\(query)\")!\n    \n    requestRestriction(url: url, completionHandler: completionHandler)\n}\n```\n\n### Remove Restrictions\n\nWhen a user requests that you remove restrictions, you use the `unrestrict` API, which performs the opposite operation that the `restrict` API performs.\n\nThe example below shows a modified version of the `restrict(container:apiToken:webToken:completionHandler:)` method from the previous example that removes restrictions instead of enabling them:\n\n```swift\nfunc unrestrict(container: CKContainer, apiToken: String, webToken: String, completionHandler: @escaping (Error?) -> Void) {\n    let webToken = encodeToken(webToken)\n    \n    let identifier = container.containerIdentifier!\n    let env = \"production\" \/\/ Use \"development\" during development.\n    let baseURL = \"https:\/\/api.apple-cloudkit.com\/database\/1\/\"\n    let apiPath = \"\\(identifier)\/\\(env)\/private\/users\/unrestrict\"\n    let query = \"?ckAPIToken=\\(apiToken)&ckWebAuthToken=\\(webToken)\"\n    \n    let url = URL(string: \"\\(baseURL)\\(apiPath)\\(query)\")!\n    \n    requestRestriction(url: url, completionHandler: completionHandler)\n}\n```\n\nA successful call to the `unrestrict(container:apiToken:webToken: completionHandler:)` function (a `nil` error parameter in the completion handler indicates success) means that your app can access and modify user data.\n\n## Privacy\n\n- **Encrypting User Data**: Deploy industry-standard security technologies using CloudKit encryption.\n- **Providing User Access to CloudKit Data**: Provide users access to the data your app stores on their behalf.\n- **CKFetchWebAuthTokenOperation**: An operation that creates an authentication token for use with CloudKit web services.\n- **Responding to Requests to Delete Data**: Provide options for users to delete their CloudKit data from your app.\n- **Identifying an App’s Containers**: Use Xcode’s Project navigator to find the identifiers of active CloudKit containers.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Deploy industry-standard security technologies using CloudKit encryption.",
          "name" : "Encrypting User Data",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/encrypting-user-data"
        },
        {
          "description" : "Provide users access to the data your app stores on their behalf.",
          "name" : "Providing User Access to CloudKit Data",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/providing-user-access-to-cloudkit-data"
        },
        {
          "description" : "An operation that creates an authentication token for use with CloudKit web services.",
          "name" : "CKFetchWebAuthTokenOperation",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKFetchWebAuthTokenOperation"
        },
        {
          "description" : "Provide options for users to delete their CloudKit data from your app.",
          "name" : "Responding to Requests to Delete Data",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/responding-to-requests-to-delete-data"
        },
        {
          "description" : "Use Xcode’s Project navigator to find the identifiers of active CloudKit containers.",
          "name" : "Identifying an App’s Containers",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/identifying-an-app-s-containers"
        }
      ],
      "title" : "Privacy"
    }
  ],
  "source" : "appleJSON",
  "title" : "Changing Access Controls on User Data",
  "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/changing-access-controls-on-user-data"
}