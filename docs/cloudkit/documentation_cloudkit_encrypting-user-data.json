{
  "abstract" : "Deploy industry-standard security technologies using CloudKit encryption.",
  "codeExamples" : [
    {
      "code" : "\/\/ Create a record.\nlet record = CKRecord(recordType: \"MyRecordType\")\n        \n\/\/ Define the encrypted field keys.\nlet dataKey = \"dataKey\"\nlet listKey = \"listKey\"\n        \n\/\/ Encrypt and decrypt arbitrary bytes of data.\nrecord.encryptedValues[dataKey] = NSData()\nlet _ = record.encryptedValues[dataKey] as? NSData\n        \n\/\/ Encrypt a list of data bytes.\nrecord.encryptedValues[listKey] = [\n    NSData(),\n    NSData()\n]\n        \n\/\/ Retrieve the keys of all encrypted fields.\nprint(record.encryptedValues.allKeys())",
      "language" : "swift"
    },
    {
      "code" : "{\n  \"operations\" : [ {\n    \"operationType\" : \"create\",\n    \"record\" : {\n      \"recordType\" : \"myRecordType\",\n      \"fields\" : {\n        \"myDoubleField\" : {\n          \"value\" : 0.55,\n          \"type\" : \"DOUBLE\",\n          \"isEncrypted\" : true\n        },\n        \"myIntListField\" : {\n          \"value\" : [ 123, 456, 789 ],\n          \"type\" : \"INT64_LIST\",\n          \"isEncrypted\" : true\n        }\n      \"recordName\" : \"recordWithEncryptedFields\",\n    }\n  } ],\n  \"zoneID\" : {\n    \"zoneName\" : \"myZone\"\n  }\n}",
      "language" : "json"
    }
  ],
  "contentHash" : "a20879438520a1ad96868b1c0c01b98a39e0d13a2785893d898eea9c04fae02f",
  "crawledAt" : "2025-12-04T19:14:21Z",
  "id" : "1D257F9D-36D7-4B65-8F62-944CC37DC082",
  "kind" : "article",
  "language" : "swift",
  "module" : "CloudKit",
  "overview" : "## Overview\n\nThe CloudKit framework enforces strict policies and adopts privacy-preserving technologies to help you encrypt your users’ data. CloudKit stores data and protects data through account authentication using secure tokens. iCloud servers use encryption to ensure that only authorized users can access their data.\n\nEncryption adds another layer of protection on top of account-based access control, and is available for data that’s sensitive or private to the user. CloudKit’s encrypted fields allow you to optionally add that second layer of cryptographic protection by choosing which fields the system encrypts within a [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKRecord].\n\nUse encrypted fields to offer data encryption to your users in your CloudKit-based apps, such as Photos, Notes, Health, Home, and so forth. See the [https:\/\/support.apple.com\/en-us\/HT202303] for more information.\n\n### Review Supported Database Types\n\nCloudKit offers multiple database types, but not all databases support encryption.\n\n### Protect Users\n\nCloudKit encrypts data with the key material in the user’s iCloud Keychain. If the user loses access to iCloud Keychain, CloudKit can’t access the key material that it previously used to encrypt the data, so iCloud can’t decrypt it.\n\nApple provides functionality to help users avoid this situation. However, there’s always a risk that a user might lose access to their iCloud keychain, and subsequently, can choose to start over by resetting to a new keychain. This may lead to a [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKError\/Code\/zoneNotFound] error from CloudKit that your app needs to handle. See the “Handle a User Keychain Reset” section below for more information.\n\n### Encrypt Fields in CloudKit\n\nUse the [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKRecord\/encryptedValues] property to set a field on a `CKRecord` that instructs CloudKit to automatically encrypt data while writing, and decrypt it while reading. This method of encryption and decryption applies to most of the `Record` value types, including [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSString], [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSNumber], [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSDate], [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSData], [doc:\/\/com.apple.documentation\/documentation\/CoreLocation\/CLLocation], and [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSArray]. However, there’s no encryption support for [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKRecord\/Reference] objects because they need to be visible to the server. CloudKit encrypts [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKAsset] by default so you can’t set it as a value for the [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKRecord\/encryptedValues] property.\n\nBelow is an example of the encrypted values property setting and getting [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSData]:\n\nYour CloudKit database schema needs to reflect which fields on specific record types require encryption. Update your schema in one of the following ways:\n\n\n\nPromote this schema change to your production environment before deploying any app changes to the App Store that rely on the new schema.\n\n### Use Assets\n\nWhen creating or updating a [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKRecord] that contains a [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKAsset], CloudKit breaks up the asset’s contents into chunks, and encrypts each chunk before storing it in the third-party services. CloudKit then encrypts the key for each chunk, which Apple maintains, with an asset key and stores the asset key on the relevant record.\n\nCloudKit automatically stores the asset key in an encrypted field on the record in the private database, and by proxy, in the shared database. This means that CloudKit ultimately encrypts the asset data to a key in the user’s iCloud Keychain.\n\nCloudKit doesn’t store the asset key in an encrypted field on the record in the public database because the record is accessible to anyone with access to that database.\n\nFor more information about security, see [https:\/\/support.apple.com\/en-jo\/guide\/security\/sec3d52c0374\/1\/web\/1].\n\n### Handle a User Keychain Reset\n\nWhen CloudKit is unable to decrypt the encrypted data, it returns a [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKError\/Code\/zoneNotFound] with an entry of [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKErrorUserDidResetEncryptedDataKey] in its `userInfo` dictionary. This error can occur in any [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKOperation] that involves reading existing zones or records, such as:\n\nWhen this error occurs, the data becomes permanently lost. Your app needs to handle this situation in the following manner:\n\n### Use CloudKit Web Services\n\nWhen making requests through the CloudKit web services interface with an authenticated user against compatible databases, you can:\n\nThe web services handle the encryption and decryption for you. The rules regarding CloudKit database schema promotion remain the same for web services as they are for native CloudKit.\n\nThe following shows an example request for creating records with the encrypted fields:",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/CloudKit\/encrypting-user-data\ncrawled: 2025-12-04T19:14:21Z\n---\n\n# Encrypting User Data\n\n**Article**\n\nDeploy industry-standard security technologies using CloudKit encryption.\n\n## Overview\n\nThe CloudKit framework enforces strict policies and adopts privacy-preserving technologies to help you encrypt your users’ data. CloudKit stores data and protects data through account authentication using secure tokens. iCloud servers use encryption to ensure that only authorized users can access their data.\n\nEncryption adds another layer of protection on top of account-based access control, and is available for data that’s sensitive or private to the user. CloudKit’s encrypted fields allow you to optionally add that second layer of cryptographic protection by choosing which fields the system encrypts within a [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKRecord].\n\nUse encrypted fields to offer data encryption to your users in your CloudKit-based apps, such as Photos, Notes, Health, Home, and so forth. See the [https:\/\/support.apple.com\/en-us\/HT202303] for more information.\n\n### Review Supported Database Types\n\nCloudKit offers multiple database types, but not all databases support encryption.\n\n\n\n### Protect Users\n\nCloudKit encrypts data with the key material in the user’s iCloud Keychain. If the user loses access to iCloud Keychain, CloudKit can’t access the key material that it previously used to encrypt the data, so iCloud can’t decrypt it.\n\nApple provides functionality to help users avoid this situation. However, there’s always a risk that a user might lose access to their iCloud keychain, and subsequently, can choose to start over by resetting to a new keychain. This may lead to a [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKError\/Code\/zoneNotFound] error from CloudKit that your app needs to handle. See the “Handle a User Keychain Reset” section below for more information.\n\n### Encrypt Fields in CloudKit\n\nUse the [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKRecord\/encryptedValues] property to set a field on a `CKRecord` that instructs CloudKit to automatically encrypt data while writing, and decrypt it while reading. This method of encryption and decryption applies to most of the `Record` value types, including [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSString], [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSNumber], [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSDate], [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSData], [doc:\/\/com.apple.documentation\/documentation\/CoreLocation\/CLLocation], and [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSArray]. However, there’s no encryption support for [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKRecord\/Reference] objects because they need to be visible to the server. CloudKit encrypts [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKAsset] by default so you can’t set it as a value for the [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKRecord\/encryptedValues] property.\n\nBelow is an example of the encrypted values property setting and getting [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSData]:\n\n```swift\n\/\/ Create a record.\nlet record = CKRecord(recordType: \"MyRecordType\")\n        \n\/\/ Define the encrypted field keys.\nlet dataKey = \"dataKey\"\nlet listKey = \"listKey\"\n        \n\/\/ Encrypt and decrypt arbitrary bytes of data.\nrecord.encryptedValues[dataKey] = NSData()\nlet _ = record.encryptedValues[dataKey] as? NSData\n        \n\/\/ Encrypt a list of data bytes.\nrecord.encryptedValues[listKey] = [\n    NSData(),\n    NSData()\n]\n        \n\/\/ Retrieve the keys of all encrypted fields.\nprint(record.encryptedValues.allKeys())\n```\n\nYour CloudKit database schema needs to reflect which fields on specific record types require encryption. Update your schema in one of the following ways:\n\n- Write a new field to a new or existing [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKRecord] through the [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKRecord\/encryptedValues] property in the development environment of your container. This triggers a schema update to your development environment, which reflects in [https:\/\/icloud.developer.apple.com\/dashboard\/#home].\n- Using CloudKit console, add a new field to a new record type in your development environment schema. Set the field type to the desired encrypted data type, such as Encrypted Double or Encrypted String.\n\n\n\nPromote this schema change to your production environment before deploying any app changes to the App Store that rely on the new schema.\n\n\n\n### Use Assets\n\nWhen creating or updating a [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKRecord] that contains a [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKAsset], CloudKit breaks up the asset’s contents into chunks, and encrypts each chunk before storing it in the third-party services. CloudKit then encrypts the key for each chunk, which Apple maintains, with an asset key and stores the asset key on the relevant record.\n\nCloudKit automatically stores the asset key in an encrypted field on the record in the private database, and by proxy, in the shared database. This means that CloudKit ultimately encrypts the asset data to a key in the user’s iCloud Keychain.\n\nCloudKit doesn’t store the asset key in an encrypted field on the record in the public database because the record is accessible to anyone with access to that database.\n\nFor more information about security, see [https:\/\/support.apple.com\/en-jo\/guide\/security\/sec3d52c0374\/1\/web\/1].\n\n### Handle a User Keychain Reset\n\nWhen CloudKit is unable to decrypt the encrypted data, it returns a [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKError\/Code\/zoneNotFound] with an entry of [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKErrorUserDidResetEncryptedDataKey] in its `userInfo` dictionary. This error can occur in any [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKOperation] that involves reading existing zones or records, such as:\n\n- [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKFetchRecordsOperation]\n- [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKFetchRecordZonesOperation]\n- [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKFetchRecordZoneChangesOperation]\n- [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKModifyRecordZonesOperation]\n- [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKModifyRecordsOperation]\n\nWhen this error occurs, the data becomes permanently lost. Your app needs to handle this situation in the following manner:\n\n- Delete the relevant zones.\n- Recreate the relevant zones.\n- Upload the locally cached data from the device to those zones. CloudKit encrypts the new data using new key material from the user’s iCloud Keychain.\n\n\n\n### Use CloudKit Web Services\n\nWhen making requests through the CloudKit web services interface with an authenticated user against compatible databases, you can:\n\n- Save data in an encrypted field\n- Pass an `isEncrypted` flag along with the payload in a [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKModifyRecordsOperation] records request\n\nThe web services handle the encryption and decryption for you. The rules regarding CloudKit database schema promotion remain the same for web services as they are for native CloudKit.\n\nThe following shows an example request for creating records with the encrypted fields:\n\n```json\n{\n  \"operations\" : [ {\n    \"operationType\" : \"create\",\n    \"record\" : {\n      \"recordType\" : \"myRecordType\",\n      \"fields\" : {\n        \"myDoubleField\" : {\n          \"value\" : 0.55,\n          \"type\" : \"DOUBLE\",\n          \"isEncrypted\" : true\n        },\n        \"myIntListField\" : {\n          \"value\" : [ 123, 456, 789 ],\n          \"type\" : \"INT64_LIST\",\n          \"isEncrypted\" : true\n        }\n      \"recordName\" : \"recordWithEncryptedFields\",\n    }\n  } ],\n  \"zoneID\" : {\n    \"zoneName\" : \"myZone\"\n  }\n}\n```\n\n## Privacy\n\n- **Providing User Access to CloudKit Data**: Provide users access to the data your app stores on their behalf.\n- **Changing Access Controls on User Data**: Restrict access to or remove restrictions from a user’s data at their request.\n- **CKFetchWebAuthTokenOperation**: An operation that creates an authentication token for use with CloudKit web services.\n- **Responding to Requests to Delete Data**: Provide options for users to delete their CloudKit data from your app.\n- **Identifying an App’s Containers**: Use Xcode’s Project navigator to find the identifiers of active CloudKit containers.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Provide users access to the data your app stores on their behalf.",
          "name" : "Providing User Access to CloudKit Data",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/providing-user-access-to-cloudkit-data"
        },
        {
          "description" : "Restrict access to or remove restrictions from a user’s data at their request.",
          "name" : "Changing Access Controls on User Data",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/changing-access-controls-on-user-data"
        },
        {
          "description" : "An operation that creates an authentication token for use with CloudKit web services.",
          "name" : "CKFetchWebAuthTokenOperation",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKFetchWebAuthTokenOperation"
        },
        {
          "description" : "Provide options for users to delete their CloudKit data from your app.",
          "name" : "Responding to Requests to Delete Data",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/responding-to-requests-to-delete-data"
        },
        {
          "description" : "Use Xcode’s Project navigator to find the identifiers of active CloudKit containers.",
          "name" : "Identifying an App’s Containers",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/identifying-an-app-s-containers"
        }
      ],
      "title" : "Privacy"
    }
  ],
  "source" : "appleJSON",
  "title" : "Encrypting User Data",
  "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/encrypting-user-data"
}