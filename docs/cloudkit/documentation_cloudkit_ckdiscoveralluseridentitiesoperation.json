{
  "abstract" : "An operation that uses the device’s contacts to search for discoverable iCloud users.",
  "codeExamples" : [
    {
      "code" : "func fetchUserIdentities(\n    completion: @escaping (Result<[CKUserIdentity], Error>) -> Void) {\n        \n    var identities = [CKUserIdentity]()\n    \n    \/\/ Create an operation to discover all the iCloud users\n    \/\/ in the user's Contacts database that use the app, and\n    \/\/ opt in to being discoverable.\n    let operation = CKDiscoverAllUserIdentitiesOperation()\n    \n    \/\/ Cache the user identities as CloudKit discovers them.  \n    operation.userIdentityDiscoveredBlock = { userIdentity in\n        identities.append(userIdentity)\n    }\n    \n    \/\/ If the operation fails, return the error to the caller.\n    \/\/ Otherwise, return the array of discovered user identities.\n    operation.discoverAllUserIdentitiesCompletionBlock = { error in\n        if let error = error {\n            completion(.failure(error))\n        } else {\n            completion(.success(identities))\n        }\n    }\n    \n    \/\/ Set an appropriate QoS and add the operation to the\n    \/\/ default container's queue to execute it.\n    operation.qualityOfService = .userInitiated\n    CKContainer.default().add(operation)\n}",
      "language" : "swift"
    }
  ],
  "conformsTo" : [
    "CVarArg",
    "CustomDebugStringConvertible",
    "CustomStringConvertible",
    "Equatable",
    "Hashable",
    "NSObjectProtocol",
    "Sendable",
    "SendableMetatype"
  ],
  "contentHash" : "ff46ea8398763b59c3462aa12dfc4d0de350262a75ca4c98b28401bd63b8c9ec",
  "crawledAt" : "2025-12-04T10:03:05Z",
  "declaration" : {
    "code" : "class CKDiscoverAllUserIdentitiesOperation",
    "language" : "swift"
  },
  "id" : "00DEE7DC-C274-407D-9943-9534BDC6393B",
  "kind" : "class",
  "language" : "swift",
  "module" : "CloudKit",
  "overview" : "## Overview\n\nUse this operation to discover iCloud users that match entries in the device’s Contacts database. CloudKit uses the email addresses and phone numbers in each Contact record to search for a matching iCloud account.\n\nAlthough your app doesn’t need authorization to use the Contacts database to execute this operation, if it has authorization, you can use the [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKUserIdentity\/contactIdentifiers] property on any returned user identity to fetch the corresponding Contact record from the database.\n\nBefore CloudKit can return a user’s identity, you must ask for their permission by calling [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKContainer\/requestApplicationPermission(_:completionHandler:)]. Do this as part of any onboarding where you can highlight the benefits of being discoverable within the context of your app.\n\nThe operation executes the handlers you provide on an internal queue it manages. Your handlers must be capable of executing on a background queue. Tasks that need access to the main queue must redirect as appropriate.\n\nThe operation calls [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKDiscoverAllUserIdentitiesOperation\/discoverAllUserIdentitiesCompletionBlock] after it executes and returns results. Use the completion handler to perform housekeeping tasks for the operation. It should also manage any failures, whether due to an error or an explicit cancellation.\n\nCloudKit operations have a default QoS of [doc:\/\/com.apple.documentation\/documentation\/Foundation\/QualityOfService\/default]. Operations with this service level are discretionary. The system schedules their execution at an optimal time according to battery level and network conditions, among other factors. Use the [doc:\/\/com.apple.documentation\/documentation\/Foundation\/Operation\/qualityOfService] property to set a more appropriate QoS for the operation.\n\nThe following example shows how to create the operation, configure its callbacks, and execute it using the default container’s queue:",
  "platforms" : [
    "iOS",
    "iPadOS",
    "Mac Catalyst",
    "macOS",
    "visionOS",
    "watchOS"
  ],
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/CloudKit\/CKDiscoverAllUserIdentitiesOperation\ncrawled: 2025-12-04T10:03:05Z\n---\n\n# CKDiscoverAllUserIdentitiesOperation\n\n**Class**\n\nAn operation that uses the device’s contacts to search for discoverable iCloud users.\n\n## Declaration\n\n```swift\nclass CKDiscoverAllUserIdentitiesOperation\n```\n\n## Overview\n\nUse this operation to discover iCloud users that match entries in the device’s Contacts database. CloudKit uses the email addresses and phone numbers in each Contact record to search for a matching iCloud account.\n\nAlthough your app doesn’t need authorization to use the Contacts database to execute this operation, if it has authorization, you can use the [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKUserIdentity\/contactIdentifiers] property on any returned user identity to fetch the corresponding Contact record from the database.\n\n\n\nBefore CloudKit can return a user’s identity, you must ask for their permission by calling [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKContainer\/requestApplicationPermission(_:completionHandler:)]. Do this as part of any onboarding where you can highlight the benefits of being discoverable within the context of your app.\n\nThe operation executes the handlers you provide on an internal queue it manages. Your handlers must be capable of executing on a background queue. Tasks that need access to the main queue must redirect as appropriate.\n\nThe operation calls [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKDiscoverAllUserIdentitiesOperation\/discoverAllUserIdentitiesCompletionBlock] after it executes and returns results. Use the completion handler to perform housekeeping tasks for the operation. It should also manage any failures, whether due to an error or an explicit cancellation.\n\n\n\nCloudKit operations have a default QoS of [doc:\/\/com.apple.documentation\/documentation\/Foundation\/QualityOfService\/default]. Operations with this service level are discretionary. The system schedules their execution at an optimal time according to battery level and network conditions, among other factors. Use the [doc:\/\/com.apple.documentation\/documentation\/Foundation\/Operation\/qualityOfService] property to set a more appropriate QoS for the operation.\n\nThe following example shows how to create the operation, configure its callbacks, and execute it using the default container’s queue:\n\n```swift\nfunc fetchUserIdentities(\n    completion: @escaping (Result<[CKUserIdentity], Error>) -> Void) {\n        \n    var identities = [CKUserIdentity]()\n    \n    \/\/ Create an operation to discover all the iCloud users\n    \/\/ in the user's Contacts database that use the app, and\n    \/\/ opt in to being discoverable.\n    let operation = CKDiscoverAllUserIdentitiesOperation()\n    \n    \/\/ Cache the user identities as CloudKit discovers them.  \n    operation.userIdentityDiscoveredBlock = { userIdentity in\n        identities.append(userIdentity)\n    }\n    \n    \/\/ If the operation fails, return the error to the caller.\n    \/\/ Otherwise, return the array of discovered user identities.\n    operation.discoverAllUserIdentitiesCompletionBlock = { error in\n        if let error = error {\n            completion(.failure(error))\n        } else {\n            completion(.success(identities))\n        }\n    }\n    \n    \/\/ Set an appropriate QoS and add the operation to the\n    \/\/ default container's queue to execute it.\n    operation.qualityOfService = .userInitiated\n    CKContainer.default().add(operation)\n}\n```\n\n## Creating an Operation\n\n- **init()**: Creates an operation for searching the device’s contacts.\n\n## Processing the Operation Results\n\n- **userIdentityDiscoveredBlock**: The closure to execute for each user identity.\n- **discoverAllUserIdentitiesCompletionBlock**: The closure to execute when the operation finishes.\n\n## Instance Properties\n\n- **discoverAllUserIdentitiesResultBlock**\n\n## Deprecated classes\n\n- **CKDiscoverUserIdentitiesOperation**: An operation that uses the provided criteria to search for discoverable iCloud users.\n- **CKFetchRecordChangesOperation**: An operation that reports on the changed and deleted records in the specified record zone.\n\n## Inherits From\n\n- CKOperation\n\n## Conforms To\n\n- CVarArg\n- CustomDebugStringConvertible\n- CustomStringConvertible\n- Equatable\n- Hashable\n- NSObjectProtocol\n- Sendable\n- SendableMetatype\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Creates an operation for searching the device’s contacts.",
          "name" : "init()",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKDiscoverAllUserIdentitiesOperation\/init()"
        }
      ],
      "title" : "Creating an Operation"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "The closure to execute for each user identity.",
          "name" : "userIdentityDiscoveredBlock",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKDiscoverAllUserIdentitiesOperation\/userIdentityDiscoveredBlock"
        },
        {
          "description" : "The closure to execute when the operation finishes.",
          "name" : "discoverAllUserIdentitiesCompletionBlock",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKDiscoverAllUserIdentitiesOperation\/discoverAllUserIdentitiesCompletionBlock"
        }
      ],
      "title" : "Processing the Operation Results"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "",
          "name" : "discoverAllUserIdentitiesResultBlock",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKDiscoverAllUserIdentitiesOperation\/discoverAllUserIdentitiesResultBlock"
        }
      ],
      "title" : "Instance Properties"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "An operation that uses the provided criteria to search for discoverable iCloud users.",
          "name" : "CKDiscoverUserIdentitiesOperation",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKDiscoverUserIdentitiesOperation"
        },
        {
          "description" : "An operation that reports on the changed and deleted records in the specified record zone.",
          "name" : "CKFetchRecordChangesOperation",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKFetchRecordChangesOperation"
        }
      ],
      "title" : "Deprecated classes"
    },
    {
      "content" : "",
      "items" : [
        {
          "name" : "CKOperation"
        }
      ],
      "title" : "Inherits From"
    }
  ],
  "source" : "appleJSON",
  "title" : "CKDiscoverAllUserIdentitiesOperation",
  "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKDiscoverAllUserIdentitiesOperation"
}