{
  "abstract" : "Define and update your schema with the CloudKit Schema Language.",
  "codeExamples" : [
    {
      "code" : "create-schema:\n    DEFINE SCHEMA \n        [ { create-role | record-type } \";\" ] ...\n\ncreate-role:\n    CREATE ROLE %role-name% \n    \nrecord-type:\n    RECORD TYPE %type-name% ( \n        {\n            [ %field-name% data-type [ field-options [..] ] ]\n            |\n            [ GRANT { READ | CREATE | WRITE } [, ... ] TO %role-name% ]\n        } [\",\" ... ]\n    )    \n\nfield-options:\n    | QUERYABLE\n    | SORTABLE\n    | SEARCHABLE\n\ndata-type:\n   primitive-type | list-type\n\nprimitive-type:\n   | ASSET\n   | BYTES\n   | DOUBLE\n   | [ ENCRYPTED ] { BYTES | STRING | DOUBLE | INT64 | LOCATION | TIMESTAMP }\n   | INT64\n   | LOCATION \n   | NUMBER [ PREFERRED AS { INT64 | DOUBLE } ]\n   | REFERENCE\n   | STRING\n   | TIMESTAMP\n   \nlist-type:\n   | LIST \"<\" primitive-type \">\"\n\n",
      "language" : "other"
    },
    {
      "code" : "\/\/ Single-line comment\n-- Single-line comment\n\/* \nMulti-line comment\n*\/",
      "language" : "other"
    },
    {
      "code" : "RECORD TYPE ApplicationType  (\n        \"___createTime\" TIMESTAMP QUERYABLE,\n        name STRING,\n        ...\n)",
      "language" : "other"
    },
    {
      "code" : "RECORD TYPE ApplicationType  (\n        name STRING,\n        ...\n)",
      "language" : "other"
    },
    {
      "code" : "GRANT WRITE TO \"_creator\"\nGRANT CREATE TO \"_icloud\"\nGRANT READ TO \"_world\"",
      "language" : "other"
    },
    {
      "code" : "DEFINE SCHEMA\n    CREATE ROLE DeptManager;\n\n    RECORD TYPE Department (\n        \"___createTime\" TIMESTAMP QUERYABLE SORTABLE,\n        \"___recordID\" REFERENCE QUERYABLE,\n        name STRING,\n        address STRING,\n        phone LIST<STRING>,\n        employees LIST<REFERENCE>,\n        GRANT WRITE TO \"_creator\", \n        GRANT CREATE TO \"_icloud\",\n        GRANT READ TO \"_world\",\n        GRANT WRITE, CREATE, READ TO DeptManager\n    );\n\n    RECORD TYPE Employee (\n        \"___createTime\" TIMESTAMP QUERYABLE SORTABLE,\n        \"___recordID\" REFERENCE QUERYABLE,\n        name STRING,\n        address STRING,\n        hiredate TIMESTAMP,\n        salary INT64,\n        GRANT WRITE TO \"_creator\", \n        GRANT CREATE TO \"_icloud\",\n        GRANT READ TO \"_world\"\n    );",
      "language" : "other"
    }
  ],
  "contentHash" : "848a33dad3144cb9f84cea1f929ff47a8ca8d061588960edbb2d6ba3be0d0e87",
  "crawledAt" : "2025-12-03T09:42:59Z",
  "id" : "C3EA237B-660D-4AB8-B608-28BED2A10098",
  "kind" : "article",
  "language" : "swift",
  "module" : "CloudKit",
  "overview" : "## Overview\n\nCloudKit’s textual representation enables you to simultaneously manage your schema and the application source code that depends on it. The CloudKit command line tools download, verify, and install a schema to your container’s sandbox environment, while the CloudKit dashboard promotes a schema to the production environment.\n\nWhen publishing a schema, CloudKit attempts to apply changes to the existing schema, if one exists, to convert it to the form specifed in the new schema. If the modifications required would result in potential data loss with respect to the current production schema (like removing a record type or field name that exists already), then the schema isn’t valid and CloudKit makes no changes.\n\nFor containers with an existing schema, use the CloudKit command line tools to download the container’s schema. Manually constructing your existing schema by hand isn’t recommended, as any mistakes may result in your existing sandbox data becoming inaccessible. A good practice is to integrate the schema into your source code repository.\n\n### Learn the CloudKit Schema Language Grammar\n\nThe grammar for the CloudKit Schema Language contains all the elements to define your schema. Use the grammar to create roles, declare record types and their permissions, as well as specify data types and options for each field in the record.\n\nAdditional details and guidelines for creating roles, record types, type names, field names, data types and permissions are listed below.\n\n`QUERYABLE` - Maintains an index to optimize equality lookups on the field.\n\n`SORTABLE` - Maintains an index optimizing for range searches on the field.\n\n`SEARCHABLE` - Maintains a text search index on the field.\n\nAvoid using the `NUMBER` type, which is only for when a field is implicitly added to a schema by a record modification on a sandbox container. If such a field has been implicitly added to a type in your schema, the `PREFERRED AS` syntax allows you to explicitly indicate which type the `NUMBER` should be treated as (`INT64` or `DOUBLE`). Once you assign `NUMBER` as a `PREFERRED AS` type, future definitions must not change that type.\n\nThe grammar uses these conventions:\n\nIdentifiers must follow existing CloudKit naming conventions and restrictions. User-defined identifiers must follow these rules:\n\nAlso, CloudKit reserves identifiers starting with a leading underscore as system-defined identifiers. For example, all record types have an implicitly defined `___recordID` field. Use double quotes when referring to such system fields as well.\n\nThe language allows comments in these forms:\n\nCloudKit doesn’t preserve the comments in your schema when you upload them to CloudKit. Additionally, when you retreive the schema, the order of the elements may differ from the order when the schema was created or updated.\n\n### Recognize Implicit Fields and Roles\n\nAll record types have the following implicitly defined fields:\n\nThese field names are always present within the record time so it’s not necessary to explicitly provide them. If you wish to make any of these fields queryable, sortable, or searchable, then your type must explicitly specify the field and the attribute. You can’t change the type of these system fields.\n\nThough CloudKit won’t remove the system field names, it doesn’t maintain the field options if the field isn’t mentioned in later schema updates. For example, if the following is in your schema:\n\nThen CloudKit builds an index for efficient searches on the record creation time field. Later, if you modify the schema to no longer mention the creation time field:\n\nThen the `__createTime` field remains on the record type (since it’s a required system field), but CloudKit drops the index on the field, and the user query performance may degrade or fail as a result.\n\nAdditionally, all record types have these implicitly defined roles:\n\nFor types that you wish to use in a `PUBLIC` database, include the following grants:\n\n### View an Example Schema\n\nThis sample schema defines a simple company department and employee information. It demonstrates extending the attributes of system fields and the double quotes necessary for referring to system identifiers.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/cloudkit\/integrating-a-text-based-schema-into-your-workflow\ncrawled: 2025-12-03T09:42:59Z\n---\n\n# Integrating a Text-Based Schema into Your Workflow\n\n**Article**\n\nDefine and update your schema with the CloudKit Schema Language.\n\n## Overview\n\nCloudKit’s textual representation enables you to simultaneously manage your schema and the application source code that depends on it. The CloudKit command line tools download, verify, and install a schema to your container’s sandbox environment, while the CloudKit dashboard promotes a schema to the production environment.\n\nWhen publishing a schema, CloudKit attempts to apply changes to the existing schema, if one exists, to convert it to the form specifed in the new schema. If the modifications required would result in potential data loss with respect to the current production schema (like removing a record type or field name that exists already), then the schema isn’t valid and CloudKit makes no changes.\n\nFor containers with an existing schema, use the CloudKit command line tools to download the container’s schema. Manually constructing your existing schema by hand isn’t recommended, as any mistakes may result in your existing sandbox data becoming inaccessible. A good practice is to integrate the schema into your source code repository.\n\n### Learn the CloudKit Schema Language Grammar\n\nThe grammar for the CloudKit Schema Language contains all the elements to define your schema. Use the grammar to create roles, declare record types and their permissions, as well as specify data types and options for each field in the record.\n\n```other\ncreate-schema:\n    DEFINE SCHEMA \n        [ { create-role | record-type } \";\" ] ...\n\ncreate-role:\n    CREATE ROLE %role-name% \n    \nrecord-type:\n    RECORD TYPE %type-name% ( \n        {\n            [ %field-name% data-type [ field-options [..] ] ]\n            |\n            [ GRANT { READ | CREATE | WRITE } [, ... ] TO %role-name% ]\n        } [\",\" ... ]\n    )    \n\nfield-options:\n    | QUERYABLE\n    | SORTABLE\n    | SEARCHABLE\n\ndata-type:\n   primitive-type | list-type\n\nprimitive-type:\n   | ASSET\n   | BYTES\n   | DOUBLE\n   | [ ENCRYPTED ] { BYTES | STRING | DOUBLE | INT64 | LOCATION | TIMESTAMP }\n   | INT64\n   | LOCATION \n   | NUMBER [ PREFERRED AS { INT64 | DOUBLE } ]\n   | REFERENCE\n   | STRING\n   | TIMESTAMP\n   \nlist-type:\n   | LIST \"<\" primitive-type \">\"\n\n\n```\n\nAdditional details and guidelines for creating roles, record types, type names, field names, data types and permissions are listed below.\n\n\n\n`QUERYABLE` - Maintains an index to optimize equality lookups on the field.\n\n`SORTABLE` - Maintains an index optimizing for range searches on the field.\n\n`SEARCHABLE` - Maintains a text search index on the field.\n\n\n\nAvoid using the `NUMBER` type, which is only for when a field is implicitly added to a schema by a record modification on a sandbox container. If such a field has been implicitly added to a type in your schema, the `PREFERRED AS` syntax allows you to explicitly indicate which type the `NUMBER` should be treated as (`INT64` or `DOUBLE`). Once you assign `NUMBER` as a `PREFERRED AS` type, future definitions must not change that type.\n\n\n\nThe grammar uses these conventions:\n\n- Brackets indicate optional parts.\n- Braces and vertical bars indicate that you must choose one alternative.\n- An ellipsis indicates that the preceding element can be repeated.\n- Names surrounded by percent signs indicate identifiers.\n\nIdentifiers must follow existing CloudKit naming conventions and restrictions. User-defined identifiers must follow these rules:\n\n- The first character must be one of `a-z` or `A-Z`.\n- Subsequent characters must be one of `a-z`, `A-Z`, `0-9`, or `_` (underscore).\n- Use double quotes around identifiers to include keywords and reserved words in the syntax definition. For example, to create a type called *grant*, define it as “grant”. The reserved words in the CloudKit Schema Language are: grant, preferred, queryable, sortable, and searchable.\n\nAlso, CloudKit reserves identifiers starting with a leading underscore as system-defined identifiers. For example, all record types have an implicitly defined `___recordID` field. Use double quotes when referring to such system fields as well.\n\nThe language allows comments in these forms:\n\n```other\n\/\/ Single-line comment\n-- Single-line comment\n\/* \nMulti-line comment\n*\/\n```\n\nCloudKit doesn’t preserve the comments in your schema when you upload them to CloudKit. Additionally, when you retreive the schema, the order of the elements may differ from the order when the schema was created or updated.\n\n### Recognize Implicit Fields and Roles\n\nAll record types have the following implicitly defined fields:\n\n- `“___createTime” TIMESTAMP`\n- `”___createdBy” REFERENCE`\n- `”___etag” STRING`\n- `”___modTime” TIMESTAMP`\n- `”___modifiedBy” REFERENCE`\n- `”___recordID” REFERENCE`\n\nThese field names are always present within the record time so it’s not necessary to explicitly provide them. If you wish to make any of these fields queryable, sortable, or searchable, then your type must explicitly specify the field and the attribute. You can’t change the type of these system fields.\n\nThough CloudKit won’t remove the system field names, it doesn’t maintain the field options if the field isn’t mentioned in later schema updates. For example, if the following is in your schema:\n\n```other\nRECORD TYPE ApplicationType  (\n        \"___createTime\" TIMESTAMP QUERYABLE,\n        name STRING,\n        ...\n)\n```\n\nThen CloudKit builds an index for efficient searches on the record creation time field. Later, if you modify the schema to no longer mention the creation time field:\n\n```other\nRECORD TYPE ApplicationType  (\n        name STRING,\n        ...\n)\n```\n\nThen the `__createTime` field remains on the record type (since it’s a required system field), but CloudKit drops the index on the field, and the user query performance may degrade or fail as a result.\n\nAdditionally, all record types have these implicitly defined roles:\n\n\n\nFor types that you wish to use in a `PUBLIC` database, include the following grants:\n\n```other\nGRANT WRITE TO \"_creator\"\nGRANT CREATE TO \"_icloud\"\nGRANT READ TO \"_world\"\n```\n\n### View an Example Schema\n\nThis sample schema defines a simple company department and employee information. It demonstrates extending the attributes of system fields and the double quotes necessary for referring to system identifiers.\n\n```other\nDEFINE SCHEMA\n    CREATE ROLE DeptManager;\n\n    RECORD TYPE Department (\n        \"___createTime\" TIMESTAMP QUERYABLE SORTABLE,\n        \"___recordID\" REFERENCE QUERYABLE,\n        name STRING,\n        address STRING,\n        phone LIST<STRING>,\n        employees LIST<REFERENCE>,\n        GRANT WRITE TO \"_creator\", \n        GRANT CREATE TO \"_icloud\",\n        GRANT READ TO \"_world\",\n        GRANT WRITE, CREATE, READ TO DeptManager\n    );\n\n    RECORD TYPE Employee (\n        \"___createTime\" TIMESTAMP QUERYABLE SORTABLE,\n        \"___recordID\" REFERENCE QUERYABLE,\n        name STRING,\n        address STRING,\n        hiredate TIMESTAMP,\n        salary INT64,\n        GRANT WRITE TO \"_creator\", \n        GRANT CREATE TO \"_icloud\",\n        GRANT READ TO \"_world\"\n    );\n```\n\n## Schemas\n\n- **Designing and Creating a CloudKit Database**: Create a schema to store your app’s objects as records in iCloud using CloudKit.\n- **Managing iCloud Containers with CloudKit Database App**: Inspect and modify the schema and data for your app’s iCloud container.\n- **CKRecordZone**: A database partition that contains related records.\n- **CKRecord**: A collection of key-value pairs that store your app’s data.\n- **CKRecord.Reference**: A relationship between two records in a record zone.\n- **CKAsset**: An external file that belongs to a record.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Create a schema to store your app’s objects as records in iCloud using CloudKit.",
          "name" : "Designing and Creating a CloudKit Database",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/designing-and-creating-a-cloudkit-database"
        },
        {
          "description" : "Inspect and modify the schema and data for your app’s iCloud container.",
          "name" : "Managing iCloud Containers with CloudKit Database App",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/managing-icloud-containers-with-cloudkit-database-app"
        },
        {
          "description" : "A database partition that contains related records.",
          "name" : "CKRecordZone",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKRecordZone"
        },
        {
          "description" : "A collection of key-value pairs that store your app’s data.",
          "name" : "CKRecord",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKRecord"
        },
        {
          "description" : "A relationship between two records in a record zone.",
          "name" : "CKRecord.Reference",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKRecord\/Reference"
        },
        {
          "description" : "An external file that belongs to a record.",
          "name" : "CKAsset",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKAsset"
        }
      ],
      "title" : "Schemas"
    }
  ],
  "source" : "appleJSON",
  "title" : "Integrating a Text-Based Schema into Your Workflow",
  "url" : "https:\/\/developer.apple.com\/documentation\/cloudkit\/integrating-a-text-based-schema-into-your-workflow"
}