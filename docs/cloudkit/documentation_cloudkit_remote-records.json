{
  "abstract" : "Use subscriptions and change tokens to efficiently manage modifications to remote records.",
  "codeExamples" : [
    {
      "code" : "func storeCloudRecord(_ record: CKRecord, on product: Product) {\n    \n    \/\/ Encode the record's metadata.\n    let coder = NSKeyedArchiver(requiringSecureCoding: true)\n    record.encodeSystemFields(with: coder)\n    \n    \/\/ Attach the encoded metadata to the \n    \/\/ model object so you can store it in\n    \/\/ your local cache.\n    product.recordMetadata = coder.encodedData\n}\n    \nfunc extractCloudRecord(from product: Product) throws -> CKRecord? {\n    guard let metadata = product.recordMetadata else { return nil }\n    \n    \/\/ Create an unarchiver from the record's stored metadata\n    \/\/ and use it to create an instance of CKRecord.\n    let coder = try NSKeyedUnarchiver(forReadingFrom: metadata)\n    let record = CKRecord(coder: coder)\n    coder.finishDecoding()\n\n    \/\/ Return the record to the caller, which can update its \n    \/\/ fields using the product's properties before saving\n    \/\/ it to iCloud.\n    return record\n}",
      "language" : "swift"
    }
  ],
  "contentHash" : "c00a8e3e3807c68fd5780a1f5d93c308818a17721df0867ca6ec5046598223bf",
  "crawledAt" : "2025-12-03T05:05:30Z",
  "id" : "6A05B2C2-C0D9-4945-AF6F-984C3C8DDC49",
  "kind" : "collection",
  "language" : "swift",
  "module" : "CloudKit",
  "overview" : "## Overview\n\nCloudKit stores your records in iCloud and uses subscriptions to notify your app in real time about record changes. You then use change tokens to handle these changes efficiently. Additionally, you can improve your app’s performance and support offline use by storing records in a local cache.\n\n\n\nWhen your app launches for the first time on a new device, use [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKFetchDatabaseChangesOperation] and [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKFetchRecordZoneChangesOperation] to fetch any records you need to populate your cache. Each operation expects a change token, which is an opaque token that represents a specific point in the database’s history. For the initial fetch, pass `nil` as the token to retrieve all changes in the database’s history. When the operation completes, save its change token so you can use it with your next fetch. Change tokens help reduce the amount of data CloudKit returns.\n\nAfter you fetch the records, subscribe to future changes. Subscriptions run in iCloud and listen for record changes, such as record creation, modification, and deletion. Create subscriptions, as necessary, in the public database, and the user’s private and shared databases. A subscription responds to changes to a database, to a custom record zone, or to records that match a specific set of criteria. You can further scope subscriptions to an individual record type.\n\nWhen the user modifies records on their device, save those changes to iCloud. In response, a subscription generates push notifications using the configuration you provide, and iCloud sends them to the user’s other devices. On receipt of a notification, fetch the changes from iCloud and update your cache. Use the change token from the previous fetch to limit the fetched records. Overwrite the token with the new one the fetch operation provides when it completes.\n\nEvery subscription type has a corresponding notification object that you can configure to meet your app’s needs. CloudKit supports high-priority visual notifications and medium-priority background notifications. A notification can include a limited number of fields from the changed record. You opt in to this behavior. For more information, see [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKSubscription\/NotificationInfo-swift.class\/desiredKeys].\n\nBecause the system coalesces notifications, don’t rely on them for specific changes. Consider notifications an indication of remote changes, and use the fetch operations to reliably retrieve all changes that occur after your most recent fetch.\n\nCloudKit supports the following subscription types:\n\n### Integrate Records with Your Existing Models\n\nIf you already cache your app’s model objects, you don’t need to cache CloudKit records in tandem. Instead, attach a record’s metadata to a model to associate the two. The metadata includes the record’s ID, record type, record zone ID, and change tag, as well as other information.\n\nWhen you fetch a record from iCloud, update the local model object using the record’s fields. Then encode the record’s metadata, attach it to the model, and save the model to the cache. To update a record in iCloud, decode the model’s metadata and use it to create an instance of [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKRecord]. Set the record’s fields to the model’s values and save it to iCloud.\n\nThe following example shows how to encode a record’s metadata and store it on a custom `Product` model. It also shows how to decode the metadata and use it to create an instance of [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKRecord].",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/CloudKit\/remote-records\ncrawled: 2025-12-03T05:05:30Z\n---\n\n# Remote Records\n\n**API Collection**\n\nUse subscriptions and change tokens to efficiently manage modifications to remote records.\n\n## Overview\n\nCloudKit stores your records in iCloud and uses subscriptions to notify your app in real time about record changes. You then use change tokens to handle these changes efficiently. Additionally, you can improve your app’s performance and support offline use by storing records in a local cache.\n\n\n\nWhen your app launches for the first time on a new device, use [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKFetchDatabaseChangesOperation] and [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKFetchRecordZoneChangesOperation] to fetch any records you need to populate your cache. Each operation expects a change token, which is an opaque token that represents a specific point in the database’s history. For the initial fetch, pass `nil` as the token to retrieve all changes in the database’s history. When the operation completes, save its change token so you can use it with your next fetch. Change tokens help reduce the amount of data CloudKit returns.\n\nAfter you fetch the records, subscribe to future changes. Subscriptions run in iCloud and listen for record changes, such as record creation, modification, and deletion. Create subscriptions, as necessary, in the public database, and the user’s private and shared databases. A subscription responds to changes to a database, to a custom record zone, or to records that match a specific set of criteria. You can further scope subscriptions to an individual record type.\n\nWhen the user modifies records on their device, save those changes to iCloud. In response, a subscription generates push notifications using the configuration you provide, and iCloud sends them to the user’s other devices. On receipt of a notification, fetch the changes from iCloud and update your cache. Use the change token from the previous fetch to limit the fetched records. Overwrite the token with the new one the fetch operation provides when it completes.\n\n\n\nEvery subscription type has a corresponding notification object that you can configure to meet your app’s needs. CloudKit supports high-priority visual notifications and medium-priority background notifications. A notification can include a limited number of fields from the changed record. You opt in to this behavior. For more information, see [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKSubscription\/NotificationInfo-swift.class\/desiredKeys].\n\nBecause the system coalesces notifications, don’t rely on them for specific changes. Consider notifications an indication of remote changes, and use the fetch operations to reliably retrieve all changes that occur after your most recent fetch.\n\nCloudKit supports the following subscription types:\n\n\n\n### Integrate Records with Your Existing Models\n\nIf you already cache your app’s model objects, you don’t need to cache CloudKit records in tandem. Instead, attach a record’s metadata to a model to associate the two. The metadata includes the record’s ID, record type, record zone ID, and change tag, as well as other information.\n\nWhen you fetch a record from iCloud, update the local model object using the record’s fields. Then encode the record’s metadata, attach it to the model, and save the model to the cache. To update a record in iCloud, decode the model’s metadata and use it to create an instance of [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKRecord]. Set the record’s fields to the model’s values and save it to iCloud.\n\nThe following example shows how to encode a record’s metadata and store it on a custom `Product` model. It also shows how to decode the metadata and use it to create an instance of [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKRecord].\n\n```swift\nfunc storeCloudRecord(_ record: CKRecord, on product: Product) {\n    \n    \/\/ Encode the record's metadata.\n    let coder = NSKeyedArchiver(requiringSecureCoding: true)\n    record.encodeSystemFields(with: coder)\n    \n    \/\/ Attach the encoded metadata to the \n    \/\/ model object so you can store it in\n    \/\/ your local cache.\n    product.recordMetadata = coder.encodedData\n}\n    \nfunc extractCloudRecord(from product: Product) throws -> CKRecord? {\n    guard let metadata = product.recordMetadata else { return nil }\n    \n    \/\/ Create an unarchiver from the record's stored metadata\n    \/\/ and use it to create an instance of CKRecord.\n    let coder = try NSKeyedUnarchiver(forReadingFrom: metadata)\n    let record = CKRecord(coder: coder)\n    coder.finishDecoding()\n\n    \/\/ Return the record to the caller, which can update its \n    \/\/ fields using the product's properties before saving\n    \/\/ it to iCloud.\n    return record\n}\n```\n\n## Database Changes\n\n- **CKDatabaseSubscription**: A subscription that generates push notifications when CloudKit modifies records in a database.\n- **CKDatabaseNotification**: A notification that triggers when the contents of a database change.\n- **CKFetchDatabaseChangesOperation**: An operation that fetches database changes.\n\n## Record Zone Changes\n\n- **CKRecordZoneSubscription**: A subscription that generates push notifications when CloudKit modifies records in a specific record zone.\n- **CKRecordZoneNotification**: A notification that triggers when the contents of a record zone change.\n- **CKFetchRecordZoneChangesOperation**: An operation that fetches record zone changes.\n\n## Change Tokens\n\n- **CKServerChangeToken**: An opaque token that represents a specific point in a database’s history.\n\n## Subscription Management\n\n- **CKFetchSubscriptionsOperation**: An operation for fetching subscriptions.\n- **CKModifySubscriptionsOperation**: An operation for modifying one or more subscriptions.\n\n## Predicate-Driven Changes\n\n- **CKQuerySubscription**: A subscription that generates push notifications when CloudKit modifies records that match a predicate.\n- **CKQueryNotification**: A notification that triggers when a record that matches the subscription’s predicate changes.\n\n## Base Objects\n\n- **CKSubscription**: An abstract base class for subscriptions.\n- **CKNotification**: The abstract base class for CloudKit notifications.\n- **CKDatabaseOperation**: The abstract base class for operations that act upon databases in CloudKit.\n\n## Records\n\n- **Local Records**: Manipulate records on-device and save changes to the server.\n- **CKSyncEngine**: An object that manages the synchronization of local and remote record data.\n- **Shared Records**: Share one or more records with other iCloud users.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "A subscription that generates push notifications when CloudKit modifies records in a database.",
          "name" : "CKDatabaseSubscription",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKDatabaseSubscription"
        },
        {
          "description" : "A notification that triggers when the contents of a database change.",
          "name" : "CKDatabaseNotification",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKDatabaseNotification"
        },
        {
          "description" : "An operation that fetches database changes.",
          "name" : "CKFetchDatabaseChangesOperation",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKFetchDatabaseChangesOperation"
        }
      ],
      "title" : "Database Changes"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "A subscription that generates push notifications when CloudKit modifies records in a specific record zone.",
          "name" : "CKRecordZoneSubscription",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKRecordZoneSubscription"
        },
        {
          "description" : "A notification that triggers when the contents of a record zone change.",
          "name" : "CKRecordZoneNotification",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKRecordZoneNotification"
        },
        {
          "description" : "An operation that fetches record zone changes.",
          "name" : "CKFetchRecordZoneChangesOperation",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKFetchRecordZoneChangesOperation"
        }
      ],
      "title" : "Record Zone Changes"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "An opaque token that represents a specific point in a database’s history.",
          "name" : "CKServerChangeToken",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKServerChangeToken"
        }
      ],
      "title" : "Change Tokens"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "An operation for fetching subscriptions.",
          "name" : "CKFetchSubscriptionsOperation",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKFetchSubscriptionsOperation"
        },
        {
          "description" : "An operation for modifying one or more subscriptions.",
          "name" : "CKModifySubscriptionsOperation",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKModifySubscriptionsOperation"
        }
      ],
      "title" : "Subscription Management"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "A subscription that generates push notifications when CloudKit modifies records that match a predicate.",
          "name" : "CKQuerySubscription",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKQuerySubscription"
        },
        {
          "description" : "A notification that triggers when a record that matches the subscription’s predicate changes.",
          "name" : "CKQueryNotification",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKQueryNotification"
        }
      ],
      "title" : "Predicate-Driven Changes"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "An abstract base class for subscriptions.",
          "name" : "CKSubscription",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKSubscription"
        },
        {
          "description" : "The abstract base class for CloudKit notifications.",
          "name" : "CKNotification",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKNotification"
        },
        {
          "description" : "The abstract base class for operations that act upon databases in CloudKit.",
          "name" : "CKDatabaseOperation",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKDatabaseOperation"
        }
      ],
      "title" : "Base Objects"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "Manipulate records on-device and save changes to the server.",
          "name" : "Local Records",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/local-records"
        },
        {
          "description" : "An object that manages the synchronization of local and remote record data.",
          "name" : "CKSyncEngine",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKSyncEngine-5sie5"
        },
        {
          "description" : "Share one or more records with other iCloud users.",
          "name" : "Shared Records",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/shared-records"
        }
      ],
      "title" : "Records"
    }
  ],
  "source" : "appleJSON",
  "title" : "Remote Records",
  "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/remote-records"
}