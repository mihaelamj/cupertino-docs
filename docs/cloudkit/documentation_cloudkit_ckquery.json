{
  "abstract" : "A query that describes the criteria to apply when searching for records in a database.",
  "codeExamples" : [
    {
      "code" : "CKReference* recordToMatch = [[CKReference alloc] initWithRecordID:employeeID action:CKReferenceActionNone];\nNSPredicate* predicate = [NSPredicate predicateWithFormat:@\"employee == %@\", recordToMatch];",
      "language" : "objc"
    },
    {
      "code" : "NSPredicate predicate = nil;\npredicate = [NSPredicate predicateWithFormat:@\"ANY favoriteColors = 'red'\"];\npredicate = [NSPredicate predicateWithFormat:@\"favoriteColors CONTAINS 'red'\"];\npredicate = [NSPredicate predicateWithFormat:@\"'red' IN favoriteColors\"];\npredicate = [NSPredicate predicateWithFormat:@\"%K CONTAINS %@\", @\"favoriteColors\", @\"red\"];",
      "language" : "objc"
    },
    {
      "code" : "NSPredicate predicate = nil;\npredicate = [NSPredicate predicateWithFormat:@\"ANY { 'red', 'green' } = favoriteColor\"];\npredicate = [NSPredicate predicateWithFormat:@\"favoriteColor IN { 'red', 'green' }\"];",
      "language" : "objc"
    },
    {
      "code" : "NSString* matchString = @\"red\";\nNSPredicate predicate = nil;\npredicate = [NSPredicate predicateWithFormat:@\"ANY favoriteColors BEGINSWITH 'red'\"]\npredicate = [NSPredicate predicateWithFormat:@\"ANY favoriteColors BEGINSWITH %@\", matchString]",
      "language" : "objc"
    },
    {
      "code" : "NSPredicate predicate = nil;\npredicate = [NSPredicate predicateWithFormat:@\"self contains 'bob smith'\"];",
      "language" : "objc"
    },
    {
      "code" : "NSPredicate predicate = nil;\npredicate = [NSPredicate predicateWithFormat:@\"self contains 'bob' AND self contains __'__smith__'__\"];",
      "language" : "objc"
    },
    {
      "code" : "CLLocation* fixedLoc = [[CLLocation alloc] initWithLatitude:37.331913 longitude:-122.030210];\nCGFloat radius = 10; \/\/ kilometers\nNSPredicate predicate =\n   [NSPredicate predicateWithFormat:@\"distanceToLocation:fromLocation:(location, %@) < %f\", fixedLoc, radius]];",
      "language" : "objc"
    },
    {
      "code" : "NSPredicate predicate = nil;\npredicate = [NSPredicate predicateWithFormat:@\"TRUEPREDICATE\"];",
      "language" : "objc"
    }
  ],
  "conformsTo" : [
    "CVarArg",
    "CustomDebugStringConvertible",
    "CustomStringConvertible",
    "Equatable",
    "Hashable",
    "NSCoding",
    "NSCopying",
    "NSObjectProtocol",
    "NSSecureCoding",
    "Sendable",
    "SendableMetatype"
  ],
  "contentHash" : "953106da74608b964b4f667652b35c02078956fc08209acb141df93398fc086f",
  "crawledAt" : "2025-12-04T08:32:46Z",
  "declaration" : {
    "code" : "class CKQuery",
    "language" : "swift"
  },
  "id" : "C6CFB057-255A-4319-96B4-E9DB292911CB",
  "kind" : "class",
  "language" : "swift",
  "module" : "CloudKit",
  "overview" : "## Overview\n\nYou create a query as the first step in the search process. The query stores the search parameters, including the type of records to search, the match criteria (predicate) to apply, and the sort parameters to apply to the results. Then you use the query to initialize an instance of [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKQueryOperation], which you execute to generate the results.\n\nAlways designate a record type and predicate when you create a query object. The record type narrows the scope of the search to one type of record, and the predicate defines the conditions for matching records of that type. Predicates usually compare one or more fields of a record to constant values, but you can create predicates that return all records of a specific type or perform more nuanced searches.\n\nBecause you can’t change the record type and predicate after initialization, you can use the same query to initialize multiple instances of [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKQueryOperation], each of which targets a different database or record zone.\n\n### Building Your Predicates\n\nAn [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSPredicate] object defines the logical conditions for determining whether a record is a match for a query. Queries support only a subset of the predicate behaviors that the `NSPredicate` class offers.\n\n#### Predicate Rules for Query Objects\n\nThe predicates you create for your query objects must follow these rules:\n\n#### Supported Predicate Operators\n\nThe following table lists the operators you can use in predicates for a query.\n\nSpecifying an unsupported operator or data type in your query’s predicate results in an error when you execute the query. For more information about creating predicate objects, see [https:\/\/developer.apple.com\/library\/archive\/documentation\/Cocoa\/Conceptual\/Predicates\/AdditionalChapters\/Introduction.html#\/\/apple_ref\/doc\/uid\/TP40001789].\n\n#### Sample Predicate Format Strings\n\nTo match records that link to a different record with an ID you know, create a predicate that matches a field that contains a reference as Listing 1 shows. In the example, the `employee` field of the record contains a [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKRecord\/Reference] object that points to another record. When the query executes, a match occurs when the ID in the locally created [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKRecord\/Reference] object is the same ID as in the specified field of the record.\n\nListing 1. Matching the ID of a record\n\nTo match the contents of a field to a specific value, use a predicate similar to the ones in Listing 2. All of the listed predicates generate the same set of results, which in the example means that the `favoriteColors` field contains the value *red*. The value in the field must match the value you specify in the predicate exactly. String-based comparisons are case-insensitive, but otherwise, all comparisons must be an exact match of the specified value.\n\nListing 2. Matching a field to a specific value\n\nYou can match more than one value at a time by using a predicate similar to the ones in Listing 3. In the example, the predicates report a match if the value in the `favoriteColor` field of a record matches either of the values `red` or `green`.\n\nListing 3. Matching a field to one or more values\n\nFor fields that contain string values, you can match the beginning portion of the string using the `BEGINSWITH` operator as Listing 4 shows. You can’t use other string comparison operators, such as `CONTAINS` or `ENDSWITH`. When using this operator, the field must contain a string value and must start with the string you specify. Matches are case-sensitive. In the examples, the predicate matches records where the `favoriteColors` field contains the strings *red*, *reddish*, or *red*` `*green*` `*duct*` `*tape*.\n\nListing 4. Matching a field that starts with a string value\n\nTo perform a tokenized search of a record’s fields, use the special operator `self`. A tokenized search searches any fields where you enable full-text search, which is all string-based fields by default. CloudKit treats each distinct word in the tokenized string as a separate token for the purpose of searching. Comparisons are case- and diacritic-insensitive. These token strings can be in a single field or in multiple fields.\n\nListing 5 shows an example that searches the fields of a record for the token strings `bob` or `smith`:\n\nListing 5. Matching a field that contains one or more tokens\n\nTo search for multiple tokens present in the fields, use the `AND` predicate operator, as Listing 6 shows.\n\nListing 6. Matching a field that contains multiple tokens\n\nTo test whether two locations are near each other, create a predicate using the `distanceToLocation:fromLocation:` function as Listing 7 shows. Predicates that use this function must have the structure in the listing. In your code, replace the `location` variable with a field name from one of your records. This data type for the field must be a [doc:\/\/com.apple.documentation\/documentation\/CoreLocation\/CLLocation] object. Similarly, replace the `fixedLoc` and `radius` values with appropriate values from your app. The `fixedLoc` value is the geographic coordinate that marks the center of a circle with the specified radius. In this example, the predicate returns a match if the location in the record is within 10 kilometers of the specified latitude and longitude.\n\nListing 7. Matching by distance from a location\n\nTo retrieve all records of a specific type, use the `TRUEPREDICATE` expression as Listing 8 shows. A predicate with this operator always evaluates to `true` and, therefore, matches every record. When using such an operator, use a cursor to batch the results into smaller groups for processing.\n\nListing 8. Retrieving all records of a specific type\n\n### Indexes and Full-Text Search\n\nIndexes make it possible to search the contents of your records efficiently. During development, the server indexes all fields with data types it can use in the predicate of a query. This automatic indexing makes it easier to experiment with queries during development, but the indexes require space in a database and require time to generate and maintain. So when migrating to a production environment, remove the indexes for any fields that you don’t use in queries.\n\nFull-text search is another feature that is on by default for all fields during development. When you move to the production environment, disable full-text search for fields with content you don’t need to search. As with removing indexes, disabling full-text search improves the performance of your tokenized searches. To configure the indexing and full-text search options for fields in your schema, use CloudKit Dashboard.\n\nIn a full-text search, CloudKit ignores the following words if they appear in the token strings:\n\n### Executing a Search Using Your Query Object\n\nTo execute a query, do one of the following:\n\nQueries always run asynchronously and deliver results to a completion handler that you provide.",
  "platforms" : [
    "iOS",
    "iPadOS",
    "Mac Catalyst",
    "macOS",
    "tvOS",
    "visionOS",
    "watchOS"
  ],
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/CloudKit\/CKQuery\ncrawled: 2025-12-04T08:32:46Z\n---\n\n# CKQuery\n\n**Class**\n\nA query that describes the criteria to apply when searching for records in a database.\n\n## Declaration\n\n```swift\nclass CKQuery\n```\n\n## Overview\n\nYou create a query as the first step in the search process. The query stores the search parameters, including the type of records to search, the match criteria (predicate) to apply, and the sort parameters to apply to the results. Then you use the query to initialize an instance of [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKQueryOperation], which you execute to generate the results.\n\nAlways designate a record type and predicate when you create a query object. The record type narrows the scope of the search to one type of record, and the predicate defines the conditions for matching records of that type. Predicates usually compare one or more fields of a record to constant values, but you can create predicates that return all records of a specific type or perform more nuanced searches.\n\nBecause you can’t change the record type and predicate after initialization, you can use the same query to initialize multiple instances of [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKQueryOperation], each of which targets a different database or record zone.\n\n### Building Your Predicates\n\nAn [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSPredicate] object defines the logical conditions for determining whether a record is a match for a query. Queries support only a subset of the predicate behaviors that the `NSPredicate` class offers.\n\n#### Predicate Rules for Query Objects\n\nThe predicates you create for your query objects must follow these rules:\n\n- Predicates derive from a format string. You can’t use value or block-based predicates.\n- Predicates use only the operators in [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKQuery#Supported-Predicate-Operators].\n- Predicates operate only on fields that contain the following types of data:\n- [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSString]\n- [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSDate]\n- [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSNumber]\n- [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSArray]\n- [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKRecord\/Reference]\n- [doc:\/\/com.apple.documentation\/documentation\/CoreLocation\/CLLocation]\n- Key names in predicates correspond to fields in the currently evaluated record. Key names can include the names of the record’s metadata properties, such as `creationDate`, or any data fields you add to the record. You can’t use key paths to specify fields in related records.\n- Predicates support the following variable substitution strings:\n- Use `%@` for value objects, such as strings, numbers, and dates.\n- Use `%K` for the name of a field. This substitution variable indicates that the system uses the substitution string to look up a field name.\n- With one exception, the `CONTAINS` operator is only for testing list membership. The exception is when you use it to perform full-text searches in conjunction with the `self` key path. The `self` key path causes the server to look in searchable string-based fields for the specified token string. For example, a predicate string of `@\"self contains 'blue'\"` searches for the word *blue* in all fields that you mark for inclusion in full-text searches. You can’t use the `self` key path to search in fields with a type that isn’t a string.\n- You can combine the `ANY` and `SOME` aggregate operators with the `IN` and `CONTAINS` operators to perform list membership tests.\n- The `distanceToLocation:fromLocation:` operator function performs a radius-based location comparison and that comparison must determine whether the location value is inside the circular area you provide. You can’t use it to search for locations outside the specified circular area. Location indexes have a resolution of no less than 10 km.\n- CloudKit doesn’t support the `ALL` aggregate operator.\n- CloudKit doesn’t support the `NOT` compound operator in the following cases:\n- You can’t use it to negate an `AND` compound predicate.\n- You can’t use it in tokenized queries, such as `self CONTAINS 'value'`.\n- You can’t use it with the `distanceToLocation:fromLocation:` function.\n- You can’t use it in `BETWEEN` queries.\n\n#### Supported Predicate Operators\n\nThe following table lists the operators you can use in predicates for a query.\n\n\n\nSpecifying an unsupported operator or data type in your query’s predicate results in an error when you execute the query. For more information about creating predicate objects, see [https:\/\/developer.apple.com\/library\/archive\/documentation\/Cocoa\/Conceptual\/Predicates\/AdditionalChapters\/Introduction.html#\/\/apple_ref\/doc\/uid\/TP40001789].\n\n#### Sample Predicate Format Strings\n\nTo match records that link to a different record with an ID you know, create a predicate that matches a field that contains a reference as Listing 1 shows. In the example, the `employee` field of the record contains a [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKRecord\/Reference] object that points to another record. When the query executes, a match occurs when the ID in the locally created [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKRecord\/Reference] object is the same ID as in the specified field of the record.\n\nListing 1. Matching the ID of a record\n\n```objc\nCKReference* recordToMatch = [[CKReference alloc] initWithRecordID:employeeID action:CKReferenceActionNone];\nNSPredicate* predicate = [NSPredicate predicateWithFormat:@\"employee == %@\", recordToMatch];\n```\n\nTo match the contents of a field to a specific value, use a predicate similar to the ones in Listing 2. All of the listed predicates generate the same set of results, which in the example means that the `favoriteColors` field contains the value *red*. The value in the field must match the value you specify in the predicate exactly. String-based comparisons are case-insensitive, but otherwise, all comparisons must be an exact match of the specified value.\n\nListing 2. Matching a field to a specific value\n\n```objc\nNSPredicate predicate = nil;\npredicate = [NSPredicate predicateWithFormat:@\"ANY favoriteColors = 'red'\"];\npredicate = [NSPredicate predicateWithFormat:@\"favoriteColors CONTAINS 'red'\"];\npredicate = [NSPredicate predicateWithFormat:@\"'red' IN favoriteColors\"];\npredicate = [NSPredicate predicateWithFormat:@\"%K CONTAINS %@\", @\"favoriteColors\", @\"red\"];\n```\n\nYou can match more than one value at a time by using a predicate similar to the ones in Listing 3. In the example, the predicates report a match if the value in the `favoriteColor` field of a record matches either of the values `red` or `green`.\n\nListing 3. Matching a field to one or more values\n\n```objc\nNSPredicate predicate = nil;\npredicate = [NSPredicate predicateWithFormat:@\"ANY { 'red', 'green' } = favoriteColor\"];\npredicate = [NSPredicate predicateWithFormat:@\"favoriteColor IN { 'red', 'green' }\"];\n```\n\nFor fields that contain string values, you can match the beginning portion of the string using the `BEGINSWITH` operator as Listing 4 shows. You can’t use other string comparison operators, such as `CONTAINS` or `ENDSWITH`. When using this operator, the field must contain a string value and must start with the string you specify. Matches are case-sensitive. In the examples, the predicate matches records where the `favoriteColors` field contains the strings *red*, *reddish*, or *red*` `*green*` `*duct*` `*tape*.\n\nListing 4. Matching a field that starts with a string value\n\n```objc\nNSString* matchString = @\"red\";\nNSPredicate predicate = nil;\npredicate = [NSPredicate predicateWithFormat:@\"ANY favoriteColors BEGINSWITH 'red'\"]\npredicate = [NSPredicate predicateWithFormat:@\"ANY favoriteColors BEGINSWITH %@\", matchString]\n```\n\nTo perform a tokenized search of a record’s fields, use the special operator `self`. A tokenized search searches any fields where you enable full-text search, which is all string-based fields by default. CloudKit treats each distinct word in the tokenized string as a separate token for the purpose of searching. Comparisons are case- and diacritic-insensitive. These token strings can be in a single field or in multiple fields.\n\nListing 5 shows an example that searches the fields of a record for the token strings `bob` or `smith`:\n\nListing 5. Matching a field that contains one or more tokens\n\n```objc\nNSPredicate predicate = nil;\npredicate = [NSPredicate predicateWithFormat:@\"self contains 'bob smith'\"];\n```\n\nTo search for multiple tokens present in the fields, use the `AND` predicate operator, as Listing 6 shows.\n\nListing 6. Matching a field that contains multiple tokens\n\n```objc\nNSPredicate predicate = nil;\npredicate = [NSPredicate predicateWithFormat:@\"self contains 'bob' AND self contains __'__smith__'__\"];\n```\n\nTo test whether two locations are near each other, create a predicate using the `distanceToLocation:fromLocation:` function as Listing 7 shows. Predicates that use this function must have the structure in the listing. In your code, replace the `location` variable with a field name from one of your records. This data type for the field must be a [doc:\/\/com.apple.documentation\/documentation\/CoreLocation\/CLLocation] object. Similarly, replace the `fixedLoc` and `radius` values with appropriate values from your app. The `fixedLoc` value is the geographic coordinate that marks the center of a circle with the specified radius. In this example, the predicate returns a match if the location in the record is within 10 kilometers of the specified latitude and longitude.\n\nListing 7. Matching by distance from a location\n\n```objc\nCLLocation* fixedLoc = [[CLLocation alloc] initWithLatitude:37.331913 longitude:-122.030210];\nCGFloat radius = 10; \/\/ kilometers\nNSPredicate predicate =\n   [NSPredicate predicateWithFormat:@\"distanceToLocation:fromLocation:(location, %@) < %f\", fixedLoc, radius]];\n```\n\nTo retrieve all records of a specific type, use the `TRUEPREDICATE` expression as Listing 8 shows. A predicate with this operator always evaluates to `true` and, therefore, matches every record. When using such an operator, use a cursor to batch the results into smaller groups for processing.\n\n\n\nListing 8. Retrieving all records of a specific type\n\n```objc\nNSPredicate predicate = nil;\npredicate = [NSPredicate predicateWithFormat:@\"TRUEPREDICATE\"];\n```\n\n### Indexes and Full-Text Search\n\nIndexes make it possible to search the contents of your records efficiently. During development, the server indexes all fields with data types it can use in the predicate of a query. This automatic indexing makes it easier to experiment with queries during development, but the indexes require space in a database and require time to generate and maintain. So when migrating to a production environment, remove the indexes for any fields that you don’t use in queries.\n\nFull-text search is another feature that is on by default for all fields during development. When you move to the production environment, disable full-text search for fields with content you don’t need to search. As with removing indexes, disabling full-text search improves the performance of your tokenized searches. To configure the indexing and full-text search options for fields in your schema, use CloudKit Dashboard.\n\nIn a full-text search, CloudKit ignores the following words if they appear in the token strings:\n\n\n\n### Executing a Search Using Your Query Object\n\nTo execute a query, do one of the following:\n\n- Create an instance of [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKQueryOperation] using your query. Run the operation directly or add it to an operation queue to perform the query and deliver the results.\n- Call the [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKDatabase\/perform(_:inZoneWith:completionHandler:)] method of [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKDatabase] to execute the query. Process the results in your completion handler.\n\nQueries always run asynchronously and deliver results to a completion handler that you provide.\n\n## Creating a Query\n\n- **init(coder:)**: Creates an operation group from a serialized instance.\n- **init(recordType:predicate:)**: Creates a query with the specified record type and predicate.\n\n## Accessing the Query Parameters\n\n- **recordType**: The record type to search.\n- **predicate**: The predicate to use for matching records.\n- **sortDescriptors**: The sort descriptors for organizing the query’s results.\n\n## Queries\n\n- **CKQueryOperation**: An operation for executing queries in a database.\n- **CKLocationSortDescriptor**: An object for sorting records that contain location data.\n\n## Inherits From\n\n- NSObject\n\n## Conforms To\n\n- CVarArg\n- CustomDebugStringConvertible\n- CustomStringConvertible\n- Equatable\n- Hashable\n- NSCoding\n- NSCopying\n- NSObjectProtocol\n- NSSecureCoding\n- Sendable\n- SendableMetatype\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Creates an operation group from a serialized instance.",
          "name" : "init(coder:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKQuery\/init(coder:)"
        },
        {
          "description" : "Creates a query with the specified record type and predicate.",
          "name" : "init(recordType:predicate:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKQuery\/init(recordType:predicate:)"
        }
      ],
      "title" : "Creating a Query"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "The record type to search.",
          "name" : "recordType",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKQuery\/recordType-6ajii"
        },
        {
          "description" : "The predicate to use for matching records.",
          "name" : "predicate",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKQuery\/predicate"
        },
        {
          "description" : "The sort descriptors for organizing the query’s results.",
          "name" : "sortDescriptors",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKQuery\/sortDescriptors"
        }
      ],
      "title" : "Accessing the Query Parameters"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "An operation for executing queries in a database.",
          "name" : "CKQueryOperation",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKQueryOperation"
        },
        {
          "description" : "An object for sorting records that contain location data.",
          "name" : "CKLocationSortDescriptor",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKLocationSortDescriptor"
        }
      ],
      "title" : "Queries"
    },
    {
      "content" : "",
      "items" : [
        {
          "name" : "NSObject"
        }
      ],
      "title" : "Inherits From"
    }
  ],
  "source" : "appleJSON",
  "title" : "CKQuery",
  "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKQuery"
}