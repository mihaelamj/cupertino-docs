{
  "abstract" : "An operation that fetches record zone changes.",
  "codeExamples" : [
    {
      "code" : "\/\/ Create a dictionary that maps a record zone ID to its\n\/\/ corresponding zone configuration. The configuration\n\/\/ contains the server change token from the most recent \n\/\/ fetch of that record zone.\nNSMutableDictionary *configurations = [NSMutableDictionary new];\nfor (CKRecordZoneID *recordZoneID in recordZoneIDs) {\n    CKFetchRecordZoneChangesConfiguration *config = \n        [CKFetchRecordZoneChangesConfiguration new];\n    config.previousServerChangeToken = [tokenCache objectForKey:recordZoneID];\n    [configurations setObject:config forKey:recordZoneID];\n}\n\n\/\/ Create a fetch operation with an array of record zone IDs\n\/\/ and the zone configuration mapping dictionary. \nCKFetchRecordZoneChangesOperation *operation = \n    [[CKFetchRecordZoneChangesOperation alloc] \n     initWithRecordZoneIDs:recordZoneIDs \n     configurationsByRecordZoneID:configurations];\n\n\/\/ Process each changed record as CloudKit returns it.   \noperation.recordChangedBlock = ^(CKRecord *record) {\n    recordHandler(record);\n};\n\n\/\/ Cache the change tokens that CloudKit provides as\n\/\/ the operation runs.\noperation.recordZoneChangeTokensUpdatedBlock = ^(CKRecordZoneID *recordZoneID, \n                                                 CKServerChangeToken *token, \n                                                 NSData *data) {\n    [tokenCache setObject:token forKey:recordZoneID];\n};\n\n\/\/ If the fetch for the current record zone completes\n\/\/ successfully, cache the final change token.    \noperation.recordZoneFetchCompletionBlock = ^(CKRecordZoneID *recordZoneID, \n                                             CKServerChangeToken *token, \n                                             NSData *data, BOOL more, \n                                             NSError *error) {\n    if (error) {\n        \/\/ Handle the error.\n    } else {\n        [tokenCache setObject:token forKey:recordZoneID];\n    }\n};\n\n\/\/ Set an appropriate QoS and add the operation to the shared\n\/\/ database's operation queue to execute it.\noperation.qualityOfService = NSQualityOfServiceUtility;\n[CKContainer.defaultContainer.sharedCloudDatabase addOperation:operation];",
      "language" : "swift"
    }
  ],
  "conformsTo" : [
    "CVarArg",
    "CustomDebugStringConvertible",
    "CustomStringConvertible",
    "Equatable",
    "Hashable",
    "NSObjectProtocol",
    "Sendable",
    "SendableMetatype"
  ],
  "contentHash" : "9e63510afdc5a55ca62bfbf6f291bad6ec80521e9530b5c2e9a15db0cd8ffed0",
  "crawledAt" : "2025-12-07T18:21:55Z",
  "declaration" : {
    "code" : "class CKFetchRecordZoneChangesOperation",
    "language" : "swift"
  },
  "id" : "60E499F4-D0EF-46A9-B8DE-799E0CBAA156",
  "kind" : "class",
  "language" : "swift",
  "module" : "CloudKit",
  "overview" : "## Overview\n\nUse this operation to fetch record changes in one or more record zones, such as those that occur during record creation, modification, and deletion. You provide a configuration object for each record zone to query for changes. The configuration contains a server change token, which is an opaque pointer to a specific change in the zone’s history. CloudKit returns only the changes that occur after that point. For the first time you fetch a record zone’s changes, or to refetch all changes in a zone’s history, use `nil` instead.\n\nCloudKit processes the record zones in succession, and returns the changes for each zone in batches. Each batch yields a new change token. If all batches return without error, the operation issues a final change token for that zone. The change tokens conform to [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSSecureCoding] and are safe to cache on-disk. This operation’s tokens aren’t compatible with [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKFetchDatabaseChangesOperation] so you should segregate them in your app’s cache. Don’t infer behavior or order from the tokens’ contents.\n\nIf you create record zones in the private database, fetch all changes the first time the app launches. Cache the results on-device and use [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKRecordZoneSubscription] to subscribe to future changes. Fetch those changes on receipt of the push notifications the subscription generates. If you use the shared database, subscribe to changes with [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKDatabaseSubscription] instead. When a user participates in sharing, CloudKit adds and removes record zones. This means you don’t know in advance which zones exist in the shared database. Use [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKFetchDatabaseChangesOperation] to fetch shared record zones on receipt of the subscription’s push notifications. Then fetch the changes in those zones using this operation. Regardless of which database you use, it’s not necessary to perform fetches each time your app launches, or to schedule fetches at regular intervals.\n\nTo run the operation, add it to the corresponding database’s operation queue. The operation executes its callbacks on a private serial queue.\n\nThe following example demonstrates how to create the operation, configure its callbacks, and execute it. For brevity, it omits the delete and operation completion callbacks.",
  "platforms" : [
    "iOS",
    "iPadOS",
    "Mac Catalyst",
    "macOS",
    "tvOS",
    "visionOS",
    "watchOS"
  ],
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/cloudkit\/ckfetchrecordzonechangesoperation\ncrawled: 2025-12-07T18:21:55Z\n---\n\n# CKFetchRecordZoneChangesOperation\n\n**Class**\n\nAn operation that fetches record zone changes.\n\n## Declaration\n\n```swift\nclass CKFetchRecordZoneChangesOperation\n```\n\n## Overview\n\nUse this operation to fetch record changes in one or more record zones, such as those that occur during record creation, modification, and deletion. You provide a configuration object for each record zone to query for changes. The configuration contains a server change token, which is an opaque pointer to a specific change in the zone’s history. CloudKit returns only the changes that occur after that point. For the first time you fetch a record zone’s changes, or to refetch all changes in a zone’s history, use `nil` instead.\n\n\n\nCloudKit processes the record zones in succession, and returns the changes for each zone in batches. Each batch yields a new change token. If all batches return without error, the operation issues a final change token for that zone. The change tokens conform to [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSSecureCoding] and are safe to cache on-disk. This operation’s tokens aren’t compatible with [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKFetchDatabaseChangesOperation] so you should segregate them in your app’s cache. Don’t infer behavior or order from the tokens’ contents.\n\nIf you create record zones in the private database, fetch all changes the first time the app launches. Cache the results on-device and use [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKRecordZoneSubscription] to subscribe to future changes. Fetch those changes on receipt of the push notifications the subscription generates. If you use the shared database, subscribe to changes with [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKDatabaseSubscription] instead. When a user participates in sharing, CloudKit adds and removes record zones. This means you don’t know in advance which zones exist in the shared database. Use [doc:\/\/com.apple.cloudkit\/documentation\/CloudKit\/CKFetchDatabaseChangesOperation] to fetch shared record zones on receipt of the subscription’s push notifications. Then fetch the changes in those zones using this operation. Regardless of which database you use, it’s not necessary to perform fetches each time your app launches, or to schedule fetches at regular intervals.\n\nTo run the operation, add it to the corresponding database’s operation queue. The operation executes its callbacks on a private serial queue.\n\nThe following example demonstrates how to create the operation, configure its callbacks, and execute it. For brevity, it omits the delete and operation completion callbacks.\n\n```swift\n\/\/ Create a dictionary that maps a record zone ID to its\n\/\/ corresponding zone configuration. The configuration\n\/\/ contains the server change token from the most recent \n\/\/ fetch of that record zone.\nNSMutableDictionary *configurations = [NSMutableDictionary new];\nfor (CKRecordZoneID *recordZoneID in recordZoneIDs) {\n    CKFetchRecordZoneChangesConfiguration *config = \n        [CKFetchRecordZoneChangesConfiguration new];\n    config.previousServerChangeToken = [tokenCache objectForKey:recordZoneID];\n    [configurations setObject:config forKey:recordZoneID];\n}\n\n\/\/ Create a fetch operation with an array of record zone IDs\n\/\/ and the zone configuration mapping dictionary. \nCKFetchRecordZoneChangesOperation *operation = \n    [[CKFetchRecordZoneChangesOperation alloc] \n     initWithRecordZoneIDs:recordZoneIDs \n     configurationsByRecordZoneID:configurations];\n\n\/\/ Process each changed record as CloudKit returns it.   \noperation.recordChangedBlock = ^(CKRecord *record) {\n    recordHandler(record);\n};\n\n\/\/ Cache the change tokens that CloudKit provides as\n\/\/ the operation runs.\noperation.recordZoneChangeTokensUpdatedBlock = ^(CKRecordZoneID *recordZoneID, \n                                                 CKServerChangeToken *token, \n                                                 NSData *data) {\n    [tokenCache setObject:token forKey:recordZoneID];\n};\n\n\/\/ If the fetch for the current record zone completes\n\/\/ successfully, cache the final change token.    \noperation.recordZoneFetchCompletionBlock = ^(CKRecordZoneID *recordZoneID, \n                                             CKServerChangeToken *token, \n                                             NSData *data, BOOL more, \n                                             NSError *error) {\n    if (error) {\n        \/\/ Handle the error.\n    } else {\n        [tokenCache setObject:token forKey:recordZoneID];\n    }\n};\n\n\/\/ Set an appropriate QoS and add the operation to the shared\n\/\/ database's operation queue to execute it.\noperation.qualityOfService = NSQualityOfServiceUtility;\n[CKContainer.defaultContainer.sharedCloudDatabase addOperation:operation];\n```\n\n## Creating a Zone Change Operation\n\n- **init(recordZoneIDs:configurationsByRecordZoneID:)**: Creates an operation for fetching record zone changes.\n- **init()**: Creates an empty fetch record zone changes operation.\n\n## Configuring the Zone Change Operation\n\n- **configurationsByRecordZoneID**: A dictionary of configurations for fetching change operations by zone identifier.\n- **CKFetchRecordZoneChangesOperation.ZoneConfiguration**: A configuration object that describes the information to fetch from a record zone.\n- **fetchAllChanges**: A Boolean value that indicates whether to send repeated requests to the server.\n- **recordZoneIDs**: The IDs of the record zones that contain the records to fetch.\n\n## Processing the Zone Change Operation Results\n\n- **recordChangedBlock**: The closure to execute with the contents of a changed record.\n- **recordWithIDWasDeletedBlock**: The closure to execute when a record no longer exists.\n- **recordZoneChangeTokensUpdatedBlock**: The closure to execute when the change token updates.\n- **recordZoneFetchCompletionBlock**: The closure to execute when a record zone’s fetch finishes.\n- **fetchRecordZoneChangesCompletionBlock**: The closure to execute when the operation finishes.\n\n## Deprecated\n\n- **Deprecated Symbols**: Review unsupported symbols and their replacements.\n\n## Instance Properties\n\n- **fetchRecordZoneChangesResultBlock**\n- **recordWasChangedBlock**\n- **recordZoneFetchResultBlock**\n\n## Record Zone Changes\n\n- **CKRecordZoneSubscription**: A subscription that generates push notifications when CloudKit modifies records in a specific record zone.\n- **CKRecordZoneNotification**: A notification that triggers when the contents of a record zone change.\n\n## Inherits From\n\n- CKDatabaseOperation\n\n## Conforms To\n\n- CVarArg\n- CustomDebugStringConvertible\n- CustomStringConvertible\n- Equatable\n- Hashable\n- NSObjectProtocol\n- Sendable\n- SendableMetatype\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Creates an operation for fetching record zone changes.",
          "name" : "init(recordZoneIDs:configurationsByRecordZoneID:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKFetchRecordZoneChangesOperation\/init(recordZoneIDs:configurationsByRecordZoneID:)"
        },
        {
          "description" : "Creates an empty fetch record zone changes operation.",
          "name" : "init()",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKFetchRecordZoneChangesOperation\/init()"
        }
      ],
      "title" : "Creating a Zone Change Operation"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "A dictionary of configurations for fetching change operations by zone identifier.",
          "name" : "configurationsByRecordZoneID",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKFetchRecordZoneChangesOperation\/configurationsByRecordZoneID"
        },
        {
          "description" : "A configuration object that describes the information to fetch from a record zone.",
          "name" : "CKFetchRecordZoneChangesOperation.ZoneConfiguration",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKFetchRecordZoneChangesOperation\/ZoneConfiguration"
        },
        {
          "description" : "A Boolean value that indicates whether to send repeated requests to the server.",
          "name" : "fetchAllChanges",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKFetchRecordZoneChangesOperation\/fetchAllChanges"
        },
        {
          "description" : "The IDs of the record zones that contain the records to fetch.",
          "name" : "recordZoneIDs",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKFetchRecordZoneChangesOperation\/recordZoneIDs"
        }
      ],
      "title" : "Configuring the Zone Change Operation"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "The closure to execute with the contents of a changed record.",
          "name" : "recordChangedBlock",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKFetchRecordZoneChangesOperation\/recordChangedBlock"
        },
        {
          "description" : "The closure to execute when a record no longer exists.",
          "name" : "recordWithIDWasDeletedBlock",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKFetchRecordZoneChangesOperation\/recordWithIDWasDeletedBlock-3z14c"
        },
        {
          "description" : "The closure to execute when the change token updates.",
          "name" : "recordZoneChangeTokensUpdatedBlock",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKFetchRecordZoneChangesOperation\/recordZoneChangeTokensUpdatedBlock"
        },
        {
          "description" : "The closure to execute when a record zone’s fetch finishes.",
          "name" : "recordZoneFetchCompletionBlock",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKFetchRecordZoneChangesOperation\/recordZoneFetchCompletionBlock"
        },
        {
          "description" : "The closure to execute when the operation finishes.",
          "name" : "fetchRecordZoneChangesCompletionBlock",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKFetchRecordZoneChangesOperation\/fetchRecordZoneChangesCompletionBlock"
        }
      ],
      "title" : "Processing the Zone Change Operation Results"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "Review unsupported symbols and their replacements.",
          "name" : "Deprecated Symbols",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/ckfetchrecordzonechangesoperation-deprecated-symbols"
        }
      ],
      "title" : "Deprecated"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "",
          "name" : "fetchRecordZoneChangesResultBlock",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKFetchRecordZoneChangesOperation\/fetchRecordZoneChangesResultBlock"
        },
        {
          "description" : "",
          "name" : "recordWasChangedBlock",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKFetchRecordZoneChangesOperation\/recordWasChangedBlock-x5bw"
        },
        {
          "description" : "",
          "name" : "recordZoneFetchResultBlock",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKFetchRecordZoneChangesOperation\/recordZoneFetchResultBlock"
        }
      ],
      "title" : "Instance Properties"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "A subscription that generates push notifications when CloudKit modifies records in a specific record zone.",
          "name" : "CKRecordZoneSubscription",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKRecordZoneSubscription"
        },
        {
          "description" : "A notification that triggers when the contents of a record zone change.",
          "name" : "CKRecordZoneNotification",
          "url" : "https:\/\/developer.apple.com\/documentation\/CloudKit\/CKRecordZoneNotification"
        }
      ],
      "title" : "Record Zone Changes"
    },
    {
      "content" : "",
      "items" : [
        {
          "name" : "CKDatabaseOperation"
        }
      ],
      "title" : "Inherits From"
    }
  ],
  "source" : "appleJSON",
  "title" : "CKFetchRecordZoneChangesOperation",
  "url" : "https:\/\/developer.apple.com\/documentation\/cloudkit\/ckfetchrecordzonechangesoperation"
}