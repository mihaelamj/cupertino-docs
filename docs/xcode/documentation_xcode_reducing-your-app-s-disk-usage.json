{
  "abstract" : "Measure and minimize the space your app uses to store its files.",
  "codeExamples" : [
    {
      "code" : "import MetricKit\n\nclass MetricService: NSObject, MXMetricManagerSubscriber {\n    let metricManager: MXMetricManager = MXMetricManager.shared\n    \n    override init() {\n        super.init()\n        metricManager.add(self)\n    }\n    \n    func didReceive(_ payloads: [MXMetricPayload]) {\n        payloads.forEach({ payload in\n            if let diskUsage = payload.diskSpaceUsageMetrics {\n                \/\/ Analyze your app's disk usage.\n            }\n        })\n    }\n}",
      "language" : "swift"
    },
    {
      "code" : "let cacheDownloadTask = URLSession.shared.downloadTask(with: cacheURL) {\n    fileURL, response, error\n\n    \/\/ Check for download errors and handle them.\n\n    guard let temporaryURL = fileURL else { return }\n    do {\n        let destinationURL = URL.cachesDirectory.appendingPathComponent(temporaryURL.lastPathComponent)\n        try FileManager.default.moveItem(at: temporaryURL, to: destinationURL)\n    }\n    catch {\n        \/\/ Handle the error.\n    }\n}",
      "language" : "swift"
    },
    {
      "code" : "func removeLocalDocument(at localURL: URL) throws {\n    let resources = try localURL.resourceValues(forKeys: [.ubiquitousItemIsUploadedKey])\n    guard resources.ubiquitousItemIsUploaded == true else { return }\n    FileManager.default.evictUbiquitousItem(at: localURL)\n}",
      "language" : "swift"
    },
    {
      "code" : "func fetchRemoteDocument(for localURL: URL) throws {\n    let resources = try localURL.resourceValues(forKeys: [.ubiquitousItemIsUploadedKey])\n    guard resources.ubiquitousItemIsUploaded != true else { return }\n    FileManager.default.startDownloadingUbiquitousItem(at: localURL)\n}",
      "language" : "swift"
    }
  ],
  "contentHash" : "d53ee16ecd77677d21e97a4188b3882d9b24aec648e98283c7a8b70eecdd3711",
  "crawledAt" : "2025-12-04T00:40:57Z",
  "id" : "5EE01AFD-E053-4602-B376-33811923F62F",
  "kind" : "article",
  "language" : "swift",
  "overview" : "## Overview\n\nPeople use multiple apps on a device, to create and access important content. Minimize your app’s disk usage to make more space for a person’s content, and to allow someone to install more apps on their device. Store recoverable data in purgeable locations, so that the system can free up space when it needs to.\n\n### Review your app’s disk usage\n\nTo see the storage used by each app on your device, open Settings and choose General > Storage.\n\n\n\nTap on your app to see a breakdown of how the app’s bundle, documents, and data contribute to the overall disk usage.\n\n### Gather metrics on disk usage\n\nUse [doc:\/\/com.apple.documentation\/documentation\/MetricKit\/MXDiskSpaceUsageMetric] to gather metrics on the number of files in your app’s container, and the disk space they occupy including space in the [doc:\/\/com.apple.documentation\/documentation\/Foundation\/URL\/cachesDirectory]:\n\n### Use purgeable folders for recoverable content\n\nWhen you download or otherwise generate content that your app can recover if it needs to, store that content in the [doc:\/\/com.apple.documentation\/documentation\/Foundation\/URL\/cachesDirectory] or the [doc:\/\/com.apple.documentation\/documentation\/Foundation\/FileManager\/temporaryDirectory]. The system automatically deletes content in the `cachesDirectory` and `temporaryDirectory` — an operation known as *purging* — when it detects that disk space is low.\n\n### Manage local copies of iCloud files\n\nWhen a person isn’t using the local copy of a file that’s stored in iCloud, call [doc:\/\/com.apple.documentation\/documentation\/Foundation\/FileManager\/evictUbiquitousItem(at:)] to remove the local copy while keeping the original on iCloud:\n\nYou can subsequently retrieve the file from iCloud by calling [doc:\/\/com.apple.documentation\/documentation\/Foundation\/FileManager\/startDownloadingUbiquitousItem(at:)]:\n\n### Copy files by creating clones\n\nWhen you use [doc:\/\/com.apple.documentation\/documentation\/Foundation\/FileManager\/copyItem(at:to:)] to copy a file on an APFS volume, the system creates a *clone* of the file. The clone refers to the original file’s content, so it uses less space on disk than if you duplicate the file through other methods. [doc:\/\/com.apple.documentation\/documentation\/MetricKit\/MXDiskSpaceUsageMetric] accounts for clones in its calculations of the disk space used by your app.\n\nFor more information, see [doc:\/\/com.apple.documentation\/documentation\/Foundation\/about-apple-file-system#Clones-Reduce-the-Cost-of-Copying].",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/Xcode\/reducing-your-app-s-disk-usage\ncrawled: 2025-12-04T00:40:57Z\n---\n\n# Reducing your app’s disk usage\n\n**Article**\n\nMeasure and minimize the space your app uses to store its files.\n\n## Overview\n\nPeople use multiple apps on a device, to create and access important content. Minimize your app’s disk usage to make more space for a person’s content, and to allow someone to install more apps on their device. Store recoverable data in purgeable locations, so that the system can free up space when it needs to.\n\n### Review your app’s disk usage\n\nTo see the storage used by each app on your device, open Settings and choose General > Storage.\n\n\n\nTap on your app to see a breakdown of how the app’s bundle, documents, and data contribute to the overall disk usage.\n\n### Gather metrics on disk usage\n\nUse [doc:\/\/com.apple.documentation\/documentation\/MetricKit\/MXDiskSpaceUsageMetric] to gather metrics on the number of files in your app’s container, and the disk space they occupy including space in the [doc:\/\/com.apple.documentation\/documentation\/Foundation\/URL\/cachesDirectory]:\n\n```swift\nimport MetricKit\n\nclass MetricService: NSObject, MXMetricManagerSubscriber {\n    let metricManager: MXMetricManager = MXMetricManager.shared\n    \n    override init() {\n        super.init()\n        metricManager.add(self)\n    }\n    \n    func didReceive(_ payloads: [MXMetricPayload]) {\n        payloads.forEach({ payload in\n            if let diskUsage = payload.diskSpaceUsageMetrics {\n                \/\/ Analyze your app's disk usage.\n            }\n        })\n    }\n}\n```\n\n### Use purgeable folders for recoverable content\n\nWhen you download or otherwise generate content that your app can recover if it needs to, store that content in the [doc:\/\/com.apple.documentation\/documentation\/Foundation\/URL\/cachesDirectory] or the [doc:\/\/com.apple.documentation\/documentation\/Foundation\/FileManager\/temporaryDirectory]. The system automatically deletes content in the `cachesDirectory` and `temporaryDirectory` — an operation known as *purging* — when it detects that disk space is low.\n\n```swift\nlet cacheDownloadTask = URLSession.shared.downloadTask(with: cacheURL) {\n    fileURL, response, error\n\n    \/\/ Check for download errors and handle them.\n\n    guard let temporaryURL = fileURL else { return }\n    do {\n        let destinationURL = URL.cachesDirectory.appendingPathComponent(temporaryURL.lastPathComponent)\n        try FileManager.default.moveItem(at: temporaryURL, to: destinationURL)\n    }\n    catch {\n        \/\/ Handle the error.\n    }\n}\n```\n\n### Manage local copies of iCloud files\n\nWhen a person isn’t using the local copy of a file that’s stored in iCloud, call [doc:\/\/com.apple.documentation\/documentation\/Foundation\/FileManager\/evictUbiquitousItem(at:)] to remove the local copy while keeping the original on iCloud:\n\n```swift\nfunc removeLocalDocument(at localURL: URL) throws {\n    let resources = try localURL.resourceValues(forKeys: [.ubiquitousItemIsUploadedKey])\n    guard resources.ubiquitousItemIsUploaded == true else { return }\n    FileManager.default.evictUbiquitousItem(at: localURL)\n}\n```\n\nYou can subsequently retrieve the file from iCloud by calling [doc:\/\/com.apple.documentation\/documentation\/Foundation\/FileManager\/startDownloadingUbiquitousItem(at:)]:\n\n```swift\nfunc fetchRemoteDocument(for localURL: URL) throws {\n    let resources = try localURL.resourceValues(forKeys: [.ubiquitousItemIsUploadedKey])\n    guard resources.ubiquitousItemIsUploaded != true else { return }\n    FileManager.default.startDownloadingUbiquitousItem(at: localURL)\n}\n```\n\n\n\n### Copy files by creating clones\n\nWhen you use [doc:\/\/com.apple.documentation\/documentation\/Foundation\/FileManager\/copyItem(at:to:)] to copy a file on an APFS volume, the system creates a *clone* of the file. The clone refers to the original file’s content, so it uses less space on disk than if you duplicate the file through other methods. [doc:\/\/com.apple.documentation\/documentation\/MetricKit\/MXDiskSpaceUsageMetric] accounts for clones in its calculations of the disk space used by your app.\n\nFor more information, see [doc:\/\/com.apple.documentation\/documentation\/Foundation\/about-apple-file-system#Clones-Reduce-the-Cost-of-Copying].\n\n## Disk usage\n\n- **Reducing disk writes**: Improve your app’s responsiveness by optimizing how it writes data to permanent storage.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Improve your app’s responsiveness by optimizing how it writes data to permanent storage.",
          "name" : "Reducing disk writes",
          "url" : "https:\/\/developer.apple.com\/documentation\/Xcode\/reducing-disk-writes"
        }
      ],
      "title" : "Disk usage"
    }
  ],
  "source" : "appleJSON",
  "title" : "Reducing your app’s disk usage",
  "url" : "https:\/\/developer.apple.com\/documentation\/Xcode\/reducing-your-app-s-disk-usage"
}