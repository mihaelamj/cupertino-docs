{
  "abstract" : "Detects when one thread accesses a mutable object while another thread is writing to it.",
  "codeExamples" : [
    {
      "code" : "let array: NSMutableArray = []\nvar sum: Int = 0\n\/\/ Executed on Thread #1\nfor value in array {\n    sum += value as! Int\n}\n\/\/ Executed on Thread #2\narray.add(42)",
      "language" : "swift"
    },
    {
      "code" : "NSMutableArray *array = [NSMutableArray new];\nNSInteger sum = 0;\n\/\/ Executed on Thread #1\nfor (id value in array) {  \n    sum += [value integerValue];\n} \n\/\/ Executed on Thread #2\n[array addObject:@42];",
      "language" : "objc"
    },
    {
      "code" : "let dictionary: NSMutableDictionary = [:]\nvar sum: Int = 0\n\/\/ Executed on Thread #1\nfor key in dictionary.keyEnumerator() {\n    sum += dictionary[key] as! Int\n}\n\/\/ Executed on Thread #2\ndictionary[\"forty-two\"] = 42",
      "language" : "swift"
    },
    {
      "code" : "NSMutableDictionary *dictionary = [NSMutableDictionary new];\nNSInteger sum = 0;\n\/\/ Executed on Thread #1\nfor (id key in dictionary) {\n    sum += [dictionary[key] integerValue];\n}\n\/\/ Executed on Thread #2\ndictionary[@\"forty-two\"] = @42;",
      "language" : "objc"
    }
  ],
  "contentHash" : "3c2d7b42393a21211cfffa518cb55262732d2e3a2c271a97f289acf600009666",
  "crawledAt" : "2025-12-04T02:40:28Z",
  "id" : "1D54CE10-0949-4345-9BEE-2409E69AEB6D",
  "kind" : "article",
  "language" : "swift",
  "overview" : "## Overview\n\nIn Xcode 9 and later, the Thread Sanitizer detects unsafe thread accesses of [doc:\/\/com.apple.documentation\/documentation\/Foundation] and [doc:\/\/com.apple.documentation\/documentation\/CoreFoundation] framework APIs. This feature applies to the following collection types:\n\n### Collection race with a mutable array\n\nIn the following example, the code enumerates a mutable array in one thread while writing to the array from another without synchronizing access:\n\n**Swift**\n\n**Objective-C**\n\n#### Solution\n\nUse [doc:\/\/com.apple.documentation\/documentation\/Dispatch] APIs to coordinate access to `array` across multiple threads.\n\n### Collection race with a mutable dictionary\n\nIn the following example, the code enumerates a mutable dictionary in one thread while writing to the dictionary from another without synchronizing access:\n\n**Objective-C**\n\n#### Solution\n\nUse [doc:\/\/com.apple.documentation\/documentation\/Dispatch] APIs to coordinate access to `dictionary` across multiple threads.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/Xcode\/races-on-collections-and-other-apis\ncrawled: 2025-12-04T02:40:28Z\n---\n\n# Races on collections and other APIs\n\n**Article**\n\nDetects when one thread accesses a mutable object while another thread is writing to it.\n\n## Overview\n\nIn Xcode 9 and later, the Thread Sanitizer detects unsafe thread accesses of [doc:\/\/com.apple.documentation\/documentation\/Foundation] and [doc:\/\/com.apple.documentation\/documentation\/CoreFoundation] framework APIs. This feature applies to the following collection types:\n\n- [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSMutableArray]\n- [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSMutableDictionary]\n- [doc:\/\/com.apple.documentation\/documentation\/CoreFoundation\/CFMutableArray]\n- [doc:\/\/com.apple.documentation\/documentation\/CoreFoundation\/CFMutableDictionary]\n\n### Collection race with a mutable array\n\nIn the following example, the code enumerates a mutable array in one thread while writing to the array from another without synchronizing access:\n\n**Swift**\n\n```swift\nlet array: NSMutableArray = []\nvar sum: Int = 0\n\/\/ Executed on Thread #1\nfor value in array {\n    sum += value as! Int\n}\n\/\/ Executed on Thread #2\narray.add(42)\n```\n\n**Objective-C**\n\n```objc\nNSMutableArray *array = [NSMutableArray new];\nNSInteger sum = 0;\n\/\/ Executed on Thread #1\nfor (id value in array) {  \n    sum += [value integerValue];\n} \n\/\/ Executed on Thread #2\n[array addObject:@42];\n```\n\n#### Solution\n\nUse [doc:\/\/com.apple.documentation\/documentation\/Dispatch] APIs to coordinate access to `array` across multiple threads.\n\n### Collection race with a mutable dictionary\n\nIn the following example, the code enumerates a mutable dictionary in one thread while writing to the dictionary from another without synchronizing access:\n\n```swift\nlet dictionary: NSMutableDictionary = [:]\nvar sum: Int = 0\n\/\/ Executed on Thread #1\nfor key in dictionary.keyEnumerator() {\n    sum += dictionary[key] as! Int\n}\n\/\/ Executed on Thread #2\ndictionary[\"forty-two\"] = 42\n```\n\n**Objective-C**\n\n```objc\nNSMutableDictionary *dictionary = [NSMutableDictionary new];\nNSInteger sum = 0;\n\/\/ Executed on Thread #1\nfor (id key in dictionary) {\n    sum += [dictionary[key] integerValue];\n}\n\/\/ Executed on Thread #2\ndictionary[@\"forty-two\"] = @42;\n```\n\n#### Solution\n\nUse [doc:\/\/com.apple.documentation\/documentation\/Dispatch] APIs to coordinate access to `dictionary` across multiple threads.\n\n## Thread Sanitizer\n\n- **Data races**: Detects unsynchronized access to mutable state across multiple threads.\n- **Swift access races**: Detects unsynchronized access to mutable state across multiple threads in Swift.\n- **Uninitialized mutexes**: Detects when you use an uninitialized mutex.\n- **Thread leaks**: Detects when you don’t close threads after use.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Detects unsynchronized access to mutable state across multiple threads.",
          "name" : "Data races",
          "url" : "https:\/\/developer.apple.com\/documentation\/Xcode\/data-races"
        },
        {
          "description" : "Detects unsynchronized access to mutable state across multiple threads in Swift.",
          "name" : "Swift access races",
          "url" : "https:\/\/developer.apple.com\/documentation\/Xcode\/swift-access-races"
        },
        {
          "description" : "Detects when you use an uninitialized mutex.",
          "name" : "Uninitialized mutexes",
          "url" : "https:\/\/developer.apple.com\/documentation\/Xcode\/uninitialized-mutexes"
        },
        {
          "description" : "Detects when you don’t close threads after use.",
          "name" : "Thread leaks",
          "url" : "https:\/\/developer.apple.com\/documentation\/Xcode\/thread-leaks"
        }
      ],
      "title" : "Thread Sanitizer"
    }
  ],
  "source" : "appleJSON",
  "title" : "Races on collections and other APIs",
  "url" : "https:\/\/developer.apple.com\/documentation\/Xcode\/races-on-collections-and-other-apis"
}