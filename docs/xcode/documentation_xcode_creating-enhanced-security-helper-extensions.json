{
  "abstract" : "Reduce opportunities for an attacker to target your app through its extensions.",
  "codeExamples" : [
    {
      "code" : "import ExtensionFoundation\n\nextension AppExtensionPoint {\n  @Definition\n  static var exampleExtension: AppExtensionPoint {\n    Name(\"exampleExtension\")\n    EnhancedSecurity()\n  }\n}",
      "language" : "swift"
    },
    {
      "code" : "import ExtensionFoundation\n\n@main\nstruct MyAppHelper: ExampleExtension {\n  @AppExtensionPoint.Bind\n  var boundExtensionPoint: AppExtensionPoint {\n    AppExtensionPoint.Identifier(host: \"com.example.my-app\", name: \"exampleExtension\")\n  }\n}",
      "language" : "swift"
    },
    {
      "code" : "let monitor = try await AppExtensionPoint.Monitor(appExtensionPoint: AppExtensionPoint.exampleExtension)\nguard let identity = monitor.identities.first else {     \n   fatalError(\"Extension not found\")\n} ",
      "language" : "swift"
    },
    {
      "code" : "do {\n  self.process = try await AppExtensionProcess(configuration: .init(appExtensionIdentity: identity, onInterruption: {\n    \/\/ The system calls this closure when the extension exits.\n  }))\n  \/\/ Communicate with the extension.\n}\ncatch let error {\n  \/\/ The system can't launch the extension.\n}",
      "language" : "swift"
    },
    {
      "code" : "struct Message: Identifiable, Codable {\n  var id: String\n  \/\/ Add properties that represent data your app sends to its extension.\n\n  struct Response: Codable {\n    \/\/ Define another structure that the extension sends back to the app in its reply.\n  }\n}",
      "language" : "swift"
    },
    {
      "code" : "do {\n  self.xpcSession = try process.makeXPCSession()\n  try xpcSession.activate()\n  \/\/ Send messages to the extension.\n}\ncatch let error {\n  \/\/ The system can't create the XPC session.\n}",
      "language" : "swift"
    },
    {
      "code" : "let response = try await withCheckedThrowingContinuation { continuation in\n  do {\n    \/\/ Construct the message the app sends to the extension.\n    let message = Message()\n    try xpcSession.send(Message()) { result in\n      switch result {\n      case .success(let reply):\n        let response = (try? reply.decode(as: Message.Response.self)) ?? \/* Create a default response. *\/\n        continuation.resume(returning: response)\n      case .failure(let error):\n        continuation.resume(throwing: error)\n      }\n    }\n  }\n  catch {\n    continuation.resume(throwing: error)\n  }\n}\n\/\/ Interpret the response from the extension.",
      "language" : "swift"
    },
    {
      "code" : "extension ExampleExtension {\n    var configuration: some AppExtensionConfiguration {\n        \/\/ Return your extension's configuration upon request.\n        return ConnectionHandler(onSessionRequest: { request in\n            let handler = MessageHandler(appExtension: self)\n            return request.accept { session in\n                return handler\n            }\n        })\n    }\n}\n \nfileprivate struct MessageHandler<E: ExampleExtension>: XPCPeerHandler, Sendable {\n    let appExtension: E\n     \n    func handleIncomingRequest(_ message: Message) -> (any Encodable)? {\n        \/\/ Process the incoming message.\n        return Message.Response()\n    }\n}\n",
      "language" : "swift"
    }
  ],
  "contentHash" : "d1b98554a95781a45a34573e64598349eec888fbad2c8f36ed60757d8bbab09d",
  "crawledAt" : "2025-12-02T17:02:00Z",
  "id" : "FABE2028-7F96-4AF9-980F-B068A7D6CD31",
  "kind" : "article",
  "language" : "swift",
  "overview" : "## Overview\n\nSeparating sensitive calculations, such as handling data from untrusted sources, into extensions that the system runs as separate processes from your app reduces the opportunity for attackers to target the sensitive calculation and gain access to other parts of your app or the system. Create Enhanced Security helper extensions on iOS, iPadOS, and macOS to enforce tighter sandbox restrictions, and enable compiler and runtime security protections.\n\n### Define the extension point in your app\n\nAdd the `EX_ENABLE_EXTENSION_POINT_GENERATION` user-defined build setting with the value `YES` to your app target’s build setting. In your app’s source code, create an extension to [doc:\/\/com.apple.documentation\/documentation\/ExtensionFoundation\/AppExtensionPoint] that defines your app’s extension point. Give the extension point the [doc:\/\/com.apple.documentation\/documentation\/ExtensionFoundation\/AppExtensionPoint\/Name] of your choosing, and the [doc:\/\/com.apple.documentation\/documentation\/ExtensionFoundation\/AppExtensionPoint\/EnhancedSecurity] attribute to tell the system to run your extension in the Enhanced Security runtime:\n\n### Create the extension\n\nFollow these steps to create the extension:\n\nEdit the main source file for the extension, so that the [doc:\/\/com.apple.documentation\/documentation\/ExtensionFoundation\/AppExtensionPoint\/Identifier] for the extension point it binds to has your app’s bundle ID as the host identifier, and the name you gave the extension point in the previous section:\n\nWrite the code to implement your extension’s behavior. The system runs your extension in a sandbox that restricts access to most system services and frameworks. In particular, your extension can’t present UI. Instead, it must communicate with its host app, and ask the app to present UI and interact with other system services on the extension’s behalf.\n\n### Discover and launch the extension\n\nIn your app, create an [doc:\/\/com.apple.documentation\/documentation\/ExtensionFoundation\/AppExtensionPoint\/Monitor] to discover the Enhanced Security extension:\n\nThe `identity` represents the bundle for the Enhanced Security extension you created in the previous section. Create an [doc:\/\/com.apple.documentation\/documentation\/ExtensionFoundation\/AppExtensionProcess] with that bundle to launch the extension:\n\n### Communicate between the app and the extension\n\nUse [doc:\/\/com.apple.documentation\/documentation\/XPC\/XPCSession] to handle communication between your app and its Enhanced Security extension. For more information, see [doc:\/\/com.apple.documentation\/documentation\/XPC\/creating-xpc-services].\n\nDefine structures that conform to [doc:\/\/com.apple.documentation\/documentation\/Swift\/Codable] in code you share between the app and extension, and create instances of those structures to send over XPC using the session you create:\n\nCall [doc:\/\/com.apple.documentation\/documentation\/ExtensionFoundation\/AppExtensionProcess\/makeXPCSession()] in your app to create an `XPCSession` you use to send messages to the extension:\n\nUse the session you create to send messages to the extension, and receive responses:\n\nIn the extension, create a [doc:\/\/com.apple.documentation\/documentation\/ExtensionFoundation\/ConnectionHandler] to accept incoming connections from the app. Call the [doc:\/\/com.apple.documentation\/documentation\/ExtensionFoundation\/ConnectionHandler\/init(onSessionRequest:)] initializer, and use the closure to accept the XPC connection and create a session.\n\n### Adopt other security hardening features\n\nEnhanced security extensions use the same compiler and runtime security features as apps that adopt the Enhanced Security capability. For more information, see [doc:\/\/com.apple.Xcode\/documentation\/Xcode\/enabling-enhanced-security-for-your-app].",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/Xcode\/creating-enhanced-security-helper-extensions\ncrawled: 2025-12-02T17:02:00Z\n---\n\n# Creating enhanced security helper extensions\n\n**Article**\n\nReduce opportunities for an attacker to target your app through its extensions.\n\n## Overview\n\nSeparating sensitive calculations, such as handling data from untrusted sources, into extensions that the system runs as separate processes from your app reduces the opportunity for attackers to target the sensitive calculation and gain access to other parts of your app or the system. Create Enhanced Security helper extensions on iOS, iPadOS, and macOS to enforce tighter sandbox restrictions, and enable compiler and runtime security protections.\n\n### Define the extension point in your app\n\nAdd the `EX_ENABLE_EXTENSION_POINT_GENERATION` user-defined build setting with the value `YES` to your app target’s build setting. In your app’s source code, create an extension to [doc:\/\/com.apple.documentation\/documentation\/ExtensionFoundation\/AppExtensionPoint] that defines your app’s extension point. Give the extension point the [doc:\/\/com.apple.documentation\/documentation\/ExtensionFoundation\/AppExtensionPoint\/Name] of your choosing, and the [doc:\/\/com.apple.documentation\/documentation\/ExtensionFoundation\/AppExtensionPoint\/EnhancedSecurity] attribute to tell the system to run your extension in the Enhanced Security runtime:\n\n```swift\nimport ExtensionFoundation\n\nextension AppExtensionPoint {\n  @Definition\n  static var exampleExtension: AppExtensionPoint {\n    Name(\"exampleExtension\")\n    EnhancedSecurity()\n  }\n}\n```\n\n### Create the extension\n\nFollow these steps to create the extension:\n\n1. In Xcode, choose File > New > Target, and select the Generic Extension template.\n2. Select the Enhanced Security Extension extension type, and click Finish.\n3. In the Xcode Project navigator, delete the extension target’s `Info.plist` file.\n4. In the target build settings editor, delete the `INFOPLIST_FILE` build setting for the extension target.\n\nEdit the main source file for the extension, so that the [doc:\/\/com.apple.documentation\/documentation\/ExtensionFoundation\/AppExtensionPoint\/Identifier] for the extension point it binds to has your app’s bundle ID as the host identifier, and the name you gave the extension point in the previous section:\n\n```swift\nimport ExtensionFoundation\n\n@main\nstruct MyAppHelper: ExampleExtension {\n  @AppExtensionPoint.Bind\n  var boundExtensionPoint: AppExtensionPoint {\n    AppExtensionPoint.Identifier(host: \"com.example.my-app\", name: \"exampleExtension\")\n  }\n}\n```\n\nWrite the code to implement your extension’s behavior. The system runs your extension in a sandbox that restricts access to most system services and frameworks. In particular, your extension can’t present UI. Instead, it must communicate with its host app, and ask the app to present UI and interact with other system services on the extension’s behalf.\n\n### Discover and launch the extension\n\nIn your app, create an [doc:\/\/com.apple.documentation\/documentation\/ExtensionFoundation\/AppExtensionPoint\/Monitor] to discover the Enhanced Security extension:\n\n```swift\nlet monitor = try await AppExtensionPoint.Monitor(appExtensionPoint: AppExtensionPoint.exampleExtension)\nguard let identity = monitor.identities.first else {     \n   fatalError(\"Extension not found\")\n} \n```\n\nThe `identity` represents the bundle for the Enhanced Security extension you created in the previous section. Create an [doc:\/\/com.apple.documentation\/documentation\/ExtensionFoundation\/AppExtensionProcess] with that bundle to launch the extension:\n\n```swift\ndo {\n  self.process = try await AppExtensionProcess(configuration: .init(appExtensionIdentity: identity, onInterruption: {\n    \/\/ The system calls this closure when the extension exits.\n  }))\n  \/\/ Communicate with the extension.\n}\ncatch let error {\n  \/\/ The system can't launch the extension.\n}\n```\n\n### Communicate between the app and the extension\n\nUse [doc:\/\/com.apple.documentation\/documentation\/XPC\/XPCSession] to handle communication between your app and its Enhanced Security extension. For more information, see [doc:\/\/com.apple.documentation\/documentation\/XPC\/creating-xpc-services].\n\nDefine structures that conform to [doc:\/\/com.apple.documentation\/documentation\/Swift\/Codable] in code you share between the app and extension, and create instances of those structures to send over XPC using the session you create:\n\n```swift\nstruct Message: Identifiable, Codable {\n  var id: String\n  \/\/ Add properties that represent data your app sends to its extension.\n\n  struct Response: Codable {\n    \/\/ Define another structure that the extension sends back to the app in its reply.\n  }\n}\n```\n\nCall [doc:\/\/com.apple.documentation\/documentation\/ExtensionFoundation\/AppExtensionProcess\/makeXPCSession()] in your app to create an `XPCSession` you use to send messages to the extension:\n\n```swift\ndo {\n  self.xpcSession = try process.makeXPCSession()\n  try xpcSession.activate()\n  \/\/ Send messages to the extension.\n}\ncatch let error {\n  \/\/ The system can't create the XPC session.\n}\n```\n\nUse the session you create to send messages to the extension, and receive responses:\n\n```swift\nlet response = try await withCheckedThrowingContinuation { continuation in\n  do {\n    \/\/ Construct the message the app sends to the extension.\n    let message = Message()\n    try xpcSession.send(Message()) { result in\n      switch result {\n      case .success(let reply):\n        let response = (try? reply.decode(as: Message.Response.self)) ?? \/* Create a default response. *\/\n        continuation.resume(returning: response)\n      case .failure(let error):\n        continuation.resume(throwing: error)\n      }\n    }\n  }\n  catch {\n    continuation.resume(throwing: error)\n  }\n}\n\/\/ Interpret the response from the extension.\n```\n\nIn the extension, create a [doc:\/\/com.apple.documentation\/documentation\/ExtensionFoundation\/ConnectionHandler] to accept incoming connections from the app. Call the [doc:\/\/com.apple.documentation\/documentation\/ExtensionFoundation\/ConnectionHandler\/init(onSessionRequest:)] initializer, and use the closure to accept the XPC connection and create a session.\n\n```swift\nextension ExampleExtension {\n    var configuration: some AppExtensionConfiguration {\n        \/\/ Return your extension's configuration upon request.\n        return ConnectionHandler(onSessionRequest: { request in\n            let handler = MessageHandler(appExtension: self)\n            return request.accept { session in\n                return handler\n            }\n        })\n    }\n}\n \nfileprivate struct MessageHandler<E: ExampleExtension>: XPCPeerHandler, Sendable {\n    let appExtension: E\n     \n    func handleIncomingRequest(_ message: Message) -> (any Encodable)? {\n        \/\/ Process the incoming message.\n        return Message.Response()\n    }\n}\n\n```\n\n### Adopt other security hardening features\n\nEnhanced security extensions use the same compiler and runtime security features as apps that adopt the Enhanced Security capability. For more information, see [doc:\/\/com.apple.Xcode\/documentation\/Xcode\/enabling-enhanced-security-for-your-app].\n\n## Security and privacy\n\n- **Verifying the origin of your XCFrameworks**: Discover who signed a framework, and take action when that changes.\n- **Enabling enhanced security for your app**: Detect out-of-bounds memory access, use of freed memory, and other potential vulnerabilities.\n- **Adopting type-aware memory allocation**: Reduce the opportunities to treat pointers as data in your code.\n- **Conforming to Mach IPC security restrictions**: Avoid crashes and potentially insecure situations associated with Mach messages.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Discover who signed a framework, and take action when that changes.",
          "name" : "Verifying the origin of your XCFrameworks",
          "url" : "https:\/\/developer.apple.com\/documentation\/Xcode\/verifying-the-origin-of-your-xcframeworks"
        },
        {
          "description" : "Detect out-of-bounds memory access, use of freed memory, and other potential vulnerabilities.",
          "name" : "Enabling enhanced security for your app",
          "url" : "https:\/\/developer.apple.com\/documentation\/Xcode\/enabling-enhanced-security-for-your-app"
        },
        {
          "description" : "Reduce the opportunities to treat pointers as data in your code.",
          "name" : "Adopting type-aware memory allocation",
          "url" : "https:\/\/developer.apple.com\/documentation\/Xcode\/adopting-type-aware-memory-allocation"
        },
        {
          "description" : "Avoid crashes and potentially insecure situations associated with Mach messages.",
          "name" : "Conforming to Mach IPC security restrictions",
          "url" : "https:\/\/developer.apple.com\/documentation\/Xcode\/conforming-to-mach-ipc-security-restrictions"
        }
      ],
      "title" : "Security and privacy"
    }
  ],
  "source" : "appleJSON",
  "title" : "Creating enhanced security helper extensions",
  "url" : "https:\/\/developer.apple.com\/documentation\/Xcode\/creating-enhanced-security-helper-extensions"
}