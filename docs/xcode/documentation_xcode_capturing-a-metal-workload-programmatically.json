{
  "abstract" : "Analyze your app’s performance by invoking Metal’s frame capture.",
  "codeExamples" : [
    {
      "code" : "func triggerProgrammaticCapture(device: MTLDevice) {\n    let captureManager = MTLCaptureManager.shared()\n    let captureDescriptor = MTLCaptureDescriptor()\n    captureDescriptor.captureObject = self.device\n    do {\n        try captureManager.startCapture(with: captureDescriptor)\n    } catch {\n        fatalError(\"error when trying to capture: \\(error)\")\n    }\n}\n\nfunc runMetalCommands(commandQueue: MTLCommandQueue) {\n    let commandBuffer = commandQueue.makeCommandBuffer()!\n    \/\/ Do Metal work.\n    commandBuffer.commit()\n    let captureManager = MTLCaptureManager.shared()\n    captureManager.stopCapture()\n}",
      "language" : "swift"
    },
    {
      "code" : "func setupProgrammaticCaptureScope(device: MTLDevice) {\n    myCaptureScope = MTLCaptureManager.shared().makeCaptureScope(device: device)\n    myCaptureScope?.label = \"My Capture Scope\"\n}\n\nfunc triggerProgrammaticCaptureScope() {\n    guard let captureScope = myCaptureScope else { return }\n    let captureManager = MTLCaptureManager.shared()\n    let captureDescriptor = MTLCaptureDescriptor()\n    captureDescriptor.captureObject = captureScope\n    do {\n        try captureManager.startCapture(with: captureDescriptor)\n    } catch {\n        fatalError(\"error when trying to capture: \\(error)\")\n    }\n}",
      "language" : "swift"
    },
    {
      "code" : "func runMetalCommands(commandQueue: MTLCommandQueue) {\n    myCaptureScope?.begin()\n    let commandBuffer = commandQueue.makeCommandBuffer()!\n    \/\/ Do Metal work.\n    commandBuffer.commit()\n    myCaptureScope?.end()\n}",
      "language" : "swift"
    },
    {
      "code" : "let captureManager = MTLCaptureManager.shared()\n\nguard captureManager.supportsDestination(.gpuTraceDocument) else {\n    print(\"Capturing to a GPU trace file isn't supported.\")\n    return\n}",
      "language" : "swift"
    },
    {
      "code" : "let captureDescriptor = MTLCaptureDescriptor()\ncaptureDescriptor.captureObject = self.device\ncaptureDescriptor.destination = .gpuTraceDocument\ncaptureDescriptor.outputURL = self.traceURL\n...",
      "language" : "swift"
    }
  ],
  "contentHash" : "db82b5590995ef2e03267924b295f5f4412876fde86252b40737f627b1f4861f",
  "crawledAt" : "2025-12-02T19:35:36Z",
  "id" : "A22BBEAE-24A8-493A-8E2C-F9361BF72C24",
  "kind" : "article",
  "language" : "swift",
  "overview" : "## Overview\n\nUse the [doc:\/\/com.apple.documentation\/documentation\/Metal\/MTLCaptureManager] to programmatically capture information about commands you send to a specific device object. For example, you can capture a specific frame or part of a frame, depending on your needs, by implementing a custom UI that triggers a capture, or by programmatically triggering a capture at runtime from within your app.\n\n### Enable capturing programmatically\n\nTo enable Metal capture in your app, add the `MetalCaptureEnabled` key to your `Info.plist` file with a value of `YES`. In Xcode’s property list editor, this key appears as `Metal Capture Enabled`.\n\nAlternatively, in macOS 14 and later, you can set the environment variable on your Metal app: `MTL_CAPTURE_ENABLED=1`.\n\n### Capture a device or command queue\n\nCreate an [doc:\/\/com.apple.documentation\/documentation\/Metal\/MTLCaptureDescriptor] object that defines which commands you want to record and what needs to happen after the capture is complete. To capture commands for a specific [doc:\/\/com.apple.documentation\/documentation\/Metal\/MTLDevice] or [doc:\/\/com.apple.documentation\/documentation\/Metal\/MTLCommandQueue], set the capture descriptor’s [doc:\/\/com.apple.documentation\/documentation\/Metal\/MTLCaptureDescriptor\/captureObject] property to point at the specific object to track, and call the [doc:\/\/com.apple.documentation\/documentation\/Metal\/MTLCaptureManager\/startCapture(with:)] method. To stop capturing commands, call the [doc:\/\/com.apple.documentation\/documentation\/Metal\/MTLCaptureManager\/stopCapture()] method.\n\nThe capture manager captures commands only within [doc:\/\/com.apple.documentation\/documentation\/Metal\/MTLCommandBuffer] objects that you create after the capture starts and commit before the capture stops.\n\n### Capture specific commands with a capture scope\n\nTo learn how to add custom scopes to your app, see [doc:\/\/com.apple.Xcode\/documentation\/Xcode\/Creating-and-using-custom-capture-scopes]. To capture commands using a custom scope, create an [doc:\/\/com.apple.documentation\/documentation\/Metal\/MTLCaptureScope] object and set the capture descriptor’s [doc:\/\/com.apple.documentation\/documentation\/Metal\/MTLCaptureDescriptor\/captureObject] property to point to it.\n\nTo define boundaries for the scoped capture, call the [doc:\/\/com.apple.documentation\/documentation\/Metal\/MTLCaptureScope] object’s [doc:\/\/com.apple.documentation\/documentation\/Metal\/MTLCaptureScope\/begin()] and [doc:\/\/com.apple.documentation\/documentation\/Metal\/MTLCaptureScope\/end()] methods just before and after the commands that you want to capture. Xcode automatically stops capturing when your app reaches the corresponding `end()` method of the capture scope.\n\n### Save the capture to your computer\n\nIf you want to analyze the capture later, you can skip launching the Metal debugger and save the GPU command information to a GPU trace file. Call [doc:\/\/com.apple.documentation\/documentation\/Metal\/MTLCaptureManager\/supportsDestination(_:)] on the capture manager to make sure the feature is available before attempting to record a trace file.\n\nThen, set the capture descriptor’s destination property to `MTLCaptureDestination.gpuTraceDocument` and specify the file’s destination.\n\nFor more information on replaying GPU trace files, see [doc:\/\/com.apple.Xcode\/documentation\/Xcode\/Replaying-a-GPU-trace-file].",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/Xcode\/Capturing-a-Metal-workload-programmatically\ncrawled: 2025-12-02T19:35:36Z\n---\n\n# Capturing a Metal workload programmatically\n\n**Article**\n\nAnalyze your app’s performance by invoking Metal’s frame capture.\n\n## Overview\n\nUse the [doc:\/\/com.apple.documentation\/documentation\/Metal\/MTLCaptureManager] to programmatically capture information about commands you send to a specific device object. For example, you can capture a specific frame or part of a frame, depending on your needs, by implementing a custom UI that triggers a capture, or by programmatically triggering a capture at runtime from within your app.\n\n### Enable capturing programmatically\n\nTo enable Metal capture in your app, add the `MetalCaptureEnabled` key to your `Info.plist` file with a value of `YES`. In Xcode’s property list editor, this key appears as `Metal Capture Enabled`.\n\nAlternatively, in macOS 14 and later, you can set the environment variable on your Metal app: `MTL_CAPTURE_ENABLED=1`.\n\n\n\n### Capture a device or command queue\n\nCreate an [doc:\/\/com.apple.documentation\/documentation\/Metal\/MTLCaptureDescriptor] object that defines which commands you want to record and what needs to happen after the capture is complete. To capture commands for a specific [doc:\/\/com.apple.documentation\/documentation\/Metal\/MTLDevice] or [doc:\/\/com.apple.documentation\/documentation\/Metal\/MTLCommandQueue], set the capture descriptor’s [doc:\/\/com.apple.documentation\/documentation\/Metal\/MTLCaptureDescriptor\/captureObject] property to point at the specific object to track, and call the [doc:\/\/com.apple.documentation\/documentation\/Metal\/MTLCaptureManager\/startCapture(with:)] method. To stop capturing commands, call the [doc:\/\/com.apple.documentation\/documentation\/Metal\/MTLCaptureManager\/stopCapture()] method.\n\n```swift\nfunc triggerProgrammaticCapture(device: MTLDevice) {\n    let captureManager = MTLCaptureManager.shared()\n    let captureDescriptor = MTLCaptureDescriptor()\n    captureDescriptor.captureObject = self.device\n    do {\n        try captureManager.startCapture(with: captureDescriptor)\n    } catch {\n        fatalError(\"error when trying to capture: \\(error)\")\n    }\n}\n\nfunc runMetalCommands(commandQueue: MTLCommandQueue) {\n    let commandBuffer = commandQueue.makeCommandBuffer()!\n    \/\/ Do Metal work.\n    commandBuffer.commit()\n    let captureManager = MTLCaptureManager.shared()\n    captureManager.stopCapture()\n}\n```\n\nThe capture manager captures commands only within [doc:\/\/com.apple.documentation\/documentation\/Metal\/MTLCommandBuffer] objects that you create after the capture starts and commit before the capture stops.\n\n\n\n### Capture specific commands with a capture scope\n\nTo learn how to add custom scopes to your app, see [doc:\/\/com.apple.Xcode\/documentation\/Xcode\/Creating-and-using-custom-capture-scopes]. To capture commands using a custom scope, create an [doc:\/\/com.apple.documentation\/documentation\/Metal\/MTLCaptureScope] object and set the capture descriptor’s [doc:\/\/com.apple.documentation\/documentation\/Metal\/MTLCaptureDescriptor\/captureObject] property to point to it.\n\n\n\n```swift\nfunc setupProgrammaticCaptureScope(device: MTLDevice) {\n    myCaptureScope = MTLCaptureManager.shared().makeCaptureScope(device: device)\n    myCaptureScope?.label = \"My Capture Scope\"\n}\n\nfunc triggerProgrammaticCaptureScope() {\n    guard let captureScope = myCaptureScope else { return }\n    let captureManager = MTLCaptureManager.shared()\n    let captureDescriptor = MTLCaptureDescriptor()\n    captureDescriptor.captureObject = captureScope\n    do {\n        try captureManager.startCapture(with: captureDescriptor)\n    } catch {\n        fatalError(\"error when trying to capture: \\(error)\")\n    }\n}\n```\n\nTo define boundaries for the scoped capture, call the [doc:\/\/com.apple.documentation\/documentation\/Metal\/MTLCaptureScope] object’s [doc:\/\/com.apple.documentation\/documentation\/Metal\/MTLCaptureScope\/begin()] and [doc:\/\/com.apple.documentation\/documentation\/Metal\/MTLCaptureScope\/end()] methods just before and after the commands that you want to capture. Xcode automatically stops capturing when your app reaches the corresponding `end()` method of the capture scope.\n\n```swift\nfunc runMetalCommands(commandQueue: MTLCommandQueue) {\n    myCaptureScope?.begin()\n    let commandBuffer = commandQueue.makeCommandBuffer()!\n    \/\/ Do Metal work.\n    commandBuffer.commit()\n    myCaptureScope?.end()\n}\n```\n\n\n\n### Save the capture to your computer\n\nIf you want to analyze the capture later, you can skip launching the Metal debugger and save the GPU command information to a GPU trace file. Call [doc:\/\/com.apple.documentation\/documentation\/Metal\/MTLCaptureManager\/supportsDestination(_:)] on the capture manager to make sure the feature is available before attempting to record a trace file.\n\n```swift\nlet captureManager = MTLCaptureManager.shared()\n\nguard captureManager.supportsDestination(.gpuTraceDocument) else {\n    print(\"Capturing to a GPU trace file isn't supported.\")\n    return\n}\n```\n\nThen, set the capture descriptor’s destination property to `MTLCaptureDestination.gpuTraceDocument` and specify the file’s destination.\n\n```swift\nlet captureDescriptor = MTLCaptureDescriptor()\ncaptureDescriptor.captureObject = self.device\ncaptureDescriptor.destination = .gpuTraceDocument\ncaptureDescriptor.outputURL = self.traceURL\n...\n```\n\nFor more information on replaying GPU trace files, see [doc:\/\/com.apple.Xcode\/documentation\/Xcode\/Replaying-a-GPU-trace-file].\n\n## Essentials\n\n- **Capturing a Metal workload in Xcode**: Analyze your app’s performance by configuring your project to use the Metal debugger.\n- **Replaying a GPU trace file**: Debug and profile your app’s performance using a GPU trace file in the Metal debugger.\n- **Investigating visual artifacts**: Discover, diagnose, and fix visual artifacts in your app with the Metal debugger.\n- **Optimizing GPU performance**: Find and address performance bottlenecks using the Metal debugger.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Analyze your app’s performance by configuring your project to use the Metal debugger.",
          "name" : "Capturing a Metal workload in Xcode",
          "url" : "https:\/\/developer.apple.com\/documentation\/Xcode\/Capturing-a-Metal-workload-in-Xcode"
        },
        {
          "description" : "Debug and profile your app’s performance using a GPU trace file in the Metal debugger.",
          "name" : "Replaying a GPU trace file",
          "url" : "https:\/\/developer.apple.com\/documentation\/Xcode\/Replaying-a-GPU-trace-file"
        },
        {
          "description" : "Discover, diagnose, and fix visual artifacts in your app with the Metal debugger.",
          "name" : "Investigating visual artifacts",
          "url" : "https:\/\/developer.apple.com\/documentation\/Xcode\/Investigating-visual-artifacts"
        },
        {
          "description" : "Find and address performance bottlenecks using the Metal debugger.",
          "name" : "Optimizing GPU performance",
          "url" : "https:\/\/developer.apple.com\/documentation\/Xcode\/Optimizing-GPU-performance"
        }
      ],
      "title" : "Essentials"
    }
  ],
  "source" : "appleJSON",
  "title" : "Capturing a Metal workload programmatically",
  "url" : "https:\/\/developer.apple.com\/documentation\/Xcode\/Capturing-a-Metal-workload-programmatically"
}