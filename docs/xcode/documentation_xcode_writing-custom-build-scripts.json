{
  "abstract" : "Extend your Xcode Cloud workflows with custom build scripts that perform custom tasks or install additional tools.",
  "codeExamples" : [
    {
      "code" : "#!\/bin\/sh\n\nif [[ -n $CI_PULL_REQUEST_NUMBER ]];\nthen\n    echo \"This build started from a pull request.\"\n\n    # Perform an action only if the build starts from a pull request.\nfi",
      "language" : "bash"
    },
    {
      "code" : "#!\/bin\/sh\n\n# Set the -e flag to stop running the script in case a command returns\n# a nonzero exit code.\nset -e\n\n# A command or script succeeded.\necho \"A command or script was successful.\"\nexit 0\n\n...\n\n# Something went wrong.\necho \"Something went wrong. Include helpful information here.\"\nexit 1",
      "language" : "bash"
    },
    {
      "code" : "#!\/bin\/sh\n\nif [ $CI_PRODUCT_PLATFORM = 'macOS' ]\nthen\n    .\/macos_perform_example_task.sh\nelse\n    .\/iOS_perform_example_task.sh\nfi",
      "language" : "bash"
    }
  ],
  "contentHash" : "422fd40ae63ba49bec4d7df56de618e5b85fd54db0736150ac2b660bb92e5c20",
  "crawledAt" : "2025-12-03T04:15:47Z",
  "id" : "F9B2168A-3660-4529-A28A-61018BA15B62",
  "kind" : "article",
  "language" : "swift",
  "overview" : "## Overview\n\nXcode Cloud leverages your project’s configured schemes and offers settings to create advanced workflows. However, Xcode Cloud workflows can offer even more flexibility to meet your project’s requirements. For example, you might need to install an additional third-party tool to successfully build your project, upload build artifacts to private storage, use a different app icon for nightly builds, and so on.\n\nIf you need additional flexibility in your Xcode Cloud workflows, create a *custom build script* to perform a specific task at a designated time. Xcode Cloud recognizes three different script types:\n\nFor Xcode Cloud to recognize your custom build scripts, you’ll need to place them at a specific location: the `ci_scripts` directory. Xcode Cloud runs your custom build scripts from this directory. Additionally, name the scripts according to conventions listed below. When it starts a new build, Xcode Cloud recognizes your custom build scripts automatically and runs them for every action.\n\nFor additional information about custom build scripts, see [https:\/\/developer.apple.com\/videos\/play\/wwdc2021\/10269]. For more information on installing a third-party tool, see [doc:\/\/com.apple.Xcode\/documentation\/Xcode\/Making-Dependencies-Available-to-Xcode-Cloud#Use-a-custom-build-script-to-install-a-third-party-dependency-or-tool].\n\n### Create the CI scripts directory\n\nCustom build scripts reside in a directory named `ci_scripts` that’s located in the same directory as your Xcode project or workspace, and Xcode Cloud runs your custom build scripts with this directory as the root directory.\n\nTo create the `ci_scripts` directory:\n\n### Create a custom build script\n\nWhen Xcode Cloud performs an action you’ve added to a workflow, it performs a series of steps. If you add a custom build script, Xcode Cloud runs it at a specific moment between these steps.\n\nThe name of a custom script’s corresponding file determines when Xcode Cloud runs the script; only use the following file names for your scripts:\n\n\n\nTo create a custom build script:\n\nXcode Cloud respects the shebang if the file is executable. If you don’t include a shebang as the first line of your custom script or forget to make the file executable, Xcode Cloud runs the script as `zsh $filename`, which — depending on your script — can cause a failing build.\n\nFiles you create with a custom build script aren’t available to other custom build scripts, and Xcode Cloud deletes any files a custom build script creates. As a result, downloadable Xcode Cloud build artifacts don’t include files you create with custom build scripts.\n\n### Add resources to the CI scripts directory\n\nCustom build scripts run in a temporary build environment where your source code may not be available. As a result, you need to place all resources your custom scripts access in the `ci_scripts` directory. For example, place artwork or `.plist` files in the directory.\n\nIn some cases, a custom build script needs to access a file that’s located in the repository, but placing it in the `ci_scripts` directory isn’t practical. In this case, create a symbolic link to the file in the `ci_scripts` directory. Xcode Cloud detects the symbolic link and makes it available within the `ci_scripts` directory in a subsequent phase of the running action.\n\n### Access environment variables\n\nEnvironment variables are key to custom scripts because they allow you to write flexible custom scripts with advanced control flows. For example, the following code snippet checks if the `CI_PULL_REQUEST_NUMBER` variable is present to only run a command when Xcode Cloud runs the script as part of a build from a pull request:\n\nFor a list of predefined environment variables, see [doc:\/\/com.apple.Xcode\/documentation\/Xcode\/Environment-Variable-Reference].\n\n### Define custom environment variables\n\nIn addition to predefined environment variables, you can define custom environment variables in a workflow’s Environment section. To learn more about configuring custom environment variables, see [doc:\/\/com.apple.Xcode\/documentation\/Xcode\/Xcode-Cloud-Workflow-Reference#Custom-environment-variables]\n\n### Add debug information\n\nThe output of your custom build scripts appears in the build report’s build logs. Log information that may be helpful when you debug a custom build script. However, never log sensitive information like API keys or access tokens in your shell script output unless you use a secret custom environment variable. If you mark a custom environment variable to be a secret, Xcode Cloud replaces its value with asterisks (`**********`) in build logs.\n\n### Write resilient scripts\n\nCustom build scripts can perform critical tasks like installing dependencies or uploading build artifacts to storage. Write resilient code that handles errors gracefully, and, if a command fails, return a nonzero exit code. By returning a nonzero exit code in your custom build script, you let Xcode Cloud know that something went wrong and let it fail the build to let you know that there’s an issue.\n\nThe following build script sets the `-e` option to stop the script if a command exits with a nonzero exit code. Additionally, return a nonzero exit code in case something goes wrong:\n\n### Use helper scripts in complex custom build scripts\n\nIf your repository contains more than one project, you’ll likely need to configure several Xcode Cloud workflows. Because Xcode Cloud only recognizes one `ci_scripts` directory in your repository — and that directory can only contain the three custom build scripts — you’ll need to add *helper scripts*. Helper scripts are shell scripts you place in the `ci_scripts` directory that you can use to split up the tasks of the default build scripts.\n\nYou can use the helper scripts to create a more flexible build environment, where you offload most of the logic you want Xcode Cloud to perform in a custom build script into a separate shell script file. For example, you might use environment variables to determine which Xcode Cloud workflow runs the build script, what started the build, the platform of the running build, and so on, to run logic only when applicable.\n\nWhen it comes to naming your helper scripts, use a filename that makes it easy to recognize the script’s purpose. For example, you might prefix helper scripts with the name of their intended platform and name the following script `platform-detect.sh` because it uses the `CI_PRODUCT_PLATFORM` variable to detect the platform for the current build:\n\nTo help make your helper scripts more recognizable, you should avoid prefixing the script names with `ci_`.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/Xcode\/Writing-Custom-Build-Scripts\ncrawled: 2025-12-03T04:15:47Z\n---\n\n# Writing custom build scripts\n\n**Article**\n\nExtend your Xcode Cloud workflows with custom build scripts that perform custom tasks or install additional tools.\n\n## Overview\n\nXcode Cloud leverages your project’s configured schemes and offers settings to create advanced workflows. However, Xcode Cloud workflows can offer even more flexibility to meet your project’s requirements. For example, you might need to install an additional third-party tool to successfully build your project, upload build artifacts to private storage, use a different app icon for nightly builds, and so on.\n\nIf you need additional flexibility in your Xcode Cloud workflows, create a *custom build script* to perform a specific task at a designated time. Xcode Cloud recognizes three different script types:\n\n- A *post-clone script* that runs after Xcode Cloud clones your Git repository.\n- A *pre-`xcodebuild` script* that runs before Xcode Cloud runs `xcodebuild`.\n- A *post-`xcodebuild` script* that Xcode Cloud runs after running `xcodebuild`.\n\nFor Xcode Cloud to recognize your custom build scripts, you’ll need to place them at a specific location: the `ci_scripts` directory. Xcode Cloud runs your custom build scripts from this directory. Additionally, name the scripts according to conventions listed below. When it starts a new build, Xcode Cloud recognizes your custom build scripts automatically and runs them for every action.\n\n\n\nFor additional information about custom build scripts, see [https:\/\/developer.apple.com\/videos\/play\/wwdc2021\/10269]. For more information on installing a third-party tool, see [doc:\/\/com.apple.Xcode\/documentation\/Xcode\/Making-Dependencies-Available-to-Xcode-Cloud#Use-a-custom-build-script-to-install-a-third-party-dependency-or-tool].\n\n### Create the CI scripts directory\n\nCustom build scripts reside in a directory named `ci_scripts` that’s located in the same directory as your Xcode project or workspace, and Xcode Cloud runs your custom build scripts with this directory as the root directory.\n\nTo create the `ci_scripts` directory:\n\n1. Open your project or workspace in Xcode and navigate to the Project navigator.\n2. In the Project navigator, Control-click your project and choose New Group to create the group and its corresponding directory.\n3. Name the new group `ci_scripts`.\n\n### Create a custom build script\n\nWhen Xcode Cloud performs an action you’ve added to a workflow, it performs a series of steps. If you add a custom build script, Xcode Cloud runs it at a specific moment between these steps.\n\nThe name of a custom script’s corresponding file determines when Xcode Cloud runs the script; only use the following file names for your scripts:\n\n\n\n\n\nTo create a custom build script:\n\n1. Open your project or workspace in Xcode and navigate to the Project navigator.\n2. Control-click the `ci_scripts` group you created earlier and choose New File.\n3. Choose the Shell Script template.\n4. Name the shell script `ci_post_clone.sh`, `ci_pre_xcodebuild.sh`, or `ci_post_xcodebuild.sh`.\n5. Create the file without adding it to a target.\n6. In Terminal, make the shell script an executable by running `chmod +x $filename.sh`.\n7. Add code to your custom build script — including a shebang in the first line; for example `#!\/bin\/sh` — and add it to your Git repository. Xcode Cloud runs it automatically when it starts the next build.\n\nXcode Cloud respects the shebang if the file is executable. If you don’t include a shebang as the first line of your custom script or forget to make the file executable, Xcode Cloud runs the script as `zsh $filename`, which — depending on your script — can cause a failing build.\n\n\n\nFiles you create with a custom build script aren’t available to other custom build scripts, and Xcode Cloud deletes any files a custom build script creates. As a result, downloadable Xcode Cloud build artifacts don’t include files you create with custom build scripts.\n\n### Add resources to the CI scripts directory\n\nCustom build scripts run in a temporary build environment where your source code may not be available. As a result, you need to place all resources your custom scripts access in the `ci_scripts` directory. For example, place artwork or `.plist` files in the directory.\n\n\n\nIn some cases, a custom build script needs to access a file that’s located in the repository, but placing it in the `ci_scripts` directory isn’t practical. In this case, create a symbolic link to the file in the `ci_scripts` directory. Xcode Cloud detects the symbolic link and makes it available within the `ci_scripts` directory in a subsequent phase of the running action.\n\n### Access environment variables\n\nEnvironment variables are key to custom scripts because they allow you to write flexible custom scripts with advanced control flows. For example, the following code snippet checks if the `CI_PULL_REQUEST_NUMBER` variable is present to only run a command when Xcode Cloud runs the script as part of a build from a pull request:\n\n```bash\n#!\/bin\/sh\n\nif [[ -n $CI_PULL_REQUEST_NUMBER ]];\nthen\n    echo \"This build started from a pull request.\"\n\n    # Perform an action only if the build starts from a pull request.\nfi\n```\n\nFor a list of predefined environment variables, see [doc:\/\/com.apple.Xcode\/documentation\/Xcode\/Environment-Variable-Reference].\n\n### Define custom environment variables\n\nIn addition to predefined environment variables, you can define custom environment variables in a workflow’s Environment section. To learn more about configuring custom environment variables, see [doc:\/\/com.apple.Xcode\/documentation\/Xcode\/Xcode-Cloud-Workflow-Reference#Custom-environment-variables]\n\n### Add debug information\n\nThe output of your custom build scripts appears in the build report’s build logs. Log information that may be helpful when you debug a custom build script. However, never log sensitive information like API keys or access tokens in your shell script output unless you use a secret custom environment variable. If you mark a custom environment variable to be a secret, Xcode Cloud replaces its value with asterisks (`**********`) in build logs.\n\n### Write resilient scripts\n\nCustom build scripts can perform critical tasks like installing dependencies or uploading build artifacts to storage. Write resilient code that handles errors gracefully, and, if a command fails, return a nonzero exit code. By returning a nonzero exit code in your custom build script, you let Xcode Cloud know that something went wrong and let it fail the build to let you know that there’s an issue.\n\nThe following build script sets the `-e` option to stop the script if a command exits with a nonzero exit code. Additionally, return a nonzero exit code in case something goes wrong:\n\n```bash\n#!\/bin\/sh\n\n# Set the -e flag to stop running the script in case a command returns\n# a nonzero exit code.\nset -e\n\n# A command or script succeeded.\necho \"A command or script was successful.\"\nexit 0\n\n...\n\n# Something went wrong.\necho \"Something went wrong. Include helpful information here.\"\nexit 1\n```\n\n### Use helper scripts in complex custom build scripts\n\nIf your repository contains more than one project, you’ll likely need to configure several Xcode Cloud workflows. Because Xcode Cloud only recognizes one `ci_scripts` directory in your repository — and that directory can only contain the three custom build scripts — you’ll need to add *helper scripts*. Helper scripts are shell scripts you place in the `ci_scripts` directory that you can use to split up the tasks of the default build scripts.\n\nYou can use the helper scripts to create a more flexible build environment, where you offload most of the logic you want Xcode Cloud to perform in a custom build script into a separate shell script file. For example, you might use environment variables to determine which Xcode Cloud workflow runs the build script, what started the build, the platform of the running build, and so on, to run logic only when applicable.\n\n\n\nWhen it comes to naming your helper scripts, use a filename that makes it easy to recognize the script’s purpose. For example, you might prefix helper scripts with the name of their intended platform and name the following script `platform-detect.sh` because it uses the `CI_PRODUCT_PLATFORM` variable to detect the platform for the current build:\n\n```bash\n#!\/bin\/sh\n\nif [ $CI_PRODUCT_PLATFORM = 'macOS' ]\nthen\n    .\/macos_perform_example_task.sh\nelse\n    .\/iOS_perform_example_task.sh\nfi\n```\n\nTo help make your helper scripts more recognizable, you should avoid prefixing the script names with `ci_`.\n\n## Custom build scripts\n\n- **Environment variable reference**: Review predefined environment variables you use in custom build scripts.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Review predefined environment variables you use in custom build scripts.",
          "name" : "Environment variable reference",
          "url" : "https:\/\/developer.apple.com\/documentation\/Xcode\/Environment-Variable-Reference"
        }
      ],
      "title" : "Custom build scripts"
    }
  ],
  "source" : "appleJSON",
  "title" : "Writing custom build scripts",
  "url" : "https:\/\/developer.apple.com\/documentation\/Xcode\/Writing-Custom-Build-Scripts"
}