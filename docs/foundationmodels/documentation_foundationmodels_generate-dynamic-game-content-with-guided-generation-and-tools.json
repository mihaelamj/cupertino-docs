{
  "abstract" : "Make gameplay more lively with AI generated dialog and encounters personalized to the player.",
  "codeExamples" : [
    {
      "code" : "struct Barista: Character {\n    let id = UUID()\n    let displayName = \"Barista\"\n    let firstLine = \"Hey there. Can you get the dream orders?\"\n\n    let persona = \"\"\"\n        Chike is the head barista at Dream Coffee, and loves serving up the perfect cup of coffee \n        to all the dreamers and creatures in the dream realm. Today is a particularly busy day, so \n        Chike is happy to have the help of a new trainee barista named Player.\n        \"\"\"\n\n    let errorResponse = \"Maybe let's stop chatting? We've got coffee to serve.\"\n}",
      "language" : "swift"
    },
    {
      "code" : "let instructions = \"\"\"\n    A multiturn conversation between a game character and the player of this game. \\\n    You are \\(character.displayName). Refer to \\(character.displayName) in the first-person \\\n    (like \"I\" or \"me\"). You must respond in the voice of \\(character.persona).\\\n\n    Keep your responses short and positive. Remember: Because this is the dream realm, \\\n    everything is free at this coffee shop and the baristas are paid in creative inpiration.\n\n    You just said: \"\\(startWith)\"\n    \"\"\"",
      "language" : "swift"
    },
    {
      "code" : "let response = try await session.respond(\n    to: userInput\n)\nlet dialog = response.content\n\n\/\/ Verify whether the input contains any blocked words or phrases.\nif textIsOK(dialog) {\n    nextUtterance = dialog\n    isGenerating = false\n} else {\n    nextUtterance = character.errorResponse\n    isGenerating = false\n    resetSession(character, startWith: character.resumeConversationLine)\n}",
      "language" : "swift"
    },
    {
      "code" : "@Generable\nstruct NPC: Equatable {\n    let name: String\n    let coffeeOrder: String\n    let picture: GenerableImage\n}",
      "language" : "swift"
    },
    {
      "code" : "let session = LanguageModelSession {\n    \"\"\"\n    A conversation between the Player and a helpful assistant. This is a fantasy \n    RPG game that takes place at Dream Coffee, the beloved coffee shop of the \n    dream realm. Your role is to use your imagination to generate fun game characters.\n    \"\"\"\n}\nlet prompt = \"\"\"\n    Create an NPC customer with a fun personality suitable for the dream realm. Have the customer order\n    coffee. Here are some examples to inspire you:\n    {name: \"Thimblefoot\", imageDescription: \"A horse with a rainbow mane\",\n    coffeeOrder: \"I would like a coffee that's refreshing and sweet like grass of a summer meadow\"}\n    {name: \"Spiderkid\", imageDescription: \"A furry spider with a cool baseball cap\",\n    coffeeOrder: \"An iced coffee please, that's as spooky as me!\"}\n    {name: \"Wise Fairy\", imageDescription: \"A blue glowing fairy that radiates wisdom and sparkles\",\n    coffeeOrder: \"Something simple and plant-based please, that will restore my wise energy.\"}\n    \"\"\"\n\n\/\/ Generate the NPC using the custom generable type.\nlet npc = try await session.respond(\n    to: prompt,\n    generating: NPC.self,\n).content",
      "language" : "swift"
    },
    {
      "code" : "let session = LanguageModelSession {\n    \"\"\"\n    A conversation between a user and a helpful assistant. This is a fantasy RPG \n    game that takes place at Dream Coffee, the beloved coffee shop of the dream \n    realm. Your role is to pretend to be the following customer:\n    \\(customer.name): \\(customer.picture.imageDescription)\n    \"\"\"\n}\nlet prompt = \"\"\"\n    You have just ordered the following drink:\n    \\(customer.coffeeOrder)\n    The barista has just made you this drink:\n    \\(drink)\n    Does this drink match your expectations? Do you like it? You must respond \n    with helpful feedback for the barista. If you like your drink, give it a \n    compliment. If you dislike your drink, politely tell the barista why.\n    \"\"\"\nreturn try await session.respond(to: prompt).content",
      "language" : "swift"
    },
    {
      "code" : "if let customer = character as? GeneratedCustomer {\n    newSession = LanguageModelSession(\n        tools: [CalendarTool(contactName: customer.displayName)],\n        instructions: instructions\n    )\n}",
      "language" : "swift"
    },
    {
      "code" : "description = \"\"\"\n    Get an event from the player's calendar with \\(contactName). \\\n    Today is \\(Date().formatted(date: .complete, time: .omitted))\n    \"\"\"",
      "language" : "swift"
    },
    {
      "code" : "let session = LanguageModelSession(\n    tools: [contactsTool],\n    instructions: \"\"\"\n        Use the \\(contactsTool.name) tool to get a name for a customer.\n        \"\"\"\n)",
      "language" : "swift"
    }
  ],
  "contentHash" : "ab732fba24e0382bcde28d15760109da1440bae7ec76831aa0115d64d2e9b951",
  "crawledAt" : "2025-12-02T15:42:01Z",
  "id" : "907A37DA-097D-412B-87A1-F5D8BD55B861",
  "kind" : "unknown",
  "language" : "swift",
  "module" : "Foundation Models",
  "overview" : "## Overview\n\nThis sample code project demonstrates the Foundation Models framework and its ability to generate dynamic content for a game. Instead of using the same dialog script for customer encounters, the app dynamically generates dialog so that each time a player talks to a character, they can have a different conversation.\n\n\n\nThe game combines several framework capabilities — like guided generation and tool calling — to create dynamic, personalized gameplay experiences. You interact with both scripted characters, like the head barista, and procedurally generated customers, each with unique personalities, appearances, and coffee orders. As you serve customers, you can engage in conversations, take custom coffee orders, and receive feedback on your brewing skills — all powered by an on-device foundation model.\n\n## Generate character dialog\n\nThe sample app generates dialog for characters by using `Character` to describe the character, like the barista:\n\nA `persona` is a detailed description of the character that the model should pretend to be. The app uses a fixed error response when it encounters a generation error or content that the system blocks for safety.\n\nThe `DialogEngine` class manages conoversations for all characters in the game using [doc:\/\/com.apple.foundationmodels\/documentation\/FoundationModels\/LanguageModelSession]. Each character maintains their own conversation session, allowing for persistent, contextual dialog that remembers previous interactions. When a conversation begins with a character, the dialog engine creates a new session with specific instructions that define the character’s personality and role:\n\nWhen the player provides input text to *talk* to the character, the sample app uses the input as a prompt to the session. When generating a response, the dialog engine includes safety mechanisms to keep conversations on topic. It maintains block lists for words and phrases that characters shouldn’t discuss, ensuring nonplayer characters (NPCs) focus on coffee-related topics. If the app generates content containing blocked terms, it automatically resets the conversation and provides the default error response for the character.\n\nIf the output dialog fails the blocked phrases check, the model may break character or discuss something that’s outside of the game world. To keep the dialog immersive, set `nextUtterance` to the character’s fixed error response and reset the session.\n\n## Generate random encounters\n\nThe `EncounterEngine` creates unique customer encounters using the [doc:\/\/com.apple.foundationmodels\/documentation\/FoundationModels\/Generable] protocol to generate structured content. Each encounter produces an NPC with a name, coffee order, and visual description.\n\nThe process of generating an NPC uses a [doc:\/\/com.apple.foundationmodels\/documentation\/FoundationModels\/LanguageModelSession] with a prompt that provide examples of the output format:\n\nEach generated NPC includes a `GenerableImage` that creates a visual representation of the character by using [doc:\/\/com.apple.documentation\/documentation\/ImagePlayground]. The image generation avoids human-like appearances, focusing instead on fantastical creatures, animals, and objects that fit the dream realm aesthetic. The `GenerableImage` class shows how to use [doc:\/\/com.apple.foundationmodels\/documentation\/FoundationModels\/GenerationSchema] to describe the properties and guides of the object. This allows for creating dynamic schemas when all of the details of the generable type isn’t known until runtime.\n\n## Use a language model to judge in-game creations\n\nThe game uses the on-device model to evaluate player performance through the `judgeDrink(drink:)` method in the encounter engine. When the player creates a coffee drink for a customer, the model assumes the customer’s persona and provides feedback on whether the drink matches their original order.\n\nThe judging system creates a new [doc:\/\/com.apple.foundationmodels\/documentation\/FoundationModels\/LanguageModelSession] that uses the specific customer’s personality and preferences, and a prompt that provides the drink details for the model to evaluate:\n\nThe model then compares the player’s creation against the customer’s original order, providing contextual feedback that’s authentic to the character’s personality. This creates a dynamic evaluation system where the same drink might receive different reactions from different customers based on their unique preferences and personas.\n\n## Use tools to personalize game content\n\nFor customers that the sample generates, provide the dialog engine with custom tools, like `CalendarTool` to create more personalized interactions. This allows characters to reference the player’s on-device information, making conversations feel more natural and connected to the player’s actual life.\n\nThe `CalendarTool` integrates with [doc:\/\/com.apple.documentation\/documentation\/EventKit] to access the player’s calendar events, and allows characters to reference real upcoming events that involve the customer’s name if they are an attendee:\n\nThe tool description tells the model what it uses the tool for:\n\nThe sample app also provides a `ContactTool` that accesses the player’s contacts to find names of people born in specific months. This allows the game to generate a coffee shop customer with names the player is familiar with.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/foundationmodels\/generate-dynamic-game-content-with-guided-generation-and-tools\ncrawled: 2025-12-02T15:42:01Z\n---\n\n# Generate dynamic game content with guided generation and tools\n\n**Sample Code**\n\nMake gameplay more lively with AI generated dialog and encounters personalized to the player.\n\n## Overview\n\nThis sample code project demonstrates the Foundation Models framework and its ability to generate dynamic content for a game. Instead of using the same dialog script for customer encounters, the app dynamically generates dialog so that each time a player talks to a character, they can have a different conversation.\n\n\n\nThe game combines several framework capabilities — like guided generation and tool calling — to create dynamic, personalized gameplay experiences. You interact with both scripted characters, like the head barista, and procedurally generated customers, each with unique personalities, appearances, and coffee orders. As you serve customers, you can engage in conversations, take custom coffee orders, and receive feedback on your brewing skills — all powered by an on-device foundation model.\n\n\n\n## Generate character dialog\n\nThe sample app generates dialog for characters by using `Character` to describe the character, like the barista:\n\n```swift\nstruct Barista: Character {\n    let id = UUID()\n    let displayName = \"Barista\"\n    let firstLine = \"Hey there. Can you get the dream orders?\"\n\n    let persona = \"\"\"\n        Chike is the head barista at Dream Coffee, and loves serving up the perfect cup of coffee \n        to all the dreamers and creatures in the dream realm. Today is a particularly busy day, so \n        Chike is happy to have the help of a new trainee barista named Player.\n        \"\"\"\n\n    let errorResponse = \"Maybe let's stop chatting? We've got coffee to serve.\"\n}\n```\n\nA `persona` is a detailed description of the character that the model should pretend to be. The app uses a fixed error response when it encounters a generation error or content that the system blocks for safety.\n\nThe `DialogEngine` class manages conoversations for all characters in the game using [doc:\/\/com.apple.foundationmodels\/documentation\/FoundationModels\/LanguageModelSession]. Each character maintains their own conversation session, allowing for persistent, contextual dialog that remembers previous interactions. When a conversation begins with a character, the dialog engine creates a new session with specific instructions that define the character’s personality and role:\n\n```swift\nlet instructions = \"\"\"\n    A multiturn conversation between a game character and the player of this game. \\\n    You are \\(character.displayName). Refer to \\(character.displayName) in the first-person \\\n    (like \"I\" or \"me\"). You must respond in the voice of \\(character.persona).\\\n\n    Keep your responses short and positive. Remember: Because this is the dream realm, \\\n    everything is free at this coffee shop and the baristas are paid in creative inpiration.\n\n    You just said: \"\\(startWith)\"\n    \"\"\"\n```\n\nWhen the player provides input text to *talk* to the character, the sample app uses the input as a prompt to the session. When generating a response, the dialog engine includes safety mechanisms to keep conversations on topic. It maintains block lists for words and phrases that characters shouldn’t discuss, ensuring nonplayer characters (NPCs) focus on coffee-related topics. If the app generates content containing blocked terms, it automatically resets the conversation and provides the default error response for the character.\n\n```swift\nlet response = try await session.respond(\n    to: userInput\n)\nlet dialog = response.content\n\n\/\/ Verify whether the input contains any blocked words or phrases.\nif textIsOK(dialog) {\n    nextUtterance = dialog\n    isGenerating = false\n} else {\n    nextUtterance = character.errorResponse\n    isGenerating = false\n    resetSession(character, startWith: character.resumeConversationLine)\n}\n```\n\nIf the output dialog fails the blocked phrases check, the model may break character or discuss something that’s outside of the game world. To keep the dialog immersive, set `nextUtterance` to the character’s fixed error response and reset the session.\n\n## Generate random encounters\n\nThe `EncounterEngine` creates unique customer encounters using the [doc:\/\/com.apple.foundationmodels\/documentation\/FoundationModels\/Generable] protocol to generate structured content. Each encounter produces an NPC with a name, coffee order, and visual description.\n\n```swift\n@Generable\nstruct NPC: Equatable {\n    let name: String\n    let coffeeOrder: String\n    let picture: GenerableImage\n}\n```\n\nThe process of generating an NPC uses a [doc:\/\/com.apple.foundationmodels\/documentation\/FoundationModels\/LanguageModelSession] with a prompt that provide examples of the output format:\n\n```swift\nlet session = LanguageModelSession {\n    \"\"\"\n    A conversation between the Player and a helpful assistant. This is a fantasy \n    RPG game that takes place at Dream Coffee, the beloved coffee shop of the \n    dream realm. Your role is to use your imagination to generate fun game characters.\n    \"\"\"\n}\nlet prompt = \"\"\"\n    Create an NPC customer with a fun personality suitable for the dream realm. Have the customer order\n    coffee. Here are some examples to inspire you:\n    {name: \"Thimblefoot\", imageDescription: \"A horse with a rainbow mane\",\n    coffeeOrder: \"I would like a coffee that's refreshing and sweet like grass of a summer meadow\"}\n    {name: \"Spiderkid\", imageDescription: \"A furry spider with a cool baseball cap\",\n    coffeeOrder: \"An iced coffee please, that's as spooky as me!\"}\n    {name: \"Wise Fairy\", imageDescription: \"A blue glowing fairy that radiates wisdom and sparkles\",\n    coffeeOrder: \"Something simple and plant-based please, that will restore my wise energy.\"}\n    \"\"\"\n\n\/\/ Generate the NPC using the custom generable type.\nlet npc = try await session.respond(\n    to: prompt,\n    generating: NPC.self,\n).content\n```\n\nEach generated NPC includes a `GenerableImage` that creates a visual representation of the character by using [doc:\/\/com.apple.documentation\/documentation\/ImagePlayground]. The image generation avoids human-like appearances, focusing instead on fantastical creatures, animals, and objects that fit the dream realm aesthetic. The `GenerableImage` class shows how to use [doc:\/\/com.apple.foundationmodels\/documentation\/FoundationModels\/GenerationSchema] to describe the properties and guides of the object. This allows for creating dynamic schemas when all of the details of the generable type isn’t known until runtime.\n\n## Use a language model to judge in-game creations\n\nThe game uses the on-device model to evaluate player performance through the `judgeDrink(drink:)` method in the encounter engine. When the player creates a coffee drink for a customer, the model assumes the customer’s persona and provides feedback on whether the drink matches their original order.\n\nThe judging system creates a new [doc:\/\/com.apple.foundationmodels\/documentation\/FoundationModels\/LanguageModelSession] that uses the specific customer’s personality and preferences, and a prompt that provides the drink details for the model to evaluate:\n\n```swift\nlet session = LanguageModelSession {\n    \"\"\"\n    A conversation between a user and a helpful assistant. This is a fantasy RPG \n    game that takes place at Dream Coffee, the beloved coffee shop of the dream \n    realm. Your role is to pretend to be the following customer:\n    \\(customer.name): \\(customer.picture.imageDescription)\n    \"\"\"\n}\nlet prompt = \"\"\"\n    You have just ordered the following drink:\n    \\(customer.coffeeOrder)\n    The barista has just made you this drink:\n    \\(drink)\n    Does this drink match your expectations? Do you like it? You must respond \n    with helpful feedback for the barista. If you like your drink, give it a \n    compliment. If you dislike your drink, politely tell the barista why.\n    \"\"\"\nreturn try await session.respond(to: prompt).content\n```\n\nThe model then compares the player’s creation against the customer’s original order, providing contextual feedback that’s authentic to the character’s personality. This creates a dynamic evaluation system where the same drink might receive different reactions from different customers based on their unique preferences and personas.\n\n## Use tools to personalize game content\n\nFor customers that the sample generates, provide the dialog engine with custom tools, like `CalendarTool` to create more personalized interactions. This allows characters to reference the player’s on-device information, making conversations feel more natural and connected to the player’s actual life.\n\nThe `CalendarTool` integrates with [doc:\/\/com.apple.documentation\/documentation\/EventKit] to access the player’s calendar events, and allows characters to reference real upcoming events that involve the customer’s name if they are an attendee:\n\n```swift\nif let customer = character as? GeneratedCustomer {\n    newSession = LanguageModelSession(\n        tools: [CalendarTool(contactName: customer.displayName)],\n        instructions: instructions\n    )\n}\n```\n\nThe tool description tells the model what it uses the tool for:\n\n```swift\ndescription = \"\"\"\n    Get an event from the player's calendar with \\(contactName). \\\n    Today is \\(Date().formatted(date: .complete, time: .omitted))\n    \"\"\"\n```\n\nThe sample app also provides a `ContactTool` that accesses the player’s contacts to find names of people born in specific months. This allows the game to generate a coffee shop customer with names the player is familiar with.\n\n```swift\nlet session = LanguageModelSession(\n    tools: [contactsTool],\n    instructions: \"\"\"\n        Use the \\(contactsTool.name) tool to get a name for a customer.\n        \"\"\"\n)\n```\n\n## Tool calling\n\n- **Expanding generation with tool calling**: Build tools that enable the model to perform tasks that are specific to your use case.\n- **Tool**: A tool that a model can call to gather information at runtime or perform side effects.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Build tools that enable the model to perform tasks that are specific to your use case.",
          "name" : "Expanding generation with tool calling",
          "url" : "https:\/\/developer.apple.com\/documentation\/FoundationModels\/expanding-generation-with-tool-calling"
        },
        {
          "description" : "A tool that a model can call to gather information at runtime or perform side effects.",
          "name" : "Tool",
          "url" : "https:\/\/developer.apple.com\/documentation\/FoundationModels\/Tool"
        }
      ],
      "title" : "Tool calling"
    }
  ],
  "source" : "appleJSON",
  "title" : "Generate dynamic game content with guided generation and tools",
  "url" : "https:\/\/developer.apple.com\/documentation\/foundationmodels\/generate-dynamic-game-content-with-guided-generation-and-tools"
}