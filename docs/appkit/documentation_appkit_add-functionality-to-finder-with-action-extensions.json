{
  "abstract" : "Implement Action Extensions to provide quick access to commonly used features of your app.",
  "codeExamples" : [
    {
      "code" : "SUBQUERY (\n    extensionItems,\n    $extensionItem,\n    SUBQUERY (\n        $extensionItem.attachments,\n        $attachment,\n        ANY $attachment.registeredTypeIdentifiers UTI-CONFORMS-TO \"public.png\"\n    ).@count == $extensionItem.attachments.@count\n).@count == 1"
    },
    {
      "code" : "let itemProvider = NSItemProvider()\nitemProvider.registerFileRepresentation(\n    forTypeIdentifier: kUTTypePNG as String, fileOptions: [.openInPlace],\n    visibility: .all, loadHandler: { completionHandler in\n        guard let sourceImage = NSImage(contentsOf: sourceUrl) else { return nil }\n        let thumbnailImage = sourceImage.thumbnailImage\n        let thumbnailUrl = self.thumbnailUrl(for: sourceUrl)\n        thumbnailImage.savePNGToDisk(at: thumbnailUrl)\n        completionHandler(thumbnailUrl, false, nil)\n        return nil\n    }\n)",
      "language" : "swift"
    },
    {
      "code" : "let itemReplacementDirectory = try FileManager.default.url(\n    for: .itemReplacementDirectory, in: .userDomainMask,\n    appropriateFor: URL(fileURLWithPath: NSHomeDirectory()), create: true)\nlet thumbnailFilename = sourceUrl.deletingPathExtension().lastPathComponent + \" Thumbnail.png\"",
      "language" : "swift"
    },
    {
      "code" : "let outputItem = NSExtensionItem()\noutputItem.attributedContentText = NSAttributedString(string: inputContent.string.uppercased())\ncontext.completeRequest(returningItems: [outputItem], completionHandler: nil)",
      "language" : "swift"
    },
    {
      "code" : "let cancelError = NSError(domain: NSCocoaErrorDomain, code: NSUserCancelledError, userInfo: nil)\ncontext.cancelRequest(withError: cancelError)",
      "language" : "swift"
    }
  ],
  "contentHash" : "9c4066b09de64c9954ca3f54b2f598bf57b26b7befbb5ed8a2a8391b8a014cab",
  "crawledAt" : "2025-12-02T15:28:31Z",
  "id" : "F15D312C-9BB6-49C0-9BFF-4E402990448C",
  "kind" : "unknown",
  "language" : "swift",
  "module" : "AppKit",
  "overview" : "## Overview\n\nAction Extensions can let users access features of your app directly from macOS. For example, if your app contains the functionality to perform image processing, an Action Extension could allow users to process their images directly from Finder. This sample code project creates three Action Extensions, two for processing images and one for processing text. One extension also presents a user interface and all three are available from both the Touch Bar and Finder Preview pane.\n\nThe project consists of four targets:\n\nThe extensions in this sample all accept file data from Finder, process it, and output the data back to Finder.\n\nBy default, new Action Extensions are not enabled in macOS. After running this sample code project, enable the extensions by selecting the “Create Thumbnail”, “Make PNG Opaque”, and “Convert Text to Upper Case” checkboxes in the Actions, Finder, and Touch Bar categories of the [https:\/\/support.apple.com\/guide\/mac-help\/change-extensions-preferences-mchl8baf92fe\/mac].\n\n### Accept File Data\n\nThe system makes Action Extensions available depending on the type of data that the user has selected in Finder. For example, if the user selects a `PNG` file, Action Extensions that support images are shown. Each of the extensions in this sample operate on different kinds of input content:\n\nThe `NSExtensionActivationRule` key in the `Info.plist` of the associated target determines the conditions under which extensions are available. The value for this key can either be a dictionary, or a string.\n\n`ThumbnailAction` and `UppercaseAction` are both configured with dictionary values. `ThumbnailAction` specifies that it accepts image data with the `NSExtensionActivationSupportsImageWithMaxCount` key and `UppercaseAction` specifies that it accepts text data with the `NSExtensionActivationSupportsText` key.\n\nFor more information on valid dictionary keys for `NSExtensionActivationRule`, see the [https:\/\/developer.apple.com\/library\/archive\/documentation\/General\/Reference\/InfoPlistKeyReference\/Articles\/AppExtensionKeys.html#\/\/apple_ref\/doc\/uid\/TP40014212-SW10].\n\n`RemoveOpacityAction` uses a [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSPredicate] query as a string value for the `NSExtensionActivationRule`. The query in this sample project filters images to only be valid if they are in PNG format.\n\nFor more information on defining extension activation rules, see the [https:\/\/developer.apple.com\/library\/archive\/documentation\/General\/Conceptual\/ExtensibilityPG\/ExtensionScenarios.html#\/\/apple_ref\/doc\/uid\/TP40014214-CH21-SW8].\n\n### Process Input Attachments\n\nWhen a user invokes an Action Extension, the system instantiates the [https:\/\/developer.apple.com\/library\/archive\/documentation\/General\/Reference\/InfoPlistKeyReference\/Articles\/AppExtensionKeys.html#\/\/apple_ref\/doc\/uid\/TP40014212-SW3] specified in the `Info.plist` and asks it to handle the request through the [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSExtensionRequestHandling] protocol.\n\nThe system calls the [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSExtensionRequestHandling\/beginRequest(with:)] method and passes in an [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSExtensionContext]. To access the input files, use the [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSExtensionItem\/attachments] property of the [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSExtensionItem] contained in the [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSExtensionContext\/inputItems] array.\n\nOnce processing completes, pass output files back to the system by creating new [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSItemProvider] objects and registering them with [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSItemProvider\/registerFileRepresentation(forTypeIdentifier:fileOptions:visibility:loadHandler:)].\n\nTo obtain the correct directory path for writing output files, use [doc:\/\/com.apple.documentation\/documentation\/Foundation\/FileManager\/url(for:in:appropriateFor:create:)], passing the [doc:\/\/com.apple.documentation\/documentation\/Foundation\/FileManager\/SearchPathDirectory\/itemReplacementDirectory] constant.\n\nFinally, signal that the action is complete by calling [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSExtensionContext\/completeRequest(returningItems:completionHandler:)].\n\n### Process Text Data\n\nThe `UppercaseAction` extension accepts any text, either supplied as attachments in the same way as `ThumbnailAction` and `RemoveOpacityAction`, or from other sources such as a standard `NSTextField` control. Check the [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSExtensionItem\/attributedContentText] property for input from text fields.\n\nIf `attributedContentText` is empty, check for input in the [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSExtensionItem\/attachments] property of [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSExtensionItem].\n\n### Present a User Interface\n\nIf the action requires user interaction then the extension may present a user interface. Set the [https:\/\/developer.apple.com\/library\/archive\/documentation\/General\/Reference\/InfoPlistKeyReference\/Articles\/AppExtensionKeys.html#\/\/apple_ref\/doc\/uid\/TP40014212-SW15] key in the `Info.plist` to `com.apple.ui-services` and ensure that the principal class is a subclass of  [doc:\/\/com.apple.appkit\/documentation\/AppKit\/NSViewController]. If the extension does not require user interaction, specify `com.apple.services` and have the principal class conform to `NSExtensionRequestHandling`.\n\nExtensions that present a user interface show their view controller’s view immediately after the extension calls [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSExtensionRequestHandling\/beginRequest(with:)] and should input files with the [doc:\/\/com.apple.appkit\/documentation\/AppKit\/NSViewController\/extensionContext] property of [doc:\/\/com.apple.appkit\/documentation\/AppKit\/NSViewController].\n\nOnce the extension’s user interface has completed any required user interaction for the task, process the files in the normal way by calling [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSExtensionContext\/completeRequest(returningItems:completionHandler:)].\n\nTo cancel the task, use the [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSExtensionContext\/cancelRequest(withError:)]. Pass a [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSUserCancelledError-swift.var] if the user canceled the task, or an error caused the failure.\n\n### Support the Touch Bar and Finder Preview Pane\n\nUsers may also access Action Extensions from the Touch Bar and from the Quick Actions menu in Finder’s Preview pane. Set both `NSExtensionServiceAllowsFinderPreviewItem` and `NSExtensionServiceAllowsTouchBarItem` to `YES` in the `Info.plist` to support the Touch Bar and Preview Pane.\n\nEach extension must also have a template icon for use in the Quick Actions menu and the Finder Preview pane. Specify the icon with the `NSExtensionServiceTouchBarIconName` key of the `Info.plist` for each target. For more information, see the [https:\/\/developer.apple.com\/design\/human-interface-guidelines\/activity-views#Share-and-action-extensions]. The color of the Touch Bar button can also be customized using the `NSExtensionServiceTouchBarBezelColorName` key. By default, this is a `TouchBarBezel` color but can be any color in the asset catalog for the target.\n\nFor information on how to add Quick Actions to the Touch Bar see the [https:\/\/support.apple.com\/guide\/automator\/use-quick-action-workflows-aut73234890a\/mac#aut7b29b7fc1].",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/AppKit\/add-functionality-to-finder-with-action-extensions\ncrawled: 2025-12-02T15:28:31Z\n---\n\n# Add Functionality to Finder with Action Extensions\n\n**Sample Code**\n\nImplement Action Extensions to provide quick access to commonly used features of your app.\n\n## Overview\n\nAction Extensions can let users access features of your app directly from macOS. For example, if your app contains the functionality to perform image processing, an Action Extension could allow users to process their images directly from Finder. This sample code project creates three Action Extensions, two for processing images and one for processing text. One extension also presents a user interface and all three are available from both the Touch Bar and Finder Preview pane.\n\nThe project consists of four targets:\n\n- A macOS app target that has no functionality, but would normally contain your main application.\n- `ThumbnailAction`, an Action Extension target that takes images of any type as inputs and outputs thumbnail versions of them. This extension preserves the original input files and creates thumbnails as new files.\n- `RemoveOpacityAction`, an Action Extension target that takes PNG images as inputs and replaces them with opaque versions of the same images. During processing, this extension prompts the user for a color to draw as the background behind the transparent image.\n- `UppercaseAction`, an Action Extension target that takes text as input and converts it to be uppercase.\n\nThe extensions in this sample all accept file data from Finder, process it, and output the data back to Finder.\n\nBy default, new Action Extensions are not enabled in macOS. After running this sample code project, enable the extensions by selecting the “Create Thumbnail”, “Make PNG Opaque”, and “Convert Text to Upper Case” checkboxes in the Actions, Finder, and Touch Bar categories of the [https:\/\/support.apple.com\/guide\/mac-help\/change-extensions-preferences-mchl8baf92fe\/mac].\n\n### Accept File Data\n\nThe system makes Action Extensions available depending on the type of data that the user has selected in Finder. For example, if the user selects a `PNG` file, Action Extensions that support images are shown. Each of the extensions in this sample operate on different kinds of input content:\n\n- `ThumbnailAction` operates on *any* kind of image.\n- `RemoveOpacityAction` operates specifically on PNG images.\n- `UppercaseAction` operates on text.\n\nThe `NSExtensionActivationRule` key in the `Info.plist` of the associated target determines the conditions under which extensions are available. The value for this key can either be a dictionary, or a string.\n\n`ThumbnailAction` and `UppercaseAction` are both configured with dictionary values. `ThumbnailAction` specifies that it accepts image data with the `NSExtensionActivationSupportsImageWithMaxCount` key and `UppercaseAction` specifies that it accepts text data with the `NSExtensionActivationSupportsText` key.\n\nFor more information on valid dictionary keys for `NSExtensionActivationRule`, see the [https:\/\/developer.apple.com\/library\/archive\/documentation\/General\/Reference\/InfoPlistKeyReference\/Articles\/AppExtensionKeys.html#\/\/apple_ref\/doc\/uid\/TP40014212-SW10].\n\n`RemoveOpacityAction` uses a [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSPredicate] query as a string value for the `NSExtensionActivationRule`. The query in this sample project filters images to only be valid if they are in PNG format.\n\n```\nSUBQUERY (\n    extensionItems,\n    $extensionItem,\n    SUBQUERY (\n        $extensionItem.attachments,\n        $attachment,\n        ANY $attachment.registeredTypeIdentifiers UTI-CONFORMS-TO \"public.png\"\n    ).@count == $extensionItem.attachments.@count\n).@count == 1\n```\n\nFor more information on defining extension activation rules, see the [https:\/\/developer.apple.com\/library\/archive\/documentation\/General\/Conceptual\/ExtensibilityPG\/ExtensionScenarios.html#\/\/apple_ref\/doc\/uid\/TP40014214-CH21-SW8].\n\n### Process Input Attachments\n\nWhen a user invokes an Action Extension, the system instantiates the [https:\/\/developer.apple.com\/library\/archive\/documentation\/General\/Reference\/InfoPlistKeyReference\/Articles\/AppExtensionKeys.html#\/\/apple_ref\/doc\/uid\/TP40014212-SW3] specified in the `Info.plist` and asks it to handle the request through the [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSExtensionRequestHandling] protocol.\n\nThe system calls the [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSExtensionRequestHandling\/beginRequest(with:)] method and passes in an [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSExtensionContext]. To access the input files, use the [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSExtensionItem\/attachments] property of the [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSExtensionItem] contained in the [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSExtensionContext\/inputItems] array.\n\nOnce processing completes, pass output files back to the system by creating new [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSItemProvider] objects and registering them with [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSItemProvider\/registerFileRepresentation(forTypeIdentifier:fileOptions:visibility:loadHandler:)].\n\n```swift\nlet itemProvider = NSItemProvider()\nitemProvider.registerFileRepresentation(\n    forTypeIdentifier: kUTTypePNG as String, fileOptions: [.openInPlace],\n    visibility: .all, loadHandler: { completionHandler in\n        guard let sourceImage = NSImage(contentsOf: sourceUrl) else { return nil }\n        let thumbnailImage = sourceImage.thumbnailImage\n        let thumbnailUrl = self.thumbnailUrl(for: sourceUrl)\n        thumbnailImage.savePNGToDisk(at: thumbnailUrl)\n        completionHandler(thumbnailUrl, false, nil)\n        return nil\n    }\n)\n```\n\nTo obtain the correct directory path for writing output files, use [doc:\/\/com.apple.documentation\/documentation\/Foundation\/FileManager\/url(for:in:appropriateFor:create:)], passing the [doc:\/\/com.apple.documentation\/documentation\/Foundation\/FileManager\/SearchPathDirectory\/itemReplacementDirectory] constant.\n\n```swift\nlet itemReplacementDirectory = try FileManager.default.url(\n    for: .itemReplacementDirectory, in: .userDomainMask,\n    appropriateFor: URL(fileURLWithPath: NSHomeDirectory()), create: true)\nlet thumbnailFilename = sourceUrl.deletingPathExtension().lastPathComponent + \" Thumbnail.png\"\n```\n\nFinally, signal that the action is complete by calling [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSExtensionContext\/completeRequest(returningItems:completionHandler:)].\n\n\n\n### Process Text Data\n\nThe `UppercaseAction` extension accepts any text, either supplied as attachments in the same way as `ThumbnailAction` and `RemoveOpacityAction`, or from other sources such as a standard `NSTextField` control. Check the [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSExtensionItem\/attributedContentText] property for input from text fields.\n\nIf `attributedContentText` is empty, check for input in the [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSExtensionItem\/attachments] property of [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSExtensionItem].\n\n```swift\nlet outputItem = NSExtensionItem()\noutputItem.attributedContentText = NSAttributedString(string: inputContent.string.uppercased())\ncontext.completeRequest(returningItems: [outputItem], completionHandler: nil)\n```\n\n### Present a User Interface\n\nIf the action requires user interaction then the extension may present a user interface. Set the [https:\/\/developer.apple.com\/library\/archive\/documentation\/General\/Reference\/InfoPlistKeyReference\/Articles\/AppExtensionKeys.html#\/\/apple_ref\/doc\/uid\/TP40014212-SW15] key in the `Info.plist` to `com.apple.ui-services` and ensure that the principal class is a subclass of  [doc:\/\/com.apple.appkit\/documentation\/AppKit\/NSViewController]. If the extension does not require user interaction, specify `com.apple.services` and have the principal class conform to `NSExtensionRequestHandling`.\n\n\n\nExtensions that present a user interface show their view controller’s view immediately after the extension calls [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSExtensionRequestHandling\/beginRequest(with:)] and should input files with the [doc:\/\/com.apple.appkit\/documentation\/AppKit\/NSViewController\/extensionContext] property of [doc:\/\/com.apple.appkit\/documentation\/AppKit\/NSViewController].\n\nOnce the extension’s user interface has completed any required user interaction for the task, process the files in the normal way by calling [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSExtensionContext\/completeRequest(returningItems:completionHandler:)].\n\nTo cancel the task, use the [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSExtensionContext\/cancelRequest(withError:)]. Pass a [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSUserCancelledError-swift.var] if the user canceled the task, or an error caused the failure.\n\n```swift\nlet cancelError = NSError(domain: NSCocoaErrorDomain, code: NSUserCancelledError, userInfo: nil)\ncontext.cancelRequest(withError: cancelError)\n```\n\n### Support the Touch Bar and Finder Preview Pane\n\nUsers may also access Action Extensions from the Touch Bar and from the Quick Actions menu in Finder’s Preview pane. Set both `NSExtensionServiceAllowsFinderPreviewItem` and `NSExtensionServiceAllowsTouchBarItem` to `YES` in the `Info.plist` to support the Touch Bar and Preview Pane.\n\nEach extension must also have a template icon for use in the Quick Actions menu and the Finder Preview pane. Specify the icon with the `NSExtensionServiceTouchBarIconName` key of the `Info.plist` for each target. For more information, see the [https:\/\/developer.apple.com\/design\/human-interface-guidelines\/activity-views#Share-and-action-extensions]. The color of the Touch Bar button can also be customized using the `NSExtensionServiceTouchBarBezelColorName` key. By default, this is a `TouchBarBezel` color but can be any color in the asset catalog for the target.\n\nFor information on how to add Quick Actions to the Touch Bar see the [https:\/\/support.apple.com\/guide\/automator\/use-quick-action-workflows-aut73234890a\/mac#aut7b29b7fc1].\n\n## Quick Actions\n\n- **NSExtensionServiceAllowsFinderPreviewItem**: A Boolean value indicating whether the extension appears in the Finder Preview pane and Quick Actions menu.\n- **NSExtensionServiceFinderPreviewLabel**: A name for display when the extension appears in the Finder Preview pane and Quick Actions menu.\n- **NSExtensionServiceFinderPreviewIconName**: The name of an icon for display when the extension appears in the Finder Preview pane and Quick Actions menu.\n- **NSExtensionServiceAllowsTouchBarItem**: A Boolean value indicating whether the extension appears as a Quick Action in the Touch Bar.\n- **NSExtensionServiceTouchBarLabel**: A name for display when the extension appears as a Quick Action in the Touch Bar.\n- **NSExtensionServiceTouchBarIconName**: The name of an icon for display when the extension appears as a Quick Action in the Touch Bar\n- **NSExtensionServiceTouchBarBezelColorName**: The color to use for the bezel around the extension when it appears as a Quick Action in the Touch Bar.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "A Boolean value indicating whether the extension appears in the Finder Preview pane and Quick Actions menu.",
          "name" : "NSExtensionServiceAllowsFinderPreviewItem",
          "url" : "https:\/\/developer.apple.com\/documentation\/BundleResources\/Information-Property-List\/NSExtension\/NSExtensionAttributes\/NSExtensionServiceAllowsFinderPreviewItem"
        },
        {
          "description" : "A name for display when the extension appears in the Finder Preview pane and Quick Actions menu.",
          "name" : "NSExtensionServiceFinderPreviewLabel",
          "url" : "https:\/\/developer.apple.com\/documentation\/BundleResources\/Information-Property-List\/NSExtension\/NSExtensionAttributes\/NSExtensionServiceFinderPreviewLabel"
        },
        {
          "description" : "The name of an icon for display when the extension appears in the Finder Preview pane and Quick Actions menu.",
          "name" : "NSExtensionServiceFinderPreviewIconName",
          "url" : "https:\/\/developer.apple.com\/documentation\/BundleResources\/Information-Property-List\/NSExtension\/NSExtensionAttributes\/NSExtensionServiceFinderPreviewIconName"
        },
        {
          "description" : "A Boolean value indicating whether the extension appears as a Quick Action in the Touch Bar.",
          "name" : "NSExtensionServiceAllowsTouchBarItem",
          "url" : "https:\/\/developer.apple.com\/documentation\/BundleResources\/Information-Property-List\/NSExtension\/NSExtensionAttributes\/NSExtensionServiceAllowsTouchBarItem"
        },
        {
          "description" : "A name for display when the extension appears as a Quick Action in the Touch Bar.",
          "name" : "NSExtensionServiceTouchBarLabel",
          "url" : "https:\/\/developer.apple.com\/documentation\/BundleResources\/Information-Property-List\/NSExtension\/NSExtensionAttributes\/NSExtensionServiceTouchBarLabel"
        },
        {
          "description" : "The name of an icon for display when the extension appears as a Quick Action in the Touch Bar",
          "name" : "NSExtensionServiceTouchBarIconName",
          "url" : "https:\/\/developer.apple.com\/documentation\/BundleResources\/Information-Property-List\/NSExtension\/NSExtensionAttributes\/NSExtensionServiceTouchBarIconName"
        },
        {
          "description" : "The color to use for the bezel around the extension when it appears as a Quick Action in the Touch Bar.",
          "name" : "NSExtensionServiceTouchBarBezelColorName",
          "url" : "https:\/\/developer.apple.com\/documentation\/BundleResources\/Information-Property-List\/NSExtension\/NSExtensionAttributes\/NSExtensionServiceTouchBarBezelColorName"
        }
      ],
      "title" : "Quick Actions"
    }
  ],
  "source" : "appleJSON",
  "title" : "Add Functionality to Finder with Action Extensions",
  "url" : "https:\/\/developer.apple.com\/documentation\/AppKit\/add-functionality-to-finder-with-action-extensions"
}