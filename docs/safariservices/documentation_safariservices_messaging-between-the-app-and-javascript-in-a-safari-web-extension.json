{
  "abstract" : "Communicate about events and share data between the containing app and JavaScript by using native messaging and app groups.",
  "codeExamples" : [
    {
      "code" : "browser.runtime.sendNativeMessage(\"application.id\", {message: \"Hello from background page\"}, function(response) {\n    console.log(\"Received sendNativeMessage response:\");\n    console.log(response);\n});",
      "language" : "javascript"
    },
    {
      "code" : "func beginRequest(with context: NSExtensionContext) {\n        guard let item = context.inputItems.first as? NSExtensionItem,\n              let userInfo = item.userInfo as? [String: Any],\n              let message = userInfo[SFExtensionMessageKey] else {\n            context.completeRequest(returningItems: nil, completionHandler: nil)\n            return\n        }\n\n        if let profileIdentifier = userInfo[SFExtensionProfileKey] as? UUID {\n            \/\/ Perform profile specific tasks.\n        } else {\n            \/\/ Perform normal browsing tasks.\n        }\n\n        let response = NSExtensionItem()\n        response.userInfo = [ SFExtensionMessageKey: [ \"Response to\": message ] ]\n            \n        context.completeRequest(returningItems: [response], completionHandler: nil)\n}",
      "language" : "swift"
    },
    {
      "code" : "let port = browser.runtime.connectNative(\"application.id\");",
      "language" : "javascript"
    },
    {
      "code" : "@IBAction func sendMessageToExtension(_ sender: AnyObject?) {\n    let messageName = \"Hello from App\"\n    let messageInfo = [\"AdditionalInformation\":\"Goes Here\"]\n    SFSafariApplication.dispatchMessage(withName: messageName, toExtensionWithIdentifier: extensionBundleIdentifier, userInfo: messageInfo) { error in\n        debugPrint(\"Message attempted. Error info: \\(String.init(describing: error))\")\n    }\n}",
      "language" : "swift"
    },
    {
      "code" : "port.onMessage.addListener(function(message) {\n    console.log(\"Received native port message:\");\n    console.log(message);\n});",
      "language" : "javascript"
    }
  ],
  "contentHash" : "d3d95fd8970f25dd1a42f3bc62bd86b9f66d6cc1b3dfbd51a8c76cddb45ea342",
  "crawledAt" : "2025-12-02T16:24:41Z",
  "id" : "716D56EC-6591-4EBA-A942-EC200313E489",
  "kind" : "article",
  "language" : "swift",
  "module" : "Safari Services",
  "overview" : "## Overview\n\nA Safari web extension consists of three parts that operate independently in their own sandboxed environments:\n\nYou use messaging APIs to communicate events and event data between these parts. You use app groups to share app data between them.\n\nBecause the macOS or iOS app and the native app extension each run in their own sandboxed environments, they cannot share data in their respective containers. You can store data in a shared space that both the macOS or iOS app and the native app extension can access and update, by enabling app groups. For more information, see [https:\/\/developer.apple.com\/library\/archive\/documentation\/General\/Conceptual\/ExtensibilityPG\/ExtensionScenarios.html#\/\/apple_ref\/doc\/uid\/TP40014214-CH21-SW6].\n\n### Send messages from JavaScript to the app\n\nYou can send messages to the native app extension from a background script or from extension pages that provide a user interface for your Safari web extension. Content scripts that are injected into web content cannot send messages to the native app extension.\n\nTo enable sending messages from JavaScript to the native app extension, add `nativeMessaging` to the list of `permissions` in the `manifest.json` file.\n\nFrom a script running in the browser or Mac web app, use `browser.runtime.sendNativeMessage` to send a message to the native app extension:\n\nSafari ignores the `application.id` parameter and only sends the message to the containing app’s native app extension. To receive the message, implement the `beginRequest:with:` function in the native app extension to handle the message:\n\nThe message from the script is the first item in the `context.inputItems` dictionary using [doc:\/\/com.apple.safariservices\/documentation\/SafariServices\/SFExtensionMessageKey] as the key. In Safari 17 or later, get the profile identifier from the `context.inputItems` dictionary using [doc:\/\/com.apple.safariservices\/documentation\/SafariServices\/SFExtensionProfileKey] as the key. Use the profile identifier for any extension logic that you need to limit to the user’s profile or to a web app instance, such as fetching or storing data.\n\nReply to the message by creating an `NSExtensionItem` response, populating response data in `userInfo`, and calling `context.completeResponse:returningItems:completionHandler` with the response.\n\n### Send messages from the app to JavaScript\n\nTo enable sending messages from the Safari web extension’s containing macOS app to its JavaScript scripts running in the browser or Mac web app, add `nativeMessaging` to the list of `permissions` in the `manifest.json` file. Send messages from the macOS app to notify the web scripts of important events, like when the user clicks a button or when data that the JavaScript script uses changes. You can’t send messages from a containing iOS app to your web extension’s JavaScript scripts.\n\nTo prepare the JavaScript script to receive messages from the macOS app, use `browser.runtime.connectNative` to establish a port connection to the containing app:\n\nSafari ignores the `application.id` parameter and only allows the script to establish a port connection with the containing macOS app.\n\nSend a message to the JavaScript script from the macOS app using `dispatchMessageWithName:toExtensionWithIdentifier:userInfo` in `SFSafariApplication`:\n\nTo receive the message in the JavaScript script, add a closure using `port.onMessage.addListener` to process the message.\n\nThe script then processes the message and initiates events in the browser.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/SafariServices\/messaging-between-the-app-and-javascript-in-a-safari-web-extension\ncrawled: 2025-12-02T16:24:41Z\n---\n\n# Messaging between the app and JavaScript in a Safari web extension\n\n**Article**\n\nCommunicate about events and share data between the containing app and JavaScript by using native messaging and app groups.\n\n## Overview\n\nA Safari web extension consists of three parts that operate independently in their own sandboxed environments:\n\n- A macOS or iOS app that can have a user interface\n- JavaScript code and web files that work in the browser or Mac web app\n- A native app extension that mediates between the macOS or iOS app and the JavaScript code\n\nYou use messaging APIs to communicate events and event data between these parts. You use app groups to share app data between them.\n\nBecause the macOS or iOS app and the native app extension each run in their own sandboxed environments, they cannot share data in their respective containers. You can store data in a shared space that both the macOS or iOS app and the native app extension can access and update, by enabling app groups. For more information, see [https:\/\/developer.apple.com\/library\/archive\/documentation\/General\/Conceptual\/ExtensibilityPG\/ExtensionScenarios.html#\/\/apple_ref\/doc\/uid\/TP40014214-CH21-SW6].\n\n### Send messages from JavaScript to the app\n\nYou can send messages to the native app extension from a background script or from extension pages that provide a user interface for your Safari web extension. Content scripts that are injected into web content cannot send messages to the native app extension.\n\nTo enable sending messages from JavaScript to the native app extension, add `nativeMessaging` to the list of `permissions` in the `manifest.json` file.\n\nFrom a script running in the browser or Mac web app, use `browser.runtime.sendNativeMessage` to send a message to the native app extension:\n\n```javascript\nbrowser.runtime.sendNativeMessage(\"application.id\", {message: \"Hello from background page\"}, function(response) {\n    console.log(\"Received sendNativeMessage response:\");\n    console.log(response);\n});\n```\n\nSafari ignores the `application.id` parameter and only sends the message to the containing app’s native app extension. To receive the message, implement the `beginRequest:with:` function in the native app extension to handle the message:\n\n```swift\nfunc beginRequest(with context: NSExtensionContext) {\n        guard let item = context.inputItems.first as? NSExtensionItem,\n              let userInfo = item.userInfo as? [String: Any],\n              let message = userInfo[SFExtensionMessageKey] else {\n            context.completeRequest(returningItems: nil, completionHandler: nil)\n            return\n        }\n\n        if let profileIdentifier = userInfo[SFExtensionProfileKey] as? UUID {\n            \/\/ Perform profile specific tasks.\n        } else {\n            \/\/ Perform normal browsing tasks.\n        }\n\n        let response = NSExtensionItem()\n        response.userInfo = [ SFExtensionMessageKey: [ \"Response to\": message ] ]\n            \n        context.completeRequest(returningItems: [response], completionHandler: nil)\n}\n```\n\nThe message from the script is the first item in the `context.inputItems` dictionary using [doc:\/\/com.apple.safariservices\/documentation\/SafariServices\/SFExtensionMessageKey] as the key. In Safari 17 or later, get the profile identifier from the `context.inputItems` dictionary using [doc:\/\/com.apple.safariservices\/documentation\/SafariServices\/SFExtensionProfileKey] as the key. Use the profile identifier for any extension logic that you need to limit to the user’s profile or to a web app instance, such as fetching or storing data.\n\nReply to the message by creating an `NSExtensionItem` response, populating response data in `userInfo`, and calling `context.completeResponse:returningItems:completionHandler` with the response.\n\n### Send messages from the app to JavaScript\n\nTo enable sending messages from the Safari web extension’s containing macOS app to its JavaScript scripts running in the browser or Mac web app, add `nativeMessaging` to the list of `permissions` in the `manifest.json` file. Send messages from the macOS app to notify the web scripts of important events, like when the user clicks a button or when data that the JavaScript script uses changes. You can’t send messages from a containing iOS app to your web extension’s JavaScript scripts.\n\nTo prepare the JavaScript script to receive messages from the macOS app, use `browser.runtime.connectNative` to establish a port connection to the containing app:\n\n```javascript\nlet port = browser.runtime.connectNative(\"application.id\");\n```\n\nSafari ignores the `application.id` parameter and only allows the script to establish a port connection with the containing macOS app.\n\nSend a message to the JavaScript script from the macOS app using `dispatchMessageWithName:toExtensionWithIdentifier:userInfo` in `SFSafariApplication`:\n\n```swift\n@IBAction func sendMessageToExtension(_ sender: AnyObject?) {\n    let messageName = \"Hello from App\"\n    let messageInfo = [\"AdditionalInformation\":\"Goes Here\"]\n    SFSafariApplication.dispatchMessage(withName: messageName, toExtensionWithIdentifier: extensionBundleIdentifier, userInfo: messageInfo) { error in\n        debugPrint(\"Message attempted. Error info: \\(String.init(describing: error))\")\n    }\n}\n```\n\nTo receive the message in the JavaScript script, add a closure using `port.onMessage.addListener` to process the message.\n\n```javascript\nport.onMessage.addListener(function(message) {\n    console.log(\"Received native port message:\");\n    console.log(message);\n});\n```\n\nThe script then processes the message and initiates events in the browser.\n\n## Messaging\n\n- **SFExtensionMessageKey**: A string the system uses as a key in a user info dictionary to identify a message.\n- **SFExtensionProfileKey**: A string the system uses as a key in a user info dictionary to identify a profile identifier.\n- **Messaging a Web Extension’s Native App**: Communicate between your Safari web extension and its containing app.\n- **Messaging between a webpage and your Safari web extension**: Configure your extension to enable messaging from webpages, and then update your extension to handle messages.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "A string the system uses as a key in a user info dictionary to identify a message.",
          "name" : "SFExtensionMessageKey",
          "url" : "https:\/\/developer.apple.com\/documentation\/SafariServices\/SFExtensionMessageKey"
        },
        {
          "description" : "A string the system uses as a key in a user info dictionary to identify a profile identifier.",
          "name" : "SFExtensionProfileKey",
          "url" : "https:\/\/developer.apple.com\/documentation\/SafariServices\/SFExtensionProfileKey"
        },
        {
          "description" : "Communicate between your Safari web extension and its containing app.",
          "name" : "Messaging a Web Extension’s Native App",
          "url" : "https:\/\/developer.apple.com\/documentation\/SafariServices\/messaging-a-web-extension-s-native-app"
        },
        {
          "description" : "Configure your extension to enable messaging from webpages, and then update your extension to handle messages.",
          "name" : "Messaging between a webpage and your Safari web extension",
          "url" : "https:\/\/developer.apple.com\/documentation\/SafariServices\/messaging-between-a-webpage-and-your-safari-web-extension"
        }
      ],
      "title" : "Messaging"
    }
  ],
  "source" : "appleJSON",
  "title" : "Messaging between the app and JavaScript in a Safari web extension",
  "url" : "https:\/\/developer.apple.com\/documentation\/SafariServices\/messaging-between-the-app-and-javascript-in-a-safari-web-extension"
}