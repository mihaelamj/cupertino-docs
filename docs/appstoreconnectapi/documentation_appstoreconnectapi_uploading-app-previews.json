{
  "abstract" : "Upload your app previews, including video files, to App Store Connect by using the asset upload APIs.",
  "codeExamples" : [
    {
      "code" : "~\/Library\/Python\/3.7\/bin\/pipenv run python3 upload-preview.py {bundle id} {platform} {version} {locale} {preview type} {path to video file}",
      "language" : "console"
    },
    {
      "code" : "~\/Library\/Python\/3.7\/bin\/pipenv run python3 upload-preview.py com.mycompany.MyApp IOS 1.0 en-US IPHONE_65 ..\/my-video.mp4",
      "language" : "console"
    },
    {
      "code" : "def create_token():\n    expiry = datetime.datetime.utcnow() + datetime.timedelta(minutes=20)\n    token_data = jwt.encode(\n        {\n            'iss': ISSUER_ID,\n            'aud': 'appstoreconnect-v1',\n            'exp': expiry\n        },\n        PRIVATE_KEY,\n        headers={\n            'kid': KEY_ID\n        },\n        algorithm='ES256'\n    )\n    return token_data.decode('UTF-8')",
      "language" : "python"
    },
    {
      "code" : "app_response = make_http_request(\n    \"GET\",\n    f\"https:\/\/api.appstoreconnect.apple.com\/v1\/apps?filter[bundleId]={bundleId}\",\n    headers={\n        \"Authorization\": auth_header\n    }\n)",
      "language" : "python"
    },
    {
      "code" : "version_response = make_http_request(\n    \"GET\",\n    f\"https:\/\/api.appstoreconnect.apple.com\/v1\/apps\/{app['id']}\/appStoreVersions?filter[versionString]={version}&filter[platform]={platform}\",\n    headers={\n        \"Authorization\": auth_header\n    }\n)",
      "language" : "python"
    },
    {
      "code" : "selected_localization_response = make_http_request(\n    \"POST\",\n    \"https:\/\/api.appstoreconnect.apple.com\/v1\/appStoreVersionLocalizations\",\n    headers={\n        \"Authorization\": auth_header,\n        \"Content-Type\": \"application\/json\"\n    },\n    body=json.dumps({\n        \"data\": {\n            \"type\": \"appStoreVersionLocalizations\",\n            \"attributes\": {\n                \"locale\": locale\n            },\n            \"relationships\": {\n                \"appStoreVersion\": {\n                    \"data\": {\n                        \"type\": \"appStoreVersions\",\n                        \"id\": version['id']\n                    }\n                }\n            }\n        }\n    })\n)",
      "language" : "python"
    },
    {
      "code" : "preview_set_response = make_http_request(\n    \"POST\",\n    \"https:\/\/api.appstoreconnect.apple.com\/v1\/appPreviewSets\",\n    headers={\n        \"Authorization\": auth_header,\n        \"Content-Type\": \"application\/json\"\n    },\n    body=json.dumps({\n        \"data\": {\n            \"type\": \"appPreviewSets\",\n            \"attributes\": {\n                \"previewType\": previewType\n            },\n            \"relationships\": {\n                \"appStoreVersionLocalization\": {\n                    \"data\": {\n                        \"type\": \"appStoreVersionLocalizations\",\n                        \"id\": selected_localization['id']\n                    }\n                }\n            }\n        }\n    })\n)",
      "language" : "python"
    },
    {
      "code" : "reserve_preview_response = make_http_request(\n    \"POST\",\n    \"https:\/\/api.appstoreconnect.apple.com\/v1\/appPreviews\",\n    headers={\n        \"Authorization\": auth_header,\n        \"Content-Type\": \"application\/json\"\n    },\n    body=json.dumps({\n        \"data\": {\n            \"type\": \"appPreviews\",\n            \"attributes\": {\n                \"fileName\": os.path.basename(filePath),\n                \"fileSize\": os.path.getsize(filePath)\n            },\n            \"relationships\": {\n                \"appPreviewSet\": {\n                    \"data\": {\n                        \"type\": \"appPreviewSets\",\n                        \"id\": selected_preview_set['id']\n                    }\n                }\n            }\n        }\n    })\n)",
      "language" : "python"
    },
    {
      "code" : "with open(filePath, mode='rb') as file:\n    file.seek(upload_operation['offset'])\n    bytes = file.read(upload_operation['length'])",
      "language" : "python"
    },
    {
      "code" : "make_http_request(\n    upload_operation['method'],\n    upload_operation['url'],\n    headers={h['name']: h['value'] for h in upload_operation['requestHeaders']},\n    body=bytes\n)",
      "language" : "python"
    },
    {
      "code" : "make_http_request(\n    \"PATCH\",\n    f\"https:\/\/api.appstoreconnect.apple.com\/v1\/appPreviews\/{preview['id']}\",\n    headers={\n        \"Authorization\": auth_header,\n        \"Content-Type\": \"application\/json\"\n    },\n    body=json.dumps({\n        \"data\": {\n            \"type\": \"appPreviews\",\n            \"id\": preview['id'],\n            \"attributes\": {\n                \"uploaded\": True,\n                \"sourceFileChecksum\": hashlib.md5(open(filePath,'rb').read()).hexdigest()\n            }\n        }\n    })\n)",
      "language" : "python"
    }
  ],
  "contentHash" : "acb391e002d07abf5580090b5636f32aa36f9b69da4944b712f4af98d2ae1c5d",
  "crawledAt" : "2025-12-02T15:29:08Z",
  "id" : "2EC38A81-F4F1-482F-A0A9-2945D4BCE613",
  "kind" : "unknown",
  "language" : "data",
  "module" : "App Store Connect API",
  "overview" : "## Overview\n\nThis sample code includes a script written in Python that uploads a video as an app preview for an app. To run this sample, you must have an app in App Store Connect with a version in the “Prepare for Submission” state, and an app preview file to upload. You’ll also need your API key.\n\nThe sample’s script first generates an authentication token, so it can call the App Store Connect API. It then creates an app preview set or uses an existing one, if one exists. The script then reserves a new app preview associated with the app preview set, uploads the binary data, and commits the upload.\n\nFor more information about the process of uploading assets, see [doc:\/\/com.apple.documentation\/documentation\/AppStoreConnectAPI\/uploading-assets-to-app-store-connect].\n\n### Configure the Sample Code Project\n\nThis project requires Python 3, which is pre-installed on macOS 10.15. It uses Python’s `pipenv` dependency management system, which you need to install. Follow these steps to install `pipenv` and the required Python modules:\n\n### Add the API Key to the Script and Prepare the Upload\n\nPrepare to run the script by following these steps:\n\n### Provide Command-Line Parameters to Run the Script\n\nOn the command line, run this command, replacing the parameters with actual values:\n\nThe command-line parameters are:\n\nThe following example replaces `{bundle id}` with `com.mycompany.MyApp`; `{platform}` with `IOS`; `{version}` with `1.0`; `{locale}` with `en-US`;  `{preview type}` with `IPHONE_65`; and `{path to video file}` with`..\/my-video.mp4`.\n\n### Generate an Authentication Token\n\nFirst, the script creates a JSON Web Token (JWT) that it uses to authenticate each App Store Connect API request. The JWT includes an expiration timestamp, along with an Issuer ID, Key ID, and the `appstoreconnect-v1` audience. The token is signed using the ES256 algorithm and the private key.\n\n### Find or Create the App Preview Set\n\nThe App Store Connect API requires the addition of an app preview to an *app preview set*. Create one app preview set for each preview type and each locale. Each set includes up to three previews. For example, a set might have a 6.5 inch iPhone in the US English locale, and another in the Mexican Spanish locale.\n\nBefore the sample creates the app preview, it needs to find the right preview set or create a new set. The script first searches for the app by bundle ID.\n\nThen, the script searches for the version by platform and version number:\n\nIf the version doesn’t have a localization for the given locale, the script creates a new one:\n\nFinally, if the localization doesn’t have an app preview set of the given type, the script creates one:\n\n### Reserve an App Preview\n\nOnce the sample project finds or creates the app preview set, it reserves a new app preview associated with the app preview set ID. The reservation tells App Store Connect the name and size of the file the script intends to upload.\n\n### Upload the Binary Data\n\nIn response to the reservation request, App Store Connect responds with a set of upload operations. Use the upload operations to upload a file, potentially in multiple parts. The sample uses the `offset` and `length` in the upload operation to extract a portion of the source file.\n\nThe `method`, `url` and `requestHeaders` in the upload operation are used for uploading the chunk of data.\n\n### Commit the App Preview\n\nOnce all the parts of the file are uploaded, the sample code then demonstrates how to commit the app preview by marking it uploaded and providing an MD5 checksum of the original source file.\n\n### Verify the App Preview\n\nApp Store Connect processes the asset asynchronously. Check the upload’s status in App Store Connect or by re-requesting the `\/v1\/appPreview\/{id}` and examining the response.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/AppStoreConnectAPI\/uploading-app-previews\ncrawled: 2025-12-02T15:29:08Z\n---\n\n# Uploading App Previews\n\n**Sample Code**\n\nUpload your app previews, including video files, to App Store Connect by using the asset upload APIs.\n\n## Overview\n\nThis sample code includes a script written in Python that uploads a video as an app preview for an app. To run this sample, you must have an app in App Store Connect with a version in the “Prepare for Submission” state, and an app preview file to upload. You’ll also need your API key.\n\nThe sample’s script first generates an authentication token, so it can call the App Store Connect API. It then creates an app preview set or uses an existing one, if one exists. The script then reserves a new app preview associated with the app preview set, uploads the binary data, and commits the upload.\n\nFor more information about the process of uploading assets, see [doc:\/\/com.apple.documentation\/documentation\/AppStoreConnectAPI\/uploading-assets-to-app-store-connect].\n\n### Configure the Sample Code Project\n\nThis project requires Python 3, which is pre-installed on macOS 10.15. It uses Python’s `pipenv` dependency management system, which you need to install. Follow these steps to install `pipenv` and the required Python modules:\n\n1. Open the Terminal app by typing Command-space and entering “Terminal.app” in the Spotlight search field.\n2. In Terminal, enter:\n\n```console\npip3 install --user pipenv\n```\n\nIf you’re prompted to install Xcode command line tools, follow the prompts. When installation is complete, run the above command again.\n3. In Terminal, navigate to the folder that contains this sample project:\n\n```console\n cd UploadingAppPreviews\n```\n4. Install the Python modules by entering:\n\n```console\n~\/Library\/Python\/3.7\/bin\/pipenv install\n```\n\nIf you’ve installed your own version of Python, the `pipenv` path may be different.\n\n### Add the API Key to the Script and Prepare the Upload\n\nPrepare to run the script by following these steps:\n\n1. Add your API key to the script by editing the *upload-preview.py* file and adding your API Key information to the KEY CONFIGURATION section at the top of the file. To find your API key, log in to App Store Connect and open the [https:\/\/appstoreconnect.apple.com\/access\/api] module. The key is found in the Keys tab. For more information, see [doc:\/\/com.apple.documentation\/documentation\/AppStoreConnectAPI\/creating-api-keys-for-app-store-connect-api].\n2. Make sure the video file you’d like to upload is available on your local machine. For more information about app previews, including technical specifications, see [https:\/\/developer.apple.com\/app-store\/app-previews\/].\n3. Your app must be in App Store Connect with a version in the “Prepare for Submission” state. To upload the app preview, you’ll need the `bundle id`, `platform`, `version number`, and `locale` of this app.\n\n### Provide Command-Line Parameters to Run the Script\n\nOn the command line, run this command, replacing the parameters with actual values:\n\n```console\n~\/Library\/Python\/3.7\/bin\/pipenv run python3 upload-preview.py {bundle id} {platform} {version} {locale} {preview type} {path to video file}\n```\n\nThe command-line parameters are:\n\n- `{bundle id}`—Your app’s bundle ID.\n- `{platform}`—Your app’s platform. See [doc:\/\/com.apple.documentation\/documentation\/AppStoreConnectAPI\/Platform] for valid values.\n- `{version}`—The version of your app to which the preview applies.\n- `{locale}`—The locale to which the preview applies. See [doc:\/\/com.apple.documentation\/documentation\/AppStoreConnectAPI\/POST-v1-appInfoLocalizations] for valid values.\n- `{preview type}`—The type of preview. See [doc:\/\/com.apple.documentation\/documentation\/AppStoreConnectAPI\/PreviewType] for valid values.\n- `{path to video file}`—The path to the video file on your computer.\n\nThe following example replaces `{bundle id}` with `com.mycompany.MyApp`; `{platform}` with `IOS`; `{version}` with `1.0`; `{locale}` with `en-US`;  `{preview type}` with `IPHONE_65`; and `{path to video file}` with`..\/my-video.mp4`.\n\n```console\n~\/Library\/Python\/3.7\/bin\/pipenv run python3 upload-preview.py com.mycompany.MyApp IOS 1.0 en-US IPHONE_65 ..\/my-video.mp4\n```\n\n### Generate an Authentication Token\n\nFirst, the script creates a JSON Web Token (JWT) that it uses to authenticate each App Store Connect API request. The JWT includes an expiration timestamp, along with an Issuer ID, Key ID, and the `appstoreconnect-v1` audience. The token is signed using the ES256 algorithm and the private key.\n\n```python\ndef create_token():\n    expiry = datetime.datetime.utcnow() + datetime.timedelta(minutes=20)\n    token_data = jwt.encode(\n        {\n            'iss': ISSUER_ID,\n            'aud': 'appstoreconnect-v1',\n            'exp': expiry\n        },\n        PRIVATE_KEY,\n        headers={\n            'kid': KEY_ID\n        },\n        algorithm='ES256'\n    )\n    return token_data.decode('UTF-8')\n```\n\n### Find or Create the App Preview Set\n\nThe App Store Connect API requires the addition of an app preview to an *app preview set*. Create one app preview set for each preview type and each locale. Each set includes up to three previews. For example, a set might have a 6.5 inch iPhone in the US English locale, and another in the Mexican Spanish locale.\n\nBefore the sample creates the app preview, it needs to find the right preview set or create a new set. The script first searches for the app by bundle ID.\n\n```python\napp_response = make_http_request(\n    \"GET\",\n    f\"https:\/\/api.appstoreconnect.apple.com\/v1\/apps?filter[bundleId]={bundleId}\",\n    headers={\n        \"Authorization\": auth_header\n    }\n)\n```\n\nThen, the script searches for the version by platform and version number:\n\n```python\nversion_response = make_http_request(\n    \"GET\",\n    f\"https:\/\/api.appstoreconnect.apple.com\/v1\/apps\/{app['id']}\/appStoreVersions?filter[versionString]={version}&filter[platform]={platform}\",\n    headers={\n        \"Authorization\": auth_header\n    }\n)\n```\n\nIf the version doesn’t have a localization for the given locale, the script creates a new one:\n\n```python\nselected_localization_response = make_http_request(\n    \"POST\",\n    \"https:\/\/api.appstoreconnect.apple.com\/v1\/appStoreVersionLocalizations\",\n    headers={\n        \"Authorization\": auth_header,\n        \"Content-Type\": \"application\/json\"\n    },\n    body=json.dumps({\n        \"data\": {\n            \"type\": \"appStoreVersionLocalizations\",\n            \"attributes\": {\n                \"locale\": locale\n            },\n            \"relationships\": {\n                \"appStoreVersion\": {\n                    \"data\": {\n                        \"type\": \"appStoreVersions\",\n                        \"id\": version['id']\n                    }\n                }\n            }\n        }\n    })\n)\n```\n\nFinally, if the localization doesn’t have an app preview set of the given type, the script creates one:\n\n```python\npreview_set_response = make_http_request(\n    \"POST\",\n    \"https:\/\/api.appstoreconnect.apple.com\/v1\/appPreviewSets\",\n    headers={\n        \"Authorization\": auth_header,\n        \"Content-Type\": \"application\/json\"\n    },\n    body=json.dumps({\n        \"data\": {\n            \"type\": \"appPreviewSets\",\n            \"attributes\": {\n                \"previewType\": previewType\n            },\n            \"relationships\": {\n                \"appStoreVersionLocalization\": {\n                    \"data\": {\n                        \"type\": \"appStoreVersionLocalizations\",\n                        \"id\": selected_localization['id']\n                    }\n                }\n            }\n        }\n    })\n)\n```\n\n### Reserve an App Preview\n\nOnce the sample project finds or creates the app preview set, it reserves a new app preview associated with the app preview set ID. The reservation tells App Store Connect the name and size of the file the script intends to upload.\n\n```python\nreserve_preview_response = make_http_request(\n    \"POST\",\n    \"https:\/\/api.appstoreconnect.apple.com\/v1\/appPreviews\",\n    headers={\n        \"Authorization\": auth_header,\n        \"Content-Type\": \"application\/json\"\n    },\n    body=json.dumps({\n        \"data\": {\n            \"type\": \"appPreviews\",\n            \"attributes\": {\n                \"fileName\": os.path.basename(filePath),\n                \"fileSize\": os.path.getsize(filePath)\n            },\n            \"relationships\": {\n                \"appPreviewSet\": {\n                    \"data\": {\n                        \"type\": \"appPreviewSets\",\n                        \"id\": selected_preview_set['id']\n                    }\n                }\n            }\n        }\n    })\n)\n```\n\n### Upload the Binary Data\n\nIn response to the reservation request, App Store Connect responds with a set of upload operations. Use the upload operations to upload a file, potentially in multiple parts. The sample uses the `offset` and `length` in the upload operation to extract a portion of the source file.\n\n```python\nwith open(filePath, mode='rb') as file:\n    file.seek(upload_operation['offset'])\n    bytes = file.read(upload_operation['length'])\n```\n\nThe `method`, `url` and `requestHeaders` in the upload operation are used for uploading the chunk of data.\n\n```python\nmake_http_request(\n    upload_operation['method'],\n    upload_operation['url'],\n    headers={h['name']: h['value'] for h in upload_operation['requestHeaders']},\n    body=bytes\n)\n```\n\n### Commit the App Preview\n\nOnce all the parts of the file are uploaded, the sample code then demonstrates how to commit the app preview by marking it uploaded and providing an MD5 checksum of the original source file.\n\n```python\nmake_http_request(\n    \"PATCH\",\n    f\"https:\/\/api.appstoreconnect.apple.com\/v1\/appPreviews\/{preview['id']}\",\n    headers={\n        \"Authorization\": auth_header,\n        \"Content-Type\": \"application\/json\"\n    },\n    body=json.dumps({\n        \"data\": {\n            \"type\": \"appPreviews\",\n            \"id\": preview['id'],\n            \"attributes\": {\n                \"uploaded\": True,\n                \"sourceFileChecksum\": hashlib.md5(open(filePath,'rb').read()).hexdigest()\n            }\n        }\n    })\n)\n```\n\n### Verify the App Preview\n\nApp Store Connect processes the asset asynchronously. Check the upload’s status in App Store Connect or by re-requesting the `\/v1\/appPreview\/{id}` and examining the response.\n\n## Managing App Previews\n\n- **Uploading Assets to App Store Connect**: Upload screenshots, app previews, attachments for App Review, and routing app coverage files to App Store Connect.\n- **App Preview Sets**: Create sets of app previews to upload to App Store Connect.\n- **App Previews**: Upload and download app previews for an app locale and display target.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Upload screenshots, app previews, attachments for App Review, and routing app coverage files to App Store Connect.",
          "name" : "Uploading Assets to App Store Connect",
          "url" : "https:\/\/developer.apple.com\/documentation\/AppStoreConnectAPI\/uploading-assets-to-app-store-connect"
        },
        {
          "description" : "Create sets of app previews to upload to App Store Connect.",
          "name" : "App Preview Sets",
          "url" : "https:\/\/developer.apple.com\/documentation\/AppStoreConnectAPI\/app-preview-sets"
        },
        {
          "description" : "Upload and download app previews for an app locale and display target.",
          "name" : "App Previews",
          "url" : "https:\/\/developer.apple.com\/documentation\/AppStoreConnectAPI\/app-previews"
        }
      ],
      "title" : "Managing App Previews"
    }
  ],
  "source" : "appleJSON",
  "title" : "Uploading App Previews",
  "url" : "https:\/\/developer.apple.com\/documentation\/AppStoreConnectAPI\/uploading-app-previews"
}