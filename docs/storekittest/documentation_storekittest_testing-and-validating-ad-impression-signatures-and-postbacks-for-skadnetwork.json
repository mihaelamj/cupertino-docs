{
  "abstract" : "Validate your ad impressions and test your postbacks by creating unit tests using the StoreKit Test framework.",
  "codeExamples" : [
    {
      "code" : "\/\/ Form the SKAdImpression instance and configure it.\nlet impression = SKAdImpression()\nimpression.version = \"4.0\"\nimpression.adNetworkIdentifier = \"com.apple.test-1\"\nimpression.sourceIdentifier = 3120\nimpression.advertisedAppStoreItemIdentifier = 525_463_029\nimpression.adImpressionIdentifier = \"b7c9da2b-15c7-4f3b-9326-135f9630033d\"\nimpression.sourceAppStoreItemIdentifier = 0\nimpression.timestamp = 1_676_057_605_705\nimpression.signature = \"MEQCIAtBBiadCFlMOEOh3K43xyKaU1\/sj\/CtgDOB+Wm7J+29AiBDfreX67mm4X9ZoM4xkHHLtuMM2OXcS5kQ7UpVb69A\/Q==\"",
      "language" : "swift"
    },
    {
      "code" : "guard let testPostbacks = SKAdTestPostback.winningPostbacks(withVersion: .version4_0,\n                                                            adNetworkIdentifier: \"com.apple.test-1\",\n                                                            sourceIdentifier: \"3120\",\n                                                            appStoreItemIdentifier: 0,\n                                                            sourceAppStoreItemIdentifier: 525_463_029,\n                                                            sourceDomain: nil,\n                                                            fidelityType: 1,\n                                                            isRedownload: false,\n                                                            postbackURL: \"TEST SERVER ENDPOINT\") else {\n    XCTFail(\"Failed to create postbacks.\")\n    return\n}",
      "language" : "swift"
    },
    {
      "code" : "try testSession.setPostbacks(testPostbacks)",
      "language" : "swift"
    },
    {
      "code" : "let fetchedPostbacks = testSession.postbacks\nguard fetchedPostbacks.count == 3 else {\n    XCTFail(\"Expecting 3 postbacks, received \\(fetchedPostbacks.count).\")\n    return\n}\n\n\/\/ A test session's `postbacks` property maintains the order of the postbacks.\nlet firstPostback = fetchedPostbacks[0]\nXCTAssertEqual(firstPostback.fineConversionValue, 42)",
      "language" : "swift"
    },
    {
      "code" : "testSession.flushPostbacks { responses, error in\n    XCTAssertNil(error)\n    guard let concreteResponses = responses else {\n        XCTFail(\"No responses received.\")\n        return\n    }\n    for response in concreteResponses {\n        let postbackResponse = response.value\n        XCTAssertNil(postbackResponse.error)\n        XCTAssertTrue(postbackResponse.didSucceed)\n    }\n}",
      "language" : "swift"
    }
  ],
  "contentHash" : "46ebe40b5363c4246d6ac2b5fd55b9e670f34b97ed443cfd65e6d0090c60d1ab",
  "crawledAt" : "2025-12-05T12:55:13Z",
  "id" : "563D85DB-AB82-4CFE-A23A-6CE22134A4BD",
  "kind" : "unknown",
  "language" : "swift",
  "module" : "StoreKit Test",
  "overview" : "## Overview\n\nThis sample code project provides examples of how to use the StoreKit Test framework to test individual units of an [https:\/\/developer.apple.com\/documentation\/storekit\/skadnetwork] implementation. The sample code runs each type of test that [doc:\/\/com.apple.storekittest\/documentation\/StoreKitTest\/SKAdTestSession] makes possible.\n\nFirst, it creates and validates ad impressions. In a typical ad attribution flow, the ad network cryptographically signs an ad impression. This unit test checks the signature and validates other aspects of the impression.\n\nNext, the sample code creates a test postback and updates the conversion value. In a typical ad attribution flow, the system creates a postback after a user installs and opens an advertised app. In the unit test, you can see and control every aspect of the test postback, so you can test your app’s conversion values and decide which postback to annotate as the winner.\n\nFinally, the sample code sends and receives the test postbacks. In a typical ad attribution flow, the system sends a postback after a timer expires. In the unit test, you control when to send the postback so that you can test that your server receives the postback.\n\n### Configure the sample code project\n\nTo run the unit tests in your environment with your settings, you’ll need the following:\n\n### Create and validate the ad impression\n\nIn the `testImpressionValidity()` method, the unit test creates an instance of [https:\/\/developer.apple.com\/documentation\/storekit\/skadimpression] to represent a view-through ad.\n\nAll of the properties are required. In the testing environment, the [https:\/\/developer.apple.com\/documentation\/storekit\/skadimpression\/3727300-sourceappstoreitemidentifier] is always `0`.\n\nThe unit test then calls the `validateImpression` method on [doc:\/\/com.apple.storekittest\/documentation\/StoreKitTest\/SKAdTestSession] and checks for errors.\n\nIf `validateImpression` returns an error, the unit test fails, and the error contains further information. If `validateImpression` doesn’t return an error, the unit test succeeds.\n\nIn the `testImpressionParametersValidity` method, the unit test creates a dictionary containing the parameters for a StoreKit-rendered ad and validates it using the `validateImpressionWithParameters` method. For more information about StoreKit-rendered ads, visit [https:\/\/developer.apple.com\/documentation\/storekit\/skadnetwork\/signing_and_providing_ads#3732910]. The `testWebAdImpressionPayloadValidity` method creates and validates a web ad impression payload. For more information on web ads, visit [https:\/\/developer.apple.com\/documentation\/skadnetworkforwebads\/get_a_signed_web_ad_impression_payload].\n\n### Create the test postbacks\n\nThe unit test creates three winning postbacks in the `testAddingPostbacks` method using the [doc:\/\/com.apple.storekittest\/documentation\/StoreKitTest\/SKAdTestPostback] class. The fields of a postback are specific to each version of the [https:\/\/developer.apple.com\/documentation\/storekit\/skadnetwork] API. This class provides an initializer that specifies the postback fields and the `SKAdNetwork` API version.\n\nFor ad postbacks using `SKAdNetwork` version 4.0 or later, test multiple conversion windows by creating an array of three postbacks corresponding to the three conversion windows using the `winningPostbacks` static method on `SKAdTestPostback`. Create a single winning or nonwinning postback using the initializer with the `sourceIdentifier` parameter. For more information on multiple conversion windows, visit [https:\/\/developer.apple.com\/documentation\/storekit\/skadnetwork\/receiving_postbacks_in_multiple_conversion_windows].\n\nAfter creating the `SKAdTestPostback` instances, the unit test calls the `setPostbacks` method on `SKAdTestSession` to add the newly created postbacks to the test session. Test postbacks added to the test session are available to the unit tests for further testing, including updating the conversion value or sending the postbacks. Test sessions can handle up to eight postbacks. Each call to the `setPostbacks` method overwrites the test postbacks in the test session.\n\n### Test updating the conversion value\n\nA postback isn’t ready to send to the server until it has a conversion value. The unit test updates the conversion value of the first test postback by calling the [https:\/\/developer.apple.com\/documentation\/storekit\/skadnetwork\/4090669-updatepostbackconversionvalue] method on [https:\/\/developer.apple.com\/documentation\/storekit\/skadnetwork]. To confirm the conversion value after updating it, the unit test retrieves the postbacks using the `postbacks` property on `SKAdTestSession` and then checks the conversion value.\n\n### Send and receive the test postback\n\nThe unit test sends the postbacks with updated conversion values to the network server by calling the `flushPostbacks` method on `SKAdTestSession` The server URL is specified in the `testAddingPostbacks` method, where the test postbacks are created.\n\nAfter sending the test postbacks, the unit test waits for a response from the server. The server responds with one [doc:\/\/com.apple.storekittest\/documentation\/StoreKitTest\/SKAdTestPostbackResponse] instance for each test postback. The response contains information about the success or failure of the postback, the error details, and the HTTP response the server received, if any.\n\nIn the `testSendingPostback()` method, the unit test checks the response for the success or failure flag and the error object. The unit test passes only if it receives a success signal in combination with a `nil` error. Calling the `flushPostbacks` method removes the test postbacks from the test session.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/storekittest\/testing-and-validating-ad-impression-signatures-and-postbacks-for-skadnetwork\ncrawled: 2025-12-05T12:55:13Z\n---\n\n# Testing and validating ad impression signatures and postbacks for SKAdNetwork\n\n**Sample Code**\n\nValidate your ad impressions and test your postbacks by creating unit tests using the StoreKit Test framework.\n\n## Overview\n\nThis sample code project provides examples of how to use the StoreKit Test framework to test individual units of an [https:\/\/developer.apple.com\/documentation\/storekit\/skadnetwork] implementation. The sample code runs each type of test that [doc:\/\/com.apple.storekittest\/documentation\/StoreKitTest\/SKAdTestSession] makes possible.\n\nFirst, it creates and validates ad impressions. In a typical ad attribution flow, the ad network cryptographically signs an ad impression. This unit test checks the signature and validates other aspects of the impression.\n\nNext, the sample code creates a test postback and updates the conversion value. In a typical ad attribution flow, the system creates a postback after a user installs and opens an advertised app. In the unit test, you can see and control every aspect of the test postback, so you can test your app’s conversion values and decide which postback to annotate as the winner.\n\nFinally, the sample code sends and receives the test postbacks. In a typical ad attribution flow, the system sends a postback after a timer expires. In the unit test, you control when to send the postback so that you can test that your server receives the postback.\n\n### Configure the sample code project\n\nTo run the unit tests in your environment with your settings, you’ll need the following:\n\n- Your ad network identifier. Configure the value in your `Info.plist` as described in [https:\/\/developer.apple.com\/documentation\/storekit\/skadnetwork\/configuring_a_source_app]. In the sample code, use the same value everywhere that the ad network identifier is required.\n- A source app identifier. In the testing environment, this value is always `0`.\n- A cryptographic key pair, consisting of a public key and a private key, created with the Elliptic Curve Digital Signature Algorithm (ECDSA) with a `prime256v1` curve. In the sample code, use the private key when you generate a signature, and use the public key when you call `validateImpression`.\n\n- Set the `publicKey` variable in the sample code project to your public key.\n- For more information on generating a private and public key pair for signing ads, visit [https:\/\/developer.apple.com\/documentation\/storekit\/skadnetwork\/registering_an_ad_network].\n- A local or remote server to listen for postbacks. Specify your server’s URL when you create test postbacks as shown in the sample code’s `testAddingPostbacks()` method.\n- A device running iOS 16.4 or later. iOS Simulator doesn’t support [skadnetwork_linkid].\n\n### Create and validate the ad impression\n\nIn the `testImpressionValidity()` method, the unit test creates an instance of [https:\/\/developer.apple.com\/documentation\/storekit\/skadimpression] to represent a view-through ad.\n\nAll of the properties are required. In the testing environment, the [https:\/\/developer.apple.com\/documentation\/storekit\/skadimpression\/3727300-sourceappstoreitemidentifier] is always `0`.\n\n```swift\n\/\/ Form the SKAdImpression instance and configure it.\nlet impression = SKAdImpression()\nimpression.version = \"4.0\"\nimpression.adNetworkIdentifier = \"com.apple.test-1\"\nimpression.sourceIdentifier = 3120\nimpression.advertisedAppStoreItemIdentifier = 525_463_029\nimpression.adImpressionIdentifier = \"b7c9da2b-15c7-4f3b-9326-135f9630033d\"\nimpression.sourceAppStoreItemIdentifier = 0\nimpression.timestamp = 1_676_057_605_705\nimpression.signature = \"MEQCIAtBBiadCFlMOEOh3K43xyKaU1\/sj\/CtgDOB+Wm7J+29AiBDfreX67mm4X9ZoM4xkHHLtuMM2OXcS5kQ7UpVb69A\/Q==\"\n```\n\nThe unit test then calls the `validateImpression` method on [doc:\/\/com.apple.storekittest\/documentation\/StoreKitTest\/SKAdTestSession] and checks for errors.\n\nIf `validateImpression` returns an error, the unit test fails, and the error contains further information. If `validateImpression` doesn’t return an error, the unit test succeeds.\n\nIn the `testImpressionParametersValidity` method, the unit test creates a dictionary containing the parameters for a StoreKit-rendered ad and validates it using the `validateImpressionWithParameters` method. For more information about StoreKit-rendered ads, visit [https:\/\/developer.apple.com\/documentation\/storekit\/skadnetwork\/signing_and_providing_ads#3732910]. The `testWebAdImpressionPayloadValidity` method creates and validates a web ad impression payload. For more information on web ads, visit [https:\/\/developer.apple.com\/documentation\/skadnetworkforwebads\/get_a_signed_web_ad_impression_payload].\n\n\n\n### Create the test postbacks\n\nThe unit test creates three winning postbacks in the `testAddingPostbacks` method using the [doc:\/\/com.apple.storekittest\/documentation\/StoreKitTest\/SKAdTestPostback] class. The fields of a postback are specific to each version of the [https:\/\/developer.apple.com\/documentation\/storekit\/skadnetwork] API. This class provides an initializer that specifies the postback fields and the `SKAdNetwork` API version.\n\nFor ad postbacks using `SKAdNetwork` version 4.0 or later, test multiple conversion windows by creating an array of three postbacks corresponding to the three conversion windows using the `winningPostbacks` static method on `SKAdTestPostback`. Create a single winning or nonwinning postback using the initializer with the `sourceIdentifier` parameter. For more information on multiple conversion windows, visit [https:\/\/developer.apple.com\/documentation\/storekit\/skadnetwork\/receiving_postbacks_in_multiple_conversion_windows].\n\n```swift\nguard let testPostbacks = SKAdTestPostback.winningPostbacks(withVersion: .version4_0,\n                                                            adNetworkIdentifier: \"com.apple.test-1\",\n                                                            sourceIdentifier: \"3120\",\n                                                            appStoreItemIdentifier: 0,\n                                                            sourceAppStoreItemIdentifier: 525_463_029,\n                                                            sourceDomain: nil,\n                                                            fidelityType: 1,\n                                                            isRedownload: false,\n                                                            postbackURL: \"TEST SERVER ENDPOINT\") else {\n    XCTFail(\"Failed to create postbacks.\")\n    return\n}\n```\n\nAfter creating the `SKAdTestPostback` instances, the unit test calls the `setPostbacks` method on `SKAdTestSession` to add the newly created postbacks to the test session. Test postbacks added to the test session are available to the unit tests for further testing, including updating the conversion value or sending the postbacks. Test sessions can handle up to eight postbacks. Each call to the `setPostbacks` method overwrites the test postbacks in the test session.\n\n```swift\ntry testSession.setPostbacks(testPostbacks)\n```\n\n### Test updating the conversion value\n\nA postback isn’t ready to send to the server until it has a conversion value. The unit test updates the conversion value of the first test postback by calling the [https:\/\/developer.apple.com\/documentation\/storekit\/skadnetwork\/4090669-updatepostbackconversionvalue] method on [https:\/\/developer.apple.com\/documentation\/storekit\/skadnetwork]. To confirm the conversion value after updating it, the unit test retrieves the postbacks using the `postbacks` property on `SKAdTestSession` and then checks the conversion value.\n\n```swift\nlet fetchedPostbacks = testSession.postbacks\nguard fetchedPostbacks.count == 3 else {\n    XCTFail(\"Expecting 3 postbacks, received \\(fetchedPostbacks.count).\")\n    return\n}\n\n\/\/ A test session's `postbacks` property maintains the order of the postbacks.\nlet firstPostback = fetchedPostbacks[0]\nXCTAssertEqual(firstPostback.fineConversionValue, 42)\n```\n\n### Send and receive the test postback\n\nThe unit test sends the postbacks with updated conversion values to the network server by calling the `flushPostbacks` method on `SKAdTestSession` The server URL is specified in the `testAddingPostbacks` method, where the test postbacks are created.\n\n\n\nAfter sending the test postbacks, the unit test waits for a response from the server. The server responds with one [doc:\/\/com.apple.storekittest\/documentation\/StoreKitTest\/SKAdTestPostbackResponse] instance for each test postback. The response contains information about the success or failure of the postback, the error details, and the HTTP response the server received, if any.\n\nIn the `testSendingPostback()` method, the unit test checks the response for the success or failure flag and the error object. The unit test passes only if it receives a success signal in combination with a `nil` error. Calling the `flushPostbacks` method removes the test postbacks from the test session.\n\n```swift\ntestSession.flushPostbacks { responses, error in\n    XCTAssertNil(error)\n    guard let concreteResponses = responses else {\n        XCTFail(\"No responses received.\")\n        return\n    }\n    for response in concreteResponses {\n        let postbackResponse = response.value\n        XCTAssertNil(postbackResponse.error)\n        XCTAssertTrue(postbackResponse.didSucceed)\n    }\n}\n```\n\n## Ad impression and postback testing\n\n- **SKAdTestSession**: The class you use to test ad impressions and postbacks in Xcode.\n- **SKAdTestPostback**: A test postback that contains ad conversion information in the testing environment.\n- **SKAdTestPostbackResponse**: The status and error information for a postback that the system sends in the testing environment.\n- **SKAdTestPostbackVersion**: A constant that indicates the postback version.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "The class you use to test ad impressions and postbacks in Xcode.",
          "name" : "SKAdTestSession",
          "url" : "https:\/\/developer.apple.com\/documentation\/StoreKitTest\/SKAdTestSession"
        },
        {
          "description" : "A test postback that contains ad conversion information in the testing environment.",
          "name" : "SKAdTestPostback",
          "url" : "https:\/\/developer.apple.com\/documentation\/StoreKitTest\/SKAdTestPostback"
        },
        {
          "description" : "The status and error information for a postback that the system sends in the testing environment.",
          "name" : "SKAdTestPostbackResponse",
          "url" : "https:\/\/developer.apple.com\/documentation\/StoreKitTest\/SKAdTestPostbackResponse"
        },
        {
          "description" : "A constant that indicates the postback version.",
          "name" : "SKAdTestPostbackVersion",
          "url" : "https:\/\/developer.apple.com\/documentation\/StoreKitTest\/SKAdTestPostbackVersion"
        }
      ],
      "title" : "Ad impression and postback testing"
    }
  ],
  "source" : "appleJSON",
  "title" : "Testing and validating ad impression signatures and postbacks for SKAdNetwork",
  "url" : "https:\/\/developer.apple.com\/documentation\/storekittest\/testing-and-validating-ad-impression-signatures-and-postbacks-for-skadnetwork"
}