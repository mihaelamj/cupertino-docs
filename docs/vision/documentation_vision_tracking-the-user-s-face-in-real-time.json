{
  "abstract" : "Detect and track faces from the selfie cam feed in real time.",
  "codeExamples" : [
    {
      "code" : "let faceDetectionRequest = VNDetectFaceRectanglesRequest(completionHandler: { (request, error) in\n    \n    if error != nil {\n        print(\"FaceDetection error: \\(String(describing: error)).\")\n    }\n    \n    guard let faceDetectionRequest = request as? VNDetectFaceRectanglesRequest,\n          let results = faceDetectionRequest.results else {\n            return\n    }\n    DispatchQueue.main.async {\n        \/\/ Add the observations to the tracking list\n        for observation in results {\n            let faceTrackingRequest = VNTrackObjectRequest(detectedObjectObservation: observation)\n            requests.append(faceTrackingRequest)\n        }\n        self.trackingRequests = requests\n    }\n})",
      "language" : "swift"
    },
    {
      "code" : "let imageRequestHandler = VNImageRequestHandler(cvPixelBuffer: pixelBuffer,\n                                                orientation: exifOrientation,\n                                                options: requestHandlerOptions)\n\ndo {\n    guard let detectRequests = self.detectionRequests else {\n        return\n    }\n    try imageRequestHandler.perform(detectRequests)\n} catch let error as NSError {\n    NSLog(\"Failed to perform FaceRectangleRequest: %@\", error)\n}",
      "language" : "swift"
    },
    {
      "code" : "try self.sequenceRequestHandler.perform(requests,\n                                         on: pixelBuffer,\n                                         orientation: exifOrientation)",
      "language" : "swift"
    },
    {
      "code" : "\/\/ Setup the next round of tracking.\nvar newTrackingRequests = [VNTrackObjectRequest]()\nfor trackingRequest in requests {\n    \n    guard let results = trackingRequest.results else {\n        return\n    }\n    \n    guard let observation = results[0] as? VNDetectedObjectObservation else {\n        return\n    }\n    \n    if !trackingRequest.isLastFrame {\n        if observation.confidence > 0.3 {\n            trackingRequest.inputObservation = observation\n        } else {\n            trackingRequest.isLastFrame = true\n        }\n        newTrackingRequests.append(trackingRequest)\n    }\n}",
      "language" : "swift"
    }
  ],
  "contentHash" : "6bdf78be6bddc759718fd5274a136d44de19c0f65bb54fd63806f2c4e887bf93",
  "crawledAt" : "2025-12-02T15:52:50Z",
  "id" : "E35798B9-6633-4CE8-830E-5E602878ACD7",
  "kind" : "unknown",
  "language" : "swift",
  "module" : "Vision",
  "overview" : "## Overview\n\nThe [https:\/\/developer.apple.com\/documentation\/vision] framework can detect and track rectangles, faces, and other salient objects across a sequence of images.\n\nThis sample shows how to create requests to track human faces and interpret the results of those requests.  In order to visualize the geometry of observed facial features, the code draws paths around the primary detected face and its most prominent features.\n\nThe sample app applies computer vision algorithms to find a face in the provided image. Once it finds a face, it attempts to track that face across subsequent frames of the video. Finally, it draws a green box around the observed face, as well as yellow paths outlining facial features, on [https:\/\/developer.apple.com\/documentation\/quartzcore] layers.\n\nTo see this sample app in action, build and run the project on iOS 11.  Grant the app permission to use the camera.\n\n### Configure the Camera to Capture Video\n\nThis section shows how to set up a camera capture session using delegates to prepare images for Vision. Configuring the camera involves the following steps.\n\nMost of this code is boilerplate setup that enables you to handle video input properly. Tweak the values only if you choose a different camera arrangement.\n\n### Parse Face Detection Results\n\nYou can provide a completion handler for a Vision request handler to execute when it finishes. The completion handler indicates whether the request succeeded or resulted in an error. If the request succeeded, its [https:\/\/developer.apple.com\/documentation\/vision\/vnrequest\/2867238-results] property contains data specific to the type of request that you can use to identify the object’s location and bounding box.\n\nFor face rectangle requests, the [https:\/\/developer.apple.com\/documentation\/vision\/vnfaceobservation] provided via callback includes a bounding box for each detected face. The sample uses this bounding box to draw paths around each of the detected face landmarks on top of the preview image.\n\nIn addition to drawing paths on [https:\/\/developer.apple.com\/documentation\/quartzcore\/calayer] to visualize the feature, you can access specific facial-feature data such as eye, pupil, nose, and lip classifications in the face observation’s [https:\/\/developer.apple.com\/documentation\/vision\/vnfaceobservation\/2867250-landmarks] property. Your app can leverage this information to track the user’s face and apply custom effects. For a face landmarks request, the face rectangle detector will also run implicitly.\n\n### Preprocess Images\n\nPerform any image preprocessing in the delegate method [https:\/\/developer.apple.com\/documentation\/avfoundation\/avcapturefileoutputdelegate\/1390096-captureoutput]. In this delegate method, create a pixel buffer to hold image contents, determine the device’s orientation, and check whether you have a face to track.\n\nBefore the Vision framework can track an object, it must first know which object to track. Determine which face to track by creating a  [https:\/\/developer.apple.com\/documentation\/vision\/vnimagerequesthandler] and passing it a still image frame. In the case of video, submit individual frames to the request handler as they arrive in the delegate method [https:\/\/developer.apple.com\/documentation\/avfoundation\/avcapturefileoutputdelegate\/1390096-captureoutput].\n\nThe [https:\/\/developer.apple.com\/documentation\/vision\/vnimagerequesthandler] handles detection of faces and objects in still images, but it doesn’t carry information from one frame to the next.  For tracking an object, create a [https:\/\/developer.apple.com\/documentation\/vision\/vnsequencerequesthandler], which can handle [https:\/\/developer.apple.com\/documentation\/vision\/vntrackobjectrequest].\n\n### Track the Detected Face\n\nOnce you have an observation from the image request handler’s face detection, input it to the sequence request handler.\n\nIf the detector hasn’t found a face, create an image request handler to detect a face. Once that detection succeeds, and you have a face observation, track it by creating a [https:\/\/developer.apple.com\/documentation\/vision\/vntrackobjectrequest].\n\nThen call the sequence handler’s [https:\/\/developer.apple.com\/documentation\/vision\/vnimagerequesthandler\/2880297-perform] function. This method runs synchronously, so use a background queue to avoid blocking the main queue as it executes, and call back to the main queue only if you need to perform UI updates such as path drawing.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/Vision\/tracking-the-user-s-face-in-real-time\ncrawled: 2025-12-02T15:52:50Z\n---\n\n# Tracking the User’s Face in Real Time\n\n**Sample Code**\n\nDetect and track faces from the selfie cam feed in real time.\n\n## Overview\n\nThe [https:\/\/developer.apple.com\/documentation\/vision] framework can detect and track rectangles, faces, and other salient objects across a sequence of images.\n\nThis sample shows how to create requests to track human faces and interpret the results of those requests.  In order to visualize the geometry of observed facial features, the code draws paths around the primary detected face and its most prominent features.\n\nThe sample app applies computer vision algorithms to find a face in the provided image. Once it finds a face, it attempts to track that face across subsequent frames of the video. Finally, it draws a green box around the observed face, as well as yellow paths outlining facial features, on [https:\/\/developer.apple.com\/documentation\/quartzcore] layers.\n\nTo see this sample app in action, build and run the project on iOS 11.  Grant the app permission to use the camera.\n\n### Configure the Camera to Capture Video\n\nThis section shows how to set up a camera capture session using delegates to prepare images for Vision. Configuring the camera involves the following steps.\n\n1. First, create a new [https:\/\/developer.apple.com\/documentation\/avfoundation\/avcapturesession] to represent video capture. Channel its output through [https:\/\/developer.apple.com\/documentation\/avfoundation\/avcapturesession].\n2. Query the user’s input device and configure it for video data output by specifying its resolution and camera.\n3. Next, create a serial dispatch queue. This queue ensures that video frames, received asynchronously through delegate callback methods, are delivered in order. Establish a capture session with [https:\/\/developer.apple.com\/documentation\/avfoundation\/avmediatype] video and set its device and resolution.\n4. Finally, designate the video’s preview layer and add it to your view hierarchy, so the camera knows where to display video frames as they are captured.\n\nMost of this code is boilerplate setup that enables you to handle video input properly. Tweak the values only if you choose a different camera arrangement.\n\n### Parse Face Detection Results\n\nYou can provide a completion handler for a Vision request handler to execute when it finishes. The completion handler indicates whether the request succeeded or resulted in an error. If the request succeeded, its [https:\/\/developer.apple.com\/documentation\/vision\/vnrequest\/2867238-results] property contains data specific to the type of request that you can use to identify the object’s location and bounding box.\n\nFor face rectangle requests, the [https:\/\/developer.apple.com\/documentation\/vision\/vnfaceobservation] provided via callback includes a bounding box for each detected face. The sample uses this bounding box to draw paths around each of the detected face landmarks on top of the preview image.\n\n```swift\nlet faceDetectionRequest = VNDetectFaceRectanglesRequest(completionHandler: { (request, error) in\n    \n    if error != nil {\n        print(\"FaceDetection error: \\(String(describing: error)).\")\n    }\n    \n    guard let faceDetectionRequest = request as? VNDetectFaceRectanglesRequest,\n          let results = faceDetectionRequest.results else {\n            return\n    }\n    DispatchQueue.main.async {\n        \/\/ Add the observations to the tracking list\n        for observation in results {\n            let faceTrackingRequest = VNTrackObjectRequest(detectedObjectObservation: observation)\n            requests.append(faceTrackingRequest)\n        }\n        self.trackingRequests = requests\n    }\n})\n```\n\nIn addition to drawing paths on [https:\/\/developer.apple.com\/documentation\/quartzcore\/calayer] to visualize the feature, you can access specific facial-feature data such as eye, pupil, nose, and lip classifications in the face observation’s [https:\/\/developer.apple.com\/documentation\/vision\/vnfaceobservation\/2867250-landmarks] property. Your app can leverage this information to track the user’s face and apply custom effects. For a face landmarks request, the face rectangle detector will also run implicitly.\n\n### Preprocess Images\n\nPerform any image preprocessing in the delegate method [https:\/\/developer.apple.com\/documentation\/avfoundation\/avcapturefileoutputdelegate\/1390096-captureoutput]. In this delegate method, create a pixel buffer to hold image contents, determine the device’s orientation, and check whether you have a face to track.\n\nBefore the Vision framework can track an object, it must first know which object to track. Determine which face to track by creating a  [https:\/\/developer.apple.com\/documentation\/vision\/vnimagerequesthandler] and passing it a still image frame. In the case of video, submit individual frames to the request handler as they arrive in the delegate method [https:\/\/developer.apple.com\/documentation\/avfoundation\/avcapturefileoutputdelegate\/1390096-captureoutput].\n\n```swift\nlet imageRequestHandler = VNImageRequestHandler(cvPixelBuffer: pixelBuffer,\n                                                orientation: exifOrientation,\n                                                options: requestHandlerOptions)\n\ndo {\n    guard let detectRequests = self.detectionRequests else {\n        return\n    }\n    try imageRequestHandler.perform(detectRequests)\n} catch let error as NSError {\n    NSLog(\"Failed to perform FaceRectangleRequest: %@\", error)\n}\n```\n\nThe [https:\/\/developer.apple.com\/documentation\/vision\/vnimagerequesthandler] handles detection of faces and objects in still images, but it doesn’t carry information from one frame to the next.  For tracking an object, create a [https:\/\/developer.apple.com\/documentation\/vision\/vnsequencerequesthandler], which can handle [https:\/\/developer.apple.com\/documentation\/vision\/vntrackobjectrequest].\n\n### Track the Detected Face\n\nOnce you have an observation from the image request handler’s face detection, input it to the sequence request handler.\n\n```swift\ntry self.sequenceRequestHandler.perform(requests,\n                                         on: pixelBuffer,\n                                         orientation: exifOrientation)\n```\n\nIf the detector hasn’t found a face, create an image request handler to detect a face. Once that detection succeeds, and you have a face observation, track it by creating a [https:\/\/developer.apple.com\/documentation\/vision\/vntrackobjectrequest].\n\n```swift\n\/\/ Setup the next round of tracking.\nvar newTrackingRequests = [VNTrackObjectRequest]()\nfor trackingRequest in requests {\n    \n    guard let results = trackingRequest.results else {\n        return\n    }\n    \n    guard let observation = results[0] as? VNDetectedObjectObservation else {\n        return\n    }\n    \n    if !trackingRequest.isLastFrame {\n        if observation.confidence > 0.3 {\n            trackingRequest.inputObservation = observation\n        } else {\n            trackingRequest.isLastFrame = true\n        }\n        newTrackingRequests.append(trackingRequest)\n    }\n}\n```\n\nThen call the sequence handler’s [https:\/\/developer.apple.com\/documentation\/vision\/vnimagerequesthandler\/2880297-perform] function. This method runs synchronously, so use a background queue to avoid blocking the main queue as it executes, and call back to the main queue only if you need to perform UI updates such as path drawing.\n\n## Object tracking\n\n- **Tracking Multiple Objects or Rectangles in Video**: Apply Vision algorithms to track objects or rectangles throughout a video.\n- **VNTrackingRequest**: The abstract superclass for image-analysis requests that track unique features across multiple images or video frames.\n- **VNTrackRectangleRequest**: An image-analysis request that tracks movement of a previously identified rectangular object across multiple images or video frames.\n- **VNTrackObjectRequest**: An image-analysis request that tracks the movement of a previously identified object across multiple images or video frames.\n- **VNDetectedObjectObservation**: An observation that provides the position and extent of an image feature that an image- analysis request detects.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Apply Vision algorithms to track objects or rectangles throughout a video.",
          "name" : "Tracking Multiple Objects or Rectangles in Video",
          "url" : "https:\/\/developer.apple.com\/documentation\/Vision\/tracking-multiple-objects-or-rectangles-in-video"
        },
        {
          "description" : "The abstract superclass for image-analysis requests that track unique features across multiple images or video frames.",
          "name" : "VNTrackingRequest",
          "url" : "https:\/\/developer.apple.com\/documentation\/Vision\/VNTrackingRequest"
        },
        {
          "description" : "An image-analysis request that tracks movement of a previously identified rectangular object across multiple images or video frames.",
          "name" : "VNTrackRectangleRequest",
          "url" : "https:\/\/developer.apple.com\/documentation\/Vision\/VNTrackRectangleRequest"
        },
        {
          "description" : "An image-analysis request that tracks the movement of a previously identified object across multiple images or video frames.",
          "name" : "VNTrackObjectRequest",
          "url" : "https:\/\/developer.apple.com\/documentation\/Vision\/VNTrackObjectRequest"
        },
        {
          "description" : "An observation that provides the position and extent of an image feature that an image- analysis request detects.",
          "name" : "VNDetectedObjectObservation",
          "url" : "https:\/\/developer.apple.com\/documentation\/Vision\/VNDetectedObjectObservation"
        }
      ],
      "title" : "Object tracking"
    }
  ],
  "source" : "appleJSON",
  "title" : "Tracking the User’s Face in Real Time",
  "url" : "https:\/\/developer.apple.com\/documentation\/Vision\/tracking-the-user-s-face-in-real-time"
}