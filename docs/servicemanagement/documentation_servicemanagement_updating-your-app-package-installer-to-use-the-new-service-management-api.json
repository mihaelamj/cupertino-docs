{
  "abstract" : "Learn about the Service Management API with a GUI-less agent app.",
  "codeExamples" : [
    {
      "code" : "let service = SMAppService.agent(plistName: \"com.xpc.example.agent.plist\")\n\ndo {\n\ttry service.register()\n\tprint(\"Successfully registered \\(service)\")\n} catch {\n\tprint(\"Unable to register \\(error)\")\n\texit(1)\n}",
      "language" : "swift"
    },
    {
      "code" : "let service = SMAppService.agent(plistName: \"com.xpc.example.agent.plist\")\n\ndo {\n\ttry service.unregister()\n\tprint(\"Successfully unregistered \\(service)\")\n} catch {\n\tprint(\"Unable to unregister \\(error)\")\n\texit(1)\n}",
      "language" : "swift"
    },
    {
      "code" : "let service = SMAppService.agent(plistName: \"com.xpc.example.agent.plist\")\n\nprint(\"\\(service) has status \\(service.status)\")",
      "language" : "swift"
    },
    {
      "code" : "% \/Library\/Application Support\/YOURDEVELOPERNAME\/SMAppServiceSampleCode.app\/Contents\/MacOS\/SMAppServiceSampleCode register\nSuccessfully registered LaunchAgent(com.xpc.example.agent.plist)\n\n% \/Library\/Application Support\/YOURDEVELOPERNAME\/SMAppServiceSampleCode.app\/Contents\/MacOS\/SMAppServiceSampleCode status\nLaunchAgent(com.xpc.example.agent.plist) has status SMAppServiceStatus(rawValue: 1)\n\n% \/Library\/Application Support\/YOURDEVELOPERNAME\/SMAppServiceSampleCode.app\/Contents\/MacOS\/SMAppServiceSampleCode test    \nReceived \"Hello World\"\n\n% \/Library\/Application Support\/YOURDEVELOPERNAME\/SMAppServiceSampleCode.app\/Contents\/MacOS\/SMAppServiceSampleCode unregister\nSuccessfully unregistered LaunchAgent(com.xpc.example.agent.plist)",
      "language" : "zsh"
    },
    {
      "code" : "% \/Library\/Application Support\/YOURDEVELOPERNAME\/SMAppServiceSampleCode.app\/Contents\/MacOS\/SMAppServiceSampleCode test\nUnable to create xpc_session <OS_xpc_rich_error: Can Retry: 0. Description:\"Underlying connection was invalidated. Reason: failed at lookup with error 3 - No such process\">",
      "language" : "zsh"
    }
  ],
  "contentHash" : "305c88bded633317bc153ac4a02885ce9607a4d51378958110ef36ab5a274252",
  "crawledAt" : "2025-12-02T15:47:13Z",
  "id" : "9A56D0D0-4600-4FC6-AF8C-D99CB02C9ED2",
  "kind" : "unknown",
  "language" : "swift",
  "module" : "Service Management",
  "overview" : "## Overview\n\nThis sample code project demonstrates how to structure your app package installer and use the new Service Management APIs. The sample project places the helper executable’s `launchd` property lists in the helper executable’s bundle, rather than relying on shared locations like `\/Library\/LaunchDaemons`. The advantages of this approach include containing your `LaunchDaemon` and `LaunchAgent` property lists in a fully codesigned app bundle that neither the system nor a third party can modify without breaking the code signature. Users can also see which app is providing the launch daemons or launch agents by choosing System Settings > General > Login Items.\n\nThis sample project contains three targets:\n\nIn addition to demonstrating the new package structure, this sample demonstrates the APIs for registering helper executables. To register a launch agent, the sample creates an agent object, `SMAppService.agent(plistName:)` and then calls `register()`.\n\nTo unregister a launch agent, the sample creates an agent object, `SMAppService.agent(plistName:)` and then calls `unregister()`.\n\nTo determine the authorization state of a launch agent, the sample creates an agent object, `SMAppService.agent(plistName:)` and then calls `status()` to determine the helper executable’s authorization state.\n\n### Configure the sample code project\n\nTo set the Team ID for the sample app and package targets, follow these steps:\n\n### Build the sample app service\n\nXcode builds the `SMAppServiceSamplePackage` installer package, and the process concludes with Xcode printing `** BUILD SUCCEEDED **` to the terminal.\n\n### Install the login item and launch agent\n\n### Run the sample launch agent\n\nThe installer adds a new login item in System Settings and installs the sample launch agent `SampleLaunchAgent` in the directory `\/Library\/Application Support\/YOURDEVELOPERNAME`. Run the `SampleLaunchAgent` executable from the Terminal by invoking the command line app inside the app bundle with an additional command argument:\n\n`\/Library\/Application Support\/YOURDEVELOPERNAME\/SMAppServiceSampleCode.app\/Contents\/MacOS\/SMAppServiceSampleCode COMMAND`\n\nThe `SMAppServiceSampleCode` app supports the following commands:\n\nThe output from the app resembles the following, for each of the app’s commands:\n\nRunning the app before registering the service, or after unregistering the service, results in an error.\n\n### Uninstall the login item and launch agent\n\nTo uninstall the sample app’s login item from System Settings, as well as the `SampleLaunchAgent`, use the following command:\n\n`sudo rm -rf  \/Library\/Application Support\/YOURDEVELOPERNAME`\n\nThe login item may remain visible in the System Settings > General > Login Items for some time. This is expected because the system removes deleted items as part of its maintenance processes overnight. To remove all third-party login items and reset the System Settings > General > Login Items to its installation defaults, use the `sfltool`:  `sudo sfltool resetbtm`.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/ServiceManagement\/updating-your-app-package-installer-to-use-the-new-service-management-api\ncrawled: 2025-12-02T15:47:13Z\n---\n\n# Updating your app package installer to use the new Service Management API\n\n**Sample Code**\n\nLearn about the Service Management API with a GUI-less agent app.\n\n## Overview\n\nThis sample code project demonstrates how to structure your app package installer and use the new Service Management APIs. The sample project places the helper executable’s `launchd` property lists in the helper executable’s bundle, rather than relying on shared locations like `\/Library\/LaunchDaemons`. The advantages of this approach include containing your `LaunchDaemon` and `LaunchAgent` property lists in a fully codesigned app bundle that neither the system nor a third party can modify without breaking the code signature. Users can also see which app is providing the launch daemons or launch agents by choosing System Settings > General > Login Items.\n\nThis sample project contains three targets:\n\n- `SampleLaunchAgent`, which builds a sample `LaunchAgent` helper executable.\n- `SMAppServiceSampleCode`, which builds a GUI-less app that contains the sample launch agent binary property list and an executable to register the agent at install time.\n- `SMAppServiceSamplePackage`, which builds the `SMAppServiceSample.pkg` installer you use to install the `SampleLaunchAgent` helper executable.\n\nIn addition to demonstrating the new package structure, this sample demonstrates the APIs for registering helper executables. To register a launch agent, the sample creates an agent object, `SMAppService.agent(plistName:)` and then calls `register()`.\n\n```swift\nlet service = SMAppService.agent(plistName: \"com.xpc.example.agent.plist\")\n\ndo {\n\ttry service.register()\n\tprint(\"Successfully registered \\(service)\")\n} catch {\n\tprint(\"Unable to register \\(error)\")\n\texit(1)\n}\n```\n\nTo unregister a launch agent, the sample creates an agent object, `SMAppService.agent(plistName:)` and then calls `unregister()`.\n\n```swift\nlet service = SMAppService.agent(plistName: \"com.xpc.example.agent.plist\")\n\ndo {\n\ttry service.unregister()\n\tprint(\"Successfully unregistered \\(service)\")\n} catch {\n\tprint(\"Unable to unregister \\(error)\")\n\texit(1)\n}\n```\n\nTo determine the authorization state of a launch agent, the sample creates an agent object, `SMAppService.agent(plistName:)` and then calls `status()` to determine the helper executable’s authorization state.\n\n```swift\nlet service = SMAppService.agent(plistName: \"com.xpc.example.agent.plist\")\n\nprint(\"\\(service) has status \\(service.status)\")\n```\n\n### Configure the sample code project\n\nTo set the Team ID for the sample app and package targets, follow these steps:\n\n1. Open `SMAppServiceSampleCode.xcodeproj` in Xcode.\n2. Select the `SMAppServiceSampleCode` target from the project editor.\n3. Click Signing & Capabilities.\n4. Choose your team from the Team pop-up menu.\n5. Select the `SMAppServiceSamplePackage` from the project editor and repeat step 4.\n\n### Build the sample app service\n\n1. Open Terminal and change to the directory into which you downloaded the `UpdatingYourAppPackageInstallerToUseTheNewServiceManagementAPI` source code.\n2. Run the command `xcodebuild -target SMAppServiceSamplePackage`.\n\nXcode builds the `SMAppServiceSamplePackage` installer package, and the process concludes with Xcode printing `** BUILD SUCCEEDED **` to the terminal.\n\n\n\n### Install the login item and launch agent\n\n1. In Terminal, navigate to the `build\/Release` directory using the command `cd build\/Release`.\n2. Open the build directory in Finder with the command `open .`.\n3. The Finder window contains all the products that the Xcode build process creates, including a package installer named `SMAppServiceSample`. Double-click the installer icon to run it, and follow the instructions to approve the installation of the `SMAppServiceSampleCode` login item and its supporting `SampleLaunchAgent` helper executable.\n\n### Run the sample launch agent\n\nThe installer adds a new login item in System Settings and installs the sample launch agent `SampleLaunchAgent` in the directory `\/Library\/Application Support\/YOURDEVELOPERNAME`. Run the `SampleLaunchAgent` executable from the Terminal by invoking the command line app inside the app bundle with an additional command argument:\n\n`\/Library\/Application Support\/YOURDEVELOPERNAME\/SMAppServiceSampleCode.app\/Contents\/MacOS\/SMAppServiceSampleCode COMMAND`\n\nThe `SMAppServiceSampleCode` app supports the following commands:\n\n- `register` — Registers the `SampleLaunchAgent`.\n- `unregister` — Unregisters the `SampleLaunchAgent`.\n- `status` — Checks the authorization status of the `SampleLaunchAgent`.\n- `test` — Sends an XPC message to the `SampleLaunchAgent` and displays the reply.\n\nThe output from the app resembles the following, for each of the app’s commands:\n\n```zsh\n% \/Library\/Application Support\/YOURDEVELOPERNAME\/SMAppServiceSampleCode.app\/Contents\/MacOS\/SMAppServiceSampleCode register\nSuccessfully registered LaunchAgent(com.xpc.example.agent.plist)\n\n% \/Library\/Application Support\/YOURDEVELOPERNAME\/SMAppServiceSampleCode.app\/Contents\/MacOS\/SMAppServiceSampleCode status\nLaunchAgent(com.xpc.example.agent.plist) has status SMAppServiceStatus(rawValue: 1)\n\n% \/Library\/Application Support\/YOURDEVELOPERNAME\/SMAppServiceSampleCode.app\/Contents\/MacOS\/SMAppServiceSampleCode test    \nReceived \"Hello World\"\n\n% \/Library\/Application Support\/YOURDEVELOPERNAME\/SMAppServiceSampleCode.app\/Contents\/MacOS\/SMAppServiceSampleCode unregister\nSuccessfully unregistered LaunchAgent(com.xpc.example.agent.plist)\n```\n\nRunning the app before registering the service, or after unregistering the service, results in an error.\n\n```zsh\n% \/Library\/Application Support\/YOURDEVELOPERNAME\/SMAppServiceSampleCode.app\/Contents\/MacOS\/SMAppServiceSampleCode test\nUnable to create xpc_session <OS_xpc_rich_error: Can Retry: 0. Description:\"Underlying connection was invalidated. Reason: failed at lookup with error 3 - No such process\">\n```\n\n### Uninstall the login item and launch agent\n\nTo uninstall the sample app’s login item from System Settings, as well as the `SampleLaunchAgent`, use the following command:\n\n`sudo rm -rf  \/Library\/Application Support\/YOURDEVELOPERNAME`\n\nThe login item may remain visible in the System Settings > General > Login Items for some time. This is expected because the system removes deleted items as part of its maintenance processes overnight. To remove all third-party login items and reset the System Settings > General > Login Items to its installation defaults, use the `sfltool`:  `sudo sfltool resetbtm`.\n\n## Essentials\n\n- **Updating helper executables from earlier versions of macOS**: Simplify your app’s helper executables and support new authorization controls.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Simplify your app’s helper executables and support new authorization controls.",
          "name" : "Updating helper executables from earlier versions of macOS",
          "url" : "https:\/\/developer.apple.com\/documentation\/ServiceManagement\/updating-helper-executables-from-earlier-versions-of-macos"
        }
      ],
      "title" : "Essentials"
    }
  ],
  "source" : "appleJSON",
  "title" : "Updating your app package installer to use the new Service Management API",
  "url" : "https:\/\/developer.apple.com\/documentation\/ServiceManagement\/updating-your-app-package-installer-to-use-the-new-service-management-api"
}