{
  "abstract" : "Calls the given closure with an inout reference to the underlying storage bound to the custom uniforms argument of a surface shader or geometry modifier.",
  "codeExamples" : [
    {
      "code" : " \/\/ Texture types do not bridge to Swift,\n \/\/ so some preprocessing work is necessary.\n #ifdef __METAL_VERSION__\n #define TEXTURE_2D metal::texture2d<half>\n #else\n #define TEXTURE_2D uint64_t\n #endif\n\n typedef struct {\n    TEXTURE_2D noiseTexture;\n    float2 noiseUVOffset;\n } SurfaceCustomUniforms;\n\n typedef struct {\n    float vertexAnimationSpeed;\n    float vertexAnimationAmplitude;\n } GeometryCustomUniforms;",
      "language" : "cpp"
    },
    {
      "code" : "#include <metal_stdlib>\n#include <RealityKit\/RealityKit.h>\n#include \"SharedHeader.h\"\n\nconstexpr sampler kSampler(coord::normalized,\n                           address::repeat,\n                           filter::linear);\n\n[[stitchable]]\nvoid surfaceShaderWithCustomUniforms(realitykit::surface_parameters params,\n                                      constant SurfaceCustomUniforms &customParams)\n{\n    float2 uv = params.geometry().uv0();\n\n    half4 noiseSample = customParams.noiseTexture.sample(kSampler, uv + customParams.noiseUVOffset);\n    half4 baseColorSample = params.textures().base_color().sample(kSampler, uv);\n\n    params.surface().set_base_color(baseColorSample.rgb + noiseSample.rgb);\n}\n\n[[stitchable]]\nvoid geometryModifierWithCustomUniforms(realitykit::geometry_parameters params,\n                                        constant GeometryCustomUniforms &customParams)\n{\n    float currentTime = params.uniforms().time() * customParams.vertexAnimationSpeed;\n    params.geometry().set_model_position_offset(sin(currentTime) * customParams.vertexAnimationAmplitude * params.geometry().normal());\n}",
      "language" : "cpp"
    },
    {
      "code" : " var customMaterial = CustomMaterial(surfaceShader: surfaceShader, lightingModel: .lit)\n customMaterial.withMutableUniforms(ofType: SurfaceCustomUniforms.self, stage: .surfaceShader) { params, resources in\n    params.noiseUVOffset = SIMD2<Float>(x: 0.25, x: 0.25)\n    resources[textureResource: \\.noiseTexture] = noiseTexture\n }\n customMaterial.withMutableUniforms(ofType: GeometryCustomUniforms.self, stage: .geometryModifier) { params, resources in\n    params.vertexAnimationSpeed = 2.0\n    params.vertexAnimationAmplitude = 0.1\n }",
      "language" : "swift"
    }
  ],
  "contentHash" : "0dbfeca293dd0fcd233aaa19efc897a0c4243ccc502efe4356798b1f352842df",
  "crawledAt" : "2025-12-02T00:57:13Z",
  "declaration" : {
    "code" : "mutating func withMutableUniforms<UniformsType>(ofType: UniformsType.Type, stage: CustomShaderStage, _ callback: (inout UniformsType, inout CustomMaterial.ResourceStorage<UniformsType>) -> Void)",
    "language" : "swift"
  },
  "id" : "E5460032-0771-4CDF-BCCD-CF76727C0622",
  "kind" : "method",
  "module" : "RealityKit",
  "overview" : "## Discussion\n\nSurfaceShaders and GeometryModifiers can declare an argument buffer parameter to be passed into their shader, along with the normal built in PBR parameters. This vastly increases the amount of data your surface shader or geometry modifier can have access to.\n\nTo use this feature, declare a custom uniforms struct in a header shared by your metal and swift code.\n\nNext, define your material functions in metal and pass the argument buffer you defined in a shared header as a second argument. Note to use this feature your material function must be `[[stitchable]]`, instead of `[[visible]]` as well.\n\nFinally, modify these custom uniforms in swift by using this method.\n\nMaterial Functions support one additional argument buffer parameter like this, per stage.",
  "platforms" : [
    "iOS",
    "iPadOS",
    "Mac Catalyst",
    "macOS",
    "tvOS"
  ],
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/realitykit\/custommaterial\/withmutableuniforms(oftype:stage:_:)\ncrawled: 2025-12-02T00:57:13Z\n---\n\n# withMutableUniforms(ofType:stage:_:)\n\n**Instance Method**\n\nCalls the given closure with an inout reference to the underlying storage bound to the custom uniforms argument of a surface shader or geometry modifier.\n\n## Declaration\n\n```swift\nmutating func withMutableUniforms<UniformsType>(ofType: UniformsType.Type, stage: CustomShaderStage, _ callback: (inout UniformsType, inout CustomMaterial.ResourceStorage<UniformsType>) -> Void)\n```\n\n## Discussion\n\nSurfaceShaders and GeometryModifiers can declare an argument buffer parameter to be passed into their shader, along with the normal built in PBR parameters. This vastly increases the amount of data your surface shader or geometry modifier can have access to.\n\nTo use this feature, declare a custom uniforms struct in a header shared by your metal and swift code.\n\n```cpp\n \/\/ Texture types do not bridge to Swift,\n \/\/ so some preprocessing work is necessary.\n #ifdef __METAL_VERSION__\n #define TEXTURE_2D metal::texture2d<half>\n #else\n #define TEXTURE_2D uint64_t\n #endif\n\n typedef struct {\n    TEXTURE_2D noiseTexture;\n    float2 noiseUVOffset;\n } SurfaceCustomUniforms;\n\n typedef struct {\n    float vertexAnimationSpeed;\n    float vertexAnimationAmplitude;\n } GeometryCustomUniforms;\n```\n\nNext, define your material functions in metal and pass the argument buffer you defined in a shared header as a second argument. Note to use this feature your material function must be `[[stitchable]]`, instead of `[[visible]]` as well.\n\n```cpp\n#include <metal_stdlib>\n#include <RealityKit\/RealityKit.h>\n#include \"SharedHeader.h\"\n\nconstexpr sampler kSampler(coord::normalized,\n                           address::repeat,\n                           filter::linear);\n\n[[stitchable]]\nvoid surfaceShaderWithCustomUniforms(realitykit::surface_parameters params,\n                                      constant SurfaceCustomUniforms &customParams)\n{\n    float2 uv = params.geometry().uv0();\n\n    half4 noiseSample = customParams.noiseTexture.sample(kSampler, uv + customParams.noiseUVOffset);\n    half4 baseColorSample = params.textures().base_color().sample(kSampler, uv);\n\n    params.surface().set_base_color(baseColorSample.rgb + noiseSample.rgb);\n}\n\n[[stitchable]]\nvoid geometryModifierWithCustomUniforms(realitykit::geometry_parameters params,\n                                        constant GeometryCustomUniforms &customParams)\n{\n    float currentTime = params.uniforms().time() * customParams.vertexAnimationSpeed;\n    params.geometry().set_model_position_offset(sin(currentTime) * customParams.vertexAnimationAmplitude * params.geometry().normal());\n}\n```\n\nFinally, modify these custom uniforms in swift by using this method.\n\n```swift\n var customMaterial = CustomMaterial(surfaceShader: surfaceShader, lightingModel: .lit)\n customMaterial.withMutableUniforms(ofType: SurfaceCustomUniforms.self, stage: .surfaceShader) { params, resources in\n    params.noiseUVOffset = SIMD2<Float>(x: 0.25, x: 0.25)\n    resources[textureResource: \\.noiseTexture] = noiseTexture\n }\n customMaterial.withMutableUniforms(ofType: GeometryCustomUniforms.self, stage: .geometryModifier) { params, resources in\n    params.vertexAnimationSpeed = 2.0\n    params.vertexAnimationAmplitude = 0.1\n }\n```\n\nMaterial Functions support one additional argument buffer parameter like this, per stage.\n\n## Setting shader properties\n\n- **program**\n- **custom**: User-defined properties for the material’s shader functions.\n- **lightingModel**: The lighting model that the material uses.\n- **withMutableUniforms(ofType:_:)**: Calls the given closure with an inout reference to the underlying storage bound to the custom uniforms argument of a surface shader and geometry modifier.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "",
          "name" : "program",
          "url" : "https:\/\/developer.apple.com\/documentation\/RealityKit\/CustomMaterial\/program-swift.property"
        },
        {
          "description" : "User-defined properties for the material’s shader functions.",
          "name" : "custom",
          "url" : "https:\/\/developer.apple.com\/documentation\/RealityKit\/CustomMaterial\/custom-swift.property"
        },
        {
          "description" : "The lighting model that the material uses.",
          "name" : "lightingModel",
          "url" : "https:\/\/developer.apple.com\/documentation\/RealityKit\/CustomMaterial\/lightingModel-swift.property"
        },
        {
          "description" : "Calls the given closure with an inout reference to the underlying storage bound to the custom uniforms argument of a surface shader and geometry modifier.",
          "name" : "withMutableUniforms(ofType:_:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/RealityKit\/CustomMaterial\/withMutableUniforms(ofType:_:)"
        }
      ],
      "title" : "Setting shader properties"
    }
  ],
  "source" : "appleJSON",
  "title" : "withMutableUniforms(ofType:stage:_:)",
  "url" : "https:\/\/developer.apple.com\/documentation\/realitykit\/custommaterial\/withmutableuniforms(oftype:stage:_:)"
}