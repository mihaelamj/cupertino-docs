{
  "abstract" : "Configure your music app to work with CarPlay by displaying a custom UI.",
  "codeExamples" : [
    {
      "code" : "var tabTemplates = [CPTemplate]()\n\nif let playlists = MediaPlayerUtilities.searchForPlaylistsInLocalLibrary(withPredicate: nil) {\n    \n    let listItems = playlists.compactMap { (playlist) -> CPListItem? in\n        let listItem = CPListItem(text: playlist.name, detailText: \"\")\n        listItem.handler = { playlistItem, completion in\n            AppleMusicAPIController.playWithItems(items: playlist.items.compactMap({ (item) -> String? in\n                return item.playbackStoreID\n            }))\n            completion()\n        }\n        return listItem\n    }\n    \n    var playlistTemplate: CPListTemplate!\n    \n    if #available(iOS 15.0, *) {\n        let configuration = CPAssistantCellConfiguration(\n                            position: .top,\n                            visibility: .always,\n                            assistantAction: .playMedia)\n        playlistTemplate = CPListTemplate(\n                            title: \"Playlists\",\n                            sections: [CPListSection(items: listItems)],\n                            assistantCellConfiguration: configuration)\n                        \n    } else {\n        playlistTemplate = CPListTemplate(\n                            title: \"Playlists\",\n                            sections: [CPListSection(items: listItems)])\n                        \n    }\n    \n    playlistTemplate.tabImage = UIImage(systemName: \"list.star\")\n    \n    tabTemplates.append(playlistTemplate)\n}\n\ntabTemplates.append(genresTemplate())\ntabTemplates.append(settingsTemplate())\n\nself.carplayInterfaceController!.delegate = self\nself.carplayInterfaceController!.setRootTemplate(CPTabBarTemplate(templates: tabTemplates), animated: true, completion: nil)",
      "language" : "swift"
    },
    {
      "code" : "let context = INMediaUserContext()\ncontext.numberOfLibraryItems = MPMediaQuery.songs().items?.count\nAppleMusicAPIController.sharedController.prepareForRequests { (success) in\n    if success {\n        context.subscriptionStatus = .subscribed\n    } else {\n        context.subscriptionStatus = .notSubscribed\n    }\n    context.becomeCurrent()\n}",
      "language" : "swift"
    },
    {
      "code" : "self.playbackObserver = NotificationCenter.default.addObserver(\n    forName: .MPMusicPlayerControllerPlaybackStateDidChange,\n    object: nil,\n    queue: .main) {\n    notification in\n    MemoryLogger.shared.appendEvent(\n        \"MPMusicPlayerControllerPlaybackStateDidChange: \\(MPMusicPlayerController.applicationQueuePlayer.playbackState)\")\n}\n\nself.nowPlayingItemObserver = NotificationCenter.default.addObserver(\n    forName: .MPMusicPlayerControllerNowPlayingItemDidChange,\n    object: nil,\n    queue: .main) {\n    notification in\n    MemoryLogger.shared.appendEvent(\"MPMusicPlayerControllerNowPlayingItemDidChange\")\n}",
      "language" : "swift"
    }
  ],
  "contentHash" : "ee82d5904399e5ee8a6049a16fc6b542a5fda4c512fb0fdc29effd4fe3add1e6",
  "crawledAt" : "2025-12-02T15:47:49Z",
  "id" : "10F58A33-FA18-4C26-9032-8E666965C0E6",
  "kind" : "unknown",
  "language" : "swift",
  "module" : "CarPlay",
  "overview" : "## Overview\n\nCarPlay Music is a sample music app that demonstrates how to display a custom UI from a CarPlay–enabled vehicle. CarPlay Music integrates with the CarPlay framework by implementing the  [doc:\/\/com.apple.documentation\/documentation\/CarPlay\/CPNowPlayingTemplate] and [doc:\/\/com.apple.documentation\/documentation\/CarPlay\/CPListTemplate]. This sample’s iOS app component provides a logging interface to help you understand the life cycle of a CarPlay app, as well as a music controller.\n\n### Configure the Sample Code Project\n\nTo configure the sample code project, perform the following:\n\n### Handle Communication with CarPlay\n\nThe app is responsible for adding and removing the root view controller of the CarPlay window in response to connections and disconnections.\n\nThe following code shows an example implementation of setting a root template:\n\n### Prepare for App Selection\n\nLike other Music apps, CarPlay Music is eligible to participate in App Selection to improve its interactions with Siri. This allows the system to automatically select the app for playing music on the device. See [doc:\/\/com.apple.documentation\/documentation\/SiriKit\/improving-siri-media-interactions-and-app-selection].\n\nThe following code demonstrates how to declare an app as eligible for App Selection:\n\n### Listen for Changes with the Music Player\n\nA good way to ensure an app UI updates automatically in response to changes is to listen for changes in the Now Playing item, as well as in the playing state. CarPlay Music uses the `applicationMusicPlayer`, so it subscribes to the `MPMusicPlayerControllerPlaybackStateDidChange` and `MPMusicPlayerControllerNowPlayingItemDidChange` notifications.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/CarPlay\/integrating-carplay-with-your-music-app\ncrawled: 2025-12-02T15:47:49Z\n---\n\n# Integrating CarPlay with Your Music App\n\n**Sample Code**\n\nConfigure your music app to work with CarPlay by displaying a custom UI.\n\n## Overview\n\nCarPlay Music is a sample music app that demonstrates how to display a custom UI from a CarPlay–enabled vehicle. CarPlay Music integrates with the CarPlay framework by implementing the  [doc:\/\/com.apple.documentation\/documentation\/CarPlay\/CPNowPlayingTemplate] and [doc:\/\/com.apple.documentation\/documentation\/CarPlay\/CPListTemplate]. This sample’s iOS app component provides a logging interface to help you understand the life cycle of a CarPlay app, as well as a music controller.\n\n### Configure the Sample Code Project\n\nTo configure the sample code project, perform the following:\n\n1. Complete the steps in [doc:\/\/com.apple.documentation\/documentation\/CarPlay\/requesting-carplay-entitlements] to request the CarPlay audio entitlement and configure the Xcode project.\n2. Create a key and developer token for the [https:\/\/developer.apple.com\/musickit] service. For more information, see [doc:\/\/com.apple.documentation\/documentation\/AppleMusicAPI\/generating-developer-tokens].\n3. Update the `developerToken` variable in the `AppleMusicAPIController.swift` file to use the developer token you create.\n\n### Handle Communication with CarPlay\n\nThe app is responsible for adding and removing the root view controller of the CarPlay window in response to connections and disconnections.\n\nThe following code shows an example implementation of setting a root template:\n\n```swift\nvar tabTemplates = [CPTemplate]()\n\nif let playlists = MediaPlayerUtilities.searchForPlaylistsInLocalLibrary(withPredicate: nil) {\n    \n    let listItems = playlists.compactMap { (playlist) -> CPListItem? in\n        let listItem = CPListItem(text: playlist.name, detailText: \"\")\n        listItem.handler = { playlistItem, completion in\n            AppleMusicAPIController.playWithItems(items: playlist.items.compactMap({ (item) -> String? in\n                return item.playbackStoreID\n            }))\n            completion()\n        }\n        return listItem\n    }\n    \n    var playlistTemplate: CPListTemplate!\n    \n    if #available(iOS 15.0, *) {\n        let configuration = CPAssistantCellConfiguration(\n                            position: .top,\n                            visibility: .always,\n                            assistantAction: .playMedia)\n        playlistTemplate = CPListTemplate(\n                            title: \"Playlists\",\n                            sections: [CPListSection(items: listItems)],\n                            assistantCellConfiguration: configuration)\n                        \n    } else {\n        playlistTemplate = CPListTemplate(\n                            title: \"Playlists\",\n                            sections: [CPListSection(items: listItems)])\n                        \n    }\n    \n    playlistTemplate.tabImage = UIImage(systemName: \"list.star\")\n    \n    tabTemplates.append(playlistTemplate)\n}\n\ntabTemplates.append(genresTemplate())\ntabTemplates.append(settingsTemplate())\n\nself.carplayInterfaceController!.delegate = self\nself.carplayInterfaceController!.setRootTemplate(CPTabBarTemplate(templates: tabTemplates), animated: true, completion: nil)\n```\n\n### Prepare for App Selection\n\nLike other Music apps, CarPlay Music is eligible to participate in App Selection to improve its interactions with Siri. This allows the system to automatically select the app for playing music on the device. See [doc:\/\/com.apple.documentation\/documentation\/SiriKit\/improving-siri-media-interactions-and-app-selection].\n\nThe following code demonstrates how to declare an app as eligible for App Selection:\n\n```swift\nlet context = INMediaUserContext()\ncontext.numberOfLibraryItems = MPMediaQuery.songs().items?.count\nAppleMusicAPIController.sharedController.prepareForRequests { (success) in\n    if success {\n        context.subscriptionStatus = .subscribed\n    } else {\n        context.subscriptionStatus = .notSubscribed\n    }\n    context.becomeCurrent()\n}\n```\n\n### Listen for Changes with the Music Player\n\nA good way to ensure an app UI updates automatically in response to changes is to listen for changes in the Now Playing item, as well as in the playing state. CarPlay Music uses the `applicationMusicPlayer`, so it subscribes to the `MPMusicPlayerControllerPlaybackStateDidChange` and `MPMusicPlayerControllerNowPlayingItemDidChange` notifications.\n\n```swift\nself.playbackObserver = NotificationCenter.default.addObserver(\n    forName: .MPMusicPlayerControllerPlaybackStateDidChange,\n    object: nil,\n    queue: .main) {\n    notification in\n    MemoryLogger.shared.appendEvent(\n        \"MPMusicPlayerControllerPlaybackStateDidChange: \\(MPMusicPlayerController.applicationQueuePlayer.playbackState)\")\n}\n\nself.nowPlayingItemObserver = NotificationCenter.default.addObserver(\n    forName: .MPMusicPlayerControllerNowPlayingItemDidChange,\n    object: nil,\n    queue: .main) {\n    notification in\n    MemoryLogger.shared.appendEvent(\"MPMusicPlayerControllerNowPlayingItemDidChange\")\n}\n```\n\n## Audio\n\n- **CPNowPlayingTemplate**: A shared system template that displays Now Playing information.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "A shared system template that displays Now Playing information.",
          "name" : "CPNowPlayingTemplate",
          "url" : "https:\/\/developer.apple.com\/documentation\/CarPlay\/CPNowPlayingTemplate"
        }
      ],
      "title" : "Audio"
    }
  ],
  "source" : "appleJSON",
  "title" : "Integrating CarPlay with Your Music App",
  "url" : "https:\/\/developer.apple.com\/documentation\/CarPlay\/integrating-carplay-with-your-music-app"
}