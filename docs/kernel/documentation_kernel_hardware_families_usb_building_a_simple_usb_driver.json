{
  "abstract" : "Set up and load a driver that logs output to the Console app.",
  "codeExamples" : [
    {
      "code" : "ioreg -w0 -rc IOUSBHostInterface -l",
      "language" : "swift"
    },
    {
      "code" : "sudo cp -R SimpleUSBInterfaceDriver.kext ~\ncd ~\nsudo chown -R root:wheel SimpleUSBInterfaceDriver.kext\nsudo chmod -R 755 SimpleUSBInterfaceDriver.kext\nsudo kextload SimpleUSBInterfaceDriver.kext",
      "language" : "swift"
    },
    {
      "code" : "sudo kextunload SimpleUSBInterfaceDriver.kext",
      "language" : "swift"
    }
  ],
  "contentHash" : "50be21309055caa629fceb4dbc229331c733f33d1965659c078da1a84a6281bb",
  "crawledAt" : "2025-12-02T15:33:11Z",
  "id" : "2D5DAE80-DDB6-49BA-9A2A-CCA93CED96FE",
  "kind" : "unknown",
  "language" : "occ",
  "module" : "Kernel",
  "overview" : "## Overview\n\nThis code project builds a simple USB driver. The driver logs events to the Console and responds to interrupts, such as when the user inserts or removes a device. Because it is a template driver with limited functionality, it can be used as a starting point for a more sophisticated driver.\n\n### Configure the Sample Code Project\n\nTo run the sample code project in Xcode, make sure to use macOS 10.15.5 or later and Xcode 11.5 or later.\n\nFor the driver to load, System Integrity Protection (SIP) must be off. For more information on this process, see [doc:\/\/com.apple.security\/documentation\/Security\/disabling-and-enabling-system-integrity-protection].\n\n### Select a USB Test Device\n\nThis sample USB driver works by detecting when a USB device is plugged into a Mac and logging the event. The test device should be unsupported under macOS; otherwise, an existing driver will take precedence, recognize the device, and preempt this sample driver.\n\nThe driver detects the device based on a number of critiera inside of the Info.plist’s `IOKitPersonalities > SimpleUSBInterfaceDriver` section, including configuration value, interface number, product identifier, and vendor identifier.\n\nThe sample driver requires the following command to find criteria that matches the keys in the Info.plist file for a selected USB device plugged into a Mac:\n\nWIth the device’s parmeters identified and placed in the Info.plist file, the driver loads and intializes the device upon insertion.\n\n### Build and Load the Driver\n\nAt build time, Xcode runs the “Launch Terminal” run script build phase, which launches the Terminal app in the directory where the newly-built driver resides.\n\nThe following commands copy the the driver into the home folder, change the current directory to that location, set ownership and permissions, and load the driver.\n\nThe kernel loads the driver and communicates the status through the logging system. The Console app shows the logging messages.\n\n### Unload the Driver\n\nWhen testing completes, the following command directs the kernel to unload the driver:\n\nIt is important to re-enable SIP once driver testing completes. Failure to re-enable SIP leaves the computer vulnerable to malicious code. See [doc:\/\/com.apple.security\/documentation\/Security\/disabling-and-enabling-system-integrity-protection] for more information.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/kernel\/hardware_families\/usb\/building_a_simple_usb_driver\ncrawled: 2025-12-02T15:33:11Z\n---\n\n# Building a Simple USB Driver\n\n**Sample Code**\n\nSet up and load a driver that logs output to the Console app.\n\n## Overview\n\nThis code project builds a simple USB driver. The driver logs events to the Console and responds to interrupts, such as when the user inserts or removes a device. Because it is a template driver with limited functionality, it can be used as a starting point for a more sophisticated driver.\n\n### Configure the Sample Code Project\n\nTo run the sample code project in Xcode, make sure to use macOS 10.15.5 or later and Xcode 11.5 or later.\n\nFor the driver to load, System Integrity Protection (SIP) must be off. For more information on this process, see [doc:\/\/com.apple.security\/documentation\/Security\/disabling-and-enabling-system-integrity-protection].\n\n### Select a USB Test Device\n\nThis sample USB driver works by detecting when a USB device is plugged into a Mac and logging the event. The test device should be unsupported under macOS; otherwise, an existing driver will take precedence, recognize the device, and preempt this sample driver.\n\nThe driver detects the device based on a number of critiera inside of the Info.plist’s `IOKitPersonalities > SimpleUSBInterfaceDriver` section, including configuration value, interface number, product identifier, and vendor identifier.\n\nThe sample driver requires the following command to find criteria that matches the keys in the Info.plist file for a selected USB device plugged into a Mac:\n\n```swift\nioreg -w0 -rc IOUSBHostInterface -l\n```\n\nWIth the device’s parmeters identified and placed in the Info.plist file, the driver loads and intializes the device upon insertion.\n\n### Build and Load the Driver\n\nAt build time, Xcode runs the “Launch Terminal” run script build phase, which launches the Terminal app in the directory where the newly-built driver resides.\n\nThe following commands copy the the driver into the home folder, change the current directory to that location, set ownership and permissions, and load the driver.\n\n```swift\nsudo cp -R SimpleUSBInterfaceDriver.kext ~\ncd ~\nsudo chown -R root:wheel SimpleUSBInterfaceDriver.kext\nsudo chmod -R 755 SimpleUSBInterfaceDriver.kext\nsudo kextload SimpleUSBInterfaceDriver.kext\n```\n\nThe kernel loads the driver and communicates the status through the logging system. The Console app shows the logging messages.\n\n### Unload the Driver\n\nWhen testing completes, the following command directs the kernel to unload the driver:\n\n```swift\nsudo kextunload SimpleUSBInterfaceDriver.kext\n```\n\nIt is important to re-enable SIP once driver testing completes. Failure to re-enable SIP leaves the computer vulnerable to malicious code. See [doc:\/\/com.apple.security\/documentation\/Security\/disabling-and-enabling-system-integrity-protection] for more information.\n\n## Device Communication\n\n- **IOUSBHostIOSourceClientRecordLink**: A structure that represents a USB host input\/output source client record entry.\n- **IOUSBHostIOSourceClientRecordList**: A structure that represents a list of USB host input\/output source client records.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "A structure that represents a USB host input\/output source client record entry.",
          "name" : "IOUSBHostIOSourceClientRecordLink",
          "url" : "https:\/\/developer.apple.com\/documentation\/kernel\/iousbhostiosourceclientrecordlink"
        },
        {
          "description" : "A structure that represents a list of USB host input\/output source client records.",
          "name" : "IOUSBHostIOSourceClientRecordList",
          "url" : "https:\/\/developer.apple.com\/documentation\/kernel\/iousbhostiosourceclientrecordlist"
        }
      ],
      "title" : "Device Communication"
    }
  ],
  "source" : "appleJSON",
  "title" : "Building a Simple USB Driver",
  "url" : "https:\/\/developer.apple.com\/documentation\/kernel\/hardware_families\/usb\/building_a_simple_usb_driver"
}