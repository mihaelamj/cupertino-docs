{
  "abstract" : "Enable background events by adding lifecycle event support.",
  "codeExamples" : [
    {
      "code" : "    import SwiftUI\n\n    \/\/ Shared state that manages the `CLLocationManager` and `CLBackgroundActivitySession`.\n    @MainActor class LocationsHandler: ObservableObject {\n    \n        static let shared = LocationsHandler()  \/\/ Create a single, shared instance of the object.\n        private let manager: CLLocationManager\n        private var background: CLBackgroundActivitySession?\n\n        @Published var lastLocation = CLLocation()\n        @Published var isStationary = false\n        @Published var count = 0\n    \n        @Published\n        var updatesStarted: Bool = UserDefaults.standard.bool(forKey: \"liveUpdatesStarted\") {\n            didSet { UserDefaults.standard.set(updatesStarted, forKey: \"liveUpdatesStarted\") }\n        }\n    \n        @Published\n        var backgroundActivity: Bool = UserDefaults.standard.bool(forKey: \"BGActivitySessionStarted\") {\n            didSet {\n                backgroundActivity ? self.background = CLBackgroundActivitySession() : self.background?.invalidate()\n                UserDefaults.standard.set(backgroundActivity, forKey: \"BGActivitySessionStarted\")\n            }\n        }\n    \n    \n        private init() {\n            self.manager = CLLocationManager()  \/\/ Creating a location manager instance is safe to call here in `MainActor`.\n        }\n    \n        func startLocationUpdates() {\n            if self.manager.authorizationStatus == .notDetermined {\n                self.manager.requestWhenInUseAuthorization()\n            }\n            self.logger.info(\"Starting location updates\")\n            Task() {\n                do {\n                    self.updatesStarted = true\n                    let updates = CLLocationUpdate.liveUpdates()\n                    for try await update in updates {\n                        if !self.updatesStarted { break }  \/\/ End location updates by breaking out of the loop.\n                        if let loc = update.location {\n                            self.lastLocation = loc\n                            self.isStationary = update.isStationary\n                            self.count += 1\n                            print(\"Location \\(self.count): \\(self.lastLocation)\")\n                        }\n                    }\n                } catch {\n                    print(\"Could not start location updates\")\n                }\n                return\n            }\n        }\n    \n        func stopLocationUpdates() {\n            print(\"Stopping location updates\")\n            self.updatesStarted = false\n            self.updatesStarted = false\n        } \n    }",
      "language" : "swift"
    },
    {
      "code" : "    import Foundation\n    import UIKit\n\n    class AppDelegate: NSObject, UIApplicationDelegate, ObservableObject {   \n    \n        func application(_ application: UIApplication, didFinishLaunchingWithOptions\n                         launchOptions: [UIApplication.LaunchOptionsKey: Any]? = nil) -> Bool {\n            let locationsHandler = LocationsHandler.shared\n        \n            \/\/ If location updates were previously active, restart them after the background launch.\n            if locationsHandler.updatesStarted {\n                locationsHandler.startLocationUpdates()\n            }\n            \/\/ If a background activity session was previously active, reinstantiate it after the background launch.\n            if locationsHandler.backgroundActivity {\n                locationsHandler.backgroundActivity = true\n            }\n            return true\n        }\n    }",
      "language" : "swift"
    },
    {
      "code" : "    @main\n    struct MyApp: App {\n        @UIApplicationDelegateAdaptor private var appDelegate: AppDelegate\n        var body: some Scene {\n            WindowGroup {\n                ContentView()\n            }\n        }\n    }",
      "language" : "swift"
    }
  ],
  "contentHash" : "be8ea088861d2ef158df08d0935c04872f862775f25c9db66fc4740cee437f62",
  "crawledAt" : "2025-12-03T12:43:27Z",
  "id" : "C81A0557-DDC1-41C5-8EC3-6BA2BF8BF72A",
  "kind" : "article",
  "language" : "swift",
  "module" : "Core Location",
  "overview" : "## Overview\n\nIn iOS 17 and later, Core Location supports live updates using Swift concurrency’s async\/await capability. In order to adopt live updates, SwiftUI and Mac Catalyst apps need to implement lifecycle event support that enables an app’s `@main app` to have explicit support for the creation and resumption of background run-loops. This enables the system to deliver Core Location events to the app and allows the delivery of events to resume in the event of return from background, launch of the app, or relaunch after a crash.\n\n### Adding lifecycle events to SwiftUI\n\nTo add support for life cycle events, you need to add three components to your app:\n\nIn your SwiftUI or Mac Catalyst App, add support for the `AppDelegate` by adding a shared state through an [doc:\/\/com.apple.documentation\/documentation\/Combine\/ObservableObject], and a [doc:\/\/com.apple.documentation\/documentation\/SwiftUI\/UIApplicationDelegateAdaptor] as an object the app’s `@main` structure maintains, as shown in the following example:\n\nNext, create an instance of a UIKit `AppDelegate` class that conforms to SwiftUI’s [doc:\/\/com.apple.documentation\/documentation\/Combine\/ObservableObject] protocol; this enables the `AppDelegate` to participate in the SwiftUI’s app-level shared state and manages the resumption of Core Location activities when needed.\n\nFinally, include the `AppDelegate` functionality in your app’s `@main` structure using a [doc:\/\/com.apple.documentation\/documentation\/SwiftUI\/UIApplicationDelegateAdaptor]:",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/corelocation\/supporting-live-updates-in-swiftui-and-mac-catalyst-apps\ncrawled: 2025-12-03T12:43:27Z\n---\n\n# Supporting live updates in SwiftUI and Mac Catalyst apps\n\n**Article**\n\nEnable background events by adding lifecycle event support.\n\n## Overview\n\nIn iOS 17 and later, Core Location supports live updates using Swift concurrency’s async\/await capability. In order to adopt live updates, SwiftUI and Mac Catalyst apps need to implement lifecycle event support that enables an app’s `@main app` to have explicit support for the creation and resumption of background run-loops. This enables the system to deliver Core Location events to the app and allows the delivery of events to resume in the event of return from background, launch of the app, or relaunch after a crash.\n\n### Adding lifecycle events to SwiftUI\n\nTo add support for life cycle events, you need to add three components to your app:\n\n1. A shared state using an [doc:\/\/com.apple.documentation\/documentation\/Combine\/ObservableObject] that maintains instances of [doc:\/\/com.apple.corelocation\/documentation\/CoreLocation\/CLLocationManager] and [doc:\/\/com.apple.corelocation\/documentation\/CoreLocation\/CLBackgroundActivitySession-3mzv3]\n2. An `AppDelegate` object that provides the [doc:\/\/com.apple.documentation\/documentation\/UIKit\/UIApplicationDelegate\/application(_:didFinishLaunchingWithOptions:)] method that handles resuming background activities on return from background or an app relaunch\n3. An `AppDelegate` object in the SwiftUI or Mac Catalyst app’s `@main` structure\n\nIn your SwiftUI or Mac Catalyst App, add support for the `AppDelegate` by adding a shared state through an [doc:\/\/com.apple.documentation\/documentation\/Combine\/ObservableObject], and a [doc:\/\/com.apple.documentation\/documentation\/SwiftUI\/UIApplicationDelegateAdaptor] as an object the app’s `@main` structure maintains, as shown in the following example:\n\n```swift\n    import SwiftUI\n\n    \/\/ Shared state that manages the `CLLocationManager` and `CLBackgroundActivitySession`.\n    @MainActor class LocationsHandler: ObservableObject {\n    \n        static let shared = LocationsHandler()  \/\/ Create a single, shared instance of the object.\n        private let manager: CLLocationManager\n        private var background: CLBackgroundActivitySession?\n\n        @Published var lastLocation = CLLocation()\n        @Published var isStationary = false\n        @Published var count = 0\n    \n        @Published\n        var updatesStarted: Bool = UserDefaults.standard.bool(forKey: \"liveUpdatesStarted\") {\n            didSet { UserDefaults.standard.set(updatesStarted, forKey: \"liveUpdatesStarted\") }\n        }\n    \n        @Published\n        var backgroundActivity: Bool = UserDefaults.standard.bool(forKey: \"BGActivitySessionStarted\") {\n            didSet {\n                backgroundActivity ? self.background = CLBackgroundActivitySession() : self.background?.invalidate()\n                UserDefaults.standard.set(backgroundActivity, forKey: \"BGActivitySessionStarted\")\n            }\n        }\n    \n    \n        private init() {\n            self.manager = CLLocationManager()  \/\/ Creating a location manager instance is safe to call here in `MainActor`.\n        }\n    \n        func startLocationUpdates() {\n            if self.manager.authorizationStatus == .notDetermined {\n                self.manager.requestWhenInUseAuthorization()\n            }\n            self.logger.info(\"Starting location updates\")\n            Task() {\n                do {\n                    self.updatesStarted = true\n                    let updates = CLLocationUpdate.liveUpdates()\n                    for try await update in updates {\n                        if !self.updatesStarted { break }  \/\/ End location updates by breaking out of the loop.\n                        if let loc = update.location {\n                            self.lastLocation = loc\n                            self.isStationary = update.isStationary\n                            self.count += 1\n                            print(\"Location \\(self.count): \\(self.lastLocation)\")\n                        }\n                    }\n                } catch {\n                    print(\"Could not start location updates\")\n                }\n                return\n            }\n        }\n    \n        func stopLocationUpdates() {\n            print(\"Stopping location updates\")\n            self.updatesStarted = false\n            self.updatesStarted = false\n        } \n    }\n```\n\nNext, create an instance of a UIKit `AppDelegate` class that conforms to SwiftUI’s [doc:\/\/com.apple.documentation\/documentation\/Combine\/ObservableObject] protocol; this enables the `AppDelegate` to participate in the SwiftUI’s app-level shared state and manages the resumption of Core Location activities when needed.\n\n```swift\n    import Foundation\n    import UIKit\n\n    class AppDelegate: NSObject, UIApplicationDelegate, ObservableObject {   \n    \n        func application(_ application: UIApplication, didFinishLaunchingWithOptions\n                         launchOptions: [UIApplication.LaunchOptionsKey: Any]? = nil) -> Bool {\n            let locationsHandler = LocationsHandler.shared\n        \n            \/\/ If location updates were previously active, restart them after the background launch.\n            if locationsHandler.updatesStarted {\n                locationsHandler.startLocationUpdates()\n            }\n            \/\/ If a background activity session was previously active, reinstantiate it after the background launch.\n            if locationsHandler.backgroundActivity {\n                locationsHandler.backgroundActivity = true\n            }\n            return true\n        }\n    }\n```\n\nFinally, include the `AppDelegate` functionality in your app’s `@main` structure using a [doc:\/\/com.apple.documentation\/documentation\/SwiftUI\/UIApplicationDelegateAdaptor]:\n\n```swift\n    @main\n    struct MyApp: App {\n        @UIApplicationDelegateAdaptor private var appDelegate: AppDelegate\n        var body: some Scene {\n            WindowGroup {\n                ContentView()\n            }\n        }\n    }\n```\n\n## Essentials\n\n- **Configuring your app to use location services**: Prepare your app to start collecting location data.\n- **CLLocationManager**: The object you use to start and stop the delivery of location-related events to your app.\n- **CLBackgroundActivitySession**: An object that manages a visual indicator that keeps your app in use in the background, allowing it to receive updates or events.\n- **CLLocationUpdate**: A structure that contains the location information the framework delivers with each update.\n- **Adopting live updates in Core Location**: Simplify location delivery using asynchronous events in Swift.\n- **Monitoring location changes with Core Location**: Define boundaries and act on user location updates.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Prepare your app to start collecting location data.",
          "name" : "Configuring your app to use location services",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreLocation\/configuring-your-app-to-use-location-services"
        },
        {
          "description" : "The object you use to start and stop the delivery of location-related events to your app.",
          "name" : "CLLocationManager",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreLocation\/CLLocationManager"
        },
        {
          "description" : "An object that manages a visual indicator that keeps your app in use in the background, allowing it to receive updates or events.",
          "name" : "CLBackgroundActivitySession",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreLocation\/CLBackgroundActivitySession-3mzv3"
        },
        {
          "description" : "A structure that contains the location information the framework delivers with each update.",
          "name" : "CLLocationUpdate",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreLocation\/CLLocationUpdate"
        },
        {
          "description" : "Simplify location delivery using asynchronous events in Swift.",
          "name" : "Adopting live updates in Core Location",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreLocation\/adopting-live-updates-in-core-location"
        },
        {
          "description" : "Define boundaries and act on user location updates.",
          "name" : "Monitoring location changes with Core Location",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreLocation\/monitoring-location-changes-with-core-location"
        }
      ],
      "title" : "Essentials"
    }
  ],
  "source" : "appleJSON",
  "title" : "Supporting live updates in SwiftUI and Mac Catalyst apps",
  "url" : "https:\/\/developer.apple.com\/documentation\/corelocation\/supporting-live-updates-in-swiftui-and-mac-catalyst-apps"
}