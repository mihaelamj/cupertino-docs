{
  "abstract" : "Add and configure an extension to enable your location-sharing app to access a user’s location in response to a request from another user.",
  "codeExamples" : [

  ],
  "contentHash" : "63d2a4bd9eabcaa0a704710e25768dfb88d092f875abb3ad71b139d0a0ca2ba0",
  "crawledAt" : "2025-12-04T02:57:55Z",
  "id" : "EE2B0E07-A4EB-4C85-BD99-6B1E78A75F99",
  "kind" : "article",
  "language" : "swift",
  "module" : "Core Location",
  "overview" : "## Overview\n\nThe Location Push Service Extension, available starting in iOS 15, is a power efficient way to query locations on iOS or iPadOS devices, even when your app isn’t running.\n\nWhen your app includes a Location Push Service Extension, the system activates the extension when it receives an Apple Push Notification service (APNs) `location` push from your server. Your app must ask for and receive Always authorization ([doc:\/\/com.apple.corelocation\/documentation\/CoreLocation\/CLAuthorizationStatus\/authorizedAlways]) from the user before the extension can function. For more information about requesting Always authorization, see [doc:\/\/com.apple.corelocation\/documentation\/CoreLocation\/requesting-authorization-to-use-location-services] and [doc:\/\/com.apple.corelocation\/documentation\/CoreLocation\/CLLocationManager\/requestAlwaysAuthorization()].\n\nWith the user’s authorization, the extension can query the user’s location and process it according to your app’s purpose. Your server sends requests with the `location` push type to APNs. For more information about sending requests to APNs, see [doc:\/\/com.apple.documentation\/documentation\/UserNotifications\/sending-notification-requests-to-apns].\n\n### Configure Your Xcode Project\n\nTo include Location Push Service Extension in your app, use Xcode 13 or later. Configure the following entitlements, capabilities, and keys for your Xcode project:\n\n### Add a Location Push Service Extension Target\n\nAdd a new target using the Location Push Service Extension template.\n\nXcode creates a subclass of [doc:\/\/com.apple.corelocation\/documentation\/CoreLocation\/CLLocationPushServiceExtension] to get you started.\n\n### Implement Location Push Functionality\n\nTo support location push functionality, implement the following code in your extension, app, and server:\n\nIf the user authorized your app with Always authorization ([doc:\/\/com.apple.corelocation\/documentation\/CoreLocation\/CLAuthorizationStatus\/authorizedAlways]), the system activates the service extension when it receives a `location` push, and calls [doc:\/\/com.apple.corelocation\/documentation\/CoreLocation\/CLLocationPushServiceExtension\/didReceiveLocationPushPayload(_:completion:)]. Your app should ask the user for Always authorization at an appropriate time.\n\n### Send Location Push Requests From Your Server\n\nWhen a user requests the location of another user, your app sends the request to your server, which sends a location push request to APNs. Ensure that your APNs `POST` request contains the following fields for a `location` push type:\n\nFor more information about sending APNs requests and using command-line tools to do so, see [doc:\/\/com.apple.documentation\/documentation\/UserNotifications\/sending-notification-requests-to-apns] and [doc:\/\/com.apple.documentation\/documentation\/UserNotifications\/sending-push-notifications-using-command-line-tools].",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/corelocation\/creating-a-location-push-service-extension\ncrawled: 2025-12-04T02:57:55Z\n---\n\n# Creating a location push service extension\n\n**Article**\n\nAdd and configure an extension to enable your location-sharing app to access a user’s location in response to a request from another user.\n\n## Overview\n\nThe Location Push Service Extension, available starting in iOS 15, is a power efficient way to query locations on iOS or iPadOS devices, even when your app isn’t running.\n\nWhen your app includes a Location Push Service Extension, the system activates the extension when it receives an Apple Push Notification service (APNs) `location` push from your server. Your app must ask for and receive Always authorization ([doc:\/\/com.apple.corelocation\/documentation\/CoreLocation\/CLAuthorizationStatus\/authorizedAlways]) from the user before the extension can function. For more information about requesting Always authorization, see [doc:\/\/com.apple.corelocation\/documentation\/CoreLocation\/requesting-authorization-to-use-location-services] and [doc:\/\/com.apple.corelocation\/documentation\/CoreLocation\/CLLocationManager\/requestAlwaysAuthorization()].\n\nWith the user’s authorization, the extension can query the user’s location and process it according to your app’s purpose. Your server sends requests with the `location` push type to APNs. For more information about sending requests to APNs, see [doc:\/\/com.apple.documentation\/documentation\/UserNotifications\/sending-notification-requests-to-apns].\n\n\n\n### Configure Your Xcode Project\n\nTo include Location Push Service Extension in your app, use Xcode 13 or later. Configure the following entitlements, capabilities, and keys for your Xcode project:\n\n1. Set the Location Push Server Extension entitlement key ([doc:\/\/com.apple.documentation\/documentation\/BundleResources\/Entitlements\/com.apple.developer.location.push]).\n2. Enable your app to receive Apple Push Notification service (APNs) pushes by adding the Push Notifications capability. For more information, see [doc:\/\/com.apple.documentation\/documentation\/UserNotifications\/registering-your-app-with-apns].\n3. Configure the purpose strings your app provides for the location service authorization prompts. For more information, see [doc:\/\/com.apple.corelocation\/documentation\/CoreLocation\/requesting-authorization-to-use-location-services].\n\n### Add a Location Push Service Extension Target\n\nAdd a new target using the Location Push Service Extension template.\n\n1. Open your iOS app project in Xcode.\n2. Choose File > New > Target.\n3. Select Location Push Service Extension from the iOS Application Extension group.\n4. Click Next.\n5. Specify the name of your extension and configure the language and other options.\n6. Click Finish.\n\nXcode creates a subclass of [doc:\/\/com.apple.corelocation\/documentation\/CoreLocation\/CLLocationPushServiceExtension] to get you started.\n\n### Implement Location Push Functionality\n\nTo support location push functionality, implement the following code in your extension, app, and server:\n\n1. In your service extension, implement the [doc:\/\/com.apple.corelocation\/documentation\/CoreLocation\/CLLocationPushServiceExtension] protocol.\n2. In your service extension, implement the [doc:\/\/com.apple.corelocation\/documentation\/CoreLocation\/CLLocationManagerDelegate\/locationManager(_:didUpdateLocations:)] method to handle the result of the location request, and process the location data received.\n3. In your app, call [doc:\/\/com.apple.corelocation\/documentation\/CoreLocation\/CLLocationManager\/startMonitoringLocationPushes(completion:)] to receive an APNs token as `Data`, and send it to your server. Your server uses this token when it creates APNs pushes.\n4. From your server, request location information by sending a `location` push request to APNs.\n\nIf the user authorized your app with Always authorization ([doc:\/\/com.apple.corelocation\/documentation\/CoreLocation\/CLAuthorizationStatus\/authorizedAlways]), the system activates the service extension when it receives a `location` push, and calls [doc:\/\/com.apple.corelocation\/documentation\/CoreLocation\/CLLocationPushServiceExtension\/didReceiveLocationPushPayload(_:completion:)]. Your app should ask the user for Always authorization at an appropriate time.\n\n\n\n### Send Location Push Requests From Your Server\n\nWhen a user requests the location of another user, your app sends the request to your server, which sends a location push request to APNs. Ensure that your APNs `POST` request contains the following fields for a `location` push type:\n\n\n\nFor more information about sending APNs requests and using command-line tools to do so, see [doc:\/\/com.apple.documentation\/documentation\/UserNotifications\/sending-notification-requests-to-apns] and [doc:\/\/com.apple.documentation\/documentation\/UserNotifications\/sending-push-notifications-using-command-line-tools].\n\n## Location updates\n\n- **Getting the current location of a device**: Start location services and provide information the system needs to optimize power usage for those services.\n- **Handling location updates in the background**: Configure your app to receive location updates when it isn’t running in the foreground.\n- **CLLocation**: The latitude, longitude, and course information reported by the system.\n- **CLLocationCoordinate2D**: The latitude and longitude associated with a location, specified using the WGS 84 reference frame.\n- **CLFloor**: The floor of a building on which the user’s device is located.\n- **CLVisit**: Information about the user’s location during a specific period of time.\n- **CLLocationSourceInformation**: Information about the source that provides a location.\n- **Monitoring location changes with Core Location**: Define boundaries and act on user location updates.\n- **CLServiceSession**\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Start location services and provide information the system needs to optimize power usage for those services.",
          "name" : "Getting the current location of a device",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreLocation\/getting-the-current-location-of-a-device"
        },
        {
          "description" : "Configure your app to receive location updates when it isn’t running in the foreground.",
          "name" : "Handling location updates in the background",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreLocation\/handling-location-updates-in-the-background"
        },
        {
          "description" : "The latitude, longitude, and course information reported by the system.",
          "name" : "CLLocation",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreLocation\/CLLocation"
        },
        {
          "description" : "The latitude and longitude associated with a location, specified using the WGS 84 reference frame.",
          "name" : "CLLocationCoordinate2D",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreLocation\/CLLocationCoordinate2D"
        },
        {
          "description" : "The floor of a building on which the user’s device is located.",
          "name" : "CLFloor",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreLocation\/CLFloor"
        },
        {
          "description" : "Information about the user’s location during a specific period of time.",
          "name" : "CLVisit",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreLocation\/CLVisit"
        },
        {
          "description" : "Information about the source that provides a location.",
          "name" : "CLLocationSourceInformation",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreLocation\/CLLocationSourceInformation"
        },
        {
          "description" : "Define boundaries and act on user location updates.",
          "name" : "Monitoring location changes with Core Location",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreLocation\/monitoring-location-changes-with-core-location"
        },
        {
          "description" : "",
          "name" : "CLServiceSession",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreLocation\/CLServiceSession-pt7n"
        }
      ],
      "title" : "Location updates"
    }
  ],
  "source" : "appleJSON",
  "title" : "Creating a location push service extension",
  "url" : "https:\/\/developer.apple.com\/documentation\/corelocation\/creating-a-location-push-service-extension"
}