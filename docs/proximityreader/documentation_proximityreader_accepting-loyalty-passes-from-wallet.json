{
  "abstract" : "Set up the necessary components so your app can begin using Tap to Pay on iPhone to read and issue loyalty passes.",
  "codeExamples" : [
    {
      "code" : "let loyaltyPass1 = VASRequest.Merchant(id: \"pass.com.example-company.loyaltypass1\",\n                                       url: URL(string: \"https:\/\/example-company.com\/foo\/v1\/passes\/pass.com.example-company.loyaltypass1\/\"),\n                                       localizedName: \"Example Company Loyalty Pass 1\")\n\nlet loyaltyPass2 = VASRequest.Merchant(id: \"pass.com.example-company.loyaltypass2\",\n                                       url: URL(string: \"https:\/\/example-company.com\/foo\/v1\/passes\/pass.com.example-company.loyaltypass2\/\"),\n                                       localizedName: \"Example Company Loyalty Pass 2\")\n\nlet request = VASRequest(vasMerchants: [loyaltyPass1, loyaltyPass2],\n                         localizedVASType: \"Example Company Loyalty Program\")",
      "language" : "swift"
    },
    {
      "code" : "public class WrapperClass {\n    \n    var reader: PaymentCardReader?\n    var session: PaymentCardReaderSession?\n\n    public func readLoyaltyPass(for passTypeIdentifier: String,\n                                merchantLoyaltyProgramName: String,\n                                merchantLoyaltyPassName: String,\n                                provisioningURL: URL?) async throws {\n        let merchant = VASRequest.Merchant(id: passTypeIdentifier,\n                                           url: provisioningURL,\n                                           localizedName: merchantLoyaltyPassName)\n        let request = VASRequest(vasMerchants: [merchant],\n                                 localizedVASType: merchantLoyaltyProgramName)\n        guard let reader = self.reader else {\n            return\n        }\n        let events = reader.events\n        do {\n            Task {\n                for await event in events {\n                    \/\/ Handle events that happen while the sheet is up.\n                }\n            }\n            let result = try await session?.readVAS(request)\n            \/\/ Send result.entries[0].customerVASData to your loyalty program provider.\n        } catch {\n            \/\/ Handle any errors that occur during read\n            \/\/ (see PaymentCardReaderSession.ReadError).\n        }\n    }\n}",
      "language" : "swift"
    },
    {
      "code" : "public class WrapperClass {\n    \n    var reader: PaymentCardReader?\n    var session: PaymentCardReaderSession?\n\n    public func readPaymentAndLoyaltyPass(for amount: Decimal,\n                                          passTypeIdentifier: String,\n                                          merchantLoyaltyProgramName: String,\n                                          merchantLoyaltyPassName: String,\n                                          provisioningURL: URL?) async throws {\n        let merchant = VASRequest.Merchant(id: passTypeIdentifier,\n                                           url: provisioningURL,\n                                           localizedName: merchantLoyaltyPassName)\n        let vasRequest = VASRequest(vasMerchants: [merchant],\n                                    localizedVASType: merchantLoyaltyProgramName)\n        \n        let paymentRequest = PaymentCardTransactionRequest(amount: amount,\n                                                           currencyCode: \"USD\",\n                                                           for: .purchase)\n        guard let reader = self.reader else {\n            return\n        }\n        let events = reader.events\n        do {\n            Task {\n                for await event in events {\n                    \/\/ Handle events that happen while the sheet is up.\n                }\n            }\n            let result = try await session?.readPaymentCard(paymentRequest,\n                                                            vasRequest: vasRequest,\n                                                            stopOnVASResult: false)\n            \/\/ Send result.0?.paymentCardData to your payment service provider.\n            \/\/ Send result.1?.entries[0].customerVASData to your loyalty program provider.\n        } catch {\n            \/\/ Handle any errors that occur during read\n            \/\/ (see PaymentCardReaderSession.ReadError).\n        }\n    }\n}",
      "language" : "swift"
    }
  ],
  "contentHash" : "e6c4a0a414ed797b9f45068e4ffe02382f904f936609a366e3ecbb94f3f3e85f",
  "crawledAt" : "2025-12-01T09:15:30Z",
  "id" : "F9909A72-E962-453C-9273-1E9924F8310B",
  "kind" : "article",
  "module" : "ProximityReader",
  "overview" : "## Overview\n\nUse ProximityReader to support Tap to Pay on iPhone so your app can read NFC passes in a customer’s Wallet as part of a merchant’s loyalty program. After configuration, ProximityReader can begin a [doc:\/\/com.apple.ProximityReader\/documentation\/ProximityReader\/PaymentCardReaderSession] so you can:\n\nFor information about how to configure the card reader, see [doc:\/\/com.apple.ProximityReader\/documentation\/ProximityReader\/adding-support-for-tap-to-pay-on-iphone-to-your-app].\n\n### Configure which loyalty passes to read\n\nTo read loyalty passes in Wallet with Tap to Pay on iPhone, you must have an existing Pass Type Identifier corresponding to a pass. To learn more, see [https:\/\/developer.apple.com\/documentation\/walletpasses\/building_a_pass\/].\n\nYou can also optionally specify a URL based on the web service you use to update passes. If no pass is found in the customer’s Wallet that corresponds to the specified Pass Type Identifier, the provided URL will be pushed to the customer’s device and can be used to trigger a push notification to add the loyalty pass in their Wallet. To learn more, see [https:\/\/developer.apple.com\/documentation\/walletpasses\/adding_a_web_service_to_update_passes\/].\n\nIf you support multiple passes, you can create a [doc:\/\/com.apple.ProximityReader\/documentation\/ProximityReader\/VASRequest] with multiple [doc:\/\/com.apple.ProximityReader\/documentation\/ProximityReader\/VASRequest\/Merchant] structures, each corresponding to a single Pass Type Identifier.\n\n### Read loyalty passes\n\nUse [doc:\/\/com.apple.ProximityReader\/documentation\/ProximityReader\/PaymentCardReaderSession\/readVAS(_:)] to bring up a sheet that prompts the merchant’s customers to hold their device near the reader. After a successful read of a loyalty pass, the sheet closes and the session returns a [doc:\/\/com.apple.ProximityReader\/documentation\/ProximityReader\/VASReadResult]. If a read isn’t successful, the sheet closes and the session returns a [doc:\/\/com.apple.ProximityReader\/documentation\/ProximityReader\/PaymentCardReaderSession\/ReadError], which may require you or your user to take an action; make sure your app can handle all the different types of errors a read session can return.\n\nAfter you get a [doc:\/\/com.apple.ProximityReader\/documentation\/ProximityReader\/VASReadResult] you must send the pass content, [doc:\/\/com.apple.ProximityReader\/documentation\/ProximityReader\/VASReadResult\/ReadEntry\/customerVASData], to your loyalty-program provider. It’s up to your app to process the returned data and to show the final result to the merchant.\n\n### Combine the read of loyalty passes with payment\n\nYou can read both a payment card and multiple loyalty passes in one tap, the flow is the same as simply reading a payment card. Use [doc:\/\/com.apple.ProximityReader\/documentation\/ProximityReader\/PaymentCardReaderSession\/readPaymentCard(_:vasRequest:stopOnVASResult:)] to bring up the sheet prompting the merchant’s customers to hold their device near the reader. After a successful read, the sheet closes and the session returns a tuple containing both [doc:\/\/com.apple.ProximityReader\/documentation\/ProximityReader\/PaymentCardReadResult] and [doc:\/\/com.apple.ProximityReader\/documentation\/ProximityReader\/VASReadResult] as a result. If a read isn’t successful, the sheet closes and the session returns a [doc:\/\/com.apple.ProximityReader\/documentation\/ProximityReader\/PaymentCardReaderSession\/ReadError], which may require you or your user to take an action; make sure that your app can handle all the different types of errors that a read session can return.\n\nAfter you get a [doc:\/\/com.apple.ProximityReader\/documentation\/ProximityReader\/VASReadResult] you must send the pass content, [doc:\/\/com.apple.ProximityReader\/documentation\/ProximityReader\/VASReadResult\/ReadEntry\/customerVASData], to your loyalty-program provider. It’s up to your app to process the returned data and to show the final result to the merchant.\n\n### Prompt a customer to join a merchant’s loyalty program\n\nUse [doc:\/\/com.apple.ProximityReader\/documentation\/ProximityReader\/PaymentCardReaderSession\/readPaymentCard(_:vasRequest:stopOnVASResult:)] to prompt a customer to join a merchant’s loyalty program, after a successful transaction, with a push notification. To do so, you only need to specify a [doc:\/\/com.apple.ProximityReader\/documentation\/ProximityReader\/VASRequest\/Merchant\/url] when trying to read a loyalty pass. If no pass corresponding to the specified Pass Type Identifier is found in the customer’s Wallet, the reader session pushes the provided URL, through NFC, to the customer’s device where the loyalty-program provider may trigger a push notification to add the loyalty pass in their Wallet.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/ProximityReader\/accepting-loyalty-passes-from-wallet\ncrawled: 2025-12-01T09:15:30Z\n---\n\n# Accepting loyalty passes from Wallet\n\n**Article**\n\nSet up the necessary components so your app can begin using Tap to Pay on iPhone to read and issue loyalty passes.\n\n## Overview\n\nUse ProximityReader to support Tap to Pay on iPhone so your app can read NFC passes in a customer’s Wallet as part of a merchant’s loyalty program. After configuration, ProximityReader can begin a [doc:\/\/com.apple.ProximityReader\/documentation\/ProximityReader\/PaymentCardReaderSession] so you can:\n\n- Read passes independently of payment, at the same time as payment, or instead of payment if the pass is available.\n- Prompt a customer to join a merchant’s loyalty program after a successful transaction, with a push notification.\n\n\n\nFor information about how to configure the card reader, see [doc:\/\/com.apple.ProximityReader\/documentation\/ProximityReader\/adding-support-for-tap-to-pay-on-iphone-to-your-app].\n\n### Configure which loyalty passes to read\n\nTo read loyalty passes in Wallet with Tap to Pay on iPhone, you must have an existing Pass Type Identifier corresponding to a pass. To learn more, see [https:\/\/developer.apple.com\/documentation\/walletpasses\/building_a_pass\/].\n\nYou can also optionally specify a URL based on the web service you use to update passes. If no pass is found in the customer’s Wallet that corresponds to the specified Pass Type Identifier, the provided URL will be pushed to the customer’s device and can be used to trigger a push notification to add the loyalty pass in their Wallet. To learn more, see [https:\/\/developer.apple.com\/documentation\/walletpasses\/adding_a_web_service_to_update_passes\/].\n\nIf you support multiple passes, you can create a [doc:\/\/com.apple.ProximityReader\/documentation\/ProximityReader\/VASRequest] with multiple [doc:\/\/com.apple.ProximityReader\/documentation\/ProximityReader\/VASRequest\/Merchant] structures, each corresponding to a single Pass Type Identifier.\n\n```swift\nlet loyaltyPass1 = VASRequest.Merchant(id: \"pass.com.example-company.loyaltypass1\",\n                                       url: URL(string: \"https:\/\/example-company.com\/foo\/v1\/passes\/pass.com.example-company.loyaltypass1\/\"),\n                                       localizedName: \"Example Company Loyalty Pass 1\")\n\nlet loyaltyPass2 = VASRequest.Merchant(id: \"pass.com.example-company.loyaltypass2\",\n                                       url: URL(string: \"https:\/\/example-company.com\/foo\/v1\/passes\/pass.com.example-company.loyaltypass2\/\"),\n                                       localizedName: \"Example Company Loyalty Pass 2\")\n\nlet request = VASRequest(vasMerchants: [loyaltyPass1, loyaltyPass2],\n                         localizedVASType: \"Example Company Loyalty Program\")\n```\n\n### Read loyalty passes\n\nUse [doc:\/\/com.apple.ProximityReader\/documentation\/ProximityReader\/PaymentCardReaderSession\/readVAS(_:)] to bring up a sheet that prompts the merchant’s customers to hold their device near the reader. After a successful read of a loyalty pass, the sheet closes and the session returns a [doc:\/\/com.apple.ProximityReader\/documentation\/ProximityReader\/VASReadResult]. If a read isn’t successful, the sheet closes and the session returns a [doc:\/\/com.apple.ProximityReader\/documentation\/ProximityReader\/PaymentCardReaderSession\/ReadError], which may require you or your user to take an action; make sure your app can handle all the different types of errors a read session can return.\n\nAfter you get a [doc:\/\/com.apple.ProximityReader\/documentation\/ProximityReader\/VASReadResult] you must send the pass content, [doc:\/\/com.apple.ProximityReader\/documentation\/ProximityReader\/VASReadResult\/ReadEntry\/customerVASData], to your loyalty-program provider. It’s up to your app to process the returned data and to show the final result to the merchant.\n\n\n\n```swift\npublic class WrapperClass {\n    \n    var reader: PaymentCardReader?\n    var session: PaymentCardReaderSession?\n\n    public func readLoyaltyPass(for passTypeIdentifier: String,\n                                merchantLoyaltyProgramName: String,\n                                merchantLoyaltyPassName: String,\n                                provisioningURL: URL?) async throws {\n        let merchant = VASRequest.Merchant(id: passTypeIdentifier,\n                                           url: provisioningURL,\n                                           localizedName: merchantLoyaltyPassName)\n        let request = VASRequest(vasMerchants: [merchant],\n                                 localizedVASType: merchantLoyaltyProgramName)\n        guard let reader = self.reader else {\n            return\n        }\n        let events = reader.events\n        do {\n            Task {\n                for await event in events {\n                    \/\/ Handle events that happen while the sheet is up.\n                }\n            }\n            let result = try await session?.readVAS(request)\n            \/\/ Send result.entries[0].customerVASData to your loyalty program provider.\n        } catch {\n            \/\/ Handle any errors that occur during read\n            \/\/ (see PaymentCardReaderSession.ReadError).\n        }\n    }\n}\n```\n\n### Combine the read of loyalty passes with payment\n\nYou can read both a payment card and multiple loyalty passes in one tap, the flow is the same as simply reading a payment card. Use [doc:\/\/com.apple.ProximityReader\/documentation\/ProximityReader\/PaymentCardReaderSession\/readPaymentCard(_:vasRequest:stopOnVASResult:)] to bring up the sheet prompting the merchant’s customers to hold their device near the reader. After a successful read, the sheet closes and the session returns a tuple containing both [doc:\/\/com.apple.ProximityReader\/documentation\/ProximityReader\/PaymentCardReadResult] and [doc:\/\/com.apple.ProximityReader\/documentation\/ProximityReader\/VASReadResult] as a result. If a read isn’t successful, the sheet closes and the session returns a [doc:\/\/com.apple.ProximityReader\/documentation\/ProximityReader\/PaymentCardReaderSession\/ReadError], which may require you or your user to take an action; make sure that your app can handle all the different types of errors that a read session can return.\n\nAfter you get a [doc:\/\/com.apple.ProximityReader\/documentation\/ProximityReader\/VASReadResult] you must send the pass content, [doc:\/\/com.apple.ProximityReader\/documentation\/ProximityReader\/VASReadResult\/ReadEntry\/customerVASData], to your loyalty-program provider. It’s up to your app to process the returned data and to show the final result to the merchant.\n\n\n\n```swift\npublic class WrapperClass {\n    \n    var reader: PaymentCardReader?\n    var session: PaymentCardReaderSession?\n\n    public func readPaymentAndLoyaltyPass(for amount: Decimal,\n                                          passTypeIdentifier: String,\n                                          merchantLoyaltyProgramName: String,\n                                          merchantLoyaltyPassName: String,\n                                          provisioningURL: URL?) async throws {\n        let merchant = VASRequest.Merchant(id: passTypeIdentifier,\n                                           url: provisioningURL,\n                                           localizedName: merchantLoyaltyPassName)\n        let vasRequest = VASRequest(vasMerchants: [merchant],\n                                    localizedVASType: merchantLoyaltyProgramName)\n        \n        let paymentRequest = PaymentCardTransactionRequest(amount: amount,\n                                                           currencyCode: \"USD\",\n                                                           for: .purchase)\n        guard let reader = self.reader else {\n            return\n        }\n        let events = reader.events\n        do {\n            Task {\n                for await event in events {\n                    \/\/ Handle events that happen while the sheet is up.\n                }\n            }\n            let result = try await session?.readPaymentCard(paymentRequest,\n                                                            vasRequest: vasRequest,\n                                                            stopOnVASResult: false)\n            \/\/ Send result.0?.paymentCardData to your payment service provider.\n            \/\/ Send result.1?.entries[0].customerVASData to your loyalty program provider.\n        } catch {\n            \/\/ Handle any errors that occur during read\n            \/\/ (see PaymentCardReaderSession.ReadError).\n        }\n    }\n}\n```\n\n### Prompt a customer to join a merchant’s loyalty program\n\nUse [doc:\/\/com.apple.ProximityReader\/documentation\/ProximityReader\/PaymentCardReaderSession\/readPaymentCard(_:vasRequest:stopOnVASResult:)] to prompt a customer to join a merchant’s loyalty program, after a successful transaction, with a push notification. To do so, you only need to specify a [doc:\/\/com.apple.ProximityReader\/documentation\/ProximityReader\/VASRequest\/Merchant\/url] when trying to read a loyalty pass. If no pass corresponding to the specified Pass Type Identifier is found in the customer’s Wallet, the reader session pushes the provided URL, through NFC, to the customer’s device where the loyalty-program provider may trigger a push notification to add the loyalty pass in their Wallet.\n\n## Loyalty card requests\n\n- **VASRequest**: A request to read a contactless loyalty card and retrieve loyalty program identifiers for the person.\n- **VASReadResult**: The result of a request to read loyalty card information.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "A request to read a contactless loyalty card and retrieve loyalty program identifiers for the person.",
          "name" : "VASRequest",
          "url" : "https:\/\/developer.apple.com\/documentation\/ProximityReader\/VASRequest"
        },
        {
          "description" : "The result of a request to read loyalty card information.",
          "name" : "VASReadResult",
          "url" : "https:\/\/developer.apple.com\/documentation\/ProximityReader\/VASReadResult"
        }
      ],
      "title" : "Loyalty card requests"
    }
  ],
  "source" : "appleJSON",
  "title" : "Accepting loyalty passes from Wallet",
  "url" : "https:\/\/developer.apple.com\/documentation\/ProximityReader\/accepting-loyalty-passes-from-wallet"
}