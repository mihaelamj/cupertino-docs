{
  "abstract" : "Support the platform SSO 2.0 protocol for encryption and decryption operations.",
  "codeExamples" : [
    {
      "code" : "{\n    \"kid\" : \"6cgzt+gMK7vzj4iXhQj4AA4lyJUQ4ZVA\/wTnA2kaYcg=\",\n    \"x5c\" : \"MIIBg...Mhw==\",\n    \"typ\" : \"platformsso-key-request+jwt\",\n    \"alg\" : \"ES256\"\n}.{\n    \"jwe_crypto\" : {\n        \"alg\" : \"ECDH-ES\",\n        \"enc\" : \"A256GCM\",\n        \"apv\" : \"AAAAB...TNGMQ\"\n    },\n    \"exp\" : 1685756137,\n    \"request_type\" : \"key_request\",\n    \"nonce\" : \"EA7D38B1-B9EA-444B-9141-97FFE7D0E3F1\",\n    \"version\" : \"1.0\",\n    \"request_nonce\" : \"AwABA...YQgAA\",\n    \"refresh_token\" : \"abcd1234\",\n    \"iss\" : \"aaff1524-fa35-40c5-94e3-2b233c5f2965\",\n    \"key_purpose\" : \"user_unlock\",\n    \"sub\" : \"foo\",\n    \"username\" : \"foo\",\n    \"iat\" : 1685755837\n}.[Signature]",
      "language" : "javascript"
    },
    {
      "code" : "POST \/oauth2\/token HTTP\/1.1\nHost: auth.example.com\nAccept: application\/platformsso-key-response+jwt\nContent-Type: application\/x-www-form-urlencoded\nclient-request-id: DCAB01D3-B1FE-4E1C-802F-B3EBDCDF9E67\nplatform_sso_version2.0&grant_type=urn:ietf:params:oauth:grant-type:jwt-bearer&assertion=ewogI...HGuQg",
      "language" : "http"
    },
    {
      "code" : "{\n    \"enc\" : \"A256GCM\",\n    \"kid\" : \"8fWc60nKm8I07JE3yG+xf9Kb61wUNrjWnVBV9zIB5mQ=\",\n    \"epk\" : {\n        \"y\" : \"SwUUA5FVmbe5K8OZ7ElRH5_qB8Z9klZyiGVvrTMyn8A\",\n        \"x\" : \"o7YsVVlHr5VrMLFX6rqT5MQkNip9_GgYAnm8nQYIrVQ\",\n        \"kty\" : \"EC\",\n        \"crv\" : \"P-256\"\n    }, \n    \"apu\" : \"AAAAB...zMp_A\",\n    \"typ\" : \"platformsso-key-response+jwt\",\n    \"alg\" : \"ECDH-ES\"\n}",
      "language" : "javascript"
    },
    {
      "code" : "{\n    \"certificate\" : \"MIIBc...2dGpb\",\n    \"exp\" : 1685756137,\n    \"iat\" : 1685755837,\n    \"key_context\" : \"BHmTq...scA==\"\n}",
      "language" : "javascript"
    },
    {
      "code" : "{\n    \"kid\" : \"NKuTL\/WHlroXidcyrxgA2Eqpt\/cXjh5s22NAkJl7Acs=\",\n    \"x5c\" : \"MIIBg...YtQ==\",\n    \"typ\" : \"platformsso-key-request+jwt\",\n    \"alg\" : \"ES256\"\n}.{\n    \"jwe_crypto\" : {\n        \"alg\" : \"ECDH-ES\",\n        \"enc\" : \"A256GCM\",\n        \"apv\" : \"AAAAB...UEwRQ\"\n    },\n    \"exp\" : 1685759411,\n    \"request_type\" : \"key_exchange\",\n    \"nonce\" : \"7F48971A-E559-4668-A680-97D1BCF7AA0E\",\n    \"version\" : \"1.0\",\n    \"request_nonce\" : \"AwABA...HYQgAA\",\n    \"other_publickey\" : \"BCdD2...RJIv0=\",\n    \"refresh_token\" : \"abcd1234\",\n    \"key_context\" : \"BHp+H...Axw==\",\n    \"iss\" : \"aaff1524-fa35-40c5-94e3-2b233c5f2965\",\n    \"key_purpose\" : \"user_unlock\",\n    \"sub\" : \"foo\",\n    \"username\" : \"foo\",\n    \"iat\" : 1685759111\n}.[Signature]",
      "language" : "javascript"
    },
    {
      "code" : "POST \/oauth2\/token HTTP\/1.1\nHost: auth.example.com\nAccept: application\/platformsso-key-response+jwt\nContent-Type: application\/x-www-form-urlencoded\nclient-request-id: DCAB01D3-B1FE-4E1C-802F-B3EBDCDF9E67\nplatform_sso_version=2.0&grant_type=urn:ietf:params:oauth:grant-type:jwt-bearer&assertion=ewogIC...JmVhg",
      "language" : "http"
    },
    {
      "code" : "{\n    \"enc\" : \"A256GCM\",\n    \"kid\" : \"cNYXaKrqHO+mBB0MHxuaEUZ2edf0T\/GgMNB\/tlHGews=\",\n    \"epk\" : {\n        \"y\" : \"WFUG_Llu2uD70NfbIFOkP5LaNsZlJ1JGIme2DPdbijU\",\n        \"x\" : \"kXzpm4kt-sbm5QlOJPNZAHhaW8rQ5QE_E2HLFcz2uNs\",\n        \"kty\" : \"EC\",\n        \"crv\" : \"P-256\"\n    }, \n    \"apu\" : \"AAAAB...z3W4o1\",\n    \"typ\" : \"platformsso-key-response+jwt\",\n    \"alg\" : \"ECDH-ES\"\n}",
      "language" : "javascript"
    },
    {
      "code" : "{\n    \"exp\" : 1685756137,\n    \"iat\" : 1685755837,\n    \"key\" : \"DpWD3c4SPmfYteESkRYk+pKVHHuryb1EtnuzhF9OjTc=\",\n    \"key_context\" : \"BHp+H...Axw==\"\n}",
      "language" : "javascript"
    }
  ],
  "contentHash" : "3bc0d1889256bfab3a3824c76c04687ee9cd8ad887e863f0738d801913dbe0f3",
  "crawledAt" : "2025-12-09T17:22:06Z",
  "id" : "9E1E6747-1A57-473E-B443-F859E870923F",
  "kind" : "article",
  "language" : "swift",
  "module" : "Authentication Services",
  "overview" : "## Overview\n\nKey requests and key exchange requests require the SSO extension and the server to support the platform SSO 2.0 protocol. To do so, the server needs to fully support requests, shared device keys, and the modified flows for registration, login, and unlock.\n\nThese requests are similar to login requests. They start with a server nonce request, sign the JSON Web Token (JWT) using the device signing key, and require an encrypted response that uses the device encryption key.\n\n### Request the key\n\nThe system uses a key request to ask the server to provision an `EC256` key for the supplied purpose. The server needs to issue a public key in a certificate so that normal keychain operations can find it and use the key. In macOS, encryption operations for login and unlock use the public key. The server can also return a context that’s stored with the key and sent with all key exchange requests. The use of the context isn’t required, but the server can encrypt it to store key material for the key, for example, to rotate encryption values. Storage of the context doesn’t include additional encryption.\n\nAfter user registration completes, macOS sends the key request. However, macOS can also send the request if it detects a problem or if it needs to rotate the keys.\n\nThe following flowchart provides a high-level overview of the key request flow:\n\n\n\nThe request is a JSON Object Signing and Encryption object (JOSE) that’s formatted per RFC 7519 and signed with the `DeviceSigningKey` and `ES256` per RFC 7515.\n\nThe following table specifies the header parameters for a key request:\n\nThe following table specifies the body parameters for a key request:\n\nThe following code provides an example of a key request:\n\nThe key network request is an HTTP POST to the [doc:\/\/com.apple.authenticationservices\/documentation\/AuthenticationServices\/ASAuthorizationProviderExtensionLoginConfiguration\/keyEndpointURL] that’s formatted per RFC 7523 and includes the following parameters:\n\nThe following code provides an example of a key network request:\n\n### Create the key response JSON Web Encryption (JWE)\n\nThe response is a JWE that’s decrypted according to RFC 7516 Section 5.2 with JWE Compact Serialization.\n\nThe JWE key response header contains the following values:\n\nThe following code provides an example of a key response JWE header:\n\nThe JWE key response body contains the following values:\n\nThe following code provides an example of a key response JWE body:\n\n### Request the key exchange\n\nThe system uses the key exchange request when using the keys to decrypt data. Typically there are two or three requests occuring at the same time, depending on the number of decryption calls and required checks. These calls need to return quickly because the user is waiting for them to complete.\n\nThe following graph provides a high-level overview of the key exchange flow:\n\n\n\nThe key exchange request is a JOSE that’s formatted per RFC 7519 and signed with the `DeviceSigningKey` and `ES256` per RFC 7515.\n\nThe following table specifies the header parameters for a key exchange request:\n\nThe following table specifies the body parameters for a key exchange request:\n\nThe following code provides an example of a key exchange request:\n\nThe key exchange network request is an HTTP POST to the [doc:\/\/com.apple.authenticationservices\/documentation\/AuthenticationServices\/ASAuthorizationProviderExtensionLoginConfiguration\/keyEndpointURL] that’s formatted per RFC 7523 and includes the following parameters:\n\nThe following code sample provides an example of a key exchange network request:\n\n### Receive the key exchange response JWE\n\nThe response is a JWE that’s decrypted according to RFC 7516 Section 5.2 with JWE Compact Serialization.\n\nThe JWE key exchange response header contains the following values:\n\nThe following code provides an example of a key exchange response JWE header:\n\nThe IdP creates a successful key response. The JWE key exchange response body contains the following values:\n\nThe following code provides an example of a key exchange response JWE body:",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/authenticationservices\/supporting-key-requests-and-key-exchange-requests\ncrawled: 2025-12-09T17:22:06Z\n---\n\n# Supporting key requests and key exchange requests\n\n**Article**\n\nSupport the platform SSO 2.0 protocol for encryption and decryption operations.\n\n## Overview\n\nKey requests and key exchange requests require the SSO extension and the server to support the platform SSO 2.0 protocol. To do so, the server needs to fully support requests, shared device keys, and the modified flows for registration, login, and unlock.\n\nThese requests are similar to login requests. They start with a server nonce request, sign the JSON Web Token (JWT) using the device signing key, and require an encrypted response that uses the device encryption key.\n\n### Request the key\n\nThe system uses a key request to ask the server to provision an `EC256` key for the supplied purpose. The server needs to issue a public key in a certificate so that normal keychain operations can find it and use the key. In macOS, encryption operations for login and unlock use the public key. The server can also return a context that’s stored with the key and sent with all key exchange requests. The use of the context isn’t required, but the server can encrypt it to store key material for the key, for example, to rotate encryption values. Storage of the context doesn’t include additional encryption.\n\nAfter user registration completes, macOS sends the key request. However, macOS can also send the request if it detects a problem or if it needs to rotate the keys.\n\nThe following flowchart provides a high-level overview of the key request flow:\n\n\n\nThe request is a JSON Object Signing and Encryption object (JOSE) that’s formatted per RFC 7519 and signed with the `DeviceSigningKey` and `ES256` per RFC 7515.\n\nThe following table specifies the header parameters for a key request:\n\n\n\nThe following table specifies the body parameters for a key request:\n\n\n\nThe following code provides an example of a key request:\n\n```javascript\n{\n    \"kid\" : \"6cgzt+gMK7vzj4iXhQj4AA4lyJUQ4ZVA\/wTnA2kaYcg=\",\n    \"x5c\" : \"MIIBg...Mhw==\",\n    \"typ\" : \"platformsso-key-request+jwt\",\n    \"alg\" : \"ES256\"\n}.{\n    \"jwe_crypto\" : {\n        \"alg\" : \"ECDH-ES\",\n        \"enc\" : \"A256GCM\",\n        \"apv\" : \"AAAAB...TNGMQ\"\n    },\n    \"exp\" : 1685756137,\n    \"request_type\" : \"key_request\",\n    \"nonce\" : \"EA7D38B1-B9EA-444B-9141-97FFE7D0E3F1\",\n    \"version\" : \"1.0\",\n    \"request_nonce\" : \"AwABA...YQgAA\",\n    \"refresh_token\" : \"abcd1234\",\n    \"iss\" : \"aaff1524-fa35-40c5-94e3-2b233c5f2965\",\n    \"key_purpose\" : \"user_unlock\",\n    \"sub\" : \"foo\",\n    \"username\" : \"foo\",\n    \"iat\" : 1685755837\n}.[Signature]\n```\n\nThe key network request is an HTTP POST to the [doc:\/\/com.apple.authenticationservices\/documentation\/AuthenticationServices\/ASAuthorizationProviderExtensionLoginConfiguration\/keyEndpointURL] that’s formatted per RFC 7523 and includes the following parameters:\n\n\n\nThe following code provides an example of a key network request:\n\n```http\nPOST \/oauth2\/token HTTP\/1.1\nHost: auth.example.com\nAccept: application\/platformsso-key-response+jwt\nContent-Type: application\/x-www-form-urlencoded\nclient-request-id: DCAB01D3-B1FE-4E1C-802F-B3EBDCDF9E67\nplatform_sso_version2.0&grant_type=urn:ietf:params:oauth:grant-type:jwt-bearer&assertion=ewogI...HGuQg\n```\n\n### Create the key response JSON Web Encryption (JWE)\n\nThe response is a JWE that’s decrypted according to RFC 7516 Section 5.2 with JWE Compact Serialization.\n\nThe JWE key response header contains the following values:\n\n\n\nThe following code provides an example of a key response JWE header:\n\n```javascript\n{\n    \"enc\" : \"A256GCM\",\n    \"kid\" : \"8fWc60nKm8I07JE3yG+xf9Kb61wUNrjWnVBV9zIB5mQ=\",\n    \"epk\" : {\n        \"y\" : \"SwUUA5FVmbe5K8OZ7ElRH5_qB8Z9klZyiGVvrTMyn8A\",\n        \"x\" : \"o7YsVVlHr5VrMLFX6rqT5MQkNip9_GgYAnm8nQYIrVQ\",\n        \"kty\" : \"EC\",\n        \"crv\" : \"P-256\"\n    }, \n    \"apu\" : \"AAAAB...zMp_A\",\n    \"typ\" : \"platformsso-key-response+jwt\",\n    \"alg\" : \"ECDH-ES\"\n}\n```\n\nThe JWE key response body contains the following values:\n\n\n\nThe following code provides an example of a key response JWE body:\n\n```javascript\n{\n    \"certificate\" : \"MIIBc...2dGpb\",\n    \"exp\" : 1685756137,\n    \"iat\" : 1685755837,\n    \"key_context\" : \"BHmTq...scA==\"\n}\n```\n\n### Request the key exchange\n\nThe system uses the key exchange request when using the keys to decrypt data. Typically there are two or three requests occuring at the same time, depending on the number of decryption calls and required checks. These calls need to return quickly because the user is waiting for them to complete.\n\nThe following graph provides a high-level overview of the key exchange flow:\n\n\n\nThe key exchange request is a JOSE that’s formatted per RFC 7519 and signed with the `DeviceSigningKey` and `ES256` per RFC 7515.\n\nThe following table specifies the header parameters for a key exchange request:\n\n\n\nThe following table specifies the body parameters for a key exchange request:\n\n\n\nThe following code provides an example of a key exchange request:\n\n```javascript\n{\n    \"kid\" : \"NKuTL\/WHlroXidcyrxgA2Eqpt\/cXjh5s22NAkJl7Acs=\",\n    \"x5c\" : \"MIIBg...YtQ==\",\n    \"typ\" : \"platformsso-key-request+jwt\",\n    \"alg\" : \"ES256\"\n}.{\n    \"jwe_crypto\" : {\n        \"alg\" : \"ECDH-ES\",\n        \"enc\" : \"A256GCM\",\n        \"apv\" : \"AAAAB...UEwRQ\"\n    },\n    \"exp\" : 1685759411,\n    \"request_type\" : \"key_exchange\",\n    \"nonce\" : \"7F48971A-E559-4668-A680-97D1BCF7AA0E\",\n    \"version\" : \"1.0\",\n    \"request_nonce\" : \"AwABA...HYQgAA\",\n    \"other_publickey\" : \"BCdD2...RJIv0=\",\n    \"refresh_token\" : \"abcd1234\",\n    \"key_context\" : \"BHp+H...Axw==\",\n    \"iss\" : \"aaff1524-fa35-40c5-94e3-2b233c5f2965\",\n    \"key_purpose\" : \"user_unlock\",\n    \"sub\" : \"foo\",\n    \"username\" : \"foo\",\n    \"iat\" : 1685759111\n}.[Signature]\n```\n\nThe key exchange network request is an HTTP POST to the [doc:\/\/com.apple.authenticationservices\/documentation\/AuthenticationServices\/ASAuthorizationProviderExtensionLoginConfiguration\/keyEndpointURL] that’s formatted per RFC 7523 and includes the following parameters:\n\n\n\nThe following code sample provides an example of a key exchange network request:\n\n```http\nPOST \/oauth2\/token HTTP\/1.1\nHost: auth.example.com\nAccept: application\/platformsso-key-response+jwt\nContent-Type: application\/x-www-form-urlencoded\nclient-request-id: DCAB01D3-B1FE-4E1C-802F-B3EBDCDF9E67\nplatform_sso_version=2.0&grant_type=urn:ietf:params:oauth:grant-type:jwt-bearer&assertion=ewogIC...JmVhg\n```\n\n### Receive the key exchange response JWE\n\nThe response is a JWE that’s decrypted according to RFC 7516 Section 5.2 with JWE Compact Serialization.\n\nThe JWE key exchange response header contains the following values:\n\n\n\nThe following code provides an example of a key exchange response JWE header:\n\n```javascript\n{\n    \"enc\" : \"A256GCM\",\n    \"kid\" : \"cNYXaKrqHO+mBB0MHxuaEUZ2edf0T\/GgMNB\/tlHGews=\",\n    \"epk\" : {\n        \"y\" : \"WFUG_Llu2uD70NfbIFOkP5LaNsZlJ1JGIme2DPdbijU\",\n        \"x\" : \"kXzpm4kt-sbm5QlOJPNZAHhaW8rQ5QE_E2HLFcz2uNs\",\n        \"kty\" : \"EC\",\n        \"crv\" : \"P-256\"\n    }, \n    \"apu\" : \"AAAAB...z3W4o1\",\n    \"typ\" : \"platformsso-key-response+jwt\",\n    \"alg\" : \"ECDH-ES\"\n}\n```\n\nThe IdP creates a successful key response. The JWE key exchange response body contains the following values:\n\n\n\nThe following code provides an example of a key exchange response JWE body:\n\n```javascript\n{\n    \"exp\" : 1685756137,\n    \"iat\" : 1685755837,\n    \"key\" : \"DpWD3c4SPmfYteESkRYk+pKVHHuryb1EtnuzhF9OjTc=\",\n    \"key_context\" : \"BHp+H...Axw==\"\n}\n```\n\n## Login request\n\n- **Performing a WS-Trust login request**: Create a WS-Trust login request using the metadata exchange data (MEX) response.\n- **Creating an embedded assertion**: Request an embedded assertion for login types that require a digital signature for authentication.\n- **Creating an encrypted embedded assertion**: Request an encrypted embedded assertion for login types that require password encryption.\n- **Creating and validating a login request**: Create a signed JOSE login request.\n- **Creating a refresh request**: Refresh a non-expired token instead of sending a new login request.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Create a WS-Trust login request using the metadata exchange data (MEX) response.",
          "name" : "Performing a WS-Trust login request",
          "url" : "https:\/\/developer.apple.com\/documentation\/AuthenticationServices\/performing-a-ws-trust-login-request"
        },
        {
          "description" : "Request an embedded assertion for login types that require a digital signature for authentication.",
          "name" : "Creating an embedded assertion",
          "url" : "https:\/\/developer.apple.com\/documentation\/AuthenticationServices\/creating-an-embedded-assertion"
        },
        {
          "description" : "Request an encrypted embedded assertion for login types that require password encryption.",
          "name" : "Creating an encrypted embedded assertion",
          "url" : "https:\/\/developer.apple.com\/documentation\/AuthenticationServices\/creating-an-encrypted-embedded-assertion"
        },
        {
          "description" : "Create a signed JOSE login request.",
          "name" : "Creating and validating a login request",
          "url" : "https:\/\/developer.apple.com\/documentation\/AuthenticationServices\/creating-and-validating-a-login-request"
        },
        {
          "description" : "Refresh a non-expired token instead of sending a new login request.",
          "name" : "Creating a refresh request",
          "url" : "https:\/\/developer.apple.com\/documentation\/AuthenticationServices\/creating-a-refresh-request"
        }
      ],
      "title" : "Login request"
    }
  ],
  "source" : "appleJSON",
  "title" : "Supporting key requests and key exchange requests",
  "url" : "https:\/\/developer.apple.com\/documentation\/authenticationservices\/supporting-key-requests-and-key-exchange-requests"
}