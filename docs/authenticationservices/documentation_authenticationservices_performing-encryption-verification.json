{
  "abstract" : "Verify the login request and create a JSON Web Encryption (JWE) response.",
  "codeExamples" : [
    {
      "code" : "{\n    \"y\" : \"PAIz7YrH4Rxz1rlfn6JcnwSmFDVGY1ISlGnmK1NX5vs\",\n    \"d\" : \"vXZoCHYVxEJVcCcQN50ZKEBwhlQYO6g3KaUIufh3vXw\",\n    \"kid\" : \"Ws9mKynZxyUSNXYtMGAjjLO+Jg16HCa\\\/5pJO0udNWJ4=\",\n    \"x\" : \"gK60EgxT-EipyAgSlrHG0LgFVrgnd8UXAvLOgykJtms\",\n    \"kty\" : \"EC\",\n    \"crv\" : \"P-256\"\n}",
      "language" : "javascript"
    },
    {
      "code" : "{\n    \"y\" : \"4MlSuUf_7J6Ljv0FBT1jK0_sKGB4WYwdKCOtnTEAwz4\",\n    \"d\" : \"1bqqmpoFEtzSnQMqp9N9ZRybnP8vjFUiZyGaSgKVGMw\",\n    \"kid\" : \"pScnuzx3x85Eyp6CtK9UQADxOsAGTP72y02Tg3m1sk8=\",\n    \"x\" : \"TvkPOH4yscrSC1rFYvnBVPYMqzR1vKck9ht4D7K_gAQ\",\n    \"kty\" : \"EC\",\n    \"crv\" : \"P-256\"\n}",
      "language" : "javascript"
    },
    {
      "code" : "{\n    \"kid\" : \"Ws9mKynZxyUSNXYtMGAjjLO+Jg16HCa\/5pJO0udNWJ4=\",\n    \"x5c\" : \"MIIBhDCCASmgAwIBAgIBATAKBggqhkjOPQQDAjA3MRQwEgYDVQQDEwtkZXZpY2UgdGVzdDELMAkGA1UEBhMCVVMxEjAQBgNVBAoTCUFwcGxlIEluYzAeFw0yMjA2MjMxNzI1MzFaFw0yMzA2MjMxNzI1MzFaMDcxFDASBgNVBAMTC2RldmljZSB0ZXN0MQswCQYDVQQGEwJVUzESMBAGA1UEChMJQXBwbGUgSW5jMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEgK60EgxT+EipyAgSlrHG0LgFVrgnd8UXAvLOgykJtms8AjPtisfhHHPWuV+folyfBKYUNUZjUhKUaeYrU1fm+6MmMCQwEgYDVR0TAQH\/BAgwBgEB\/wIBADAOBgNVHQ8BAf8EBAMCB4AwCgYIKoZIzj0EAwIDSQAwRgIhAMwGOYwgf5xGxNcZLL\/Y4phA66w\/PSVLeQYhec2JTQF1AiEAlNSUDycvv0DwDQYU4wUpco\/GBuhc4mPmli3+DT+p1Is=\",\n    \"typ\" : \"JWT\",\n    \"alg\" : \"ES256\"\n}.{\n    \"iat\" : \"1656005132\",\n    \"jwe_crypto\" : {\n        \"alg\" : \"ECDH-ES\",\n        \"enc\" : \"A256GCM\",\n        \"apv\" : \"AAAABUFwcGxlAAAAQQRO-Q84fjKxytILWsVi-cFU9gyrNHW8pyT2G3gPsr-ABODJUrlH_-yei479BQU9YytP7ChgeFmMHSgjrZ0xAMM-AAAAJERERjY4MTcxLTQwOUQtNEUyQy05MUYwLTlFNDJENzc0NTM2NQ\"\n    },\n    \"password\" : \"bar\",\n    \"request_nonce\" : \"AwABAAAAAAADAOz_BADv_xtgu_SM1Mvoq02PYz_YfXxx5FAgcLHLNikH6gjrBWwcqnRW_haxqO9JCiPat5KfkTily04S8EH3AQwVsWCxHYQgAA\",\n    \"scope\" : \"openid offline_access urn:apple:platformsso\",\n    \"grant_type\" : \"password\",\n    \"username\" : \"foo\",\n    \"aud\" : \"https:\/\/localhost.apple.com:8888\/auth\/token\",\n    \"client_id\" : \"aaff1524-fa35-40c5-94e3-2b233c5f2965\",\n    \"nonce\" : \"DDF68171-409D-4E2C-91F0-9E42D7745365\"\n}",
      "language" : "javascript"
    },
    {
      "code" : "ewogICJraWQiIDogIldzOW1LeW5aeHlVU05YWXRNR0FqakxPK0pnMTZIQ2EvNXBKTzB1ZE5XSjQ9IiwKICAieDVjIiA6ICJNSUlCaERDQ0FTbWdBd0lCQWdJQkFUQUtCZ2dxaGtqT1BRUURBakEzTVJRd0VnWURWUVFERXd0a1pYWnBZMlVnZEdWemRERUxNQWtHQTFVRUJoTUNWVk14RWpBUUJnTlZCQW9UQ1VGd2NHeGxJRWx1WXpBZUZ3MHlNakEyTWpNeE56STFNekZhRncweU16QTJNak14TnpJMU16RmFNRGN4RkRBU0JnTlZCQU1UQzJSbGRtbGpaU0IwWlhOME1Rc3dDUVlEVlFRR0V3SlZVekVTTUJBR0ExVUVDaE1KUVhCd2JHVWdTVzVqTUZrd0V3WUhLb1pJemowQ0FRWUlLb1pJemowREFRY0RRZ0FFZ0s2MEVneFQrRWlweUFnU2xySEcwTGdGVnJnbmQ4VVhBdkxPZ3lrSnRtczhBalB0aXNmaEhIUFd1Vitmb2x5ZkJLWVVOVVpqVWhLVWFlWXJVMWZtKzZNbU1DUXdFZ1lEVlIwVEFRSC9CQWd3QmdFQi93SUJBREFPQmdOVkhROEJBZjhFQkFNQ0I0QXdDZ1lJS29aSXpqMEVBd0lEU1FBd1JnSWhBTXdHT1l3Z2Y1eEd4TmNaTEwvWTRwaEE2NncvUFNWTGVRWWhlYzJKVFFGMUFpRUFsTlNVRHljdnYwRHdEUVlVNHdVcGNvL0dCdWhjNG1QbWxpMytEVCtwMUlzPSIsCiAgInR5cCIgOiAiSldUIiwKICAiYWxnIiA6ICJFUzI1NiIKfQ.ewogICJpYXQiIDogIjE2NTYwMDUxMzIiLAogICJqd2VfY3J5cHRvIiA6IHsKICAgICJhbGciIDogIkVDREgtRVMiLAogICAgImVuYyIgOiAiQTI1NkdDTSIsCiAgICAiYXB2IiA6ICJBQUFBQlVGd2NHeGxBQUFBUVFSTy1RODRmakt4eXRJTFdzVmktY0ZVOWd5ck5IVzhweVQyRzNnUHNyLUFCT0RKVXJsSF8teWVpNDc5QlFVOVl5dFA3Q2hnZUZtTUhTZ2pyWjB4QU1NLUFBQUFKRVJFUmpZNE1UY3hMVFF3T1VRdE5FVXlReTA1TVVZd0xUbEZOREpFTnpjME5UTTJOUSIKICB9LAogICJwYXNzd29yZCIgOiAiYmFyIiwKICAicmVxdWVzdF9ub25jZSIgOiAiQXdBQkFBQUFBQUFEQU96X0JBRHZfeHRndV9TTTFNdm9xMDJQWXpfWWZYeHg1RkFnY0xITE5pa0g2Z2pyQld3Y3FuUldfaGF4cU85SkNpUGF0NUtma1RpbHkwNFM4RUgzQVF3VnNXQ3hIWVFnQUEiLAogICJzY29wZSIgOiAib3BlbmlkIG9mZmxpbmVfYWNjZXNzIHVybjphcHBsZTpwbGF0Zm9ybXNzbyIsCiAgImdyYW50X3R5cGUiIDogInBhc3N3b3JkIiwKICAidXNlcm5hbWUiIDogImZvbyIsCiAgImF1ZCIgOiAiaHR0cHM6Ly9sb2NhbGhvc3QuYXBwbGUuY29tOjg4ODgvYXV0aC90b2tlbiIsCiAgImNsaWVudF9pZCIgOiAiYWFmZjE1MjQtZmEzNS00MGM1LTk0ZTMtMmIyMzNjNWYyOTY1IiwKICAibm9uY2UiIDogIkRERjY4MTcxLTQwOUQtNEUyQy05MUYwLTlFNDJENzc0NTM2NSIKfQ.JMD4NkC0bwrQ0GZI66EMo50Rwgfj3fewTc_6836zWbyvNwcCSNmL9hKIgJx-oFoiwZ0dtYYN5KPI3MHLg3-GBw",
      "language" : "shell"
    },
    {
      "code" : "ewogICJlbmMiIDogIkEyNTZHQ00iLAogICJraWQiIDogInBTY251engzeDg1RXlwNkN0SzlVUUFEeE9zQUdUUDcyeTAyVGczbTFzazg9IiwKICAiZXBrIiA6IHsKICAgICJ5IiA6ICJlcmY5bkVrRUM4U2l1d1AtN2Y3dWREN0NuWDVLRWF1VklmQlBvcW5tbFlvIiwKICAgICJ4IiA6ICJWSVhkZ3UzeDBlTGdFVnRST1o1WVE0R1VTOFdaUVQtM0hQcVgyRlBvWTRJIiwKICAgICJrdHkiIDogIkVDIiwKICAgICJjcnYiIDogIlAtMjU2IgogIH0sCiAgImFwdSIgOiAiQUFBQUJVRlFVRXhGQUFBQVFRUlVoZDJDN2ZIUjR1QVJXMUU1bmxoRGdaUkx4WmxCUDdjYy1wZllVLWhqZ25xM19aeEpCQXZFb3JzRF91My03blEtd3AxLVNoR3JsU0h3VDZLcDVwV0siLAogICJ0eXAiIDogIkpXVCIsCiAgImFsZyIgOiAiRUNESC1FUyIKfQ..cFAKroCUiODyXmdK.Clpc69y98u7GwODBB9u4ZIcxyOY-MHlVmPIlP5Tz9pKKMLJfHTKkWtHpP1Y8YKAdT7iuRN09bTNRgArfPLIlo7WkUolOGoU3oV07p3m3cOmTzmVqOmVs0dXlEVZlF21TX_hjN2sj5RpC4tWBdKVdoCej4u0Brkgypw0jXtKUzjIM2HcE-8Yy4fC-ixTnescR1M3eM_6IWRR1MtEYTy1C7JrBcw9gZVSmvC1DpeH49gYw9FkIQUpdnfvyreVU0DfvqhABvp29fpVmQqoaENoLuqDt0Ajfko5LWRz3sLcZipoZ0gdRgwQpcNLnBUYAZs5D7t8Yuay2CZjAoTZcbFv4F8Mrg2BgEncVwhC9jTEVGe3GinlsziPdSVIt-7lXbV99yk2qX0eYb4ItScWgUfl3y_p623Xtr3AOxlslahF7fm8PN3sAJnwb_aQQxeeQZQyRZKD9uMHHUTMZeoJbXxV1KdGgQMYdW0Z40_WYFtqT8UwboptazbZX02GOmz2gO7JSe0OHgLCPAfvp9Ah2apYrEDqp01tYwhCG8SNuBB_sXPuJx-euUuxu70s1809k44A_hAc_iYDPwTBpAXBLOiuJIxVZgy54WNNiP_WqBImjsA1ioE7Mrvqkn-DnkM0NP2rt1GvaZ-IpUNgAXKudjiT51guQLnRcr9r3pNmmIaUrqKepMJdAYqUbc9PjYUus7RX-20r5pudVi8Ef0Tg5y9Hk3f7sfiX9peBea_L5yQP-tjXJN8lITRBFCtvvsTb0ALVbKTTHiItmYFxl7XzAljiOMiXEKDKwb0VqOtkU4Ljdz2_M7mW0sT1M6_8XZ6dn3W9RMAeqmLnKlxU5gxj0rK5C8Dnok-I2jOlDzr7uS01WBmaln4E2MTRLyGsdUhXk6JLewtomMTrM7dfq1x6iZubbV8fOk4ayKlEh6xQONPfUXAnr-OB45gllZ2GWNaipd9nwJyGnktSQYpjHiMgl-eKQ3nwwD6Tnj9yYZgvq-D5_DUknvk1XMGTF1CAKaGWDWvf4t2LTyxLld6qgDKyrQWYVKRbHY5LtUqlQjTUP9WGVCNnojVfEIVJIxGXspgL_QwViuBBkmHa_IEd18UE68_yhtBh1dxi_K3td6AG01_Fm1UgYNhi4SPHJqA22zJQ397HdAAGk1bYk5IacY9qyqpVXPBRhEE92DG5oDZcCUB9li87NWRJIaF46Q1z5S2ROSBimBi-nyOX5G4DpgrPjst3lK7NacpssjdPk2fDh3XXKu2r4RXBr7l7hweuwKNgyzPBoTZ37dadYKz1MpxO5Ag43xLzTougLDkVrS5w.4dpX5cVdPodXep2NyC2Vyg",
      "language" : "shell"
    }
  ],
  "contentHash" : "55e51d1c89e52c908d720b8d9b51d87a9ac9ec36ca0a7db57e4b58622416da36",
  "crawledAt" : "2025-12-09T17:21:44Z",
  "id" : "DEAD4D0A-A08A-4B7D-B86D-4964739AB437",
  "kind" : "article",
  "language" : "swift",
  "module" : "Authentication Services",
  "overview" : "## Overview\n\nUse the code snippets in this article to complete the process of encryption verification that works with platform SSO:\n\nUse this device signing key:\n\nUse this device encryption key:\n\n### Sign the login request\n\nNote how the system signs the following login JSON Web Token (JWT) using the device-signing key:\n\nThe signed and encoded login JWT output is:\n\n### Encrypt the response\n\nUse the following ephemeral key, response header, and plain text to generate a sample encrypted response. The plain text is encrypted and all data values are base-64 URL encoded.\n\n`}`\n\n### Perform Diffie-Hellman key exchange\n\nDiffie–Hellman key exchange is a method to securely exchange cryptographic keys over a public channel.\n\nUse the device encryption public key and the ephemeral private key to perform Diffie-Hellman key exchange ([doc:\/\/com.apple.documentation\/documentation\/Security\/SecKeyAlgorithm\/ecdhKeyExchangeStandard]).\n\n### Perform ConcatKDF\n\nConcatKDF is a concatenation Key Derivation Function (KDF) to derive a shared key from the result of performing Diffie-Hellman key exchange.\n\nPerform ConcatKDF using the key exchange result, algorithm, `PartyUInfo`, and `PartyVInfo`: Here are the values that these code snippets use, including the data before the hash and the computed key (output):\n\n### Encrypt the plain text\n\nThe system uses the key from ConcatKDF with the Initialization Vector (IV) and the Additional Authentication Data (AAD) to encrypt the plain text using AESGCM. The AAD is the ASCII-encoded response header per RFC 7516 Section 5.1, Step 14. The response header was already base-64 URL encoded. Here are the values that these code snippets use, and the output:\n\n### Verify the login JWE response\n\nCheck the response to confirm that it matches the following output when formatted as a JWE with compact serialization. The system formats the response per RFC 7516 Section 5.1, Step 19. The JWE encrypted key is empty because the system uses direct key agreement:\n\n### Decrypt the JWE\n\nThe system calculates the key differently when decrypting the JWE. For decryption, the system performs Diffie-Hellman key exchange ([doc:\/\/com.apple.documentation\/documentation\/Security\/SecKeyAlgorithm\/ecdhKeyExchangeStandard]) using the device encryption private key and the ephemeral public key from the JWE header. The other inputs for ConcatKDF are the same and the system uses the calculated key for AESGCM decryption using the fields from the encrypted JWE.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/AuthenticationServices\/performing-encryption-verification\ncrawled: 2025-12-09T17:21:44Z\n---\n\n# Performing encryption verification\n\n**Article**\n\nVerify the login request and create a JSON Web Encryption (JWE) response.\n\n## Overview\n\nUse the code snippets in this article to complete the process of encryption verification that works with platform SSO:\n\n- Create device signing and encryption keys\n- Sign the login request and encrypt the response\n- Perform key exchange\n- Derive a shared key and encrypt the plain text\n- Verify the login response and decrypt the JWE\n\nUse this device signing key:\n\n```javascript\n{\n    \"y\" : \"PAIz7YrH4Rxz1rlfn6JcnwSmFDVGY1ISlGnmK1NX5vs\",\n    \"d\" : \"vXZoCHYVxEJVcCcQN50ZKEBwhlQYO6g3KaUIufh3vXw\",\n    \"kid\" : \"Ws9mKynZxyUSNXYtMGAjjLO+Jg16HCa\\\/5pJO0udNWJ4=\",\n    \"x\" : \"gK60EgxT-EipyAgSlrHG0LgFVrgnd8UXAvLOgykJtms\",\n    \"kty\" : \"EC\",\n    \"crv\" : \"P-256\"\n}\n```\n\nUse this device encryption key:\n\n```javascript\n{\n    \"y\" : \"4MlSuUf_7J6Ljv0FBT1jK0_sKGB4WYwdKCOtnTEAwz4\",\n    \"d\" : \"1bqqmpoFEtzSnQMqp9N9ZRybnP8vjFUiZyGaSgKVGMw\",\n    \"kid\" : \"pScnuzx3x85Eyp6CtK9UQADxOsAGTP72y02Tg3m1sk8=\",\n    \"x\" : \"TvkPOH4yscrSC1rFYvnBVPYMqzR1vKck9ht4D7K_gAQ\",\n    \"kty\" : \"EC\",\n    \"crv\" : \"P-256\"\n}\n```\n\n### Sign the login request\n\nNote how the system signs the following login JSON Web Token (JWT) using the device-signing key:\n\n```javascript\n{\n    \"kid\" : \"Ws9mKynZxyUSNXYtMGAjjLO+Jg16HCa\/5pJO0udNWJ4=\",\n    \"x5c\" : \"MIIBhDCCASmgAwIBAgIBATAKBggqhkjOPQQDAjA3MRQwEgYDVQQDEwtkZXZpY2UgdGVzdDELMAkGA1UEBhMCVVMxEjAQBgNVBAoTCUFwcGxlIEluYzAeFw0yMjA2MjMxNzI1MzFaFw0yMzA2MjMxNzI1MzFaMDcxFDASBgNVBAMTC2RldmljZSB0ZXN0MQswCQYDVQQGEwJVUzESMBAGA1UEChMJQXBwbGUgSW5jMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEgK60EgxT+EipyAgSlrHG0LgFVrgnd8UXAvLOgykJtms8AjPtisfhHHPWuV+folyfBKYUNUZjUhKUaeYrU1fm+6MmMCQwEgYDVR0TAQH\/BAgwBgEB\/wIBADAOBgNVHQ8BAf8EBAMCB4AwCgYIKoZIzj0EAwIDSQAwRgIhAMwGOYwgf5xGxNcZLL\/Y4phA66w\/PSVLeQYhec2JTQF1AiEAlNSUDycvv0DwDQYU4wUpco\/GBuhc4mPmli3+DT+p1Is=\",\n    \"typ\" : \"JWT\",\n    \"alg\" : \"ES256\"\n}.{\n    \"iat\" : \"1656005132\",\n    \"jwe_crypto\" : {\n        \"alg\" : \"ECDH-ES\",\n        \"enc\" : \"A256GCM\",\n        \"apv\" : \"AAAABUFwcGxlAAAAQQRO-Q84fjKxytILWsVi-cFU9gyrNHW8pyT2G3gPsr-ABODJUrlH_-yei479BQU9YytP7ChgeFmMHSgjrZ0xAMM-AAAAJERERjY4MTcxLTQwOUQtNEUyQy05MUYwLTlFNDJENzc0NTM2NQ\"\n    },\n    \"password\" : \"bar\",\n    \"request_nonce\" : \"AwABAAAAAAADAOz_BADv_xtgu_SM1Mvoq02PYz_YfXxx5FAgcLHLNikH6gjrBWwcqnRW_haxqO9JCiPat5KfkTily04S8EH3AQwVsWCxHYQgAA\",\n    \"scope\" : \"openid offline_access urn:apple:platformsso\",\n    \"grant_type\" : \"password\",\n    \"username\" : \"foo\",\n    \"aud\" : \"https:\/\/localhost.apple.com:8888\/auth\/token\",\n    \"client_id\" : \"aaff1524-fa35-40c5-94e3-2b233c5f2965\",\n    \"nonce\" : \"DDF68171-409D-4E2C-91F0-9E42D7745365\"\n}\n```\n\nThe signed and encoded login JWT output is:\n\n```shell\newogICJraWQiIDogIldzOW1LeW5aeHlVU05YWXRNR0FqakxPK0pnMTZIQ2EvNXBKTzB1ZE5XSjQ9IiwKICAieDVjIiA6ICJNSUlCaERDQ0FTbWdBd0lCQWdJQkFUQUtCZ2dxaGtqT1BRUURBakEzTVJRd0VnWURWUVFERXd0a1pYWnBZMlVnZEdWemRERUxNQWtHQTFVRUJoTUNWVk14RWpBUUJnTlZCQW9UQ1VGd2NHeGxJRWx1WXpBZUZ3MHlNakEyTWpNeE56STFNekZhRncweU16QTJNak14TnpJMU16RmFNRGN4RkRBU0JnTlZCQU1UQzJSbGRtbGpaU0IwWlhOME1Rc3dDUVlEVlFRR0V3SlZVekVTTUJBR0ExVUVDaE1KUVhCd2JHVWdTVzVqTUZrd0V3WUhLb1pJemowQ0FRWUlLb1pJemowREFRY0RRZ0FFZ0s2MEVneFQrRWlweUFnU2xySEcwTGdGVnJnbmQ4VVhBdkxPZ3lrSnRtczhBalB0aXNmaEhIUFd1Vitmb2x5ZkJLWVVOVVpqVWhLVWFlWXJVMWZtKzZNbU1DUXdFZ1lEVlIwVEFRSC9CQWd3QmdFQi93SUJBREFPQmdOVkhROEJBZjhFQkFNQ0I0QXdDZ1lJS29aSXpqMEVBd0lEU1FBd1JnSWhBTXdHT1l3Z2Y1eEd4TmNaTEwvWTRwaEE2NncvUFNWTGVRWWhlYzJKVFFGMUFpRUFsTlNVRHljdnYwRHdEUVlVNHdVcGNvL0dCdWhjNG1QbWxpMytEVCtwMUlzPSIsCiAgInR5cCIgOiAiSldUIiwKICAiYWxnIiA6ICJFUzI1NiIKfQ.ewogICJpYXQiIDogIjE2NTYwMDUxMzIiLAogICJqd2VfY3J5cHRvIiA6IHsKICAgICJhbGciIDogIkVDREgtRVMiLAogICAgImVuYyIgOiAiQTI1NkdDTSIsCiAgICAiYXB2IiA6ICJBQUFBQlVGd2NHeGxBQUFBUVFSTy1RODRmakt4eXRJTFdzVmktY0ZVOWd5ck5IVzhweVQyRzNnUHNyLUFCT0RKVXJsSF8teWVpNDc5QlFVOVl5dFA3Q2hnZUZtTUhTZ2pyWjB4QU1NLUFBQUFKRVJFUmpZNE1UY3hMVFF3T1VRdE5FVXlReTA1TVVZd0xUbEZOREpFTnpjME5UTTJOUSIKICB9LAogICJwYXNzd29yZCIgOiAiYmFyIiwKICAicmVxdWVzdF9ub25jZSIgOiAiQXdBQkFBQUFBQUFEQU96X0JBRHZfeHRndV9TTTFNdm9xMDJQWXpfWWZYeHg1RkFnY0xITE5pa0g2Z2pyQld3Y3FuUldfaGF4cU85SkNpUGF0NUtma1RpbHkwNFM4RUgzQVF3VnNXQ3hIWVFnQUEiLAogICJzY29wZSIgOiAib3BlbmlkIG9mZmxpbmVfYWNjZXNzIHVybjphcHBsZTpwbGF0Zm9ybXNzbyIsCiAgImdyYW50X3R5cGUiIDogInBhc3N3b3JkIiwKICAidXNlcm5hbWUiIDogImZvbyIsCiAgImF1ZCIgOiAiaHR0cHM6Ly9sb2NhbGhvc3QuYXBwbGUuY29tOjg4ODgvYXV0aC90b2tlbiIsCiAgImNsaWVudF9pZCIgOiAiYWFmZjE1MjQtZmEzNS00MGM1LTk0ZTMtMmIyMzNjNWYyOTY1IiwKICAibm9uY2UiIDogIkRERjY4MTcxLTQwOUQtNEUyQy05MUYwLTlFNDJENzc0NTM2NSIKfQ.JMD4NkC0bwrQ0GZI66EMo50Rwgfj3fewTc_6836zWbyvNwcCSNmL9hKIgJx-oFoiwZ0dtYYN5KPI3MHLg3-GBw\n```\n\n### Encrypt the response\n\nUse the following ephemeral key, response header, and plain text to generate a sample encrypted response. The plain text is encrypted and all data values are base-64 URL encoded.\n\n\n\n`}`\n\n\n\n### Perform Diffie-Hellman key exchange\n\nDiffie–Hellman key exchange is a method to securely exchange cryptographic keys over a public channel.\n\nUse the device encryption public key and the ephemeral private key to perform Diffie-Hellman key exchange ([doc:\/\/com.apple.documentation\/documentation\/Security\/SecKeyAlgorithm\/ecdhKeyExchangeStandard]).\n\n\n\n### Perform ConcatKDF\n\nConcatKDF is a concatenation Key Derivation Function (KDF) to derive a shared key from the result of performing Diffie-Hellman key exchange.\n\nPerform ConcatKDF using the key exchange result, algorithm, `PartyUInfo`, and `PartyVInfo`: Here are the values that these code snippets use, including the data before the hash and the computed key (output):\n\n\n\n### Encrypt the plain text\n\nThe system uses the key from ConcatKDF with the Initialization Vector (IV) and the Additional Authentication Data (AAD) to encrypt the plain text using AESGCM. The AAD is the ASCII-encoded response header per RFC 7516 Section 5.1, Step 14. The response header was already base-64 URL encoded. Here are the values that these code snippets use, and the output:\n\n\n\n### Verify the login JWE response\n\nCheck the response to confirm that it matches the following output when formatted as a JWE with compact serialization. The system formats the response per RFC 7516 Section 5.1, Step 19. The JWE encrypted key is empty because the system uses direct key agreement:\n\n```shell\newogICJlbmMiIDogIkEyNTZHQ00iLAogICJraWQiIDogInBTY251engzeDg1RXlwNkN0SzlVUUFEeE9zQUdUUDcyeTAyVGczbTFzazg9IiwKICAiZXBrIiA6IHsKICAgICJ5IiA6ICJlcmY5bkVrRUM4U2l1d1AtN2Y3dWREN0NuWDVLRWF1VklmQlBvcW5tbFlvIiwKICAgICJ4IiA6ICJWSVhkZ3UzeDBlTGdFVnRST1o1WVE0R1VTOFdaUVQtM0hQcVgyRlBvWTRJIiwKICAgICJrdHkiIDogIkVDIiwKICAgICJjcnYiIDogIlAtMjU2IgogIH0sCiAgImFwdSIgOiAiQUFBQUJVRlFVRXhGQUFBQVFRUlVoZDJDN2ZIUjR1QVJXMUU1bmxoRGdaUkx4WmxCUDdjYy1wZllVLWhqZ25xM19aeEpCQXZFb3JzRF91My03blEtd3AxLVNoR3JsU0h3VDZLcDVwV0siLAogICJ0eXAiIDogIkpXVCIsCiAgImFsZyIgOiAiRUNESC1FUyIKfQ..cFAKroCUiODyXmdK.Clpc69y98u7GwODBB9u4ZIcxyOY-MHlVmPIlP5Tz9pKKMLJfHTKkWtHpP1Y8YKAdT7iuRN09bTNRgArfPLIlo7WkUolOGoU3oV07p3m3cOmTzmVqOmVs0dXlEVZlF21TX_hjN2sj5RpC4tWBdKVdoCej4u0Brkgypw0jXtKUzjIM2HcE-8Yy4fC-ixTnescR1M3eM_6IWRR1MtEYTy1C7JrBcw9gZVSmvC1DpeH49gYw9FkIQUpdnfvyreVU0DfvqhABvp29fpVmQqoaENoLuqDt0Ajfko5LWRz3sLcZipoZ0gdRgwQpcNLnBUYAZs5D7t8Yuay2CZjAoTZcbFv4F8Mrg2BgEncVwhC9jTEVGe3GinlsziPdSVIt-7lXbV99yk2qX0eYb4ItScWgUfl3y_p623Xtr3AOxlslahF7fm8PN3sAJnwb_aQQxeeQZQyRZKD9uMHHUTMZeoJbXxV1KdGgQMYdW0Z40_WYFtqT8UwboptazbZX02GOmz2gO7JSe0OHgLCPAfvp9Ah2apYrEDqp01tYwhCG8SNuBB_sXPuJx-euUuxu70s1809k44A_hAc_iYDPwTBpAXBLOiuJIxVZgy54WNNiP_WqBImjsA1ioE7Mrvqkn-DnkM0NP2rt1GvaZ-IpUNgAXKudjiT51guQLnRcr9r3pNmmIaUrqKepMJdAYqUbc9PjYUus7RX-20r5pudVi8Ef0Tg5y9Hk3f7sfiX9peBea_L5yQP-tjXJN8lITRBFCtvvsTb0ALVbKTTHiItmYFxl7XzAljiOMiXEKDKwb0VqOtkU4Ljdz2_M7mW0sT1M6_8XZ6dn3W9RMAeqmLnKlxU5gxj0rK5C8Dnok-I2jOlDzr7uS01WBmaln4E2MTRLyGsdUhXk6JLewtomMTrM7dfq1x6iZubbV8fOk4ayKlEh6xQONPfUXAnr-OB45gllZ2GWNaipd9nwJyGnktSQYpjHiMgl-eKQ3nwwD6Tnj9yYZgvq-D5_DUknvk1XMGTF1CAKaGWDWvf4t2LTyxLld6qgDKyrQWYVKRbHY5LtUqlQjTUP9WGVCNnojVfEIVJIxGXspgL_QwViuBBkmHa_IEd18UE68_yhtBh1dxi_K3td6AG01_Fm1UgYNhi4SPHJqA22zJQ397HdAAGk1bYk5IacY9qyqpVXPBRhEE92DG5oDZcCUB9li87NWRJIaF46Q1z5S2ROSBimBi-nyOX5G4DpgrPjst3lK7NacpssjdPk2fDh3XXKu2r4RXBr7l7hweuwKNgyzPBoTZ37dadYKz1MpxO5Ag43xLzTougLDkVrS5w.4dpX5cVdPodXep2NyC2Vyg\n```\n\n### Decrypt the JWE\n\nThe system calculates the key differently when decrypting the JWE. For decryption, the system performs Diffie-Hellman key exchange ([doc:\/\/com.apple.documentation\/documentation\/Security\/SecKeyAlgorithm\/ecdhKeyExchangeStandard]) using the device encryption private key and the ephemeral public key from the JWE header. The other inputs for ConcatKDF are the same and the system uses the calculated key for AESGCM decryption using the fields from the encrypted JWE.\n\n## Login response\n\n- **Creating a JSON Web Encryption (JWE) login response**: Create an encrypted login response and configure the concatenation key derivation function (Concat KDF).\n- **Processing the JSON Web Encryption (JWE) login response**: Validate the encrypted response.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Create an encrypted login response and configure the concatenation key derivation function (Concat KDF).",
          "name" : "Creating a JSON Web Encryption (JWE) login response",
          "url" : "https:\/\/developer.apple.com\/documentation\/AuthenticationServices\/creating-a-json-web-encryption-jwe-login-response"
        },
        {
          "description" : "Validate the encrypted response.",
          "name" : "Processing the JSON Web Encryption (JWE) login response",
          "url" : "https:\/\/developer.apple.com\/documentation\/AuthenticationServices\/processing-the-json-web-encryption-jwe-login-response"
        }
      ],
      "title" : "Login response"
    }
  ],
  "source" : "appleJSON",
  "title" : "Performing encryption verification",
  "url" : "https:\/\/developer.apple.com\/documentation\/AuthenticationServices\/performing-encryption-verification"
}