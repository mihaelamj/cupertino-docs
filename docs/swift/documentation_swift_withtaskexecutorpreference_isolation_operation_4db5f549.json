{
  "abstract" : "Configure the current task hierarchy’s task executor preference to the passed [doc:\/\/com.apple.Swift\/documentation\/Swift\/TaskExecutor], and execute the passed in closure by immediately hopping to that executor.",
  "codeExamples" : [
    {
      "code" : "[ func \/ closure ] - \/* where should it execute? *\/\n                              |\n                    +--------------+          +===========================+\n          +-------- | is isolated? | - yes -> | actor has unownedExecutor |\n          |         +--------------+          +===========================+\n          |                                       |                |\n          |                                      yes               no\n          |                                       |                |\n          |                                       v                v\n          |                  +=======================+    \/* task executor preference? *\/\n          |                  | on specified executor |        |                   |\n          |                  +=======================+       yes                  no\n          |                                                   |                   |\n          |                                                   |                   v\n          |                                                   |    +==========================+\n          |                                                   |    | default (actor) executor |\n          |                                                   v    +==========================+\n          v                                     +==============================+\n \/* task executor preference? *\/ ---- yes ----> | on Task's preferred executor |\n          |                                     +==============================+\n          no\n          |\n          v\n +===============================+\n | on global concurrent executor |\n +===============================+",
      "language" : "swift"
    },
    {
      "code" : "Task {\n  \/\/ case 0) \"no task executor preference\"\n\n  \/\/ default task executor\n  \/\/ ...\n  await SomeDefaultActor().hello() \/\/ default executor\n  await ActorWithCustomExecutor().hello() \/\/ 'hello' executes on actor's custom executor\n\n  \/\/ child tasks execute on default executor:\n  async let x = ...\n  await withTaskGroup(of: Int.self) { group in g.addTask { 7 } }\n\n  await withTaskExecutorPreference(specific) {\n    \/\/ case 1) 'specific' task executor preference\n\n    \/\/ 'specific' task executor\n    \/\/ ...\n    await SomeDefaultActor().hello() \/\/ 'hello' executes on 'specific' executor\n    await ActorWithCustomExecutor().hello() \/\/ 'hello' executes on actor's custom executor (same as case 0)\n\n    \/\/ child tasks execute on 'specific' task executor:\n    async let x = ...\n    await withTaskGroup(of: Int.self) { group in\n      group.addTask { 7 } \/\/ child task executes on 'specific' executor\n      group.addTask(executorPreference: globalConcurrentExecutor) { 13 } \/\/ child task executes on global concurrent executor\n    }\n\n    \/\/ disable the task executor preference:\n    await withTaskExecutorPreference(globalConcurrentExecutor) {\n      \/\/ equivalent to case 0) preference is globalConcurrentExecutor\n\n      \/\/ default task executor\n      \/\/ ...\n      await SomeDefaultActor().hello() \/\/ default executor (same as case 0)\n      await ActorWithCustomExecutor().hello() \/\/ 'hello' executes on actor's custom executor (same as case 0)\n\n      \/\/ child tasks execute on default executor (same as case 0):\n      async let x = ...\n      await withTaskGroup(of: Int.self) { group in group.addTask { 7 } }\n    }\n  }\n}",
      "language" : "swift"
    }
  ],
  "contentHash" : "1daba35ea0323faedf2e782bc8e1c479b0fdbf35d18cc60a4404113859af82be",
  "crawledAt" : "2025-12-03T17:12:17Z",
  "declaration" : {
    "code" : "func withTaskExecutorPreference<T, Failure>(_ taskExecutor: (any TaskExecutor)?, isolation: isolated (any Actor)? = #isolation, operation: () async throws(Failure) -> T) async throws(Failure) -> T where Failure : Error",
    "language" : "swift"
  },
  "id" : "0D62A7E3-9ACC-4F8A-995A-1B394205846B",
  "kind" : "function",
  "language" : "swift",
  "module" : "Swift",
  "overview" : "## Return Value\n\nThe value returned from the `operation` closure\n\n### Task executor preference semantics\n\nTask executors influence *where* nonisolated asynchronous functions, and default actor methods execute. The preferred executor will be used whenever possible, rather than hopping to the global concurrent pool.\n\nFor an in depth discussion of this topic, see [doc:\/\/com.apple.Swift\/documentation\/Swift\/TaskExecutor].\n\n### Disabling task executor preference\n\nPassing `nil` as executor means disabling any preference preference (if it was set) and the task hierarchy will execute without any executor preference until a different preference is set.\n\n### Asynchronous function execution semantics in presence of task executor preferences\n\nThe following diagram illustrates on which executor an `async` function will execute, in presence (or lack thereof) a task executor preference.\n\nIn short, without a task executor preference, `nonisolated async` functions will execute on the global concurrent executor. If a task executor preference is present, such `nonisolated async` functions will execute on the preferred task executor.\n\nIsolated functions semantically execute on the actor they are isolated to, however if such actor does not declare a custom executor (it is a “default actor”) in presence of a task executor preference, tasks executing on this actor will use the preferred executor as source of threads to run the task, while isolated on the actor.\n\n### Example",
  "platforms" : [
    "iOS",
    "iPadOS",
    "Mac Catalyst",
    "macOS",
    "tvOS",
    "visionOS",
    "watchOS"
  ],
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/Swift\/withTaskExecutorPreference(_:isolation:operation:)\ncrawled: 2025-12-03T17:12:17Z\n---\n\n# withTaskExecutorPreference(_:isolation:operation:)\n\n**Function**\n\nConfigure the current task hierarchy’s task executor preference to the passed [doc:\/\/com.apple.Swift\/documentation\/Swift\/TaskExecutor], and execute the passed in closure by immediately hopping to that executor.\n\n## Declaration\n\n```swift\nfunc withTaskExecutorPreference<T, Failure>(_ taskExecutor: (any TaskExecutor)?, isolation: isolated (any Actor)? = #isolation, operation: () async throws(Failure) -> T) async throws(Failure) -> T where Failure : Error\n```\n\n## Parameters\n\n- **taskExecutor**: The executor to use as preferred task executor for this operation, and any child tasks created inside the `operation` closure. If `nil` it is interpreted as “no preference” and calling this method will have no impact on execution semantics of the `operation`\n- **operation**: The operation to execute on the passed executor\n\n## Return Value\n\nThe value returned from the `operation` closure\n\n### Task executor preference semantics\n\nTask executors influence *where* nonisolated asynchronous functions, and default actor methods execute. The preferred executor will be used whenever possible, rather than hopping to the global concurrent pool.\n\nFor an in depth discussion of this topic, see [doc:\/\/com.apple.Swift\/documentation\/Swift\/TaskExecutor].\n\n### Disabling task executor preference\n\nPassing `nil` as executor means disabling any preference preference (if it was set) and the task hierarchy will execute without any executor preference until a different preference is set.\n\n### Asynchronous function execution semantics in presence of task executor preferences\n\nThe following diagram illustrates on which executor an `async` function will execute, in presence (or lack thereof) a task executor preference.\n\n```swift\n[ func \/ closure ] - \/* where should it execute? *\/\n                              |\n                    +--------------+          +===========================+\n          +-------- | is isolated? | - yes -> | actor has unownedExecutor |\n          |         +--------------+          +===========================+\n          |                                       |                |\n          |                                      yes               no\n          |                                       |                |\n          |                                       v                v\n          |                  +=======================+    \/* task executor preference? *\/\n          |                  | on specified executor |        |                   |\n          |                  +=======================+       yes                  no\n          |                                                   |                   |\n          |                                                   |                   v\n          |                                                   |    +==========================+\n          |                                                   |    | default (actor) executor |\n          |                                                   v    +==========================+\n          v                                     +==============================+\n \/* task executor preference? *\/ ---- yes ----> | on Task's preferred executor |\n          |                                     +==============================+\n          no\n          |\n          v\n +===============================+\n | on global concurrent executor |\n +===============================+\n```\n\nIn short, without a task executor preference, `nonisolated async` functions will execute on the global concurrent executor. If a task executor preference is present, such `nonisolated async` functions will execute on the preferred task executor.\n\nIsolated functions semantically execute on the actor they are isolated to, however if such actor does not declare a custom executor (it is a “default actor”) in presence of a task executor preference, tasks executing on this actor will use the preferred executor as source of threads to run the task, while isolated on the actor.\n\n### Example\n\n```swift\nTask {\n  \/\/ case 0) \"no task executor preference\"\n\n  \/\/ default task executor\n  \/\/ ...\n  await SomeDefaultActor().hello() \/\/ default executor\n  await ActorWithCustomExecutor().hello() \/\/ 'hello' executes on actor's custom executor\n\n  \/\/ child tasks execute on default executor:\n  async let x = ...\n  await withTaskGroup(of: Int.self) { group in g.addTask { 7 } }\n\n  await withTaskExecutorPreference(specific) {\n    \/\/ case 1) 'specific' task executor preference\n\n    \/\/ 'specific' task executor\n    \/\/ ...\n    await SomeDefaultActor().hello() \/\/ 'hello' executes on 'specific' executor\n    await ActorWithCustomExecutor().hello() \/\/ 'hello' executes on actor's custom executor (same as case 0)\n\n    \/\/ child tasks execute on 'specific' task executor:\n    async let x = ...\n    await withTaskGroup(of: Int.self) { group in\n      group.addTask { 7 } \/\/ child task executes on 'specific' executor\n      group.addTask(executorPreference: globalConcurrentExecutor) { 13 } \/\/ child task executes on global concurrent executor\n    }\n\n    \/\/ disable the task executor preference:\n    await withTaskExecutorPreference(globalConcurrentExecutor) {\n      \/\/ equivalent to case 0) preference is globalConcurrentExecutor\n\n      \/\/ default task executor\n      \/\/ ...\n      await SomeDefaultActor().hello() \/\/ default executor (same as case 0)\n      await ActorWithCustomExecutor().hello() \/\/ 'hello' executes on actor's custom executor (same as case 0)\n\n      \/\/ child tasks execute on default executor (same as case 0):\n      async let x = ...\n      await withTaskGroup(of: Int.self) { group in group.addTask { 7 } }\n    }\n  }\n}\n```\n\n\n\n\n\n## Executors\n\n- **Executor**: A service that can execute jobs.\n- **ExecutorJob**: A unit of schedulable work.\n- **SerialExecutor**: A service that executes jobs.\n- **TaskExecutor**: An executor that may be used as preferred executor by a task.\n- **PartialAsyncTask**\n- **UnownedJob**: A unit of schedulable work.\n- **JobPriority**: The priority of this job.\n- **UnownedSerialExecutor**: An unowned reference to a serial executor (a `SerialExecutor` value).\n- **UnownedTaskExecutor**\n- **globalConcurrentExecutor**: The global concurrent executor that is used by default for Swift Concurrency tasks.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "A service that can execute jobs.",
          "name" : "Executor",
          "url" : "https:\/\/developer.apple.com\/documentation\/Swift\/Executor"
        },
        {
          "description" : "A unit of schedulable work.",
          "name" : "ExecutorJob",
          "url" : "https:\/\/developer.apple.com\/documentation\/Swift\/ExecutorJob"
        },
        {
          "description" : "A service that executes jobs.",
          "name" : "SerialExecutor",
          "url" : "https:\/\/developer.apple.com\/documentation\/Swift\/SerialExecutor"
        },
        {
          "description" : "An executor that may be used as preferred executor by a task.",
          "name" : "TaskExecutor",
          "url" : "https:\/\/developer.apple.com\/documentation\/Swift\/TaskExecutor"
        },
        {
          "description" : "",
          "name" : "PartialAsyncTask",
          "url" : "https:\/\/developer.apple.com\/documentation\/Swift\/PartialAsyncTask"
        },
        {
          "description" : "A unit of schedulable work.",
          "name" : "UnownedJob",
          "url" : "https:\/\/developer.apple.com\/documentation\/Swift\/UnownedJob"
        },
        {
          "description" : "The priority of this job.",
          "name" : "JobPriority",
          "url" : "https:\/\/developer.apple.com\/documentation\/Swift\/JobPriority"
        },
        {
          "description" : "An unowned reference to a serial executor (a `SerialExecutor` value).",
          "name" : "UnownedSerialExecutor",
          "url" : "https:\/\/developer.apple.com\/documentation\/Swift\/UnownedSerialExecutor"
        },
        {
          "description" : "",
          "name" : "UnownedTaskExecutor",
          "url" : "https:\/\/developer.apple.com\/documentation\/Swift\/UnownedTaskExecutor"
        },
        {
          "description" : "The global concurrent executor that is used by default for Swift Concurrency tasks.",
          "name" : "globalConcurrentExecutor",
          "url" : "https:\/\/developer.apple.com\/documentation\/Swift\/globalConcurrentExecutor"
        }
      ],
      "title" : "Executors"
    }
  ],
  "source" : "appleJSON",
  "title" : "withTaskExecutorPreference(_:isolation:operation:)",
  "url" : "https:\/\/developer.apple.com\/documentation\/Swift\/withTaskExecutorPreference(_:isolation:operation:)"
}