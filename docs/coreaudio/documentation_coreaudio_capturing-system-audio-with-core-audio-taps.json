{
  "abstract" : "Use a Core Audio tap to capture outgoing audio from a process or group of processes.",
  "codeExamples" : [
    {
      "code" : "\/\/ Create a tap description.\nlet description = CATapDescription()\n\n\/\/ Fill out the description properties with the tap configuration from the UI.\ndescription.name = tapConfiguration.name\ndescription.processes = Array(tapConfiguration.processes)\ndescription.isPrivate = tapConfiguration.isPrivate\ndescription.muteBehavior = CATapMuteBehavior(rawValue: tapConfiguration.mute.rawValue) ?? description.muteBehavior\ndescription.isMixdown = tapConfiguration.mixdown == .mono || tapConfiguration.mixdown == .stereo\ndescription.isMono = tapConfiguration.mixdown == .mono\ndescription.isExclusive = tapConfiguration.exclusive\ndescription.deviceUID = tapConfiguration.device\ndescription.stream = tapConfiguration.streamIndex\n\n\/\/ Ask the HAL to create a new tap and put the resulting `AudioObjectID` in `tapID`.\nvar tapID = AudioObjectID(kAudioObjectUnknown)\nAudioHardwareCreateProcessTap(description, &tapID)",
      "language" : "swift"
    },
    {
      "code" : "let description = [kAudioAggregateDeviceNameKey: \"Sample Aggregate Audio Device\", kAudioAggregateDeviceUIDKey: UUID().uuidString]\nvar id: AudioObjectID = 0\nAudioHardwareCreateAggregateDevice(description as CFDictionary, &id)",
      "language" : "swift"
    },
    {
      "code" : "\/\/ Get the UID of the audio tap.\nvar propertyAddress = getPropertyAddress(selector: kAudioTapPropertyUID)\nvar propertySize = UInt32(MemoryLayout<CFString>.stride)\nvar tapUID: CFString = \"\" as CFString\n_ = withUnsafeMutablePointer(to: &tapUID) { tapUID in\n    AudioObjectGetPropertyData(tapID, &propertyAddress, 0, nil, &propertySize, tapUID)\n}",
      "language" : "swift"
    },
    {
      "code" : "var propertyAddress = getPropertyAddress(selector: kAudioAggregateDevicePropertyTapList)\nvar propertySize: UInt32 = 0\nAudioObjectGetPropertyDataSize(self.id, &propertyAddress, 0, nil, &propertySize)\nvar list: CFArray? = nil\n_ = withUnsafeMutablePointer(to: &list) { list in\n    AudioObjectGetPropertyData(tapID, &propertyAddress, 0, nil, &propertySize, list)\n}\n\nif var listAsArray = list as? [CFString] {\n    \/\/ Add the new object ID if it's not already in the list.\n    if !listAsArray.contains(tapUID as CFString) {\n        listAsArray.append(tapUID as CFString)\n        propertySize += UInt32(MemoryLayout<CFString>.stride)\n    }\n    \n    \/\/ Set the list back on the aggregate device.\n    list = listAsArray as CFArray\n    _ = withUnsafeMutablePointer(to: &list) { list in\n        AudioObjectSetPropertyData(aggregateDeviceID, &propertyAddress, 0, nil, propertySize, list)\n    }\n}",
      "language" : "swift"
    }
  ],
  "contentHash" : "67503141a850eb4a6aaeeb01cc743134d88ad8dd445dd80211fa19a1a3918905",
  "crawledAt" : "2025-12-02T15:47:39Z",
  "id" : "888DF854-564C-4FC1-BEAE-2FC3AB65C7A6",
  "kind" : "unknown",
  "language" : "swift",
  "module" : "Core Audio",
  "overview" : "## Overview\n\nThis sample code project shows you how to use a tap as an input in a HAL aggregate device, just like a microphone. An audio tap object can specify which outputs it captures from a process or group of processes, as well as different mixdown options (mono, stereo, and so on). Taps can be public (visible to all users), or private (only visible inside the process that created the tap). Taps can also mute the process output so that the process will no longer play to the speaker or selected audio device, and all process output will go to the tap.\n\n### Create a tap and an aggregate device\n\nYou create a tap by passing a [doc:\/\/com.apple.coreaudio\/documentation\/CoreAudio\/CATapDescription] to [doc:\/\/com.apple.coreaudio\/documentation\/CoreAudio\/AudioHardwareCreateProcessTap(_:_:)]. This returns an `AudioObjectID` for the new tap object. You can destroy a tap using [doc:\/\/com.apple.coreaudio\/documentation\/CoreAudio\/AudioHardwareDestroyProcessTap(_:)]:\n\nYou similarly create an aggregate device by passing a `CFDictionary` to [doc:\/\/com.apple.coreaudio\/documentation\/CoreAudio\/AudioHardwareCreateAggregateDevice(_:_:)], and destroy it using [doc:\/\/com.apple.coreaudio\/documentation\/CoreAudio\/AudioHardwareDestroyAggregateDevice(_:)].\n\n### Add a tap to an aggregate device\n\nTo use a tap as an input source, add it to an aggregate device that you configure for playback. First get the tap’s unique identifier by passing the `kAudioTapPropertyUID` selector and the tap’s audio object ID to [doc:\/\/com.apple.coreaudio\/documentation\/CoreAudio\/AudioObjectGetPropertyData(_:_:_:_:_:_:)]:\n\nThen use the `kAudioAggregateDevicePropertyTapList` selector to get and set the list of taps in an aggregate device. To add a tap, pass the tap’s audio object ID and a `CFArray` of `CFString` objects containing the tap’s unique identifier to [doc:\/\/com.apple.coreaudio\/documentation\/CoreAudio\/AudioObjectSetPropertyData(_:_:_:_:_:_:)]:\n\n### Configure the sample code project\n\nBefore you run the sample code project in Xcode, ensure that you’re using macOS 14.2 or later.\n\nThe first time you start recording from an aggregate device that contains a tap, the system prompts you to grant the app system audio recording permission.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/CoreAudio\/capturing-system-audio-with-core-audio-taps\ncrawled: 2025-12-02T15:47:39Z\n---\n\n# Capturing system audio with Core Audio taps\n\n**Sample Code**\n\nUse a Core Audio tap to capture outgoing audio from a process or group of processes.\n\n## Overview\n\nThis sample code project shows you how to use a tap as an input in a HAL aggregate device, just like a microphone. An audio tap object can specify which outputs it captures from a process or group of processes, as well as different mixdown options (mono, stereo, and so on). Taps can be public (visible to all users), or private (only visible inside the process that created the tap). Taps can also mute the process output so that the process will no longer play to the speaker or selected audio device, and all process output will go to the tap.\n\n### Create a tap and an aggregate device\n\nYou create a tap by passing a [doc:\/\/com.apple.coreaudio\/documentation\/CoreAudio\/CATapDescription] to [doc:\/\/com.apple.coreaudio\/documentation\/CoreAudio\/AudioHardwareCreateProcessTap(_:_:)]. This returns an `AudioObjectID` for the new tap object. You can destroy a tap using [doc:\/\/com.apple.coreaudio\/documentation\/CoreAudio\/AudioHardwareDestroyProcessTap(_:)]:\n\n```swift\n\/\/ Create a tap description.\nlet description = CATapDescription()\n\n\/\/ Fill out the description properties with the tap configuration from the UI.\ndescription.name = tapConfiguration.name\ndescription.processes = Array(tapConfiguration.processes)\ndescription.isPrivate = tapConfiguration.isPrivate\ndescription.muteBehavior = CATapMuteBehavior(rawValue: tapConfiguration.mute.rawValue) ?? description.muteBehavior\ndescription.isMixdown = tapConfiguration.mixdown == .mono || tapConfiguration.mixdown == .stereo\ndescription.isMono = tapConfiguration.mixdown == .mono\ndescription.isExclusive = tapConfiguration.exclusive\ndescription.deviceUID = tapConfiguration.device\ndescription.stream = tapConfiguration.streamIndex\n\n\/\/ Ask the HAL to create a new tap and put the resulting `AudioObjectID` in `tapID`.\nvar tapID = AudioObjectID(kAudioObjectUnknown)\nAudioHardwareCreateProcessTap(description, &tapID)\n```\n\nYou similarly create an aggregate device by passing a `CFDictionary` to [doc:\/\/com.apple.coreaudio\/documentation\/CoreAudio\/AudioHardwareCreateAggregateDevice(_:_:)], and destroy it using [doc:\/\/com.apple.coreaudio\/documentation\/CoreAudio\/AudioHardwareDestroyAggregateDevice(_:)].\n\n```swift\nlet description = [kAudioAggregateDeviceNameKey: \"Sample Aggregate Audio Device\", kAudioAggregateDeviceUIDKey: UUID().uuidString]\nvar id: AudioObjectID = 0\nAudioHardwareCreateAggregateDevice(description as CFDictionary, &id)\n```\n\n### Add a tap to an aggregate device\n\nTo use a tap as an input source, add it to an aggregate device that you configure for playback. First get the tap’s unique identifier by passing the `kAudioTapPropertyUID` selector and the tap’s audio object ID to [doc:\/\/com.apple.coreaudio\/documentation\/CoreAudio\/AudioObjectGetPropertyData(_:_:_:_:_:_:)]:\n\n```swift\n\/\/ Get the UID of the audio tap.\nvar propertyAddress = getPropertyAddress(selector: kAudioTapPropertyUID)\nvar propertySize = UInt32(MemoryLayout<CFString>.stride)\nvar tapUID: CFString = \"\" as CFString\n_ = withUnsafeMutablePointer(to: &tapUID) { tapUID in\n    AudioObjectGetPropertyData(tapID, &propertyAddress, 0, nil, &propertySize, tapUID)\n}\n```\n\nThen use the `kAudioAggregateDevicePropertyTapList` selector to get and set the list of taps in an aggregate device. To add a tap, pass the tap’s audio object ID and a `CFArray` of `CFString` objects containing the tap’s unique identifier to [doc:\/\/com.apple.coreaudio\/documentation\/CoreAudio\/AudioObjectSetPropertyData(_:_:_:_:_:_:)]:\n\n```swift\nvar propertyAddress = getPropertyAddress(selector: kAudioAggregateDevicePropertyTapList)\nvar propertySize: UInt32 = 0\nAudioObjectGetPropertyDataSize(self.id, &propertyAddress, 0, nil, &propertySize)\nvar list: CFArray? = nil\n_ = withUnsafeMutablePointer(to: &list) { list in\n    AudioObjectGetPropertyData(tapID, &propertyAddress, 0, nil, &propertySize, list)\n}\n\nif var listAsArray = list as? [CFString] {\n    \/\/ Add the new object ID if it's not already in the list.\n    if !listAsArray.contains(tapUID as CFString) {\n        listAsArray.append(tapUID as CFString)\n        propertySize += UInt32(MemoryLayout<CFString>.stride)\n    }\n    \n    \/\/ Set the list back on the aggregate device.\n    list = listAsArray as CFArray\n    _ = withUnsafeMutablePointer(to: &list) { list in\n        AudioObjectSetPropertyData(aggregateDeviceID, &propertyAddress, 0, nil, propertySize, list)\n    }\n}\n```\n\n### Configure the sample code project\n\nBefore you run the sample code project in Xcode, ensure that you’re using macOS 14.2 or later.\n\n\n\nThe first time you start recording from an aggregate device that contains a tap, the system prompts you to grant the app system audio recording permission.\n\n## Drivers\n\n- **Creating an Audio Server Driver Plug-in**: Build a virtual audio device by creating a custom driver plug-in.\n- **Building an Audio Server Plug-in and Driver Extension**: Create a plug-in and driver extension to support an audio device in macOS.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Build a virtual audio device by creating a custom driver plug-in.",
          "name" : "Creating an Audio Server Driver Plug-in",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreAudio\/creating-an-audio-server-driver-plug-in"
        },
        {
          "description" : "Create a plug-in and driver extension to support an audio device in macOS.",
          "name" : "Building an Audio Server Plug-in and Driver Extension",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreAudio\/building-an-audio-server-plug-in-and-driver-extension"
        }
      ],
      "title" : "Drivers"
    }
  ],
  "source" : "appleJSON",
  "title" : "Capturing system audio with Core Audio taps",
  "url" : "https:\/\/developer.apple.com\/documentation\/CoreAudio\/capturing-system-audio-with-core-audio-taps"
}