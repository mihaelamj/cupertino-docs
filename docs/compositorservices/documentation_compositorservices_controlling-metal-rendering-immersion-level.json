{
  "abstract" : "Enable flexible immersive rendering by supporting progressive immersion when rendering your Metal content.",
  "codeExamples" : [
    {
      "code" : "ImmersiveSpace(id: \"MyImmersiveSpace\") {\n    CompositorLayer(configuration: MyConfiguration()) { @MainActor layerRenderer in\n        Renderer.startRenderLoop(layerRenderer)\n    }\n}.immersionStyle(selection: $immersionStyle, in: .progressive, .full)",
      "language" : "swift"
    },
    {
      "code" : "    MyConfiguration: CompositorLayerConfiguration {\n        func makeConfiguration(capabilities: LayerRenderer.Capabilities,\n        configuration: inout LayerRenderer.Configuration)\n        \/\/ Configure other aspects of LayerRenderer.\n\n            if configuration.layout == .layered {\n                let stencilFormat: MTLPixelFormat = .stencil8\n                if capabilities.drawableRenderContextSupportedStencilFormats.contains(stencilFormat) {\n                    configuration.drawableRenderContextStencilFormat = stencilFormat\n                }\n            }\n        configuration.drawableRenderContextRasterSampleCount = 1\n        }\n    }\n}",
      "language" : "swift"
    },
    {
      "code" : "struct Renderer {\n    let portalStencilValue: UInt8 = 200 \/\/ Value isn't used in other stencil operations.\n\n    func renderFrame with scene: MyScene, drawable: LayerRenderer.Drawable, commandBuffer: MTLCommandBuffer) {\n        let drawableRenderContext = drawable.addRenderContext(commandBuffer: commandBuffer)\n        let renderEncoder = configureRenderPass(commandBuffer: commandBuffer)\n\n        drawableRenderContext.drawMaskOnStencilAttachment(commandEncoder: renderEncoder, value: portalstencilValue)\n        renderEncoder.setStencilReferenceValue(UInt32(portalStencilValue))\n        scene.render(to: drawable, renderEncoder: renderEncoder)\n        drawableRenderContext.endEncoding(commandEncoder: commandEncoder)\n        drawable.encodePresent(commandBuffer: commandBuffer)\n    }\n}",
      "language" : "swift"
    }
  ],
  "contentHash" : "f269d6fa2b70658670b260e579446d3330d78f3bbd410b33de513232c1052216",
  "crawledAt" : "2025-12-04T17:51:24Z",
  "id" : "FFA595AC-10A3-4677-8344-0527BFCEC7E6",
  "kind" : "article",
  "language" : "swift",
  "module" : "Compositor Services",
  "overview" : "## Overview\n\nImmersion is the degeree to which your rendered content from your app replaces the viewing area. Compositor Services supports full and mixed immersion styles by default. People using your app can control the immersion level by rotating the Digital Crown on Apple Vision Pro. For some content, people may prefer progressive immersion, where the viewing area is only partially replaced by rendered content, for viewing comfort. This helps them retain the context of their environment when they’re viewing content with complex scenes with movement.\n\n## Enable progressive immersion\n\nTo support progressive immersion requires some additional adoption from your app provide a mask that represents the progressive immersion level. When you attach the mask to the same render encoder where your content renders the system provides performant, single pass rendering. The mask also allows the system to avoid rendering content outside of the masked area for additional performance savings. The system provides support for smoothing and fading the edge of the progressive portal into your surroundings.\n\nSet the possible immersion styles to ensure your immersive space supports progressive immersion.\n\nAfter allowing both progressive and full immersion styles, your app can switch between them.\n\n## Configure the compositor layer\n\nAfter your app supports progressive immersion, configure the compositor layer. Check that the layer capabilities support your preferred stencil format with `drawableRenderContextSupportedStencilformats`. Set the `drawableRenderContextStencilFormat` property for the stencil format to the layer configuration. Configure the `drawableRenderContextRasterSampleCount` with the appropriate sample count depending on your app’s use of multisample antialiasing:\n\n## Apply a stencil mask\n\nApply the portal stencil mask to the layer render drawable by adding a render context to your command buffer with `addRenderContext(commandBuffer:)`. This step is a requirement for the system to efficiently draw the faded edges of the portal over your rendered 3D content. Use the same command buffer for your subsequent drawing commands. Draw your mask on the stencil with `drawMaskOnStencilAttachment(commandEncoder:value:)` to prevent invisible pixels from rendering and then select an available stencil value. After rendering the scene, use `endEncoding(commandEncoder:)` to cease rendering, rather than directly ending the command encoder. This allows the portal effect to apply efficiently over your content.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/CompositorServices\/controlling-metal-rendering-immersion-level\ncrawled: 2025-12-04T17:51:24Z\n---\n\n# Controlling Metal rendering immersion level\n\n**Article**\n\nEnable flexible immersive rendering by supporting progressive immersion when rendering your Metal content.\n\n## Overview\n\nImmersion is the degeree to which your rendered content from your app replaces the viewing area. Compositor Services supports full and mixed immersion styles by default. People using your app can control the immersion level by rotating the Digital Crown on Apple Vision Pro. For some content, people may prefer progressive immersion, where the viewing area is only partially replaced by rendered content, for viewing comfort. This helps them retain the context of their environment when they’re viewing content with complex scenes with movement.\n\n## Enable progressive immersion\n\nTo support progressive immersion requires some additional adoption from your app provide a mask that represents the progressive immersion level. When you attach the mask to the same render encoder where your content renders the system provides performant, single pass rendering. The mask also allows the system to avoid rendering content outside of the masked area for additional performance savings. The system provides support for smoothing and fading the edge of the progressive portal into your surroundings.\n\nSet the possible immersion styles to ensure your immersive space supports progressive immersion.\n\n```swift\nImmersiveSpace(id: \"MyImmersiveSpace\") {\n    CompositorLayer(configuration: MyConfiguration()) { @MainActor layerRenderer in\n        Renderer.startRenderLoop(layerRenderer)\n    }\n}.immersionStyle(selection: $immersionStyle, in: .progressive, .full)\n```\n\nAfter allowing both progressive and full immersion styles, your app can switch between them.\n\n## Configure the compositor layer\n\nAfter your app supports progressive immersion, configure the compositor layer. Check that the layer capabilities support your preferred stencil format with `drawableRenderContextSupportedStencilformats`. Set the `drawableRenderContextStencilFormat` property for the stencil format to the layer configuration. Configure the `drawableRenderContextRasterSampleCount` with the appropriate sample count depending on your app’s use of multisample antialiasing:\n\n```swift\n    MyConfiguration: CompositorLayerConfiguration {\n        func makeConfiguration(capabilities: LayerRenderer.Capabilities,\n        configuration: inout LayerRenderer.Configuration)\n        \/\/ Configure other aspects of LayerRenderer.\n\n            if configuration.layout == .layered {\n                let stencilFormat: MTLPixelFormat = .stencil8\n                if capabilities.drawableRenderContextSupportedStencilFormats.contains(stencilFormat) {\n                    configuration.drawableRenderContextStencilFormat = stencilFormat\n                }\n            }\n        configuration.drawableRenderContextRasterSampleCount = 1\n        }\n    }\n}\n```\n\n\n\n## Apply a stencil mask\n\nApply the portal stencil mask to the layer render drawable by adding a render context to your command buffer with `addRenderContext(commandBuffer:)`. This step is a requirement for the system to efficiently draw the faded edges of the portal over your rendered 3D content. Use the same command buffer for your subsequent drawing commands. Draw your mask on the stencil with `drawMaskOnStencilAttachment(commandEncoder:value:)` to prevent invisible pixels from rendering and then select an available stencil value. After rendering the scene, use `endEncoding(commandEncoder:)` to cease rendering, rather than directly ending the command encoder. This allows the portal effect to apply efficiently over your content.\n\n```swift\nstruct Renderer {\n    let portalStencilValue: UInt8 = 200 \/\/ Value isn't used in other stencil operations.\n\n    func renderFrame with scene: MyScene, drawable: LayerRenderer.Drawable, commandBuffer: MTLCommandBuffer) {\n        let drawableRenderContext = drawable.addRenderContext(commandBuffer: commandBuffer)\n        let renderEncoder = configureRenderPass(commandBuffer: commandBuffer)\n\n        drawableRenderContext.drawMaskOnStencilAttachment(commandEncoder: renderEncoder, value: portalstencilValue)\n        renderEncoder.setStencilReferenceValue(UInt32(portalStencilValue))\n        scene.render(to: drawable, renderEncoder: renderEncoder)\n        drawableRenderContext.endEncoding(commandEncoder: commandEncoder)\n        drawable.encodePresent(commandBuffer: commandBuffer)\n    }\n}\n```\n\n",
  "sections" : [

  ],
  "source" : "appleJSON",
  "title" : "Controlling Metal rendering immersion level",
  "url" : "https:\/\/developer.apple.com\/documentation\/CompositorServices\/controlling-metal-rendering-immersion-level"
}