{
  "abstract" : "Set up the classes that manage and persist your app’s objects.",
  "codeExamples" : [
    {
      "code" : "\/\/ Define an observable class to encapsulate all Core Data-related functionality.\nclass CoreDataStack: ObservableObject {\n    static let shared = CoreDataStack()\n    \n    \/\/ Create a persistent container as a lazy variable to defer instantiation until its first use.\n    lazy var persistentContainer: NSPersistentContainer = {\n        \n        \/\/ Pass the data model filename to the container’s initializer.\n        let container = NSPersistentContainer(name: \"DataModel\")\n        \n        \/\/ Load any persistent stores, which creates a store if none exists.\n        container.loadPersistentStores { _, error in\n            if let error {\n                \/\/ Handle the error appropriately. However, it's useful to use\n                \/\/ `fatalError(_:file:line:)` during development.\n                fatalError(\"Failed to load persistent stores: \\(error.localizedDescription)\")\n            }\n        }\n        return container\n    }()\n        \n    private init() { }\n}",
      "language" : "swift"
    },
    {
      "code" : "@main\nstruct ShoppingListApp: App {\n    \/\/ Create an observable instance of the Core Data stack.\n    @StateObject private var coreDataStack = CoreDataStack.shared\n    \n    var body: some Scene {\n        WindowGroup {\n            ContentView()\n            \/\/ Inject the persistent container's managed object context\n            \/\/ into the environment.\n                .environment(\\.managedObjectContext,\n                              coreDataStack.persistentContainer.viewContext)\n        }\n    }\n}",
      "language" : "swift"
    },
    {
      "code" : "\/\/#-code-listing(AccessManagedObjectContext) [Access the managed object context]\nstruct ContentView: View {\n    \/\/ Get a reference to the managed object context from the environment.\n    @Environment(\\.managedObjectContext) private var viewContext\n\n    \/\/ Remaining implementation of the user interface.\n}",
      "language" : "swift"
    },
    {
      "code" : "extension CoreDataStack {\n    \/\/ Add a convenience method to commit changes to the store.\n    func save() {\n        \/\/ Verify that the context has uncommitted changes.\n        guard persistentContainer.viewContext.hasChanges else { return }\n        \n        do {\n            \/\/ Attempt to save changes.\n            try persistentContainer.viewContext.save()\n        } catch {\n            \/\/ Handle the error appropriately.\n            print(\"Failed to save the context:\", error.localizedDescription)\n        }\n    }\n    \n    func delete(item: ShoppingItem) {\n        persistentContainer.viewContext.delete(item)\n        save()\n    }\n}",
      "language" : "swift"
    }
  ],
  "contentHash" : "c7cb64c8b4802abedb72adb2991ca2a83d797da9ac82f1e03b121ae078c00daf",
  "crawledAt" : "2025-12-04T20:33:57Z",
  "id" : "056CB66D-B560-4469-8EDC-06AC793DCFA2",
  "kind" : "article",
  "language" : "swift",
  "module" : "Core Data",
  "overview" : "## Overview\n\nAfter you create a data model file as described in [doc:\/\/com.apple.coredata\/documentation\/CoreData\/creating-a-core-data-model], set up the classes that collaboratively support your app’s model layer. These classes are collectively referred to as the Core Data stack.\n\n\n\n### Initialize a Persistent Container\n\nTypically, you initialize a Core Data stack as a singleton:\n\nOnce created, the persistent container holds references to the model, context, and store coordinator instances in its [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSPersistentContainer\/managedObjectModel], [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSPersistentContainer\/viewContext], and [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSPersistentContainer\/persistentStoreCoordinator] properties, respectively.\n\nYou can now use the Core Data stack througout your app.\n\n### Inject the managed object context\n\nCreate an instance of the Core Data stack and inject its managed object context into your app environment:\n\nUse an environment property wrapper to access the managed object context in your views:\n\n### Add functionality to the stack\n\nYour Core Data stack is a convenient place to put related code, such as methods to save changes and delete managed objects in the persistent store:\n\nThe `save` method improves performance by saving the context only when there are changes.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/coredata\/setting-up-a-core-data-stack\ncrawled: 2025-12-04T20:33:57Z\n---\n\n# Setting up a Core Data stack\n\n**Article**\n\nSet up the classes that manage and persist your app’s objects.\n\n## Overview\n\nAfter you create a data model file as described in [doc:\/\/com.apple.coredata\/documentation\/CoreData\/creating-a-core-data-model], set up the classes that collaboratively support your app’s model layer. These classes are collectively referred to as the Core Data stack.\n\n\n\n- An instance of [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSManagedObjectModel] represents your app’s model file describing your app’s types, properties, and relationships.\n- An instance of [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSManagedObjectContext] tracks changes to instances of your app’s types.\n- An instance of [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSPersistentStoreCoordinator] saves and fetches instances of your app’s types from stores.\n- An instance of [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSPersistentContainer] sets up the model, context, and store coordinator all at once.\n\n### Initialize a Persistent Container\n\nTypically, you initialize a Core Data stack as a singleton:\n\n```swift\n\/\/ Define an observable class to encapsulate all Core Data-related functionality.\nclass CoreDataStack: ObservableObject {\n    static let shared = CoreDataStack()\n    \n    \/\/ Create a persistent container as a lazy variable to defer instantiation until its first use.\n    lazy var persistentContainer: NSPersistentContainer = {\n        \n        \/\/ Pass the data model filename to the container’s initializer.\n        let container = NSPersistentContainer(name: \"DataModel\")\n        \n        \/\/ Load any persistent stores, which creates a store if none exists.\n        container.loadPersistentStores { _, error in\n            if let error {\n                \/\/ Handle the error appropriately. However, it's useful to use\n                \/\/ `fatalError(_:file:line:)` during development.\n                fatalError(\"Failed to load persistent stores: \\(error.localizedDescription)\")\n            }\n        }\n        return container\n    }()\n        \n    private init() { }\n}\n```\n\nOnce created, the persistent container holds references to the model, context, and store coordinator instances in its [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSPersistentContainer\/managedObjectModel], [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSPersistentContainer\/viewContext], and [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSPersistentContainer\/persistentStoreCoordinator] properties, respectively.\n\nYou can now use the Core Data stack througout your app.\n\n### Inject the managed object context\n\nCreate an instance of the Core Data stack and inject its managed object context into your app environment:\n\n```swift\n@main\nstruct ShoppingListApp: App {\n    \/\/ Create an observable instance of the Core Data stack.\n    @StateObject private var coreDataStack = CoreDataStack.shared\n    \n    var body: some Scene {\n        WindowGroup {\n            ContentView()\n            \/\/ Inject the persistent container's managed object context\n            \/\/ into the environment.\n                .environment(\\.managedObjectContext,\n                              coreDataStack.persistentContainer.viewContext)\n        }\n    }\n}\n```\n\nUse an environment property wrapper to access the managed object context in your views:\n\n```swift\n\/\/#-code-listing(AccessManagedObjectContext) [Access the managed object context]\nstruct ContentView: View {\n    \/\/ Get a reference to the managed object context from the environment.\n    @Environment(\\.managedObjectContext) private var viewContext\n\n    \/\/ Remaining implementation of the user interface.\n}\n```\n\n### Add functionality to the stack\n\nYour Core Data stack is a convenient place to put related code, such as methods to save changes and delete managed objects in the persistent store:\n\n```swift\nextension CoreDataStack {\n    \/\/ Add a convenience method to commit changes to the store.\n    func save() {\n        \/\/ Verify that the context has uncommitted changes.\n        guard persistentContainer.viewContext.hasChanges else { return }\n        \n        do {\n            \/\/ Attempt to save changes.\n            try persistentContainer.viewContext.save()\n        } catch {\n            \/\/ Handle the error appropriately.\n            print(\"Failed to save the context:\", error.localizedDescription)\n        }\n    }\n    \n    func delete(item: ShoppingItem) {\n        persistentContainer.viewContext.delete(item)\n        save()\n    }\n}\n```\n\nThe `save` method improves performance by saving the context only when there are changes.\n\n## Legacy Stack Setup\n\n- **Setting up a Core Data stack manually**: Create the individual components that Core Data requires manually, to support earlier versions of Apple operating systems.\n\n## Essentials\n\n- **Creating a Core Data model**: Define your app’s object structure with a data model file.\n- **Core Data stack**: Manage and persist your app’s model layer.\n- **Handling Different Data Types in Core Data**: Create, store, and present records for a variety of data types.\n- **Linking Data Between Two Core Data Stores**: Organize data in two different stores and implement a link between them.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Create the individual components that Core Data requires manually, to support earlier versions of Apple operating systems.",
          "name" : "Setting up a Core Data stack manually",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreData\/setting-up-a-core-data-stack-manually"
        }
      ],
      "title" : "Legacy Stack Setup"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "Define your app’s object structure with a data model file.",
          "name" : "Creating a Core Data model",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreData\/creating-a-core-data-model"
        },
        {
          "description" : "Manage and persist your app’s model layer.",
          "name" : "Core Data stack",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreData\/core-data-stack"
        },
        {
          "description" : "Create, store, and present records for a variety of data types.",
          "name" : "Handling Different Data Types in Core Data",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreData\/handling-different-data-types-in-core-data"
        },
        {
          "description" : "Organize data in two different stores and implement a link between them.",
          "name" : "Linking Data Between Two Core Data Stores",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreData\/linking-data-between-two-core-data-stores"
        }
      ],
      "title" : "Essentials"
    }
  ],
  "source" : "appleJSON",
  "title" : "Setting up a Core Data stack",
  "url" : "https:\/\/developer.apple.com\/documentation\/coredata\/setting-up-a-core-data-stack"
}