{
  "abstract" : "The key for enabling deferred lightweight migrations.",
  "codeExamples" : [
    {
      "code" : "let options = [\n    \/\/ Enable deferred lightweight migrations.\n    NSPersistentStoreDeferredLightweightMigrationOptionKey: true,\n    \/\/ Enable lightweight migrations.\n    NSMigratePersistentStoresAutomaticallyOption: true,\n    NSInferMappingModelAutomaticallyOption: true\n]\n        \nlet store = coordinator.addPersistentStore(\n    type: .sqlite,\n    at: storeURL,\n    options: options\n)",
      "language" : "swift"
    },
    {
      "code" : "let key = NSPersistentStoreDeferredLightweightMigrationOptionKey\nif let hasMigration = store.metadata[key], hasMigration == true {\n    coordinator.finishDeferredLightweightMigration()\n}",
      "language" : "swift"
    }
  ],
  "contentHash" : "1944e999ef2a0c9c851abec17368538f22ddf3cac1f6b0d60211afe425d5e1b3",
  "crawledAt" : "2025-12-01T14:43:00Z",
  "declaration" : {
    "code" : "let NSPersistentStoreDeferredLightweightMigrationOptionKey: String",
    "language" : "swift"
  },
  "id" : "04A8AC37-98DB-47DC-A960-96EB3677C2CC",
  "kind" : "unknown",
  "module" : "Core Data",
  "overview" : "## Discussion\n\nAs your managed object model changes, Core Data can use lightweight migrations to synchronize the underlying store data with those evolving entity definitions. These migrations happen at runtime, so they need to be fast or they can lead to a poor experience, because a migration must complete before your app can continue. Reduce the impact of migrations by deferring expensive cleanup tasks — such as dropping a table — until a more opportune time.\n\nDeferred lightweight migrations are off by default. To enable them, add [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSPersistentStoreDeferredLightweightMigrationOptionKey], with a value of [doc:\/\/com.apple.documentation\/documentation\/Swift\/true], to the options dictionary you provide when adding a persistent store to the coordinator.\n\nAfter you enable deferred lightweight migrations, Core Data continues to perform your lightweight migrations as usual, but defers any time-consuming cleanup tasks that don’t impact the execution of your app. Those tasks still need to run, but you choose when to run them. To determine whether there are deferred tasks to finish, query the store’s metadata with [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSPersistentStoreDeferredLightweightMigrationOptionKey]. If the returned value is [doc:\/\/com.apple.documentation\/documentation\/Swift\/true], execute those tasks using the coordinator. A single migration may defer several distinct tasks and you can execute them all at once using [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSPersistentStoreCoordinator\/finishDeferredLightweightMigration()], or individually using [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSPersistentStoreCoordinator\/finishDeferredLightweightMigrationTask()].",
  "platforms" : [
    "iOS",
    "iPadOS",
    "Mac Catalyst",
    "macOS",
    "tvOS",
    "visionOS",
    "watchOS"
  ],
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/CoreData\/NSPersistentStoreDeferredLightweightMigrationOptionKey\ncrawled: 2025-12-01T14:43:00Z\n---\n\n# NSPersistentStoreDeferredLightweightMigrationOptionKey\n\n**Global Variable**\n\nThe key for enabling deferred lightweight migrations.\n\n## Declaration\n\n```swift\nlet NSPersistentStoreDeferredLightweightMigrationOptionKey: String\n```\n\n## Discussion\n\nAs your managed object model changes, Core Data can use lightweight migrations to synchronize the underlying store data with those evolving entity definitions. These migrations happen at runtime, so they need to be fast or they can lead to a poor experience, because a migration must complete before your app can continue. Reduce the impact of migrations by deferring expensive cleanup tasks — such as dropping a table — until a more opportune time.\n\n\n\nDeferred lightweight migrations are off by default. To enable them, add [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSPersistentStoreDeferredLightweightMigrationOptionKey], with a value of [doc:\/\/com.apple.documentation\/documentation\/Swift\/true], to the options dictionary you provide when adding a persistent store to the coordinator.\n\n```swift\nlet options = [\n    \/\/ Enable deferred lightweight migrations.\n    NSPersistentStoreDeferredLightweightMigrationOptionKey: true,\n    \/\/ Enable lightweight migrations.\n    NSMigratePersistentStoresAutomaticallyOption: true,\n    NSInferMappingModelAutomaticallyOption: true\n]\n        \nlet store = coordinator.addPersistentStore(\n    type: .sqlite,\n    at: storeURL,\n    options: options\n)\n```\n\nAfter you enable deferred lightweight migrations, Core Data continues to perform your lightweight migrations as usual, but defers any time-consuming cleanup tasks that don’t impact the execution of your app. Those tasks still need to run, but you choose when to run them. To determine whether there are deferred tasks to finish, query the store’s metadata with [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSPersistentStoreDeferredLightweightMigrationOptionKey]. If the returned value is [doc:\/\/com.apple.documentation\/documentation\/Swift\/true], execute those tasks using the coordinator. A single migration may defer several distinct tasks and you can execute them all at once using [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSPersistentStoreCoordinator\/finishDeferredLightweightMigration()], or individually using [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSPersistentStoreCoordinator\/finishDeferredLightweightMigrationTask()].\n\n```swift\nlet key = NSPersistentStoreDeferredLightweightMigrationOptionKey\nif let hasMigration = store.metadata[key], hasMigration == true {\n    coordinator.finishDeferredLightweightMigration()\n}\n```\n\n## Deferring a store’s migrations\n\n- **finishDeferredLightweightMigrationTask()**: Executes a single pending task of a deferred lightweight migration.\n- **finishDeferredLightweightMigration()**: Executes all remaining tasks of a deferred lightweight migration.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Executes a single pending task of a deferred lightweight migration.",
          "name" : "finishDeferredLightweightMigrationTask()",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreData\/NSPersistentStoreCoordinator\/finishDeferredLightweightMigrationTask()"
        },
        {
          "description" : "Executes all remaining tasks of a deferred lightweight migration.",
          "name" : "finishDeferredLightweightMigration()",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreData\/NSPersistentStoreCoordinator\/finishDeferredLightweightMigration()"
        }
      ],
      "title" : "Deferring a store’s migrations"
    }
  ],
  "source" : "appleJSON",
  "title" : "NSPersistentStoreDeferredLightweightMigrationOptionKey",
  "url" : "https:\/\/developer.apple.com\/documentation\/CoreData\/NSPersistentStoreDeferredLightweightMigrationOptionKey"
}