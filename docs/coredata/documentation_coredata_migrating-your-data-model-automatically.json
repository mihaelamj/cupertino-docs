{
  "abstract" : "Enable lightweight migrations to keep your data model and the underlying data in a consistent state.",
  "codeExamples" : [
    {
      "code" : "\/\/ Create a persistent store coordinator with a managed object model.\nlet coordinator = NSPersistentStoreCoordinator(managedObjectModel: managedObjectModel)\n\n\/\/ Create a URL to the data store.\n\ndo {\n    \/\/ Set the options to enable lightweight data migrations.\n    let options = [NSMigratePersistentStoresAutomaticallyOption: true,\n                         NSInferMappingModelAutomaticallyOption: true]\n    \n    \/\/ Set the options when you add the store to the coordinator.\n    _ = try coordinator.addPersistentStore(type: .sqlite,\n                                           at: storeURL,\n                                           options: options)\n} catch {\n    \/\/ Handle the error appropriately. It's useful to use\n    \/\/ `fatalError(_:file:line:)` during development.\n    fatalError(\"Failed to add persistent store: \\(error.localizedDescription)\")\n}",
      "language" : "swift"
    }
  ],
  "contentHash" : "4beebbbff05be5cd97f149ff59b6b7ccd486eed6691ef2000c8e1a4ed9cdcd4d",
  "crawledAt" : "2025-12-06T03:05:05Z",
  "id" : "D33512DE-9AF1-4B1E-AEF2-D686ABE5AA5F",
  "kind" : "article",
  "language" : "swift",
  "module" : "Core Data",
  "overview" : "## Overview\n\nCore Data can typically perform an automatic data migration, referred to as lightweight migration. Lightweight migration infers the migration from the differences between the source and the destination managed object models.\n\n### Generating an inferred mapping model\n\nTo perform automatic lightweight migration, Core Data needs to be able to find the source and destination managed object models at runtime. It looks for models in the bundles returned by the [doc:\/\/com.apple.documentation\/documentation\/Foundation\/Bundle\/allBundles] and [doc:\/\/com.apple.documentation\/documentation\/Foundation\/Bundle\/allFrameworks] methods of the [doc:\/\/com.apple.documentation\/documentation\/Foundation\/Bundle] class. Core Data then analyzes the schema changes to persistent entities and properties, and generates an inferred mapping model.\n\nGenerating an inferred mapping model requires changes to fit an obvious migration pattern, for example:\n\n### Managing changes to entities and properties\n\nIf you rename an entity or property, you can set the renaming identifier in the destination model to the name of the corresponding property or entity in the source model. Use the Xcode Data Modeling tool’s property inspector (for either an entity or a property) to set the renaming identifier in the managed object model. For example, you can:\n\nThe renaming identifier creates a canonical name, so set the renaming identifier to the name of the property in the source model (unless that property already has a renaming identifier). This means you can rename a property in version 2 of a model, then rename it again in version 3. The renaming will work correctly going from version 2 to version 3, or from version 1 to version 3.\n\n### Managing changes to relationships\n\nLightweight migration can also manage changes to relationships and to the type of relationship. You can add a new relationship or delete an existing relationship. You can also rename a relationship by using a renaming identifier, just like an attribute.\n\nIn addition, you can change a relationship from a to-one to a to-many, or a nonordered to-many to an ordered (and vice versa).\n\n### Managing changes to hierarchies\n\nYou can add, remove, and rename entities in the hierarchy. You can also create a new parent or child entity and move properties up and down the entity hierarchy. You can move entities out of a hierarchy, but you can’t merge entity hierarchies. If two existing entities don’t share a common parent in the source, they can’t share a common parent in the destination.\n\n### Confirming whether Core Data can infer the model\n\nIf you want to determine in advance whether Core Data can infer the mapping model between the source and destination models without actually doing the work of migration, you can use [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSMappingModel\/inferredMappingModel(forSourceModel:destinationModel:)] method. The method returns the inferred model if Core Data is able to create it; otherwise, it returns `nil`.\n\nIf your data change exceeds the capabilities of automatic migration, you can perform a heavyweight migration (often referred to as manual migration).\n\n### Requesting lightweight migration\n\nYou request automatic lightweight migration using the options dictionary that you pass into [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSPersistentStoreCoordinator\/addPersistentStore(ofType:configurationName:at:options:)]. Set values corresponding to both the [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSMigratePersistentStoresAutomaticallyOption] and the [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSInferMappingModelAutomaticallyOption] keys to [doc:\/\/com.apple.documentation\/documentation\/Swift\/true]:\n\nWith these settings in place, Core Data attempts a lightweight migration when it detects the persistent store no longer matches the current model.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/CoreData\/migrating-your-data-model-automatically\ncrawled: 2025-12-06T03:05:05Z\n---\n\n# Migrating your data model automatically\n\n**Article**\n\nEnable lightweight migrations to keep your data model and the underlying data in a consistent state.\n\n## Overview\n\nCore Data can typically perform an automatic data migration, referred to as lightweight migration. Lightweight migration infers the migration from the differences between the source and the destination managed object models.\n\n### Generating an inferred mapping model\n\nTo perform automatic lightweight migration, Core Data needs to be able to find the source and destination managed object models at runtime. It looks for models in the bundles returned by the [doc:\/\/com.apple.documentation\/documentation\/Foundation\/Bundle\/allBundles] and [doc:\/\/com.apple.documentation\/documentation\/Foundation\/Bundle\/allFrameworks] methods of the [doc:\/\/com.apple.documentation\/documentation\/Foundation\/Bundle] class. Core Data then analyzes the schema changes to persistent entities and properties, and generates an inferred mapping model.\n\nGenerating an inferred mapping model requires changes to fit an obvious migration pattern, for example:\n\n- Addition of an attribute\n- Removal of an attribute\n- A nonoptional attribute becoming optional\n- An optional attribute becoming non-optional, and defining a default value\n- Renaming an entity or property\n\n### Managing changes to entities and properties\n\nIf you rename an entity or property, you can set the renaming identifier in the destination model to the name of the corresponding property or entity in the source model. Use the Xcode Data Modeling tool’s property inspector (for either an entity or a property) to set the renaming identifier in the managed object model. For example, you can:\n\n- Rename a Car entity to Automobile\n- Rename a Car’s color attribute to paintColor\n\nThe renaming identifier creates a canonical name, so set the renaming identifier to the name of the property in the source model (unless that property already has a renaming identifier). This means you can rename a property in version 2 of a model, then rename it again in version 3. The renaming will work correctly going from version 2 to version 3, or from version 1 to version 3.\n\n### Managing changes to relationships\n\nLightweight migration can also manage changes to relationships and to the type of relationship. You can add a new relationship or delete an existing relationship. You can also rename a relationship by using a renaming identifier, just like an attribute.\n\nIn addition, you can change a relationship from a to-one to a to-many, or a nonordered to-many to an ordered (and vice versa).\n\n### Managing changes to hierarchies\n\nYou can add, remove, and rename entities in the hierarchy. You can also create a new parent or child entity and move properties up and down the entity hierarchy. You can move entities out of a hierarchy, but you can’t merge entity hierarchies. If two existing entities don’t share a common parent in the source, they can’t share a common parent in the destination.\n\n### Confirming whether Core Data can infer the model\n\nIf you want to determine in advance whether Core Data can infer the mapping model between the source and destination models without actually doing the work of migration, you can use [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSMappingModel\/inferredMappingModel(forSourceModel:destinationModel:)] method. The method returns the inferred model if Core Data is able to create it; otherwise, it returns `nil`.\n\nIf your data change exceeds the capabilities of automatic migration, you can perform a heavyweight migration (often referred to as manual migration).\n\n### Requesting lightweight migration\n\nYou request automatic lightweight migration using the options dictionary that you pass into [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSPersistentStoreCoordinator\/addPersistentStore(ofType:configurationName:at:options:)]. Set values corresponding to both the [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSMigratePersistentStoresAutomaticallyOption] and the [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSInferMappingModelAutomaticallyOption] keys to [doc:\/\/com.apple.documentation\/documentation\/Swift\/true]:\n\n```swift\n\/\/ Create a persistent store coordinator with a managed object model.\nlet coordinator = NSPersistentStoreCoordinator(managedObjectModel: managedObjectModel)\n\n\/\/ Create a URL to the data store.\n\ndo {\n    \/\/ Set the options to enable lightweight data migrations.\n    let options = [NSMigratePersistentStoresAutomaticallyOption: true,\n                         NSInferMappingModelAutomaticallyOption: true]\n    \n    \/\/ Set the options when you add the store to the coordinator.\n    _ = try coordinator.addPersistentStore(type: .sqlite,\n                                           at: storeURL,\n                                           options: options)\n} catch {\n    \/\/ Handle the error appropriately. It's useful to use\n    \/\/ `fatalError(_:file:line:)` during development.\n    fatalError(\"Failed to add persistent store: \\(error.localizedDescription)\")\n}\n```\n\nWith these settings in place, Core Data attempts a lightweight migration when it detects the persistent store no longer matches the current model.\n\n## Data model migration\n\n- **Staged migrations**: Migrate complex data models containing changes that are incompatible with lightweight migrations.\n- **Manual migrations**: Migrate elaborate data models with changes that go beyond the capabilities of both lightweight and staged migrations.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Migrate complex data models containing changes that are incompatible with lightweight migrations.",
          "name" : "Staged migrations",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreData\/staged-migrations"
        },
        {
          "description" : "Migrate elaborate data models with changes that go beyond the capabilities of both lightweight and staged migrations.",
          "name" : "Manual migrations",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreData\/manual-migrations"
        }
      ],
      "title" : "Data model migration"
    }
  ],
  "source" : "appleJSON",
  "title" : "Migrating your data model automatically",
  "url" : "https:\/\/developer.apple.com\/documentation\/CoreData\/migrating-your-data-model-automatically"
}