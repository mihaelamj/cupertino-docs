{
  "abstract" : "Migrate complex data models containing changes that are incompatible with lightweight migrations.",
  "codeExamples" : [

  ],
  "contentHash" : "be0f19ebe85cd9fa1bdfe77ed2891e6f33e0286b2bfc722eab535dcd2772b98c",
  "crawledAt" : "2025-12-06T03:05:05Z",
  "id" : "85F7AFBB-6EB8-490B-840B-D2CEDA523788",
  "kind" : "collection",
  "language" : "swift",
  "module" : "Core Data",
  "overview" : "## Overview\n\nCore Data uses lightweight migrations to keep the data in your app’s persistent store consistent with the app’s managed object model. A lightweight migration automatically determines the differences between two model versions and generates a mapping model that Core Data then uses to make the necessary changes to the persistent store. Lightweight migrations support a number of common operations, such as adding an entity, removing a relationship, changing a nonoptional attribute to an optional attribute, renaming an entity, and so on.\n\nAs your object model evolves, you may find that the aggregate changes between two model versions exceed the capabilities of lightweight migrations. For example, if you change an optional attribute to be nonoptional, there’s no way for a lightweight migration to infer the default value it needs to assign to any instances of that attribute with a `nil` value.\n\n*Staged lightweight migrations* solve this problem by reducing an incompatible migration into a series of compatible stages. A migration manager runs these stages in a specific order, providing opportunities for you to prepare the persistent store before each stage runs, and perform any cleanup afterward. This enables you to handle scenarios like changing an optional attribute to be nonoptional because you have an opportunity to set any `nil` values to a concrete value before the stage runs.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/CoreData\/staged-migrations\ncrawled: 2025-12-06T03:05:05Z\n---\n\n# Staged migrations\n\n**API Collection**\n\nMigrate complex data models containing changes that are incompatible with lightweight migrations.\n\n## Overview\n\nCore Data uses lightweight migrations to keep the data in your app’s persistent store consistent with the app’s managed object model. A lightweight migration automatically determines the differences between two model versions and generates a mapping model that Core Data then uses to make the necessary changes to the persistent store. Lightweight migrations support a number of common operations, such as adding an entity, removing a relationship, changing a nonoptional attribute to an optional attribute, renaming an entity, and so on.\n\nAs your object model evolves, you may find that the aggregate changes between two model versions exceed the capabilities of lightweight migrations. For example, if you change an optional attribute to be nonoptional, there’s no way for a lightweight migration to infer the default value it needs to assign to any instances of that attribute with a `nil` value.\n\n*Staged lightweight migrations* solve this problem by reducing an incompatible migration into a series of compatible stages. A migration manager runs these stages in a specific order, providing opportunities for you to prepare the persistent store before each stage runs, and perform any cleanup afterward. This enables you to handle scenarios like changing an optional attribute to be nonoptional because you have an opportunity to set any `nil` values to a concrete value before the stage runs.\n\n\n\n## Migration staging\n\n- **NSPersistentStoreStagedMigrationManagerOptionKey**: The key for specifying your staged migration manager.\n- **NSStagedMigrationManager**: An object that handles the migration event loop and provides access to the migrating persistent store.\n\n## Migration stages\n\n- **NSLightweightMigrationStage**: An object that describes a series of models suitable for lightweight migration.\n- **NSCustomMigrationStage**: An object that enables you to participate in the migration between two versions of the same model.\n- **NSMigrationStage**: An abstract base class for describing an individual stage of a migration.\n\n## Data model migration\n\n- **Migrating your data model automatically**: Enable lightweight migrations to keep your data model and the underlying data in a consistent state.\n- **Manual migrations**: Migrate elaborate data models with changes that go beyond the capabilities of both lightweight and staged migrations.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "The key for specifying your staged migration manager.",
          "name" : "NSPersistentStoreStagedMigrationManagerOptionKey",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreData\/NSPersistentStoreStagedMigrationManagerOptionKey"
        },
        {
          "description" : "An object that handles the migration event loop and provides access to the migrating persistent store.",
          "name" : "NSStagedMigrationManager",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreData\/NSStagedMigrationManager"
        }
      ],
      "title" : "Migration staging"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "An object that describes a series of models suitable for lightweight migration.",
          "name" : "NSLightweightMigrationStage",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreData\/NSLightweightMigrationStage"
        },
        {
          "description" : "An object that enables you to participate in the migration between two versions of the same model.",
          "name" : "NSCustomMigrationStage",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreData\/NSCustomMigrationStage"
        },
        {
          "description" : "An abstract base class for describing an individual stage of a migration.",
          "name" : "NSMigrationStage",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreData\/NSMigrationStage"
        }
      ],
      "title" : "Migration stages"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "Enable lightweight migrations to keep your data model and the underlying data in a consistent state.",
          "name" : "Migrating your data model automatically",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreData\/migrating-your-data-model-automatically"
        },
        {
          "description" : "Migrate elaborate data models with changes that go beyond the capabilities of both lightweight and staged migrations.",
          "name" : "Manual migrations",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreData\/manual-migrations"
        }
      ],
      "title" : "Data model migration"
    }
  ],
  "source" : "appleJSON",
  "title" : "Staged migrations",
  "url" : "https:\/\/developer.apple.com\/documentation\/CoreData\/staged-migrations"
}