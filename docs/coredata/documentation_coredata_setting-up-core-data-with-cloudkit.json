{
  "abstract" : "Set up the classes and capabilities that sync your store to CloudKit.",
  "codeExamples" : [
    {
      "code" : "init(inMemory: Bool = false) {\n    container = NSPersistentContainer(name: \"Earthquakes\")\n    if inMemory {\n        container.persistentStoreDescriptions.first!.url = URL(fileURLWithPath: \"\/dev\/null\")\n    }\n    container.loadPersistentStores(completionHandler: { (storeDescription, error) in\n        if let error = error as NSError? {\n            fatalError(\"Unresolved error \\(error), \\(error.userInfo)\")\n        }\n    })\n    container.viewContext.automaticallyMergesChangesFromParent = true\n}",
      "language" : "swift"
    },
    {
      "code" : "    let container = NSPersistentCloudKitContainer(name: \"Earthquakes\")",
      "language" : "swift"
    },
    {
      "code" : "lazy var persistentContainer: NSPersistentCloudKitContainer = {\n    let container = NSPersistentCloudKitContainer(name: \"Earthquakes\")\n    \n    \/\/ Create a store description for a local store.\n    let localStoreLocation = URL(fileURLWithPath: \"\/path\/to\/local.store\")\n    let localStoreDescription =\n        NSPersistentStoreDescription(url: localStoreLocation)\n    localStoreDescription.configuration = \"Local\"\n    \n    \/\/ Create a store description for a CloudKit-backed local store.\n    let cloudStoreLocation = URL(fileURLWithPath: \"\/path\/to\/cloud.store\")\n    let cloudStoreDescription =\n        NSPersistentStoreDescription(url: cloudStoreLocation)\n    cloudStoreDescription.configuration = \"Cloud\"\n\n    \/\/ Set the container options on the cloud store.\n    cloudStoreDescription.cloudKitContainerOptions = \n        NSPersistentCloudKitContainerOptions(\n            containerIdentifier: \"com.my.container\")\n    \n    \/\/ Update the container's list of store descriptions.\n    container.persistentStoreDescriptions = [\n        cloudStoreDescription,\n        localStoreDescription\n    ]\n    \n    \/\/ Load both stores.\n    container.loadPersistentStores { storeDescription, error in\n        guard error == nil else {\n            fatalError(\"Could not load persistent stores. \\(error!)\")\n        }\n    }\n    \n    return container\n}()",
      "language" : "swift"
    }
  ],
  "contentHash" : "1c344d4202d33a1d64b2b94d83659610952af3e30d5e47111d69b6240f1d81bd",
  "crawledAt" : "2025-12-02T18:49:47Z",
  "id" : "B0D360D2-0471-4111-B18D-63D1CCFCC265",
  "kind" : "article",
  "language" : "swift",
  "module" : "Core Data",
  "overview" : "## Overview\n\nTo sync your Core Data store to CloudKit, you enable the CloudKit capability for your app. You also set up the Core Data stack with a persistent container that is capable of managing one or more local persistent stores that are backed by a CloudKit private database.\n\n### Configure a new Xcode project\n\nWhen you create a new project, you specify whether you want to add support for Core Data with CloudKit directly from the project setup interface. The resulting project contains an [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSPersistentCloudKitContainer]. Once you enable CloudKit in your project, you use this container to manage one or more local stores that are backed with a CloudKit database.\n\n\n\nNot all project templates support Core Data. If the template you want to use doesn’t currently support Core Data, add Core Data to the project as described in [doc:\/\/com.apple.coredata\/documentation\/CoreData\/setting-up-a-core-data-stack]. Then add Core Data with CloudKit as described in [doc:\/\/com.apple.coredata\/documentation\/CoreData\/setting-up-core-data-with-cloudkit#Update-an-existing-Xcode-project].\n\n### Enable iCloud\n\nCore Data with CloudKit requires specific entitlements for your app to communicate with the server. If you have created a new template following the steps above, this will be done for you. For an existing app, begin by adding the iCloud capability to your Xcode project.\n\n\n\nAn iCloud section appears on your app’s Signing & Capabilities page.\n\n### Enable CloudKit and push notifications\n\nCore Data with CloudKit uses the CloudKit service to access your team’s containers. To enable CloudKit, configure the iCloud capability.\n\n\n\nXcode checks that your development team supports the Push Notification and iCloud capabilities, then registers your app’s bundle identifier and manages provisioning profiles.\n\n### Enable Remote notifications in the background\n\nFor CloudKit to silently notify your app when new content is available, without presenting a user notification such as an alert, sound, or badge, you need to enable the Remote notifications Background Mode.\n\n\n\nFor more information about silent notifications, see [doc:\/\/com.apple.documentation\/documentation\/UserNotifications\/pushing-background-updates-to-your-app].\n\n### Update an existing Xcode project\n\nIf you want to add Core Data with CloudKit to an app that already uses Core Data, you need to modify both your project’s configuration and some of its code.\n\nFirst, enable iCloud, CloudKit, Push notifications, and Remote notifications in the background as described in the preceding sections. Then, replace your persistent container with an instance of [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSPersistentCloudKitContainer].\n\nFor example, if you created a project from the Multiplatform App template, with the Use Core Data checkbox selected, the following code appeared in the `PersistenceController`:\n\n[doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSPersistentContainer] supports only local persistent stores. To add the ability to sync a local store to a CloudKit database, replace [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSPersistentContainer] with the subclass [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSPersistentCloudKitContainer].\n\n### Manage multiple stores\n\nYou might need to mirror a subset of your data using CloudKit, while keeping other data completely local. You can add configurations to your model to organize your data in separate stores, then choose which stores to sync to CloudKit.\n\n\n\nFor an app without configurations, [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSPersistentCloudKitContainer] matches the first store description with the first CloudKit container identifier in the entitlements.\n\nFor an app with configurations, you need to tell it which CloudKit container, if any, to use with each store. For each of your configurations, make the following changes to your container setup:\n\nThe following example code creates two store descriptions: one for the “Local” configuration, and one for the “Cloud” configuration. It then sets the cloud store description’s [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSPersistentStoreDescription\/cloudKitContainerOptions] to match the store with its CloudKit container. Finally, it updates the container’s list of persistent store descriptions to include all local and cloud-backed store descriptions, and loads both stores.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/CoreData\/setting-up-core-data-with-cloudkit\ncrawled: 2025-12-02T18:49:47Z\n---\n\n# Setting Up Core Data with CloudKit\n\n**Article**\n\nSet up the classes and capabilities that sync your store to CloudKit.\n\n## Overview\n\nTo sync your Core Data store to CloudKit, you enable the CloudKit capability for your app. You also set up the Core Data stack with a persistent container that is capable of managing one or more local persistent stores that are backed by a CloudKit private database.\n\n### Configure a new Xcode project\n\nWhen you create a new project, you specify whether you want to add support for Core Data with CloudKit directly from the project setup interface. The resulting project contains an [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSPersistentCloudKitContainer]. Once you enable CloudKit in your project, you use this container to manage one or more local stores that are backed with a CloudKit database.\n\n1. Choose File > New > Project to create a new project.\n2. Select a project template to use as the starting point for your project, and click Next.\n3. Select the Core Data option for Storage.\n4. Select the Host in Cloudkit checkbox.\n5. Enter any other project details and click Next.\n6. Specify a location for your project and click Create.\n\n\n\nNot all project templates support Core Data. If the template you want to use doesn’t currently support Core Data, add Core Data to the project as described in [doc:\/\/com.apple.coredata\/documentation\/CoreData\/setting-up-a-core-data-stack]. Then add Core Data with CloudKit as described in [doc:\/\/com.apple.coredata\/documentation\/CoreData\/setting-up-core-data-with-cloudkit#Update-an-existing-Xcode-project].\n\n### Enable iCloud\n\nCore Data with CloudKit requires specific entitlements for your app to communicate with the server. If you have created a new template following the steps above, this will be done for you. For an existing app, begin by adding the iCloud capability to your Xcode project.\n\n1. In Project Settings, select the Signing & Capabilities tab.\n2. Make sure that “Automatically manage signing” is selected.\n3. Specify your development team.\n4. Click the + Capability button, then do a search for iCloud in the Add Capability editor and select that capability.\n\n\n\nAn iCloud section appears on your app’s Signing & Capabilities page.\n\n### Enable CloudKit and push notifications\n\nCore Data with CloudKit uses the CloudKit service to access your team’s containers. To enable CloudKit, configure the iCloud capability.\n\n1. In Project Settings, select the Signing & Capabilities tab and find the iCloud section.\n2. Select the CloudKit checkbox. This selection also adds push notifications that notify your app when remote content changes.\n3. Under Containers, add or select a container. For more information about working with CloudKit containers and setting up profiles, see [https:\/\/developer.apple.com\/library\/archive\/documentation\/DataManagement\/Conceptual\/CloudKitQuickStart\/EnablingiCloudandConfiguringCloudKit\/EnablingiCloudandConfiguringCloudKit.html#\/\/apple_ref\/doc\/uid\/TP40014987-CH2].\n\n\n\nXcode checks that your development team supports the Push Notification and iCloud capabilities, then registers your app’s bundle identifier and manages provisioning profiles.\n\n### Enable Remote notifications in the background\n\nFor CloudKit to silently notify your app when new content is available, without presenting a user notification such as an alert, sound, or badge, you need to enable the Remote notifications Background Mode.\n\n1. In Project Settings, select the Signing & Capabilities tab.\n2. Click the + Capability button, then do a search for Background Modes in the Add Capability editor and select that capability.\n3. Select the “Remote notifications” checkbox.\n\n\n\nFor more information about silent notifications, see [doc:\/\/com.apple.documentation\/documentation\/UserNotifications\/pushing-background-updates-to-your-app].\n\n### Update an existing Xcode project\n\nIf you want to add Core Data with CloudKit to an app that already uses Core Data, you need to modify both your project’s configuration and some of its code.\n\nFirst, enable iCloud, CloudKit, Push notifications, and Remote notifications in the background as described in the preceding sections. Then, replace your persistent container with an instance of [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSPersistentCloudKitContainer].\n\nFor example, if you created a project from the Multiplatform App template, with the Use Core Data checkbox selected, the following code appeared in the `PersistenceController`:\n\n```swift\ninit(inMemory: Bool = false) {\n    container = NSPersistentContainer(name: \"Earthquakes\")\n    if inMemory {\n        container.persistentStoreDescriptions.first!.url = URL(fileURLWithPath: \"\/dev\/null\")\n    }\n    container.loadPersistentStores(completionHandler: { (storeDescription, error) in\n        if let error = error as NSError? {\n            fatalError(\"Unresolved error \\(error), \\(error.userInfo)\")\n        }\n    })\n    container.viewContext.automaticallyMergesChangesFromParent = true\n}\n```\n\n[doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSPersistentContainer] supports only local persistent stores. To add the ability to sync a local store to a CloudKit database, replace [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSPersistentContainer] with the subclass [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSPersistentCloudKitContainer].\n\n```swift\n    let container = NSPersistentCloudKitContainer(name: \"Earthquakes\")\n```\n\n### Manage multiple stores\n\nYou might need to mirror a subset of your data using CloudKit, while keeping other data completely local. You can add configurations to your model to organize your data in separate stores, then choose which stores to sync to CloudKit.\n\n1. Open your project’s `.xcdatamodeld` file.\n2. Choose Editor > Add Configuration.\n3. Drag each entity into a configuration.\n4. Select a configuration that you want to sync to CloudKit, then select the “Used with CloudKit” checkbox in the data model editor. Repeat for each configuration that you want to sync.\n\n\n\nFor an app without configurations, [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSPersistentCloudKitContainer] matches the first store description with the first CloudKit container identifier in the entitlements.\n\nFor an app with configurations, you need to tell it which CloudKit container, if any, to use with each store. For each of your configurations, make the following changes to your container setup:\n\n1. Create an [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSPersistentStoreDescription].\n2. Set the store description’s configuration.\n3. If this configuration needs to synchronize to CloudKit, set the store description’s [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSPersistentStoreDescription\/cloudKitContainerOptions] to an instance of [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSPersistentCloudKitContainerOptions]. Provide the container identifier of your CloudKit container in the initializer.\n4. Add the store description to the persistent container before loading the store.\n\nThe following example code creates two store descriptions: one for the “Local” configuration, and one for the “Cloud” configuration. It then sets the cloud store description’s [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSPersistentStoreDescription\/cloudKitContainerOptions] to match the store with its CloudKit container. Finally, it updates the container’s list of persistent store descriptions to include all local and cloud-backed store descriptions, and loads both stores.\n\n```swift\nlazy var persistentContainer: NSPersistentCloudKitContainer = {\n    let container = NSPersistentCloudKitContainer(name: \"Earthquakes\")\n    \n    \/\/ Create a store description for a local store.\n    let localStoreLocation = URL(fileURLWithPath: \"\/path\/to\/local.store\")\n    let localStoreDescription =\n        NSPersistentStoreDescription(url: localStoreLocation)\n    localStoreDescription.configuration = \"Local\"\n    \n    \/\/ Create a store description for a CloudKit-backed local store.\n    let cloudStoreLocation = URL(fileURLWithPath: \"\/path\/to\/cloud.store\")\n    let cloudStoreDescription =\n        NSPersistentStoreDescription(url: cloudStoreLocation)\n    cloudStoreDescription.configuration = \"Cloud\"\n\n    \/\/ Set the container options on the cloud store.\n    cloudStoreDescription.cloudKitContainerOptions = \n        NSPersistentCloudKitContainerOptions(\n            containerIdentifier: \"com.my.container\")\n    \n    \/\/ Update the container's list of store descriptions.\n    container.persistentStoreDescriptions = [\n        cloudStoreDescription,\n        localStoreDescription\n    ]\n    \n    \/\/ Load both stores.\n    container.loadPersistentStores { storeDescription, error in\n        guard error == nil else {\n            fatalError(\"Could not load persistent stores. \\(error!)\")\n        }\n    }\n    \n    return container\n}()\n```\n\n## Configuring CloudKit Mirroring\n\n- **Creating a Core Data Model for CloudKit**: Design a CloudKit-compatible data model and initialize your CloudKit schema.\n- **Syncing a Core Data Store with CloudKit**: Synchronize objects between devices, and handle store changes in the user interface.\n- **Reading CloudKit Records for Core Data**: Access CloudKit records created from Core Data managed objects.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Design a CloudKit-compatible data model and initialize your CloudKit schema.",
          "name" : "Creating a Core Data Model for CloudKit",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreData\/creating-a-core-data-model-for-cloudkit"
        },
        {
          "description" : "Synchronize objects between devices, and handle store changes in the user interface.",
          "name" : "Syncing a Core Data Store with CloudKit",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreData\/syncing-a-core-data-store-with-cloudkit"
        },
        {
          "description" : "Access CloudKit records created from Core Data managed objects.",
          "name" : "Reading CloudKit Records for Core Data",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreData\/reading-cloudkit-records-for-core-data"
        }
      ],
      "title" : "Configuring CloudKit Mirroring"
    }
  ],
  "source" : "appleJSON",
  "title" : "Setting Up Core Data with CloudKit",
  "url" : "https:\/\/developer.apple.com\/documentation\/CoreData\/setting-up-core-data-with-cloudkit"
}