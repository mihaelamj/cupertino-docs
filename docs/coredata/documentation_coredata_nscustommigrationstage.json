{
  "abstract" : "An object that enables you to participate in the migration between two versions of the same model.",
  "codeExamples" : [

  ],
  "conformsTo" : [
    "CVarArg",
    "CustomDebugStringConvertible",
    "CustomStringConvertible",
    "Equatable",
    "Hashable",
    "NSObjectProtocol"
  ],
  "contentHash" : "d176d53845ae544419aad1487d6b403b4401e8fefb08ef438b8e25dae87fa678",
  "crawledAt" : "2025-12-08T00:59:41Z",
  "declaration" : {
    "code" : "class NSCustomMigrationStage",
    "language" : "swift"
  },
  "id" : "CE3D9DCE-0114-405B-9CDE-8D182273BC41",
  "kind" : "class",
  "language" : "swift",
  "module" : "Core Data",
  "overview" : "## Overview\n\nUse [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSCustomMigrationStage] when you have two versions of a model that Core Data can’t automatically migrate. Custom migration stages enable you to participate in the migration process by assigning handlers that the stage invokes before and after it runs. The handlers provide an opportunity to prepare the persistent store’s data for the upcoming changes before the stage runs, and perform any cleanup tasks afterward.\n\nFor example, to support a migration that changes an optional attribute to be nonoptional, you might assign a handler to the stage’s [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSCustomMigrationStage\/willMigrateHandler-5wead] property that sets any `nil` instances of that attribute to a default value, thereby ensuring the migration succeeds. To access the store you’re migrating, use the [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSStagedMigrationManager\/container] property of the migration manager that Core Data provides to every handler.",
  "platforms" : [
    "iOS",
    "iPadOS",
    "Mac Catalyst",
    "macOS",
    "tvOS",
    "visionOS",
    "watchOS"
  ],
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/CoreData\/NSCustomMigrationStage\ncrawled: 2025-12-08T00:59:41Z\n---\n\n# NSCustomMigrationStage\n\n**Class**\n\nAn object that enables you to participate in the migration between two versions of the same model.\n\n## Declaration\n\n```swift\nclass NSCustomMigrationStage\n```\n\n## Overview\n\nUse [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSCustomMigrationStage] when you have two versions of a model that Core Data can’t automatically migrate. Custom migration stages enable you to participate in the migration process by assigning handlers that the stage invokes before and after it runs. The handlers provide an opportunity to prepare the persistent store’s data for the upcoming changes before the stage runs, and perform any cleanup tasks afterward.\n\nFor example, to support a migration that changes an optional attribute to be nonoptional, you might assign a handler to the stage’s [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSCustomMigrationStage\/willMigrateHandler-5wead] property that sets any `nil` instances of that attribute to a default value, thereby ensuring the migration succeeds. To access the store you’re migrating, use the [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSStagedMigrationManager\/container] property of the migration manager that Core Data provides to every handler.\n\n## Creating a custom migration stage\n\n- **init(migratingFrom:to:)**: Creates a custom migration stage with the specified source and destination model references.\n- **NSManagedObjectModelReference**: An object that describes a specific version of an object model.\n\n## Accessing model references\n\n- **currentModel**: The reference that represents the migration’s source model.\n- **nextModel**: The reference that represents the migration’s destination model.\n\n## Assigning event handlers\n\n- **willMigrateHandler**: The handler to execute before the stage runs.\n- **didMigrateHandler**: The handler to execute after the stage runs.\n\n## Migration stages\n\n- **NSLightweightMigrationStage**: An object that describes a series of models suitable for lightweight migration.\n- **NSMigrationStage**: An abstract base class for describing an individual stage of a migration.\n\n## Inherits From\n\n- NSMigrationStage\n\n## Conforms To\n\n- CVarArg\n- CustomDebugStringConvertible\n- CustomStringConvertible\n- Equatable\n- Hashable\n- NSObjectProtocol\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Creates a custom migration stage with the specified source and destination model references.",
          "name" : "init(migratingFrom:to:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreData\/NSCustomMigrationStage\/init(migratingFrom:to:)"
        },
        {
          "description" : "An object that describes a specific version of an object model.",
          "name" : "NSManagedObjectModelReference",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreData\/NSManagedObjectModelReference"
        }
      ],
      "title" : "Creating a custom migration stage"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "The reference that represents the migration’s source model.",
          "name" : "currentModel",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreData\/NSCustomMigrationStage\/currentModel"
        },
        {
          "description" : "The reference that represents the migration’s destination model.",
          "name" : "nextModel",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreData\/NSCustomMigrationStage\/nextModel"
        }
      ],
      "title" : "Accessing model references"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "The handler to execute before the stage runs.",
          "name" : "willMigrateHandler",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreData\/NSCustomMigrationStage\/willMigrateHandler-5wead"
        },
        {
          "description" : "The handler to execute after the stage runs.",
          "name" : "didMigrateHandler",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreData\/NSCustomMigrationStage\/didMigrateHandler-2zbss"
        }
      ],
      "title" : "Assigning event handlers"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "An object that describes a series of models suitable for lightweight migration.",
          "name" : "NSLightweightMigrationStage",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreData\/NSLightweightMigrationStage"
        },
        {
          "description" : "An abstract base class for describing an individual stage of a migration.",
          "name" : "NSMigrationStage",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreData\/NSMigrationStage"
        }
      ],
      "title" : "Migration stages"
    },
    {
      "content" : "",
      "items" : [
        {
          "name" : "NSMigrationStage"
        }
      ],
      "title" : "Inherits From"
    }
  ],
  "source" : "appleJSON",
  "title" : "NSCustomMigrationStage",
  "url" : "https:\/\/developer.apple.com\/documentation\/CoreData\/NSCustomMigrationStage"
}