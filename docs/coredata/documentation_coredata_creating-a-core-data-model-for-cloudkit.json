{
  "abstract" : "Design a CloudKit-compatible data model and initialize your CloudKit schema.",
  "codeExamples" : [
    {
      "code" : "let container = NSPersistentCloudKitContainer(name: \"Earthquakes\")\n\n\/\/ Only initialize the schema when building the app with the \n\/\/ Debug build configuration.        \n#if DEBUG\ndo {\n    \/\/ Use the container to initialize the development schema.\n    try container.initializeCloudKitSchema(options: [])\n} catch {\n    \/\/ Handle any errors.\n}\n#endif",
      "language" : "swift"
    },
    {
      "code" : "<NSCloudKitMirroringDelegate: 0x7f9699d29a90>: Successfully set up CloudKit \n    integration for store"
    },
    {
      "code" : "\/\/ The current version of the app's data model.\nlet maxCompatibleVersion = 3\n\nlet context = NSManagedObjectContext(\n    concurrencyType: .privateQueueConcurrencyType\n)\n\ncontext.performAndWait {\n    let fetchRequest = NSFetchRequest<NSManagedObject>(entityName: \"Post\")\n    \n    \/\/ Create a predicate that matches against the version attribute.\n    fetchRequest.predicate = NSPredicate(\n        format: \"version <= %d\",\n        argumentArray: [maxCompatibleVersion]\n    )\n    \n    \/\/ Fetch all posts with a version less than or equal to maxCompatibleVersion.\n    let results = context.fetch(fetchRequest)\n}",
      "language" : "swift"
    }
  ],
  "contentHash" : "fc970e2f8a9dd3e2c0ee982e10b183946a478f4832a556d201abc88b0dbbf51d",
  "crawledAt" : "2025-12-02T18:49:48Z",
  "id" : "C2E1B721-45DC-425B-B753-AA6C14EFDD82",
  "kind" : "article",
  "language" : "swift",
  "module" : "Core Data",
  "overview" : "## Overview\n\nTo pass records between a Core Data store and a CloudKit database, they both require a shared understanding of the data structure. You define this in the Core Data model and then use that to generate a CloudKit schema.\n\n\n\n### Create a Data Model\n\nUse Xcode’s Core Data model editor to define your app’s entities and their attributes, or construct your model in code. For more information, see [doc:\/\/com.apple.coredata\/documentation\/CoreData\/creating-a-core-data-model] and the articles under [doc:\/\/com.apple.coredata\/documentation\/CoreData\/modeling-data].\n\nCloudKit doesn’t support all the features of a Core Data model. As you design your model, be aware of the following limitations and make sure you create a compatible data model.\n\nFor more information about how Core Data translates managed objects to CloudKit records, see [doc:\/\/com.apple.coredata\/documentation\/CoreData\/reading-cloudkit-records-for-core-data].\n\n### Initialize Your CloudKit Schema During Development\n\nAfter creating your Core Data model, inform CloudKit about the types of records it contains by initializing a development schema. This is a draft schema that you can rewrite as often as necessary during development. You can’t delete a record type or modify any existing attributes after you promote a development schema to production.\n\nUse the persistent container to initialize the development schema, which you can do during app launch or from within one or more integration tests. To exclude schema initialization from your production builds, use the following:\n\nAfter initializing the schema, the console contains an entry similar to the following:\n\nWhile initializing the schema, Core Data creates a temporary instance of each distinct record type in each of the container’s stores that mirror to a CloudKit database and uploads them to the iCloud servers. After completing the upload, the schema is visible in the CloudKit dashboard and Core Data removes the temporary records.\n\nFor more information about configuring a CloudKit persistent container, see [doc:\/\/com.apple.coredata\/documentation\/CoreData\/setting-up-core-data-with-cloudkit].\n\n### Reset the Environment\n\nAs you change the model during development, periodically visit the CloudKit dashboard to reset the development environment and delete the existing development schema, before initializing a new one. For more information about resetting the development environment, see [https:\/\/developer.apple.com\/library\/archive\/documentation\/DataManagement\/Conceptual\/CloudKitQuickStart\/EditingSchemesUsingCloudKitDashboard\/EditingSchemesUsingCloudKitDashboard.html#\/\/apple_ref\/doc\/uid\/TP40014987-CH5].\n\n### Promote the Schema to Production\n\nWhen you’re happy with your data model, have a fully tested app, and are ready to submit it to the App Store, it’s time to promote your schema from development to production.\n\nInitialize your schema one last time, then promote it from the CloudKit dashboard. For more information about promoting a schema from development to production, see [https:\/\/developer.apple.com\/library\/archive\/documentation\/DataManagement\/Conceptual\/CloudKitQuickStart\/DeployingYourCloudKitApp\/DeployingYourCloudKitApp.html#\/\/apple_ref\/doc\/uid\/TP40014987-CH10].\n\n### Update the Production Schema\n\nPlan carefully for how your app handles forward compatibility and major changes to the data model, because you can’t rename or delete CloudKit record types and fields in production. Consider these strategies:\n\nFor example, consider a `Post` entity with a `version` attribute that stores the version of the app that creates the record. You can use a predicate to fetch only the records that are compatible with the current version of the app.\n\nAlong with these choices, consider your timelines for supporting multiple versions of your app, and for migrating users to newer app versions.\n\nFor tips on migrating records to a new schema, see [https:\/\/developer.apple.com\/library\/archive\/documentation\/General\/Conceptual\/iCloudDesignGuide\/DesigningforCloudKit\/DesigningforCloudKit.html#\/\/apple_ref\/doc\/uid\/TP40012094-CH9]. For more information about Core Data model migration, see [doc:\/\/com.apple.coredata\/documentation\/CoreData\/migrating-your-data-model-automatically]. For heavyweight migrations, see the [https:\/\/developer.apple.com\/library\/archive\/documentation\/Cocoa\/Conceptual\/CoreDataVersioning\/Articles\/Introduction.html#\/\/apple_ref\/doc\/uid\/TP40004399-CH1] guide.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/CoreData\/creating-a-core-data-model-for-cloudkit\ncrawled: 2025-12-02T18:49:48Z\n---\n\n# Creating a Core Data Model for CloudKit\n\n**Article**\n\nDesign a CloudKit-compatible data model and initialize your CloudKit schema.\n\n## Overview\n\nTo pass records between a Core Data store and a CloudKit database, they both require a shared understanding of the data structure. You define this in the Core Data model and then use that to generate a CloudKit schema.\n\n\n\n### Create a Data Model\n\nUse Xcode’s Core Data model editor to define your app’s entities and their attributes, or construct your model in code. For more information, see [doc:\/\/com.apple.coredata\/documentation\/CoreData\/creating-a-core-data-model] and the articles under [doc:\/\/com.apple.coredata\/documentation\/CoreData\/modeling-data].\n\nCloudKit doesn’t support all the features of a Core Data model. As you design your model, be aware of the following limitations and make sure you create a compatible data model.\n\n\n\nFor more information about how Core Data translates managed objects to CloudKit records, see [doc:\/\/com.apple.coredata\/documentation\/CoreData\/reading-cloudkit-records-for-core-data].\n\n### Initialize Your CloudKit Schema During Development\n\nAfter creating your Core Data model, inform CloudKit about the types of records it contains by initializing a development schema. This is a draft schema that you can rewrite as often as necessary during development. You can’t delete a record type or modify any existing attributes after you promote a development schema to production.\n\nUse the persistent container to initialize the development schema, which you can do during app launch or from within one or more integration tests. To exclude schema initialization from your production builds, use the following:\n\n```swift\nlet container = NSPersistentCloudKitContainer(name: \"Earthquakes\")\n\n\/\/ Only initialize the schema when building the app with the \n\/\/ Debug build configuration.        \n#if DEBUG\ndo {\n    \/\/ Use the container to initialize the development schema.\n    try container.initializeCloudKitSchema(options: [])\n} catch {\n    \/\/ Handle any errors.\n}\n#endif\n```\n\nAfter initializing the schema, the console contains an entry similar to the following:\n\n```\n<NSCloudKitMirroringDelegate: 0x7f9699d29a90>: Successfully set up CloudKit \n    integration for store\n```\n\nWhile initializing the schema, Core Data creates a temporary instance of each distinct record type in each of the container’s stores that mirror to a CloudKit database and uploads them to the iCloud servers. After completing the upload, the schema is visible in the CloudKit dashboard and Core Data removes the temporary records.\n\nFor more information about configuring a CloudKit persistent container, see [doc:\/\/com.apple.coredata\/documentation\/CoreData\/setting-up-core-data-with-cloudkit].\n\n### Reset the Environment\n\nAs you change the model during development, periodically visit the CloudKit dashboard to reset the development environment and delete the existing development schema, before initializing a new one. For more information about resetting the development environment, see [https:\/\/developer.apple.com\/library\/archive\/documentation\/DataManagement\/Conceptual\/CloudKitQuickStart\/EditingSchemesUsingCloudKitDashboard\/EditingSchemesUsingCloudKitDashboard.html#\/\/apple_ref\/doc\/uid\/TP40014987-CH5].\n\n### Promote the Schema to Production\n\nWhen you’re happy with your data model, have a fully tested app, and are ready to submit it to the App Store, it’s time to promote your schema from development to production.\n\n\n\nInitialize your schema one last time, then promote it from the CloudKit dashboard. For more information about promoting a schema from development to production, see [https:\/\/developer.apple.com\/library\/archive\/documentation\/DataManagement\/Conceptual\/CloudKitQuickStart\/DeployingYourCloudKitApp\/DeployingYourCloudKitApp.html#\/\/apple_ref\/doc\/uid\/TP40014987-CH10].\n\n### Update the Production Schema\n\nPlan carefully for how your app handles forward compatibility and major changes to the data model, because you can’t rename or delete CloudKit record types and fields in production. Consider these strategies:\n\n- Migrate users to a completely new store, using [doc:\/\/com.apple.coredata\/documentation\/CoreData\/NSPersistentCloudKitContainerOptions] to associate the new store with a new container.\n- Incrementally add new fields to existing record types. If you adopt this approach, older versions of your app have access to every record a user creates, but not every field.\n- Version your entities by including a `version` attribute from the outset, and use a fetch request to select only those records that are compatible with the current version of the app. If you adopt this approach, older versions of your app won’t fetch records that a user creates with a more recent version, effectively hiding them on that device.\n\nFor example, consider a `Post` entity with a `version` attribute that stores the version of the app that creates the record. You can use a predicate to fetch only the records that are compatible with the current version of the app.\n\n```swift\n\/\/ The current version of the app's data model.\nlet maxCompatibleVersion = 3\n\nlet context = NSManagedObjectContext(\n    concurrencyType: .privateQueueConcurrencyType\n)\n\ncontext.performAndWait {\n    let fetchRequest = NSFetchRequest<NSManagedObject>(entityName: \"Post\")\n    \n    \/\/ Create a predicate that matches against the version attribute.\n    fetchRequest.predicate = NSPredicate(\n        format: \"version <= %d\",\n        argumentArray: [maxCompatibleVersion]\n    )\n    \n    \/\/ Fetch all posts with a version less than or equal to maxCompatibleVersion.\n    let results = context.fetch(fetchRequest)\n}\n```\n\nAlong with these choices, consider your timelines for supporting multiple versions of your app, and for migrating users to newer app versions.\n\nFor tips on migrating records to a new schema, see [https:\/\/developer.apple.com\/library\/archive\/documentation\/General\/Conceptual\/iCloudDesignGuide\/DesigningforCloudKit\/DesigningforCloudKit.html#\/\/apple_ref\/doc\/uid\/TP40012094-CH9]. For more information about Core Data model migration, see [doc:\/\/com.apple.coredata\/documentation\/CoreData\/migrating-your-data-model-automatically]. For heavyweight migrations, see the [https:\/\/developer.apple.com\/library\/archive\/documentation\/Cocoa\/Conceptual\/CoreDataVersioning\/Articles\/Introduction.html#\/\/apple_ref\/doc\/uid\/TP40004399-CH1] guide.\n\n## Configuring CloudKit Mirroring\n\n- **Setting Up Core Data with CloudKit**: Set up the classes and capabilities that sync your store to CloudKit.\n- **Syncing a Core Data Store with CloudKit**: Synchronize objects between devices, and handle store changes in the user interface.\n- **Reading CloudKit Records for Core Data**: Access CloudKit records created from Core Data managed objects.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Set up the classes and capabilities that sync your store to CloudKit.",
          "name" : "Setting Up Core Data with CloudKit",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreData\/setting-up-core-data-with-cloudkit"
        },
        {
          "description" : "Synchronize objects between devices, and handle store changes in the user interface.",
          "name" : "Syncing a Core Data Store with CloudKit",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreData\/syncing-a-core-data-store-with-cloudkit"
        },
        {
          "description" : "Access CloudKit records created from Core Data managed objects.",
          "name" : "Reading CloudKit Records for Core Data",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreData\/reading-cloudkit-records-for-core-data"
        }
      ],
      "title" : "Configuring CloudKit Mirroring"
    }
  ],
  "source" : "appleJSON",
  "title" : "Creating a Core Data Model for CloudKit",
  "url" : "https:\/\/developer.apple.com\/documentation\/CoreData\/creating-a-core-data-model-for-cloudkit"
}