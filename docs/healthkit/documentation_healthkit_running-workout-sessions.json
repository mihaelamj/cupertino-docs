{
  "abstract" : "Track a workout on Apple Watch.",
  "codeExamples" : [
    {
      "code" : "\/\/ The quantity type to write to the health store.\nlet typesToShare: Set = [\n    HKQuantityType.workoutType()\n]\n\n\/\/ The quantity types to read from the health store.\nlet typesToRead: Set = [\n    HKQuantityType.quantityType(forIdentifier: .heartRate)!,\n    HKQuantityType.quantityType(forIdentifier: .activeEnergyBurned)!,\n    HKQuantityType.quantityType(forIdentifier: .distanceWalkingRunning)!,\n    HKObjectType.activitySummaryType(),\n    HKCharacteristicType(.activityMoveMode)\n]\n\n\/\/ Request authorization for those quantity types.\nhealthStore.requestAuthorization(toShare: typesToShare, read: typesToRead) { (success, error) in\n    \/\/ Handle errors here.\n}",
      "language" : "swift"
    },
    {
      "code" : "let configuration = HKWorkoutConfiguration()\nconfiguration.activityType = .running\nconfiguration.locationType = .outdoor",
      "language" : "swift"
    },
    {
      "code" : "do {\n    session = try HKWorkoutSession(healthStore: healthStore, configuration: configuration)\n    builder = session.associatedWorkoutBuilder()\n} catch {\n    \/\/ Handle failure here.\n    return\n}",
      "language" : "swift"
    },
    {
      "code" : "builder.dataSource = HKLiveWorkoutDataSource(healthStore: healthStore,\n                                             workoutConfiguration: configuration)",
      "language" : "swift"
    },
    {
      "code" : "session.delegate = self\nbuilder.delegate = self",
      "language" : "swift"
    },
    {
      "code" : "session.startActivity(with: Date())\nbuilder.beginCollection(withStart: Date()) { (success, error) in\n    \n    guard success else {\n        \/\/ Handle errors.\n    }\n    \n    \/\/ Indicate that the session has started.\n}",
      "language" : "swift"
    },
    {
      "code" : "func workoutBuilder(_ workoutBuilder: HKLiveWorkoutBuilder, didCollectDataOf collectedTypes: Set<HKSampleType>) {\n    for type in collectedTypes {\n        guard let quantityType = type as? HKQuantityType else {\n            return \/\/ Nothing to do.\n        }\n        \n        \/\/ Calculate statistics for the type.\n        let statistics = workoutBuilder.statistics(for: quantityType)\n        let label = labelForQuantityType(quantityType)\n        \n        DispatchQueue.main.async() {\n            \/\/ Update the user interface.\n        }   \n    }\n}",
      "language" : "swift"
    },
    {
      "code" : "func workoutBuilderDidCollectEvent(_ workoutBuilder: HKLiveWorkoutBuilder) {\n    \n    let lastEvent = workoutBuilder.workoutEvents.last\n    \n    DispatchQueue.main.async() {\n        \/\/ Update the user interface here.\n    }    \n}",
      "language" : "swift"
    },
    {
      "code" : "session.stopActivity(with: Date())",
      "language" : "swift"
    },
    {
      "code" : "func workoutSession(_ workoutSession: HKWorkoutSession, didChangeTo toState: HKWorkoutSessionState,\n                    from fromState: HKWorkoutSessionState, date: Date) {\n\n    \/\/ Wait for the session to transition states before ending the builder.\n    if toState == .stopped {\n\n        builder.endCollection(withEnd: date) { (success, error) in\n\n            guard success else {\n                \/\/ Handle errors.\n            }\n\n            builder.finishWorkout { (workout, error) in\n                \n                guard workout != nil else {\n                    \/\/ Handle errors.\n                }\n\n                session.end()\n                \n                DispatchQueue.main.async() {\n                    \/\/ Update the user interface.\n                }\n            }\n        }\n    }\n}",
      "language" : "swift"
    }
  ],
  "contentHash" : "6205486bc33e60a3aa0ca9153207d7eeaaf3a80bb3377a6c43bc5648262aba18",
  "crawledAt" : "2025-12-02T15:44:46Z",
  "id" : "66CA14C7-8D81-4492-B110-F14969D3A26E",
  "kind" : "article",
  "language" : "swift",
  "module" : "HealthKit",
  "overview" : "## Overview\n\nUse workout sessions to track a user’s activity on Apple Watch. While the session runs, the system fine-tunes the watch’s sensors for the specified activity. For example, all workout sessions generate high-frequency heart rate samples; however, an outdoor cycling activity generates accurate location data, while an indoor cycling activity doesn’t.\n\nTo track workouts on Apple Watch, you must set up, start, and save a workout session. Make starting and stopping workouts on Apple Watch as easy and obvious as possible. The app must clearly indicate when a workout session is in progress, and either automatically save workout data for the user, or provide a clear option to explicitly save or discard workout data. Finally, the watchOS app should provide clear feedback when a workout is successfully saved. For more information, see [https:\/\/developer.apple.com\/watchos\/human-interface-guidelines\/system-capabilities\/health-and-fitness\/] in [https:\/\/developer.apple.com\/watchos\/human-interface-guidelines\/overview\/themes\/].\n\n### Set up the app\n\nBefore creating a workout session, you must set up HealthKit and request permission to read and share any health data your app intends to use. For step-by-step instructions, see [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/setting-up-healthkit].\n\nFor workout sessions, you must request permission to share workout types. You may also want to read any data types automatically recorded by Apple Watch as part of the session.\n\nApps with an active workout session can run in the background, so you need to add the background modes capability to your WatchKit App Extension.\n\nWorkout sessions require the Workout processing background mode. If your app plays audio or provides haptic feedback during the workout session, you must also add the Audio background mode.\n\n\n\nUse the [doc:\/\/com.apple.documentation\/documentation\/AVFAudio\/AVAudioPlayer] class to play short audio clips. To play long form audio in the background, see [doc:\/\/com.apple.documentation\/documentation\/WatchKit\/playing-background-audio].\n\n### Start a session\n\nTo start a workout session, begin by creating a configuration object for the workout.\n\nUse the configuration to set the type of activity and the location for the workout. Apple Watch optimizes both the sensors and the calorimetry based on the configuration.\n\nFor example, while the session runs, Apple Watch automatically saves active energy-burned samples to the HealthKit store. HealthKit provides optimized calorie calculations for some activities. These include, but are not limited to, run, walk, cycle, stair-climbing, elliptical, and rowing activities. Furthermore, the calculations for activities may differ between indoor and outdoor locations. For all other activities, the system estimates calories based on the data from Apple Watch’s sensors. Depending on the activity, this rate is either never lower than the brisk walk burn rate or never lower than the brisk walk burn rate when moving.\n\nNext, use the configuration to create your workout session and get a reference to the session’s [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKLiveWorkoutBuilder] object.\n\nThe [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKWorkoutSession] class’s initializer can throw an exception if the configuration is invalid, so you need to wrap the initializer in a `do-catch` block.\n\nThen, create an [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKLiveWorkoutDataSource] object and assign it to the workout builder.\n\nUse the same configuration object for the workout session and the live data source. While the session runs, Apple Watch automatically collects data about the workout, and saves samples to the HealthKit store. For example, an outdoor running session collects and saves [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKQuantityTypeIdentifier\/activeEnergyBurned], [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKQuantityTypeIdentifier\/basalEnergyBurned], [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKQuantityTypeIdentifier\/heartRate], and [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKQuantityTypeIdentifier\/distanceWalkingRunning] samples.\n\nYou can assign delegates to monitor both the workout session and the workout builder.\n\nYour [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKWorkoutSessionDelegate] receives updates whenever the session’s state changes, an event occurs, or the session fails due to an error. Your [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKLiveWorkoutBuilderDelegate] receives updates when either Apple Watch or your app adds a new sample or event to the builder.\n\nBy default, the workout session automatically forwards all events to the builder, so both delegates should receive the same set of events. However, you can set the builder’s [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKLiveWorkoutBuilder\/shouldCollectWorkoutEvents] property to [doc:\/\/com.apple.documentation\/documentation\/Swift\/false] if you want to control the events set to the builder.\n\nFinally, start the session and the builder.\n\nYour app’s user interface should clearly indicate that a workout session is running. Use data passed to your [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKLiveWorkoutBuilderDelegate] to update information about the session.\n\n### Handle samples and events\n\nWhile the session runs, Apple Watch automatically collects and adds samples and events based on the workout configuration. You can record additional information by adding your own events and samples to the workout. To add samples, call the builder’s [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKWorkoutBuilder\/add(_:completion:)] method. To add events, call the [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKWorkoutBuilder\/addWorkoutEvents(_:completion:)] method.\n\nTypically, you should update your app’s user interface whenever the builder receives a new sample or event. To respond to new samples, implement your [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKLiveWorkoutBuilderDelegate] delegate’s [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKLiveWorkoutBuilderDelegate\/workoutBuilder(_:didCollectDataOf:)] method.\n\nHealthKit calls this method whenever the builder receives a new sample. Your implementation should examine the samples and update your app’s user interface—for example, by updating the current distance traveled, calories burned, and pace during a run. Use the workout builder’s [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKWorkoutBuilder\/statistics(for:)] method to calculate statistics, such as the total, average, minimum, or maximum, for any types that have new data.\n\nTo respond to new events, implement your [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKLiveWorkoutBuilderDelegate] delegate’s [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKLiveWorkoutBuilderDelegate\/workoutBuilderDidCollectEvent(_:)] method.\n\nHealthKit calls this method whenever the builder receives a new event. Use the builder’s [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKWorkoutBuilder\/workoutEvents] property to examine the last event, and update your user interface as needed. For example, when a [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKWorkoutEventType\/lap] event occurs, you can increment the number of laps shown.\n\n### Run in the background\n\nWhen your app has an active workout session, it continues to run in the background. Background execution grants your app the following abilities:\n\nTo maintain high performance on Apple Watch, you must limit the amount of work your app performs in the background. If your app uses an excessive amount of CPU while in the background, watchOS may suspend it. Use Xcode’s CPU report tool or the time profiler in Instruments to test your app’s CPU usage. The system also generates a log with a backtrace whenever it terminates your app.\n\n### Coordinate with the companion app\n\nIf the watchOS app has an iOS companion, be sure to keep both apps in sync. This is particularly important if the user can start workouts on either device.\n\n### End a session\n\nAfter the user finishes the workout, stop the session by calling [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKWorkoutSession\/stopActivity(with:)].\n\nAfter the session has transitioned to the `.stopped` state, call the builder’s [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKWorkoutBuilder\/endCollection(withEnd:completion:)] and [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKWorkoutBuilder\/finishWorkout(completion:)] methods. Finally, call [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKWorkoutSession\/end()] to end the session.\n\nThe [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKWorkoutBuilder\/endCollection(withEnd:completion:)] method sets the workout’s end date and deactivates the builder. The [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKWorkoutBuilder\/finishWorkout(completion:)] method saves the workout and its associated data to the HealthKit store.\n\n### Recover from crashes\n\nIf your app crashes during a workout session, the system calls your extension delegate’s [doc:\/\/com.apple.documentation\/documentation\/WatchKit\/WKExtensionDelegate\/handleActiveWorkoutRecovery()] method when the app relaunches. In your implementation of this method, call the HealthKit store’s [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKHealthStore\/recoverActiveWorkoutSession(completion:)] method. HealthKit attempts to restore the previous workout session, returning either a new session object or an error to the completion block.\n\nAs soon as you receive the session object, you must access its builder and set up your data source and delegates again.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/HealthKit\/running-workout-sessions\ncrawled: 2025-12-02T15:44:46Z\n---\n\n# Running workout sessions\n\n**Article**\n\nTrack a workout on Apple Watch.\n\n## Overview\n\nUse workout sessions to track a user’s activity on Apple Watch. While the session runs, the system fine-tunes the watch’s sensors for the specified activity. For example, all workout sessions generate high-frequency heart rate samples; however, an outdoor cycling activity generates accurate location data, while an indoor cycling activity doesn’t.\n\nTo track workouts on Apple Watch, you must set up, start, and save a workout session. Make starting and stopping workouts on Apple Watch as easy and obvious as possible. The app must clearly indicate when a workout session is in progress, and either automatically save workout data for the user, or provide a clear option to explicitly save or discard workout data. Finally, the watchOS app should provide clear feedback when a workout is successfully saved. For more information, see [https:\/\/developer.apple.com\/watchos\/human-interface-guidelines\/system-capabilities\/health-and-fitness\/] in [https:\/\/developer.apple.com\/watchos\/human-interface-guidelines\/overview\/themes\/].\n\n### Set up the app\n\nBefore creating a workout session, you must set up HealthKit and request permission to read and share any health data your app intends to use. For step-by-step instructions, see [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/setting-up-healthkit].\n\nFor workout sessions, you must request permission to share workout types. You may also want to read any data types automatically recorded by Apple Watch as part of the session.\n\n```swift\n\/\/ The quantity type to write to the health store.\nlet typesToShare: Set = [\n    HKQuantityType.workoutType()\n]\n\n\/\/ The quantity types to read from the health store.\nlet typesToRead: Set = [\n    HKQuantityType.quantityType(forIdentifier: .heartRate)!,\n    HKQuantityType.quantityType(forIdentifier: .activeEnergyBurned)!,\n    HKQuantityType.quantityType(forIdentifier: .distanceWalkingRunning)!,\n    HKObjectType.activitySummaryType(),\n    HKCharacteristicType(.activityMoveMode)\n]\n\n\/\/ Request authorization for those quantity types.\nhealthStore.requestAuthorization(toShare: typesToShare, read: typesToRead) { (success, error) in\n    \/\/ Handle errors here.\n}\n```\n\n\n\nApps with an active workout session can run in the background, so you need to add the background modes capability to your WatchKit App Extension.\n\nWorkout sessions require the Workout processing background mode. If your app plays audio or provides haptic feedback during the workout session, you must also add the Audio background mode.\n\n\n\nUse the [doc:\/\/com.apple.documentation\/documentation\/AVFAudio\/AVAudioPlayer] class to play short audio clips. To play long form audio in the background, see [doc:\/\/com.apple.documentation\/documentation\/WatchKit\/playing-background-audio].\n\n\n\n### Start a session\n\nTo start a workout session, begin by creating a configuration object for the workout.\n\n```swift\nlet configuration = HKWorkoutConfiguration()\nconfiguration.activityType = .running\nconfiguration.locationType = .outdoor\n```\n\nUse the configuration to set the type of activity and the location for the workout. Apple Watch optimizes both the sensors and the calorimetry based on the configuration.\n\nFor example, while the session runs, Apple Watch automatically saves active energy-burned samples to the HealthKit store. HealthKit provides optimized calorie calculations for some activities. These include, but are not limited to, run, walk, cycle, stair-climbing, elliptical, and rowing activities. Furthermore, the calculations for activities may differ between indoor and outdoor locations. For all other activities, the system estimates calories based on the data from Apple Watch’s sensors. Depending on the activity, this rate is either never lower than the brisk walk burn rate or never lower than the brisk walk burn rate when moving.\n\nNext, use the configuration to create your workout session and get a reference to the session’s [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKLiveWorkoutBuilder] object.\n\n```swift\ndo {\n    session = try HKWorkoutSession(healthStore: healthStore, configuration: configuration)\n    builder = session.associatedWorkoutBuilder()\n} catch {\n    \/\/ Handle failure here.\n    return\n}\n```\n\nThe [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKWorkoutSession] class’s initializer can throw an exception if the configuration is invalid, so you need to wrap the initializer in a `do-catch` block.\n\nThen, create an [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKLiveWorkoutDataSource] object and assign it to the workout builder.\n\n```swift\nbuilder.dataSource = HKLiveWorkoutDataSource(healthStore: healthStore,\n                                             workoutConfiguration: configuration)\n```\n\nUse the same configuration object for the workout session and the live data source. While the session runs, Apple Watch automatically collects data about the workout, and saves samples to the HealthKit store. For example, an outdoor running session collects and saves [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKQuantityTypeIdentifier\/activeEnergyBurned], [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKQuantityTypeIdentifier\/basalEnergyBurned], [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKQuantityTypeIdentifier\/heartRate], and [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKQuantityTypeIdentifier\/distanceWalkingRunning] samples.\n\nYou can assign delegates to monitor both the workout session and the workout builder.\n\n```swift\nsession.delegate = self\nbuilder.delegate = self\n```\n\nYour [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKWorkoutSessionDelegate] receives updates whenever the session’s state changes, an event occurs, or the session fails due to an error. Your [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKLiveWorkoutBuilderDelegate] receives updates when either Apple Watch or your app adds a new sample or event to the builder.\n\nBy default, the workout session automatically forwards all events to the builder, so both delegates should receive the same set of events. However, you can set the builder’s [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKLiveWorkoutBuilder\/shouldCollectWorkoutEvents] property to [doc:\/\/com.apple.documentation\/documentation\/Swift\/false] if you want to control the events set to the builder.\n\nFinally, start the session and the builder.\n\n```swift\nsession.startActivity(with: Date())\nbuilder.beginCollection(withStart: Date()) { (success, error) in\n    \n    guard success else {\n        \/\/ Handle errors.\n    }\n    \n    \/\/ Indicate that the session has started.\n}\n```\n\nYour app’s user interface should clearly indicate that a workout session is running. Use data passed to your [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKLiveWorkoutBuilderDelegate] to update information about the session.\n\n### Handle samples and events\n\nWhile the session runs, Apple Watch automatically collects and adds samples and events based on the workout configuration. You can record additional information by adding your own events and samples to the workout. To add samples, call the builder’s [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKWorkoutBuilder\/add(_:completion:)] method. To add events, call the [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKWorkoutBuilder\/addWorkoutEvents(_:completion:)] method.\n\nTypically, you should update your app’s user interface whenever the builder receives a new sample or event. To respond to new samples, implement your [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKLiveWorkoutBuilderDelegate] delegate’s [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKLiveWorkoutBuilderDelegate\/workoutBuilder(_:didCollectDataOf:)] method.\n\n```swift\nfunc workoutBuilder(_ workoutBuilder: HKLiveWorkoutBuilder, didCollectDataOf collectedTypes: Set<HKSampleType>) {\n    for type in collectedTypes {\n        guard let quantityType = type as? HKQuantityType else {\n            return \/\/ Nothing to do.\n        }\n        \n        \/\/ Calculate statistics for the type.\n        let statistics = workoutBuilder.statistics(for: quantityType)\n        let label = labelForQuantityType(quantityType)\n        \n        DispatchQueue.main.async() {\n            \/\/ Update the user interface.\n        }   \n    }\n}\n```\n\nHealthKit calls this method whenever the builder receives a new sample. Your implementation should examine the samples and update your app’s user interface—for example, by updating the current distance traveled, calories burned, and pace during a run. Use the workout builder’s [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKWorkoutBuilder\/statistics(for:)] method to calculate statistics, such as the total, average, minimum, or maximum, for any types that have new data.\n\nTo respond to new events, implement your [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKLiveWorkoutBuilderDelegate] delegate’s [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKLiveWorkoutBuilderDelegate\/workoutBuilderDidCollectEvent(_:)] method.\n\n```swift\nfunc workoutBuilderDidCollectEvent(_ workoutBuilder: HKLiveWorkoutBuilder) {\n    \n    let lastEvent = workoutBuilder.workoutEvents.last\n    \n    DispatchQueue.main.async() {\n        \/\/ Update the user interface here.\n    }    \n}\n```\n\nHealthKit calls this method whenever the builder receives a new event. Use the builder’s [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKWorkoutBuilder\/workoutEvents] property to examine the last event, and update your user interface as needed. For example, when a [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKWorkoutEventType\/lap] event occurs, you can increment the number of laps shown.\n\n### Run in the background\n\nWhen your app has an active workout session, it continues to run in the background. Background execution grants your app the following abilities:\n\n- Your app continues to run throughout the entire workout session, even when the user lowers their wrist or interacts with a different app. When the user raises their wrist, your app reappears, letting the user quickly check their current progress and performance.\n- If the user navigates back to the watch face, Apple Watch displays a small icon at the top of the screen, indicating that a workout session is running. Users can tap the icon to navigate back to your app.\n- Your app continues to receive data from HealthKit and Apple Watch’s sensors in the background. Use this data to keep your app up to date at all times. For example, your app could display the user’s current heart rate, the distance that the user has cycled, and any other relevant statistics whenever the user raises their wrist.\n- Your app can alert the user using audio or haptic feedback while running in the background.\n\nTo maintain high performance on Apple Watch, you must limit the amount of work your app performs in the background. If your app uses an excessive amount of CPU while in the background, watchOS may suspend it. Use Xcode’s CPU report tool or the time profiler in Instruments to test your app’s CPU usage. The system also generates a log with a backtrace whenever it terminates your app.\n\n### Coordinate with the companion app\n\nIf the watchOS app has an iOS companion, be sure to keep both apps in sync. This is particularly important if the user can start workouts on either device.\n\n- If the user starts the workout in your watchOS app, and then tries to end it in the iOS companion, the iOS app should instruct the user to end the workout in your watchOS app. Otherwise, Apple Watch workout continues to run, which can lead to accidentally saving invalid data to the HealthKit store.\n- If the user starts a workout in the iOS companion, and then opens your watchOS app, the watchOS app should automatically start a workout session for the workout in progress. If you save the workout in the watchOS app, you can incorporate data from the iOS workout. For example, you should set the workout’s [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKSample\/startDate] to the iOS workout’s start. Also, if your app calculates its own calories, you can retroactively give credit for the calories burned before the workout session began.\n- If the user doesn’t start and stop a workout session in your watchOS app, don’t try to retroactively create a workout session on Apple Watch.\n\n### End a session\n\nAfter the user finishes the workout, stop the session by calling [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKWorkoutSession\/stopActivity(with:)].\n\n```swift\nsession.stopActivity(with: Date())\n```\n\nAfter the session has transitioned to the `.stopped` state, call the builder’s [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKWorkoutBuilder\/endCollection(withEnd:completion:)] and [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKWorkoutBuilder\/finishWorkout(completion:)] methods. Finally, call [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKWorkoutSession\/end()] to end the session.\n\n```swift\nfunc workoutSession(_ workoutSession: HKWorkoutSession, didChangeTo toState: HKWorkoutSessionState,\n                    from fromState: HKWorkoutSessionState, date: Date) {\n\n    \/\/ Wait for the session to transition states before ending the builder.\n    if toState == .stopped {\n\n        builder.endCollection(withEnd: date) { (success, error) in\n\n            guard success else {\n                \/\/ Handle errors.\n            }\n\n            builder.finishWorkout { (workout, error) in\n                \n                guard workout != nil else {\n                    \/\/ Handle errors.\n                }\n\n                session.end()\n                \n                DispatchQueue.main.async() {\n                    \/\/ Update the user interface.\n                }\n            }\n        }\n    }\n}\n```\n\nThe [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKWorkoutBuilder\/endCollection(withEnd:completion:)] method sets the workout’s end date and deactivates the builder. The [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKWorkoutBuilder\/finishWorkout(completion:)] method saves the workout and its associated data to the HealthKit store.\n\n### Recover from crashes\n\nIf your app crashes during a workout session, the system calls your extension delegate’s [doc:\/\/com.apple.documentation\/documentation\/WatchKit\/WKExtensionDelegate\/handleActiveWorkoutRecovery()] method when the app relaunches. In your implementation of this method, call the HealthKit store’s [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKHealthStore\/recoverActiveWorkoutSession(completion:)] method. HealthKit attempts to restore the previous workout session, returning either a new session object or an error to the completion block.\n\nAs soon as you receive the session object, you must access its builder and set up your data source and delegates again.\n\n## Sessions\n\n- **Build a workout app for Apple Watch**: Create your own workout app, quickly and easily, with HealthKit and SwiftUI.\n- **Building a multidevice workout app**: Mirror a workout from a watchOS app to its companion iOS app, and perform bidirectional communication between them.\n- **Building a workout app for iPhone and iPad**: Start a workout in iOS, control it from the Lock Screen with App Intents, and present the workout status with Live Activities.\n- **HKWorkoutSession**: A session that tracks a person’s workout.\n- **HKWorkoutConfiguration**: An object that contains configuration information about a workout session.\n- **HKWorkoutSessionState**: A workout session’s state.\n- **HKLiveWorkoutBuilder**: A builder object that constructs a workout incrementally based on live data from an active workout session.\n- **HKLiveWorkoutDataSource**: A data source that automatically provides live data from an active workout session.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Create your own workout app, quickly and easily, with HealthKit and SwiftUI.",
          "name" : "Build a workout app for Apple Watch",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/build-a-workout-app-for-apple-watch"
        },
        {
          "description" : "Mirror a workout from a watchOS app to its companion iOS app, and perform bidirectional communication between them.",
          "name" : "Building a multidevice workout app",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/building-a-multidevice-workout-app"
        },
        {
          "description" : "Start a workout in iOS, control it from the Lock Screen with App Intents, and present the workout status with Live Activities.",
          "name" : "Building a workout app for iPhone and iPad",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/building-a-workout-app-for-iphone-and-ipad"
        },
        {
          "description" : "A session that tracks a person’s workout.",
          "name" : "HKWorkoutSession",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKWorkoutSession"
        },
        {
          "description" : "An object that contains configuration information about a workout session.",
          "name" : "HKWorkoutConfiguration",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKWorkoutConfiguration"
        },
        {
          "description" : "A workout session’s state.",
          "name" : "HKWorkoutSessionState",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKWorkoutSessionState"
        },
        {
          "description" : "A builder object that constructs a workout incrementally based on live data from an active workout session.",
          "name" : "HKLiveWorkoutBuilder",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKLiveWorkoutBuilder"
        },
        {
          "description" : "A data source that automatically provides live data from an active workout session.",
          "name" : "HKLiveWorkoutDataSource",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKLiveWorkoutDataSource"
        }
      ],
      "title" : "Sessions"
    }
  ],
  "source" : "appleJSON",
  "title" : "Running workout sessions",
  "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/running-workout-sessions"
}