{
  "abstract" : "A query descriptor that gathers a collection of statistics calculated over a series of fixed-length time intervals.",
  "codeExamples" : [
    {
      "code" : "\/\/ Create a predicate for this week's samples.\nlet calendar = Calendar(identifier: .gregorian)\nlet today = calendar.startOfDay(for: Date())\n\nguard let endDate = calendar.date(byAdding: .day, value: 1, to: today) else {\n    fatalError(\"*** Unable to calculate the end time ***\")\n}\n\nguard let startDate = calendar.date(byAdding: .day, value: -7, to: endDate) else {\n    fatalError(\"*** Unable to calculate the start time ***\")\n}\n\nlet thisWeek = HKQuery.predicateForSamples(withStart: startDate, end: endDate)\n\n\/\/ Create the query descriptor.\nlet stepType = HKQuantityType(.stepCount)\nlet stepsThisWeek = HKSamplePredicate.quantitySample(type: stepType, predicate:thisWeek)\nlet everyDay = DateComponents(day:1)\n\nlet sumOfStepsQuery = HKStatisticsCollectionQueryDescriptor(\n    predicate: stepsThisWeek,\n    options: .cumulativeSum,\n    anchorDate: endDate,\n    intervalComponents: everyDay)\n\nlet stepCounts = try await sumOfStepsQuery.result(for: store)\n\n\/\/ Use the statistics collection here.",
      "language" : "swift"
    },
    {
      "code" : "\/\/ Run a long-running query that updates its statistics as new data comes in.\nlet updateQueue = sumOfStepsQuery.results(for: store)\n\n\/\/ Wait for the initial results and updates.\nupdateTask = Task {\n    for try await results in updateQueue {\n        \/\/ Use the statistics collection here.\n    }\n}",
      "language" : "swift"
    }
  ],
  "conformsTo" : [
    "Copyable",
    "HKAsyncQuery",
    "HKAsyncSequenceQuery"
  ],
  "contentHash" : "73e13fa03ae3dc8d67774bbe86422e1e423c781a21aa175b76bae4b3833c6524",
  "crawledAt" : "2025-12-04T19:18:56Z",
  "declaration" : {
    "code" : "struct HKStatisticsCollectionQueryDescriptor",
    "language" : "swift"
  },
  "id" : "3CFA26BA-7895-4F43-9099-F3F6C176E007",
  "kind" : "struct",
  "language" : "swift",
  "module" : "HealthKit",
  "overview" : "## Overview\n\nUse [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKStatisticsCollectionQueryDescriptor] to run a query that calculates statistics grouped into time intervals. To get a snapshot of the current data in the store, create a descriptor and call its [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKStatisticsCollectionQueryDescriptor\/result(for:)] method.\n\nTo set up a long-running query that updates the calculations based on any new data that arrives while it’s running, call the [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKStatisticsCollectionQueryDescriptor\/results(for:)] method instead. The first result contains calculations based on samples currently in the HealthKit store, and additional results represent updates as they occur.",
  "platforms" : [
    "iOS",
    "iPadOS",
    "Mac Catalyst",
    "macOS",
    "visionOS",
    "watchOS"
  ],
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/healthkit\/hkstatisticscollectionquerydescriptor\ncrawled: 2025-12-04T19:18:56Z\n---\n\n# HKStatisticsCollectionQueryDescriptor\n\n**Structure**\n\nA query descriptor that gathers a collection of statistics calculated over a series of fixed-length time intervals.\n\n## Declaration\n\n```swift\nstruct HKStatisticsCollectionQueryDescriptor\n```\n\n## Overview\n\nUse [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKStatisticsCollectionQueryDescriptor] to run a query that calculates statistics grouped into time intervals. To get a snapshot of the current data in the store, create a descriptor and call its [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKStatisticsCollectionQueryDescriptor\/result(for:)] method.\n\n```swift\n\/\/ Create a predicate for this week's samples.\nlet calendar = Calendar(identifier: .gregorian)\nlet today = calendar.startOfDay(for: Date())\n\nguard let endDate = calendar.date(byAdding: .day, value: 1, to: today) else {\n    fatalError(\"*** Unable to calculate the end time ***\")\n}\n\nguard let startDate = calendar.date(byAdding: .day, value: -7, to: endDate) else {\n    fatalError(\"*** Unable to calculate the start time ***\")\n}\n\nlet thisWeek = HKQuery.predicateForSamples(withStart: startDate, end: endDate)\n\n\/\/ Create the query descriptor.\nlet stepType = HKQuantityType(.stepCount)\nlet stepsThisWeek = HKSamplePredicate.quantitySample(type: stepType, predicate:thisWeek)\nlet everyDay = DateComponents(day:1)\n\nlet sumOfStepsQuery = HKStatisticsCollectionQueryDescriptor(\n    predicate: stepsThisWeek,\n    options: .cumulativeSum,\n    anchorDate: endDate,\n    intervalComponents: everyDay)\n\nlet stepCounts = try await sumOfStepsQuery.result(for: store)\n\n\/\/ Use the statistics collection here.\n```\n\nTo set up a long-running query that updates the calculations based on any new data that arrives while it’s running, call the [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKStatisticsCollectionQueryDescriptor\/results(for:)] method instead. The first result contains calculations based on samples currently in the HealthKit store, and additional results represent updates as they occur.\n\n```swift\n\/\/ Run a long-running query that updates its statistics as new data comes in.\nlet updateQueue = sumOfStepsQuery.results(for: store)\n\n\/\/ Wait for the initial results and updates.\nupdateTask = Task {\n    for try await results in updateQueue {\n        \/\/ Use the statistics collection here.\n    }\n}\n```\n\n## Creating Query Descriptors\n\n- **init(predicate:options:anchorDate:intervalComponents:)**: Creates a statistics collection query descriptor.\n\n## Running Queries\n\n- **result(for:)**: Runs a one-shot query and asynchronously returns statistics calculated from the current matching results.\n- **results(for:)**: Initiates a long-running query that returns statistics and updates using an asynchronous sequence.\n- **HKStatisticsCollectionQueryDescriptor.Results**: An asynchronous sequence that emits updates from a statistics collection query.\n\n## Accessing Query Properties\n\n- **predicate**: A predicate that defines the set of data that the query uses to calculate the statistics.\n- **options**: A list of options that define the type of statistical calculations performed and the way in which HealthKit merges data from multiple sources.\n- **anchorDate**: The date that anchors the collection’s time intervals.\n- **intervalComponents**: The date components that define the time interval for each statistics object in the collection.\n\n## Structures\n\n- **HKStatisticsCollectionQueryDescriptor.Result**: A collection of results.\n\n## Default Implementations\n\n- **HKAsyncQuery Implementations**\n- **HKAsyncSequenceQuery Implementations**\n\n## Statistics\n\n- **Executing Statistical Queries**: Create and run statistical queries.\n- **Executing Statistics Collection Queries**: Calculate statistical data for graphs and charts.\n- **HKStatisticsQueryDescriptor**: A query descriptor that calculates the minimum, maximum, average, or sum over a set of samples from the HealthKit store.\n- **HKStatisticsQuery**: A query that performs statistical calculations over a set of matching quantity samples, and returns the results.\n- **HKStatisticsCollectionQuery**: A query that performs multiple statistics queries over a series of fixed-length time intervals.\n- **HKStatistics**: An object that represents the result of calculating the minimum, maximum, average, or sum over a set of samples from the HealthKit store.\n- **HKStatisticsCollection**: An object that manages a collection of statistics, representing the results calculated over separate time intervals.\n- **HKStatisticsOptions**: Options for specifying the statistic to calculate.\n\n## Conforms To\n\n- Copyable\n- HKAsyncQuery\n- HKAsyncSequenceQuery\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Creates a statistics collection query descriptor.",
          "name" : "init(predicate:options:anchorDate:intervalComponents:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKStatisticsCollectionQueryDescriptor\/init(predicate:options:anchorDate:intervalComponents:)"
        }
      ],
      "title" : "Creating Query Descriptors"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "Runs a one-shot query and asynchronously returns statistics calculated from the current matching results.",
          "name" : "result(for:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKStatisticsCollectionQueryDescriptor\/result(for:)"
        },
        {
          "description" : "Initiates a long-running query that returns statistics and updates using an asynchronous sequence.",
          "name" : "results(for:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKStatisticsCollectionQueryDescriptor\/results(for:)"
        },
        {
          "description" : "An asynchronous sequence that emits updates from a statistics collection query.",
          "name" : "HKStatisticsCollectionQueryDescriptor.Results",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKStatisticsCollectionQueryDescriptor\/Results"
        }
      ],
      "title" : "Running Queries"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "A predicate that defines the set of data that the query uses to calculate the statistics.",
          "name" : "predicate",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKStatisticsCollectionQueryDescriptor\/predicate"
        },
        {
          "description" : "A list of options that define the type of statistical calculations performed and the way in which HealthKit merges data from multiple sources.",
          "name" : "options",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKStatisticsCollectionQueryDescriptor\/options"
        },
        {
          "description" : "The date that anchors the collection’s time intervals.",
          "name" : "anchorDate",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKStatisticsCollectionQueryDescriptor\/anchorDate"
        },
        {
          "description" : "The date components that define the time interval for each statistics object in the collection.",
          "name" : "intervalComponents",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKStatisticsCollectionQueryDescriptor\/intervalComponents"
        }
      ],
      "title" : "Accessing Query Properties"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "A collection of results.",
          "name" : "HKStatisticsCollectionQueryDescriptor.Result",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKStatisticsCollectionQueryDescriptor\/Result"
        }
      ],
      "title" : "Structures"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "",
          "name" : "HKAsyncQuery Implementations",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKStatisticsCollectionQueryDescriptor\/HKAsyncQuery-Implementations"
        },
        {
          "description" : "",
          "name" : "HKAsyncSequenceQuery Implementations",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKStatisticsCollectionQueryDescriptor\/HKAsyncSequenceQuery-Implementations"
        }
      ],
      "title" : "Default Implementations"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "Create and run statistical queries.",
          "name" : "Executing Statistical Queries",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/executing-statistical-queries"
        },
        {
          "description" : "Calculate statistical data for graphs and charts.",
          "name" : "Executing Statistics Collection Queries",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/executing-statistics-collection-queries"
        },
        {
          "description" : "A query descriptor that calculates the minimum, maximum, average, or sum over a set of samples from the HealthKit store.",
          "name" : "HKStatisticsQueryDescriptor",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKStatisticsQueryDescriptor"
        },
        {
          "description" : "A query that performs statistical calculations over a set of matching quantity samples, and returns the results.",
          "name" : "HKStatisticsQuery",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKStatisticsQuery"
        },
        {
          "description" : "A query that performs multiple statistics queries over a series of fixed-length time intervals.",
          "name" : "HKStatisticsCollectionQuery",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKStatisticsCollectionQuery"
        },
        {
          "description" : "An object that represents the result of calculating the minimum, maximum, average, or sum over a set of samples from the HealthKit store.",
          "name" : "HKStatistics",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKStatistics"
        },
        {
          "description" : "An object that manages a collection of statistics, representing the results calculated over separate time intervals.",
          "name" : "HKStatisticsCollection",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKStatisticsCollection"
        },
        {
          "description" : "Options for specifying the statistic to calculate.",
          "name" : "HKStatisticsOptions",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKStatisticsOptions"
        }
      ],
      "title" : "Statistics"
    }
  ],
  "source" : "appleJSON",
  "title" : "HKStatisticsCollectionQueryDescriptor",
  "url" : "https:\/\/developer.apple.com\/documentation\/healthkit\/hkstatisticscollectionquerydescriptor"
}