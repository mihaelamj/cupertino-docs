{
  "abstract" : "Create, run, and sort sample queries.",
  "codeExamples" : [
    {
      "code" : "guard let sampleType = HKSampleType.quantityType(forIdentifier: HKQuantityTypeIdentifier.dietaryEnergyConsumed) else {\n    fatalError(\"*** This method should never fail ***\")\n}",
      "language" : "swift"
    },
    {
      "code" : "let query = HKSampleQuery(sampleType: sampleType, predicate: nil, limit: Int(HKObjectQueryNoLimit), sortDescriptors: nil) {\n    query, results, error in\n    \n    guard let samples = results as? [HKQuantitySample] else {\n        \/\/ Handle any errors here.\n        return\n    }\n    \n    for sample in samples {\n        \/\/ Process each sample here.\n    }\n    \n    \/\/ The results come back on an anonymous background queue.\n    \/\/ Dispatch to the main queue before modifying the UI.\n    \n    DispatchQueue.main.async {\n        \/\/ Update the UI here.\n    }\n}",
      "language" : "swift"
    },
    {
      "code" : "store.execute(query)",
      "language" : "swift"
    },
    {
      "code" : "let calendar = NSCalendar.current\nlet now = Date()\nlet components = calendar.dateComponents([.year, .month, .day], from: now)\n    \nguard let startDate = calendar.date(from: components) else {\n    fatalError(\"*** Unable to create the start date ***\")\n}\n \nguard let endDate = calendar.date(byAdding: .day, value: 1, to: startDate) else {\n    fatalError(\"*** Unable to create the end date ***\")\n}\n\nlet today = HKQuery.predicateForSamples(withStart: startDate, end: endDate, options: [])",
      "language" : "swift"
    },
    {
      "code" : "let sortByDate = NSSortDescriptor(key: HKSampleSortIdentifierStartDate, ascending: true)",
      "language" : "swift"
    },
    {
      "code" : "let filteredAndSortedQuery = HKSampleQuery(sampleType: sampleType,\n                                           predicate: today,\n                                           limit: Int(HKObjectQueryNoLimit),\n                                           sortDescriptors: [sortByDate]) {\n    query, results, error in\n    \/\/ Process the results here.\n}",
      "language" : "swift"
    }
  ],
  "contentHash" : "fe84f97e541635f27c1106dd614276c25b2d8fd8d8fa43ec45982c28ac942af8",
  "crawledAt" : "2025-12-03T07:49:38Z",
  "id" : "1F615177-0284-42AB-9A6C-4ED31FA0D7B3",
  "kind" : "article",
  "language" : "swift",
  "module" : "HealthKit",
  "overview" : "## Overview\n\nUse sample queries to read samples from the HealthKit store. Each query returns a single type of sample, such as step count or heart rate. You can filter results further with a predicate, or sort the results using sort descriptors.\n\n### Create and Run the Query\n\nYou create a sample query by calling the [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKSampleQuery\/init(sampleType:predicate:limit:sortDescriptors:resultsHandler:)] initializer. Start by creating the sample type.\n\nThen create the query itself. This query returns all dietary energy consumed samples. Its results handler checks for any errors before processing the samples, then dispatches updates to the user interface to the main queue.\n\nAfter the query is instantiated, you run it by calling the HealthKit store’s [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKHealthStore\/execute(_:)] method.\n\nThis method runs the query on an anonymous background queue. When the query is complete, it executes the results handler on the same background queue (but not necessarily the same thread).\n\n### Filter and Sort Results\n\nBy default, a query returns all samples of the specified type. Often you want the HealthKit store to filter the results, and only return a specific subset of samples. You may also want the store to sort the results before returning them.\n\nTo filter the results, create a predicate for your samples. The following code limits the search results to samples with a start date between midnight last night and midnight tonight.\n\nTo sort the results, create one or more sort descriptors. The following code sorts the results by their start dates.\n\nThen create a query using both the predicate and an array of sort descriptors.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/HealthKit\/executing-sample-queries\ncrawled: 2025-12-03T07:49:38Z\n---\n\n# Executing Sample Queries\n\n**Article**\n\nCreate, run, and sort sample queries.\n\n## Overview\n\nUse sample queries to read samples from the HealthKit store. Each query returns a single type of sample, such as step count or heart rate. You can filter results further with a predicate, or sort the results using sort descriptors.\n\n### Create and Run the Query\n\nYou create a sample query by calling the [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKSampleQuery\/init(sampleType:predicate:limit:sortDescriptors:resultsHandler:)] initializer. Start by creating the sample type.\n\n```swift\nguard let sampleType = HKSampleType.quantityType(forIdentifier: HKQuantityTypeIdentifier.dietaryEnergyConsumed) else {\n    fatalError(\"*** This method should never fail ***\")\n}\n```\n\nThen create the query itself. This query returns all dietary energy consumed samples. Its results handler checks for any errors before processing the samples, then dispatches updates to the user interface to the main queue.\n\n```swift\nlet query = HKSampleQuery(sampleType: sampleType, predicate: nil, limit: Int(HKObjectQueryNoLimit), sortDescriptors: nil) {\n    query, results, error in\n    \n    guard let samples = results as? [HKQuantitySample] else {\n        \/\/ Handle any errors here.\n        return\n    }\n    \n    for sample in samples {\n        \/\/ Process each sample here.\n    }\n    \n    \/\/ The results come back on an anonymous background queue.\n    \/\/ Dispatch to the main queue before modifying the UI.\n    \n    DispatchQueue.main.async {\n        \/\/ Update the UI here.\n    }\n}\n```\n\nAfter the query is instantiated, you run it by calling the HealthKit store’s [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKHealthStore\/execute(_:)] method.\n\n```swift\nstore.execute(query)\n```\n\nThis method runs the query on an anonymous background queue. When the query is complete, it executes the results handler on the same background queue (but not necessarily the same thread).\n\n### Filter and Sort Results\n\nBy default, a query returns all samples of the specified type. Often you want the HealthKit store to filter the results, and only return a specific subset of samples. You may also want the store to sort the results before returning them.\n\nTo filter the results, create a predicate for your samples. The following code limits the search results to samples with a start date between midnight last night and midnight tonight.\n\n```swift\nlet calendar = NSCalendar.current\nlet now = Date()\nlet components = calendar.dateComponents([.year, .month, .day], from: now)\n    \nguard let startDate = calendar.date(from: components) else {\n    fatalError(\"*** Unable to create the start date ***\")\n}\n \nguard let endDate = calendar.date(byAdding: .day, value: 1, to: startDate) else {\n    fatalError(\"*** Unable to create the end date ***\")\n}\n\nlet today = HKQuery.predicateForSamples(withStart: startDate, end: endDate, options: [])\n```\n\nTo sort the results, create one or more sort descriptors. The following code sorts the results by their start dates.\n\n```swift\nlet sortByDate = NSSortDescriptor(key: HKSampleSortIdentifierStartDate, ascending: true)\n```\n\nThen create a query using both the predicate and an array of sort descriptors.\n\n```swift\nlet filteredAndSortedQuery = HKSampleQuery(sampleType: sampleType,\n                                           predicate: today,\n                                           limit: Int(HKObjectQueryNoLimit),\n                                           sortDescriptors: [sortByDate]) {\n    query, results, error in\n    \/\/ Process the results here.\n}\n```\n\n## Creating Sample Queries\n\n- **init(sampleType:predicate:limit:sortDescriptors:resultsHandler:)**: Instantiates and returns a sample query.\n- **init(queryDescriptors:limit:resultsHandler:)**: Creates a query for samples that match any of the descriptors you provided.\n- **init(queryDescriptors:limit:sortDescriptors:resultsHandler:)**: Creates a query for samples that match any of the query descriptors you provided, sorted by the sort descriptors you provided.\n- **HKObjectQueryNoLimit**: A value indicating that the query returns all the matching samples in the HealthKit store.\n- **HealthKit sort descriptors**: Identifiers for sorting results.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Instantiates and returns a sample query.",
          "name" : "init(sampleType:predicate:limit:sortDescriptors:resultsHandler:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKSampleQuery\/init(sampleType:predicate:limit:sortDescriptors:resultsHandler:)"
        },
        {
          "description" : "Creates a query for samples that match any of the descriptors you provided.",
          "name" : "init(queryDescriptors:limit:resultsHandler:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKSampleQuery\/init(queryDescriptors:limit:resultsHandler:)"
        },
        {
          "description" : "Creates a query for samples that match any of the query descriptors you provided, sorted by the sort descriptors you provided.",
          "name" : "init(queryDescriptors:limit:sortDescriptors:resultsHandler:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKSampleQuery\/init(queryDescriptors:limit:sortDescriptors:resultsHandler:)"
        },
        {
          "description" : "A value indicating that the query returns all the matching samples in the HealthKit store.",
          "name" : "HKObjectQueryNoLimit",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKObjectQueryNoLimit"
        },
        {
          "description" : "Identifiers for sorting results.",
          "name" : "HealthKit sort descriptors",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/healthkit-sort-descriptors"
        }
      ],
      "title" : "Creating Sample Queries"
    }
  ],
  "source" : "appleJSON",
  "title" : "Executing Sample Queries",
  "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/executing-sample-queries"
}