{
  "abstract" : "A query interface that runs anchored object queries using Swift concurrency.",
  "codeExamples" : [
    {
      "code" : "let stepType = HKQuantityType(.stepCount)\n\n\/\/ Start by reading all matching data.\nvar anchor: HKQueryAnchor? = nil\nvar results: HKAnchoredObjectQueryDescriptor<HKQuantitySample>.Result\n\n\nrepeat {\n    \/\/ Create a query descriptor that reads a batch\n    \/\/ of 100 matching samples.\n    let anchorDescriptor =\n    HKAnchoredObjectQueryDescriptor(\n        predicates: [.quantitySample(type: stepType)],\n        anchor: anchor,\n        limit: 100\n    )\n\n    results = try await anchorDescriptor.result(for: store)\n    anchor = results.newAnchor\n    \n    \/\/ Process the batch of results here.\n    \n} while (results.addedSamples != []) && (results.deletedObjects != [])",
      "language" : "swift"
    },
    {
      "code" : "let stepType = HKQuantityType(.stepCount)\n\n\/\/ Create a query descriptor.\nlet anchorDescriptor =\nHKAnchoredObjectQueryDescriptor(\n    predicates: [.quantitySample(type: stepType)],\n    anchor: anchor\n)\n\nlet updateQueue = anchorDescriptor.results(for: store)\n\nupdateTask = Task {\n    for try await update in updateQueue {\n        \/\/ Process the update here.\n        print(update)\n    }\n}",
      "language" : "swift"
    }
  ],
  "conformsTo" : [
    "Copyable",
    "HKAsyncQuery",
    "HKAsyncSequenceQuery",
    "Sendable",
    "SendableMetatype"
  ],
  "contentHash" : "13c78154590de3852be87739288ef88179a54933040cef99e1d6006f0c0da9fc",
  "crawledAt" : "2025-12-04T17:47:26Z",
  "declaration" : {
    "code" : "struct HKAnchoredObjectQueryDescriptor<Sample> where Sample : HKSample",
    "language" : "swift"
  },
  "id" : "19A1AE12-1913-4FFE-B2A3-95662D6240FF",
  "kind" : "struct",
  "language" : "swift",
  "module" : "HealthKit",
  "overview" : "## Overview\n\nUse  [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKAnchoredObjectQueryDescriptor] to read any changes to the HealthKit store that occurred after the provided anchor. When creating a new query descriptor, if you pass `nil` as the `anchor` parameter, the query reads all matching data from the store.\n\nThere are two common use cases for anchored object queries:\n\n### Batch Read Existing Data\n\nUsers may have large quantities of data saved to the HealthKit store; therefore, reading all data for a given data type might become very expensive, both in terms of memory usage and processing time. To avoid performance issues, you can use [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKAnchoredObjectQueryDescriptor] queries to read the data in batches.\n\nStart with a `nil`-valued anchor, and create a one-shot query descriptor that reads a batch of data. After you process the results from one query, start a new one-shot query for the next batch. Continue reading batches until there’s no new data.\n\n### Monitor for Changes\n\nTo monitor the HealthKit store for changes, start by creating an [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKAnchoredObjectQueryDescriptor] instance that matches the data you want to monitor. Pass in the anchor from the last time you read data from the HealthKit store.\n\nNext, call the query descriptor’s [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKAnchoredObjectQueryDescriptor\/results(for:)] method to start your long-running query. This method returns an [doc:\/\/com.apple.documentation\/documentation\/Swift\/AsyncSequence] instance which HealthKit uses to return `Results\/Element` instances. The first result represents any changes currently in the HealthKit store, and additional results represent changes as they occur.",
  "platforms" : [
    "iOS",
    "iPadOS",
    "Mac Catalyst",
    "macOS",
    "visionOS",
    "watchOS"
  ],
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/healthkit\/hkanchoredobjectquerydescriptor\ncrawled: 2025-12-04T17:47:26Z\n---\n\n# HKAnchoredObjectQueryDescriptor\n\n**Structure**\n\nA query interface that runs anchored object queries using Swift concurrency.\n\n## Declaration\n\n```swift\nstruct HKAnchoredObjectQueryDescriptor<Sample> where Sample : HKSample\n```\n\n## Overview\n\nUse  [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKAnchoredObjectQueryDescriptor] to read any changes to the HealthKit store that occurred after the provided anchor. When creating a new query descriptor, if you pass `nil` as the `anchor` parameter, the query reads all matching data from the store.\n\nThere are two common use cases for anchored object queries:\n\n- Batch-read all the matching data from the HealthKit store using a series of [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKAnchoredObjectQueryDescriptor] instances.\n- Monitor the HealthKit store for any changes to the matching data using a long-running [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKAnchoredObjectQueryDescriptor] instance.\n\n### Batch Read Existing Data\n\nUsers may have large quantities of data saved to the HealthKit store; therefore, reading all data for a given data type might become very expensive, both in terms of memory usage and processing time. To avoid performance issues, you can use [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKAnchoredObjectQueryDescriptor] queries to read the data in batches.\n\nStart with a `nil`-valued anchor, and create a one-shot query descriptor that reads a batch of data. After you process the results from one query, start a new one-shot query for the next batch. Continue reading batches until there’s no new data.\n\n```swift\nlet stepType = HKQuantityType(.stepCount)\n\n\/\/ Start by reading all matching data.\nvar anchor: HKQueryAnchor? = nil\nvar results: HKAnchoredObjectQueryDescriptor<HKQuantitySample>.Result\n\n\nrepeat {\n    \/\/ Create a query descriptor that reads a batch\n    \/\/ of 100 matching samples.\n    let anchorDescriptor =\n    HKAnchoredObjectQueryDescriptor(\n        predicates: [.quantitySample(type: stepType)],\n        anchor: anchor,\n        limit: 100\n    )\n\n    results = try await anchorDescriptor.result(for: store)\n    anchor = results.newAnchor\n    \n    \/\/ Process the batch of results here.\n    \n} while (results.addedSamples != []) && (results.deletedObjects != [])\n```\n\n\n\n### Monitor for Changes\n\nTo monitor the HealthKit store for changes, start by creating an [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKAnchoredObjectQueryDescriptor] instance that matches the data you want to monitor. Pass in the anchor from the last time you read data from the HealthKit store.\n\nNext, call the query descriptor’s [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKAnchoredObjectQueryDescriptor\/results(for:)] method to start your long-running query. This method returns an [doc:\/\/com.apple.documentation\/documentation\/Swift\/AsyncSequence] instance which HealthKit uses to return `Results\/Element` instances. The first result represents any changes currently in the HealthKit store, and additional results represent changes as they occur.\n\n```swift\nlet stepType = HKQuantityType(.stepCount)\n\n\/\/ Create a query descriptor.\nlet anchorDescriptor =\nHKAnchoredObjectQueryDescriptor(\n    predicates: [.quantitySample(type: stepType)],\n    anchor: anchor\n)\n\nlet updateQueue = anchorDescriptor.results(for: store)\n\nupdateTask = Task {\n    for try await update in updateQueue {\n        \/\/ Process the update here.\n        print(update)\n    }\n}\n```\n\n## Creating Query Descriptors\n\n- **init(predicates:anchor:limit:)**: Creates an anchored object query descriptor.\n\n## Running Queries\n\n- **result(for:)**: Runs a one-shot query and asynchronously returns a snapshot of the current matching results.\n- **results(for:)**: Initiates a long-running query that returns its results using an asynchronous sequence.\n- **HKAnchoredObjectQueryDescriptor.Result**: A set of results from an anchored object query.\n- **HKAnchoredObjectQueryDescriptor.Results**: An asynchronous sequence that emits updates from an anchored object query.\n\n## Accessing Query Properties\n\n- **predicates**: A predicate that limits the results that the query returns.\n- **anchor**: An anchor that a previous anchored object query returned.\n- **limit**: The maximum number of samples that the query returns.\n\n## Default Implementations\n\n- **HKAsyncQuery Implementations**\n- **HKAsyncSequenceQuery Implementations**\n\n## Long-running queries\n\n- **HKActivitySummaryQueryDescriptor**: A query interface that reads activity summaries using Swift concurrency.\n- **HKActivitySummaryQuery**: A query for reading activity summary objects from the HealthKit store.\n- **HKAnchoredObjectQuery**: A query that returns changes to the HealthKit store, including a snapshot of new changes and continuous monitoring as a long-running query.\n- **HKObserverQuery**: A long-running query that monitors the HealthKit store and updates your app when the HealthKit store saves or deletes a matching sample.\n\n## Conforms To\n\n- Copyable\n- HKAsyncQuery\n- HKAsyncSequenceQuery\n- Sendable\n- SendableMetatype\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Creates an anchored object query descriptor.",
          "name" : "init(predicates:anchor:limit:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKAnchoredObjectQueryDescriptor\/init(predicates:anchor:limit:)"
        }
      ],
      "title" : "Creating Query Descriptors"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "Runs a one-shot query and asynchronously returns a snapshot of the current matching results.",
          "name" : "result(for:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKAnchoredObjectQueryDescriptor\/result(for:)"
        },
        {
          "description" : "Initiates a long-running query that returns its results using an asynchronous sequence.",
          "name" : "results(for:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKAnchoredObjectQueryDescriptor\/results(for:)"
        },
        {
          "description" : "A set of results from an anchored object query.",
          "name" : "HKAnchoredObjectQueryDescriptor.Result",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKAnchoredObjectQueryDescriptor\/Result"
        },
        {
          "description" : "An asynchronous sequence that emits updates from an anchored object query.",
          "name" : "HKAnchoredObjectQueryDescriptor.Results",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKAnchoredObjectQueryDescriptor\/Results"
        }
      ],
      "title" : "Running Queries"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "A predicate that limits the results that the query returns.",
          "name" : "predicates",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKAnchoredObjectQueryDescriptor\/predicates"
        },
        {
          "description" : "An anchor that a previous anchored object query returned.",
          "name" : "anchor",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKAnchoredObjectQueryDescriptor\/anchor"
        },
        {
          "description" : "The maximum number of samples that the query returns.",
          "name" : "limit",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKAnchoredObjectQueryDescriptor\/limit"
        }
      ],
      "title" : "Accessing Query Properties"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "",
          "name" : "HKAsyncQuery Implementations",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKAnchoredObjectQueryDescriptor\/HKAsyncQuery-Implementations"
        },
        {
          "description" : "",
          "name" : "HKAsyncSequenceQuery Implementations",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKAnchoredObjectQueryDescriptor\/HKAsyncSequenceQuery-Implementations"
        }
      ],
      "title" : "Default Implementations"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "A query interface that reads activity summaries using Swift concurrency.",
          "name" : "HKActivitySummaryQueryDescriptor",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKActivitySummaryQueryDescriptor"
        },
        {
          "description" : "A query for reading activity summary objects from the HealthKit store.",
          "name" : "HKActivitySummaryQuery",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKActivitySummaryQuery"
        },
        {
          "description" : "A query that returns changes to the HealthKit store, including a snapshot of new changes and continuous monitoring as a long-running query.",
          "name" : "HKAnchoredObjectQuery",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKAnchoredObjectQuery"
        },
        {
          "description" : "A long-running query that monitors the HealthKit store and updates your app when the HealthKit store saves or deletes a matching sample.",
          "name" : "HKObserverQuery",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKObserverQuery"
        }
      ],
      "title" : "Long-running queries"
    }
  ],
  "source" : "appleJSON",
  "title" : "HKAnchoredObjectQueryDescriptor",
  "url" : "https:\/\/developer.apple.com\/documentation\/healthkit\/hkanchoredobjectquerydescriptor"
}