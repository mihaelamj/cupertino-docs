{
  "abstract" : "Create and run source queries.",
  "codeExamples" : [
    {
      "code" : "guard let stepCountType = HKObjectType.quantityType(forIdentifier: .stepCount) else {\n    \/\/ This should never fail when using a defined constant.\n    fatalError(\"*** Unable to get the step count type ***\")\n}",
      "language" : "swift"
    },
    {
      "code" : "let query = HKSourceQuery(sampleType: stepCountType, samplePredicate: nil) { (query, sourcesOrNil, errorOrNil) in\n    \n    guard let sources = sourcesOrNil else {\n        \/\/ Properly handle the error.\n        return\n    }\n    \n    for source in sources {\n        \/\/ Process sources here.\n    }\n    \n    DispatchQueue.main.async {\n        \/\/ Update the UI here.\n    }\n}",
      "language" : "swift"
    },
    {
      "code" : "store.execute(query)",
      "language" : "swift"
    }
  ],
  "contentHash" : "c53735c938adc4fd5e2f1c63bd4e0539e9e53592f94a47ed18a595c95dde8ac5",
  "crawledAt" : "2025-12-03T07:54:37Z",
  "id" : "75EF9FD6-6CAC-458C-88D0-0B02FA918BC1",
  "kind" : "article",
  "language" : "swift",
  "module" : "HealthKit",
  "overview" : "## Overview\n\nSource queries return a list of apps and devices that have saved data to the HealthKit store.  The query returns all sources for the specified sample type.\n\n### Create Source Queries\n\nYou create a source query by calling the [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKSourceQuery\/init(sampleType:samplePredicate:completionHandler:)] initializer. Start by creating the type object for the desired samples. The following example creates a type object for step counts.\n\nThen use the type object to create the query. Source queries return a list of sources (apps and devices) that have saved queries matching the sample type. The callback handler should check for errors before processing the sources. It should also dispatch updates to the user interface back to the main thread.\n\n### Run the Query\n\nAfter the query is instantiated, you run it by calling the HealthKit store’s [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKHealthStore\/execute(_:)] method.\n\nThis runs the query on an anonymous background queue. When the query is complete, it executes the results handler on the same background queue (but not necessarily the same thread).",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/HealthKit\/executing-source-queries\ncrawled: 2025-12-03T07:54:37Z\n---\n\n# Executing Source Queries\n\n**Article**\n\nCreate and run source queries.\n\n## Overview\n\nSource queries return a list of apps and devices that have saved data to the HealthKit store.  The query returns all sources for the specified sample type.\n\n### Create Source Queries\n\nYou create a source query by calling the [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKSourceQuery\/init(sampleType:samplePredicate:completionHandler:)] initializer. Start by creating the type object for the desired samples. The following example creates a type object for step counts.\n\n```swift\nguard let stepCountType = HKObjectType.quantityType(forIdentifier: .stepCount) else {\n    \/\/ This should never fail when using a defined constant.\n    fatalError(\"*** Unable to get the step count type ***\")\n}\n```\n\nThen use the type object to create the query. Source queries return a list of sources (apps and devices) that have saved queries matching the sample type. The callback handler should check for errors before processing the sources. It should also dispatch updates to the user interface back to the main thread.\n\n```swift\nlet query = HKSourceQuery(sampleType: stepCountType, samplePredicate: nil) { (query, sourcesOrNil, errorOrNil) in\n    \n    guard let sources = sourcesOrNil else {\n        \/\/ Properly handle the error.\n        return\n    }\n    \n    for source in sources {\n        \/\/ Process sources here.\n    }\n    \n    DispatchQueue.main.async {\n        \/\/ Update the UI here.\n    }\n}\n```\n\n### Run the Query\n\nAfter the query is instantiated, you run it by calling the HealthKit store’s [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKHealthStore\/execute(_:)] method.\n\n```swift\nstore.execute(query)\n```\n\nThis runs the query on an anonymous background queue. When the query is complete, it executes the results handler on the same background queue (but not necessarily the same thread).\n\n## Creating Source Queries\n\n- **init(sampleType:samplePredicate:completionHandler:)**: Instantiates and returns a source query.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Instantiates and returns a source query.",
          "name" : "init(sampleType:samplePredicate:completionHandler:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKSourceQuery\/init(sampleType:samplePredicate:completionHandler:)"
        }
      ],
      "title" : "Creating Source Queries"
    }
  ],
  "source" : "appleJSON",
  "title" : "Executing Source Queries",
  "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/executing-source-queries"
}