{
  "abstract" : "Creates a query that monitors the HealthKit store and responds to any changes matching any of the query descriptors you provided.",
  "codeExamples" : [
    {
      "code" : "\/\/ Create the data types.\nlet stepCountType = HKQuantityType(.stepCount)\nlet pushCountType = HKQuantityType(.pushCount)\n\n\/\/ Specify the desired sample types.\nlet stepDescriptor = HKQueryDescriptor(sampleType: stepCountType, predicate: nil)\nlet pushDescriptor = HKQueryDescriptor(sampleType: pushCountType, predicate: nil)\n\n\/\/ Create the query.\nlet observerQuery = HKObserverQuery(queryDescriptors: [stepDescriptor, pushDescriptor])\n{ query, updatedSampleTypes, completionHandler, error in\n    \n    if let error = error {\n        \/\/ Handle errors here.\n    }\n    \n    if let types = updatedSampleTypes {\n        let descriptors = types.map { type in\n            HKQueryDescriptor(sampleType: type, predicate: nil)\n        }\n        \n        \/\/ Create an inner query to access the changed data.\n        let anchorQuery = HKAnchoredObjectQuery(queryDescriptors: descriptors,\n                                                anchor: anchor,\n                                                limit: HKObjectQueryNoLimit)\n        {\n            anchorQuery, samples, deleted, newAnchor, error in\n            if let error = error {\n                \/\/ Handle errors here.\n            }\n            \n            DispatchQueue.main.async {\n                \/\/ Update the anchor.\n                anchor = newAnchor\n                \n                \/\/ Process the samples and deleted objects here.\n                \n                \/\/ Call the observer's completion handler.\n                completionHandler()\n            }\n        }\n        \n        \/\/ Run the inner query.\n        store.execute(anchorQuery)\n    }\n}",
      "language" : "swift"
    }
  ],
  "contentHash" : "5d121adfdeff466fcb48890ba6d0d1d35797ea6902b13ca5be2ef05cbf38a4bc",
  "crawledAt" : "2025-12-03T08:13:24Z",
  "declaration" : {
    "code" : "init(queryDescriptors: [HKQueryDescriptor], updateHandler: @escaping (HKObserverQuery, Set<HKSampleType>?, @escaping HKObserverQueryCompletionHandler, (any Error)?) -> Void)",
    "language" : "swift"
  },
  "id" : "5BD8C605-39CF-4D39-BAD4-A4F54AF8F380",
  "kind" : "unknown",
  "language" : "swift",
  "module" : "HealthKit",
  "overview" : "## Discussion\n\nUse this initializer to create an observer query for changes that match any of the [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKQueryDescriptor] objects. Each descriptor can specify a different data type.\n\nAfter instantiating the query, call the [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKHealthStore] class’s [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKHealthStore\/execute(_:)] method to run this query. Observer queries are long-running tasks. They continue to run on an anonymous background thread and call their results handler when the system, the user, or any app adds or deletes a matching sample from the HealthKit store. To stop a query, call the [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKHealthStore] class’s [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKHealthStore\/stop(_:)] method. You can use Observer queries to receive updates in the background. For more information, see [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/executing-observer-queries].\n\nThe system calls the update handler block you provide every time something saves or deletes samples matching this query from the HealthKit store. You often need to launch other queries from inside this block to get the updated data. In particular, you can use anchored object queries to retrieve the list of new samples added to the store. For more information, see [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKAnchoredObjectQuery].\n\nFor example, the following code monitors the store and calls the update handler after any relevant changes:",
  "platforms" : [
    "iOS",
    "iPadOS",
    "Mac Catalyst",
    "macOS",
    "visionOS",
    "watchOS"
  ],
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/HealthKit\/HKObserverQuery\/init(queryDescriptors:updateHandler:)\ncrawled: 2025-12-03T08:13:24Z\n---\n\n# init(queryDescriptors:updateHandler:)\n\n**Initializer**\n\nCreates a query that monitors the HealthKit store and responds to any changes matching any of the query descriptors you provided.\n\n## Declaration\n\n```swift\ninit(queryDescriptors: [HKQueryDescriptor], updateHandler: @escaping (HKObserverQuery, Set<HKSampleType>?, @escaping HKObserverQueryCompletionHandler, (any Error)?) -> Void)\n```\n\n## Parameters\n\n- **queryDescriptors**: An array of descriptors that specifies the types of samples the query returns.\n- **updateHandler**: A block that the system calls when a matching sample is saved to or deleted from the HealthKit store. This block takes the following parameters:\n\n\n\n## Discussion\n\nUse this initializer to create an observer query for changes that match any of the [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKQueryDescriptor] objects. Each descriptor can specify a different data type.\n\nAfter instantiating the query, call the [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKHealthStore] class’s [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKHealthStore\/execute(_:)] method to run this query. Observer queries are long-running tasks. They continue to run on an anonymous background thread and call their results handler when the system, the user, or any app adds or deletes a matching sample from the HealthKit store. To stop a query, call the [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKHealthStore] class’s [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKHealthStore\/stop(_:)] method. You can use Observer queries to receive updates in the background. For more information, see [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/executing-observer-queries].\n\nThe system calls the update handler block you provide every time something saves or deletes samples matching this query from the HealthKit store. You often need to launch other queries from inside this block to get the updated data. In particular, you can use anchored object queries to retrieve the list of new samples added to the store. For more information, see [doc:\/\/com.apple.healthkit\/documentation\/HealthKit\/HKAnchoredObjectQuery].\n\nFor example, the following code monitors the store and calls the update handler after any relevant changes:\n\n```swift\n\/\/ Create the data types.\nlet stepCountType = HKQuantityType(.stepCount)\nlet pushCountType = HKQuantityType(.pushCount)\n\n\/\/ Specify the desired sample types.\nlet stepDescriptor = HKQueryDescriptor(sampleType: stepCountType, predicate: nil)\nlet pushDescriptor = HKQueryDescriptor(sampleType: pushCountType, predicate: nil)\n\n\/\/ Create the query.\nlet observerQuery = HKObserverQuery(queryDescriptors: [stepDescriptor, pushDescriptor])\n{ query, updatedSampleTypes, completionHandler, error in\n    \n    if let error = error {\n        \/\/ Handle errors here.\n    }\n    \n    if let types = updatedSampleTypes {\n        let descriptors = types.map { type in\n            HKQueryDescriptor(sampleType: type, predicate: nil)\n        }\n        \n        \/\/ Create an inner query to access the changed data.\n        let anchorQuery = HKAnchoredObjectQuery(queryDescriptors: descriptors,\n                                                anchor: anchor,\n                                                limit: HKObjectQueryNoLimit)\n        {\n            anchorQuery, samples, deleted, newAnchor, error in\n            if let error = error {\n                \/\/ Handle errors here.\n            }\n            \n            DispatchQueue.main.async {\n                \/\/ Update the anchor.\n                anchor = newAnchor\n                \n                \/\/ Process the samples and deleted objects here.\n                \n                \/\/ Call the observer's completion handler.\n                completionHandler()\n            }\n        }\n        \n        \/\/ Run the inner query.\n        store.execute(anchorQuery)\n    }\n}\n```\n\n## Creating Observer Queries\n\n- **Executing Observer Queries**: Create and run observer queries.\n- **init(sampleType:predicate:updateHandler:)**: Instantiates and returns a query that monitors the HealthKit store and responds to changes.\n- **HKObserverQueryCompletionHandler**: The completion handler for background deliveries.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Create and run observer queries.",
          "name" : "Executing Observer Queries",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/executing-observer-queries"
        },
        {
          "description" : "Instantiates and returns a query that monitors the HealthKit store and responds to changes.",
          "name" : "init(sampleType:predicate:updateHandler:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKObserverQuery\/init(sampleType:predicate:updateHandler:)"
        },
        {
          "description" : "The completion handler for background deliveries.",
          "name" : "HKObserverQueryCompletionHandler",
          "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKObserverQueryCompletionHandler"
        }
      ],
      "title" : "Creating Observer Queries"
    }
  ],
  "source" : "appleJSON",
  "title" : "init(queryDescriptors:updateHandler:)",
  "url" : "https:\/\/developer.apple.com\/documentation\/HealthKit\/HKObserverQuery\/init(queryDescriptors:updateHandler:)"
}