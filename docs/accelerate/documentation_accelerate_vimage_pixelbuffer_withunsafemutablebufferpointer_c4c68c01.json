{
  "abstract" : "Calls the given closure with a pointer to the buffer’s mutable contiguous storage.",
  "codeExamples" : [
    {
      "code" : "let srcImage =  imageLiteral(resourceName: \" ... \").cgImage(\n    forProposedRect: nil,\n    context: nil,\n    hints: nil)!\n\nvar cgImageFormat = vImage_CGImageFormat()\n\nlet buffer = try vImage.PixelBuffer(\n    cgImage: srcImage,\n    cgImageFormat: &cgImageFormat,\n    pixelFormat: vImage.Interleaved8x4.self)\n\nbuffer.withUnsafeMutableBufferPointer { ptr in\n    \n    \/\/ Define font.\n    let fontAttributes = [\n        kCTFontFamilyNameAttribute : \"Futura\",\n        kCTFontStyleNameAttribute : \"Medium Italic\"\n    ] as NSDictionary\n    let fontDescriptor = CTFontDescriptorCreateWithAttributes(fontAttributes)\n    let font = CTFontCreateWithFontDescriptor(fontDescriptor, 48, nil)\n    let attributes = [kCTFontAttributeName : font] as CFDictionary\n    \n    \/\/ Create `CGContext` and attributed string.\n    guard\n        let context = CGContext(data: ptr.baseAddress!,\n                                width: buffer.width,\n                                height: buffer.height,\n                                bitsPerComponent: Int(cgImageFormat.bitsPerComponent),\n                                bytesPerRow: buffer.rowStride * buffer.byteCountPerPixel,\n                                space: cgImageFormat.colorSpace.takeRetainedValue(),\n                                bitmapInfo: cgImageFormat.bitmapInfo.rawValue),\n        let text = CFAttributedStringCreate(nil,\n                                            \"vImage Pixel Buffer\" as CFString,\n                                            attributes) else {\n        return\n    }\n    \n    let line = CTLineCreateWithAttributedString(text)\n    \n    context.textPosition = CGPoint(x: 25, y: 25)\n    \n    \/\/ Draw text background gray rectangle.\n    let boundingRect = CTLineGetImageBounds(line, context).insetBy(dx: -5, dy: -5)\n    context.setFillColor(.init(gray: 0.75, alpha: 0.75))\n    context.addRect(boundingRect)\n    context.drawPath(using: .fill)\n    \n    \/\/ Draw text to `CGContext`.\n    CTLineDraw(line, context)\n}\n\nlet result = buffer.makeCGImage(cgImageFormat: cgImageFormat)!",
      "language" : "swift"
    },
    {
      "code" : "let buffer = vImage.PixelBuffer(\n    size: vImage.Size(width: 512,\n                      height: 512),\n    pixelFormat: vImage.Interleaved8x3.self)\n\nbuffer.withUnsafeMutableBufferPointer { bufferPtr in\n\n    guard\n        var descriptor = BNNSNDArrayDescriptor(\n            data: bufferPtr,\n            shape: .vector(bufferPtr.count)),\n        let randomNumberGenerator = BNNSCreateRandomGenerator(\n            BNNSRandomGeneratorMethodAES_CTR,\n            nil) else {\n                fatalError()\n            }\n\n    BNNSRandomFillUniformInt(randomNumberGenerator,\n                             &descriptor,\n                             0, 255)\n\n    BNNSDestroyRandomGenerator(randomNumberGenerator)\n}",
      "language" : "swift"
    }
  ],
  "contentHash" : "3f8512748bf80a931f6954546537ba2624bdd06395608903459ee3320aab209f",
  "crawledAt" : "2025-12-03T08:08:53Z",
  "declaration" : {
    "code" : "func withUnsafeMutableBufferPointer<R>(_ body: (inout UnsafeMutableBufferPointer<Format.ComponentType>) throws -> R) rethrows -> R",
    "language" : "swift"
  },
  "id" : "4050F597-1967-43A9-ACC5-B8CF7F6B34FF",
  "kind" : "method",
  "language" : "swift",
  "module" : "Accelerate",
  "overview" : "## Return Value\n\nThe return value, if any, of the body closure parameter.\n\n## Discussion\n\nYou can use this function to simplify interoperation with other libraries and frameworks.\n\n### Add Text to a Pixel Buffer\n\nThe following code creates a [doc:\/\/com.apple.documentation\/documentation\/CoreGraphics\/CGContext] instance from the pointer to the buffer’s storage. The code renders a gray rectangle over the image and draws text inside the rectangle by calling [doc:\/\/com.apple.documentation\/documentation\/CoreText\/CTLineDraw(_:_:)].\n\nOn return, the buffer contains the original image with a text overlay.\n\n\n\n### Fill a Pixel Buffer with Random Values\n\nThe following code uses Accelerate’s [doc:\/\/com.apple.accelerate\/documentation\/Accelerate\/BNNS] library to fill a pixel buffer with random values:\n\nOn return, the buffer contains random color values.\n\n",
  "platforms" : [
    "iOS",
    "iPadOS",
    "Mac Catalyst",
    "macOS",
    "tvOS",
    "visionOS",
    "watchOS"
  ],
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/accelerate\/vimage\/pixelbuffer\/withunsafemutablebufferpointer(_:)\ncrawled: 2025-12-03T08:08:53Z\n---\n\n# withUnsafeMutableBufferPointer(_:)\n\n**Instance Method**\n\nCalls the given closure with a pointer to the buffer’s mutable contiguous storage.\n\n## Declaration\n\n```swift\nfunc withUnsafeMutableBufferPointer<R>(_ body: (inout UnsafeMutableBufferPointer<Format.ComponentType>) throws -> R) rethrows -> R\n```\n\n## Parameters\n\n- **body**: A closure with an [doc:\/\/com.apple.documentation\/documentation\/Swift\/UnsafeMutableBufferPointer] parameter that points to the contiguous storage for the pixel buffer.\n\n## Return Value\n\nThe return value, if any, of the body closure parameter.\n\n## Discussion\n\nYou can use this function to simplify interoperation with other libraries and frameworks.\n\n\n\n### Add Text to a Pixel Buffer\n\nThe following code creates a [doc:\/\/com.apple.documentation\/documentation\/CoreGraphics\/CGContext] instance from the pointer to the buffer’s storage. The code renders a gray rectangle over the image and draws text inside the rectangle by calling [doc:\/\/com.apple.documentation\/documentation\/CoreText\/CTLineDraw(_:_:)].\n\n```swift\nlet srcImage =  imageLiteral(resourceName: \" ... \").cgImage(\n    forProposedRect: nil,\n    context: nil,\n    hints: nil)!\n\nvar cgImageFormat = vImage_CGImageFormat()\n\nlet buffer = try vImage.PixelBuffer(\n    cgImage: srcImage,\n    cgImageFormat: &cgImageFormat,\n    pixelFormat: vImage.Interleaved8x4.self)\n\nbuffer.withUnsafeMutableBufferPointer { ptr in\n    \n    \/\/ Define font.\n    let fontAttributes = [\n        kCTFontFamilyNameAttribute : \"Futura\",\n        kCTFontStyleNameAttribute : \"Medium Italic\"\n    ] as NSDictionary\n    let fontDescriptor = CTFontDescriptorCreateWithAttributes(fontAttributes)\n    let font = CTFontCreateWithFontDescriptor(fontDescriptor, 48, nil)\n    let attributes = [kCTFontAttributeName : font] as CFDictionary\n    \n    \/\/ Create `CGContext` and attributed string.\n    guard\n        let context = CGContext(data: ptr.baseAddress!,\n                                width: buffer.width,\n                                height: buffer.height,\n                                bitsPerComponent: Int(cgImageFormat.bitsPerComponent),\n                                bytesPerRow: buffer.rowStride * buffer.byteCountPerPixel,\n                                space: cgImageFormat.colorSpace.takeRetainedValue(),\n                                bitmapInfo: cgImageFormat.bitmapInfo.rawValue),\n        let text = CFAttributedStringCreate(nil,\n                                            \"vImage Pixel Buffer\" as CFString,\n                                            attributes) else {\n        return\n    }\n    \n    let line = CTLineCreateWithAttributedString(text)\n    \n    context.textPosition = CGPoint(x: 25, y: 25)\n    \n    \/\/ Draw text background gray rectangle.\n    let boundingRect = CTLineGetImageBounds(line, context).insetBy(dx: -5, dy: -5)\n    context.setFillColor(.init(gray: 0.75, alpha: 0.75))\n    context.addRect(boundingRect)\n    context.drawPath(using: .fill)\n    \n    \/\/ Draw text to `CGContext`.\n    CTLineDraw(line, context)\n}\n\nlet result = buffer.makeCGImage(cgImageFormat: cgImageFormat)!\n```\n\nOn return, the buffer contains the original image with a text overlay.\n\n\n\n### Fill a Pixel Buffer with Random Values\n\nThe following code uses Accelerate’s [doc:\/\/com.apple.accelerate\/documentation\/Accelerate\/BNNS] library to fill a pixel buffer with random values:\n\n```swift\nlet buffer = vImage.PixelBuffer(\n    size: vImage.Size(width: 512,\n                      height: 512),\n    pixelFormat: vImage.Interleaved8x3.self)\n\nbuffer.withUnsafeMutableBufferPointer { bufferPtr in\n\n    guard\n        var descriptor = BNNSNDArrayDescriptor(\n            data: bufferPtr,\n            shape: .vector(bufferPtr.count)),\n        let randomNumberGenerator = BNNSCreateRandomGenerator(\n            BNNSRandomGeneratorMethodAES_CTR,\n            nil) else {\n                fatalError()\n            }\n\n    BNNSRandomFillUniformInt(randomNumberGenerator,\n                             &descriptor,\n                             0, 255)\n\n    BNNSDestroyRandomGenerator(randomNumberGenerator)\n}\n```\n\nOn return, the buffer contains random color values.\n\n\n\n",
  "sections" : [

  ],
  "source" : "appleJSON",
  "title" : "withUnsafeMutableBufferPointer(_:)",
  "url" : "https:\/\/developer.apple.com\/documentation\/accelerate\/vimage\/pixelbuffer\/withunsafemutablebufferpointer(_:)"
}