{
  "abstract" : "Desaturate a range of colors in an image with a multidimensional lookup table.",
  "codeExamples" : [
    {
      "code" : "let targetLabColor = ColorConverter.rgbToLab(red: targetRGB[0],\n                                             green: targetRGB.count > 1 ? targetRGB[1] : targetRGB[0],\n                                             blue: targetRGB.count > 2 ? targetRGB[2] : targetRGB[0])",
      "language" : "swift"
    },
    {
      "code" : "var bufferIndex = 0\nlet multiplier = CGFloat(UInt16.max)\nfor red in ramp {\n    for green in ramp {\n        for blue in ramp {\n           \n            let srcLabColor = ColorConverter.rgbToLab(red: red, green: green, blue: blue)\n            \n            let distance = simd_distance(targetLabColor, srcLabColor)\n            \n            let effectMultiplier = 1 - simd_smoothstep(0, tolerance, distance)\n            \n            let src = NSColor(red: red,\n                              green: green,\n                              blue: blue,\n                              alpha: 1)\n            \n            let dest = NSColor(hue: src.hueComponent,\n                               saturation: src.saturationComponent * (desaturate ? CGFloat(effectMultiplier) : 1),\n                               brightness: src.brightnessComponent * (darken ? CGFloat(effectMultiplier) : 1),\n                               alpha: 1)\n            \n            lookupTableData[ bufferIndex ] = UInt16(dest.redComponent * multiplier)\n            bufferIndex += 1\n            \n            lookupTableData[ bufferIndex ] = UInt16(dest.greenComponent * multiplier)\n            bufferIndex += 1\n            \n            lookupTableData[ bufferIndex ] = UInt16(dest.blueComponent * multiplier)\n            bufferIndex += 1\n        }\n    }\n}",
      "language" : "swift"
    },
    {
      "code" : "let lookupTable = vImage.MultidimensionalLookupTable(\n    entryCountPerSourceChannel: entryCountPerSourceChannel,\n    destinationChannelCount: destChannelCount,\n    data: lookupTableData)\n\nlookupTable.apply(sources: rgbSourceBuffers,\n                  destinations: [ redDestinationBuffer,\n                                  greenDestinationBuffer,\n                                  blueDestinationBuffer ],\n                  interpolation: .full)",
      "language" : "swift"
    },
    {
      "code" : "interleavedDestinationBuffer.interleave(planarSourceBuffers: [ redDestinationBuffer,\n                                                               greenDestinationBuffer,\n                                                               blueDestinationBuffer ])",
      "language" : "swift"
    }
  ],
  "contentHash" : "b51e6eee97cfbb46a5cb1358940f8a100fcfdf0e0e9ca28f32d615a4567b3389",
  "crawledAt" : "2025-12-02T15:27:47Z",
  "id" : "B4036CCA-5A66-48E8-A7F0-956DAF8BDAE4",
  "kind" : "unknown",
  "language" : "swift",
  "module" : "Accelerate",
  "overview" : "## Overview\n\nThis sample code app allows you to desaturate the colors in an image based on their similarity to a selected color. For example, the image below shows an original image (left) and the transformed image (right) where the app has transformed the cake sprinkles that aren’t yellow to grayscale.\n\n\n\nBefore exploring the code, try building and running the app to familiarize yourself with the effect of the different transformations on the image. In the app, click the smaller image to select a color and the app displays the transformed result as the larger image.\n\n### Create the lookup table data\n\nThe multidimensional lookup table that this sample code project uses is a 3D cube with `entriesPerChannel` values along each axis.\n\nThe app defines the `targetLabColor` variable as the color that the user selects in the user interface.\n\nThe code below performs `entriesPerChannel` iterations from `0` to `1` over each color channel to populate the multidimensional lookup table data. With each iteration, the code calls [doc:\/\/com.apple.accelerate\/documentation\/simd\/simd_distance-2dror] to compute the Euclidean distance in L*a*b* color space between the target color and the color that red, green, and blue loops define.\n\nThe distance between the two colors forms the basis for the amount of desaturation or darkening that the app applies to each color value in the lookup table.\n\nFor more information about creating multidimensional lookup table data, see [doc:\/\/com.apple.accelerate\/documentation\/Accelerate\/applying-color-transforms-to-images-with-a-multidimensional-lookup-table].\n\n### Create the multidimensional lookup\n\nThe [doc:\/\/com.apple.accelerate\/documentation\/Accelerate\/vImage\/MultidimensionalLookupTable] structure uses the lookup table to transform the source image, either desaturating or darkening colors that aren’t close to the selected target color.\n\nThe code below creates a multidimension lookup table structure, applies the lookup table to the three source planar buffers, and writes the result to the three destination buffers:\n\nThe three destination planar buffers contain the transformed image.\n\n### Create a Core Graphics image\n\nThe code below interleaves the three planar buffers into a single RGB buffer. Finally, the [doc:\/\/com.apple.accelerate\/documentation\/Accelerate\/vImage\/PixelBuffer\/makeCGImage(cgImageFormat:)] function returns a Core Graphics image that the app displays in the user interface.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/Accelerate\/applying-transformations-to-selected-colors-in-an-image\ncrawled: 2025-12-02T15:27:47Z\n---\n\n# Applying transformations to selected colors in an image\n\n**Sample Code**\n\nDesaturate a range of colors in an image with a multidimensional lookup table.\n\n## Overview\n\nThis sample code app allows you to desaturate the colors in an image based on their similarity to a selected color. For example, the image below shows an original image (left) and the transformed image (right) where the app has transformed the cake sprinkles that aren’t yellow to grayscale.\n\n\n\nBefore exploring the code, try building and running the app to familiarize yourself with the effect of the different transformations on the image. In the app, click the smaller image to select a color and the app displays the transformed result as the larger image.\n\n### Create the lookup table data\n\nThe multidimensional lookup table that this sample code project uses is a 3D cube with `entriesPerChannel` values along each axis.\n\nThe app defines the `targetLabColor` variable as the color that the user selects in the user interface.\n\n```swift\nlet targetLabColor = ColorConverter.rgbToLab(red: targetRGB[0],\n                                             green: targetRGB.count > 1 ? targetRGB[1] : targetRGB[0],\n                                             blue: targetRGB.count > 2 ? targetRGB[2] : targetRGB[0])\n```\n\nThe code below performs `entriesPerChannel` iterations from `0` to `1` over each color channel to populate the multidimensional lookup table data. With each iteration, the code calls [doc:\/\/com.apple.accelerate\/documentation\/simd\/simd_distance-2dror] to compute the Euclidean distance in L*a*b* color space between the target color and the color that red, green, and blue loops define.\n\nThe distance between the two colors forms the basis for the amount of desaturation or darkening that the app applies to each color value in the lookup table.\n\n```swift\nvar bufferIndex = 0\nlet multiplier = CGFloat(UInt16.max)\nfor red in ramp {\n    for green in ramp {\n        for blue in ramp {\n           \n            let srcLabColor = ColorConverter.rgbToLab(red: red, green: green, blue: blue)\n            \n            let distance = simd_distance(targetLabColor, srcLabColor)\n            \n            let effectMultiplier = 1 - simd_smoothstep(0, tolerance, distance)\n            \n            let src = NSColor(red: red,\n                              green: green,\n                              blue: blue,\n                              alpha: 1)\n            \n            let dest = NSColor(hue: src.hueComponent,\n                               saturation: src.saturationComponent * (desaturate ? CGFloat(effectMultiplier) : 1),\n                               brightness: src.brightnessComponent * (darken ? CGFloat(effectMultiplier) : 1),\n                               alpha: 1)\n            \n            lookupTableData[ bufferIndex ] = UInt16(dest.redComponent * multiplier)\n            bufferIndex += 1\n            \n            lookupTableData[ bufferIndex ] = UInt16(dest.greenComponent * multiplier)\n            bufferIndex += 1\n            \n            lookupTableData[ bufferIndex ] = UInt16(dest.blueComponent * multiplier)\n            bufferIndex += 1\n        }\n    }\n}\n```\n\nFor more information about creating multidimensional lookup table data, see [doc:\/\/com.apple.accelerate\/documentation\/Accelerate\/applying-color-transforms-to-images-with-a-multidimensional-lookup-table].\n\n### Create the multidimensional lookup\n\nThe [doc:\/\/com.apple.accelerate\/documentation\/Accelerate\/vImage\/MultidimensionalLookupTable] structure uses the lookup table to transform the source image, either desaturating or darkening colors that aren’t close to the selected target color.\n\nThe code below creates a multidimension lookup table structure, applies the lookup table to the three source planar buffers, and writes the result to the three destination buffers:\n\n```swift\nlet lookupTable = vImage.MultidimensionalLookupTable(\n    entryCountPerSourceChannel: entryCountPerSourceChannel,\n    destinationChannelCount: destChannelCount,\n    data: lookupTableData)\n\nlookupTable.apply(sources: rgbSourceBuffers,\n                  destinations: [ redDestinationBuffer,\n                                  greenDestinationBuffer,\n                                  blueDestinationBuffer ],\n                  interpolation: .full)\n```\n\nThe three destination planar buffers contain the transformed image.\n\n### Create a Core Graphics image\n\nThe code below interleaves the three planar buffers into a single RGB buffer. Finally, the [doc:\/\/com.apple.accelerate\/documentation\/Accelerate\/vImage\/PixelBuffer\/makeCGImage(cgImageFormat:)] function returns a Core Graphics image that the app displays in the user interface.\n\n```swift\ninterleavedDestinationBuffer.interleave(planarSourceBuffers: [ redDestinationBuffer,\n                                                               greenDestinationBuffer,\n                                                               blueDestinationBuffer ])\n```\n\n## Transforming with a multidimensional lookup table\n\n- **Applying color transforms to images with a multidimensional lookup table**: Precompute translation values to optimize color space conversion and other pointwise operations.\n- **Cropping to the subject in a chroma-keyed image**: Convert a chroma-key color to alpha values and trim transparent pixels using Accelerate.\n- **vImageMultidimensionalTable_Create(_:_:_:_:_:_:_:)**: Creates a multidimensional lookup table.\n- **vImageMultiDimensionalInterpolatedLookupTable_PlanarF(_:_:_:_:_:_:)**: Uses a multidimensional lookup table to transform a 32-bit planar image.\n- **vImageMultiDimensionalInterpolatedLookupTable_Planar16Q12(_:_:_:_:_:_:)**: Uses a multidimensional lookup table to transform a 16Q12 planar image.\n- **vImageMultidimensionalTable_Retain(_:)**: Retains a multidimensional table.\n- **vImageMultidimensionalTable_Release(_:)**: Releases a multidimensional table.\n- **vImage_MultidimensionalTable**: An opaque pointer that represents a multidimensional lookup table.\n- **vImageMDTableUsageHint**: Constants that indicate the use for a multidimensional lookup table.\n- **vImage_InterpolationMethod**: Constants that represent different interpolation methods.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Precompute translation values to optimize color space conversion and other pointwise operations.",
          "name" : "Applying color transforms to images with a multidimensional lookup table",
          "url" : "https:\/\/developer.apple.com\/documentation\/Accelerate\/applying-color-transforms-to-images-with-a-multidimensional-lookup-table"
        },
        {
          "description" : "Convert a chroma-key color to alpha values and trim transparent pixels using Accelerate.",
          "name" : "Cropping to the subject in a chroma-keyed image",
          "url" : "https:\/\/developer.apple.com\/documentation\/Accelerate\/cropping-to-the-subject-in-a-chroma-keyed-image"
        },
        {
          "description" : "Creates a multidimensional lookup table.",
          "name" : "vImageMultidimensionalTable_Create(_:_:_:_:_:_:_:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Accelerate\/vImageMultidimensionalTable_Create(_:_:_:_:_:_:_:)"
        },
        {
          "description" : "Uses a multidimensional lookup table to transform a 32-bit planar image.",
          "name" : "vImageMultiDimensionalInterpolatedLookupTable_PlanarF(_:_:_:_:_:_:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Accelerate\/vImageMultiDimensionalInterpolatedLookupTable_PlanarF(_:_:_:_:_:_:)"
        },
        {
          "description" : "Uses a multidimensional lookup table to transform a 16Q12 planar image.",
          "name" : "vImageMultiDimensionalInterpolatedLookupTable_Planar16Q12(_:_:_:_:_:_:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Accelerate\/vImageMultiDimensionalInterpolatedLookupTable_Planar16Q12(_:_:_:_:_:_:)"
        },
        {
          "description" : "Retains a multidimensional table.",
          "name" : "vImageMultidimensionalTable_Retain(_:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Accelerate\/vImageMultidimensionalTable_Retain(_:)"
        },
        {
          "description" : "Releases a multidimensional table.",
          "name" : "vImageMultidimensionalTable_Release(_:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Accelerate\/vImageMultidimensionalTable_Release(_:)"
        },
        {
          "description" : "An opaque pointer that represents a multidimensional lookup table.",
          "name" : "vImage_MultidimensionalTable",
          "url" : "https:\/\/developer.apple.com\/documentation\/Accelerate\/vImage_MultidimensionalTable"
        },
        {
          "description" : "Constants that indicate the use for a multidimensional lookup table.",
          "name" : "vImageMDTableUsageHint",
          "url" : "https:\/\/developer.apple.com\/documentation\/Accelerate\/vImageMDTableUsageHint"
        },
        {
          "description" : "Constants that represent different interpolation methods.",
          "name" : "vImage_InterpolationMethod",
          "url" : "https:\/\/developer.apple.com\/documentation\/Accelerate\/vImage_InterpolationMethod"
        }
      ],
      "title" : "Transforming with a multidimensional lookup table"
    }
  ],
  "source" : "appleJSON",
  "title" : "Applying transformations to selected colors in an image",
  "url" : "https:\/\/developer.apple.com\/documentation\/Accelerate\/applying-transformations-to-selected-colors-in-an-image"
}