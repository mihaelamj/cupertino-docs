{
  "abstract" : "Calculate the histogram of one image, and apply it to a second image.",
  "codeExamples" : [
    {
      "code" : "\/\/\/ Performs a histogram specification operation using `vImage.PixelBuffer` structures.\nstatic func applyHistogramSpecification_PixelBuffer(\n    histogramSourceImage: CGImage,\n    imageSourceImage: CGImage) -> CGImage {\n        \n        let histogramSource = try! vImage.PixelBuffer<vImage.Interleaved8x4>(\n            cgImage: histogramSourceImage,\n            cgImageFormat: &imageFormat)\n        \n        let imageSource = try! vImage.PixelBuffer<vImage.Interleaved8x4>(\n            cgImage: imageSourceImage,\n            cgImageFormat: &imageFormat)\n        \n        let destinationBuffer = vImage.PixelBuffer<vImage.Interleaved8x4>(\n            size: imageSource.size)\n        \n        let histogram = histogramSource.histogram()\n        \n        imageSource.specifyHistogram(histogram, destination: destinationBuffer)\n        \n        return destinationBuffer.makeCGImage(cgImageFormat: imageFormat)!\n    }",
      "language" : "swift"
    },
    {
      "code" : "var histogramBinZero = [vImagePixelCount](repeating: 0, count: 256)\nvar histogramBinOne = [vImagePixelCount](repeating: 0, count: 256)\nvar histogramBinTwo = [vImagePixelCount](repeating: 0, count: 256)\nvar histogramBinThree = [vImagePixelCount](repeating: 0, count: 256)",
      "language" : "swift"
    },
    {
      "code" : "histogramBinZero.withUnsafeMutableBufferPointer { zeroPtr in\n    histogramBinOne.withUnsafeMutableBufferPointer { onePtr in\n        histogramBinTwo.withUnsafeMutableBufferPointer { twoPtr in\n            histogramBinThree.withUnsafeMutableBufferPointer { threePtr in\n                \n                var histogramBins = [zeroPtr.baseAddress, onePtr.baseAddress,\n                                     twoPtr.baseAddress, threePtr.baseAddress]\n                \n                histogramBins.withUnsafeMutableBufferPointer { histogramBinsPtr in\n                    let error = vImageHistogramCalculation_ARGB8888(&histogramSource,\n                                                                    histogramBinsPtr.baseAddress!,\n                                                                    vImage_Flags(kvImageNoFlags))\n                    \n                    guard error == kvImageNoError else {\n                        fatalError(\"Error calculating histogram: \\(error)\")\n                    }\n                }\n            }\n        }\n    }\n}",
      "language" : "swift"
    },
    {
      "code" : "histogramBinZero.withUnsafeBufferPointer { zeroPtr in\n    histogramBinOne.withUnsafeBufferPointer { onePtr in\n        histogramBinTwo.withUnsafeBufferPointer { twoPtr in\n            histogramBinThree.withUnsafeBufferPointer { threePtr in\n                \n                var histogramBins = [zeroPtr.baseAddress, onePtr.baseAddress,\n                                     twoPtr.baseAddress, threePtr.baseAddress]\n                \n                histogramBins.withUnsafeMutableBufferPointer { histogramBinsPtr in\n                    let error = vImageHistogramSpecification_ARGB8888(&imageSource,\n                                                                      &destinationBuffer,\n                                                                      histogramBinsPtr.baseAddress!,\n                                                                      vImage_Flags(kvImageNoFlags))\n                    \n                    guard error == kvImageNoError else {\n                        fatalError(\"Error specifying histogram: \\(error)\")\n                    }\n                }\n            }\n        }\n    }\n}",
      "language" : "swift"
    }
  ],
  "contentHash" : "ac6e5cd0a49a1a3987ec1fb87fd823f66a8d47c448e6c385fc36999699294e92",
  "crawledAt" : "2025-12-02T15:28:03Z",
  "id" : "CAD8171C-E0EB-42DA-A0F4-1B927F575C00",
  "kind" : "unknown",
  "language" : "swift",
  "module" : "Accelerate",
  "overview" : "## Overview\n\n*Histogram specification* is an image-processing operation that calculates the histogram of a reference image and applies it to an input image. The operation changes the colors and tones of the input image to match those of the reference image.\n\nThe example below shows a source image (bottom left) and a histogram reference image (top left), with the histogram specification output on the right.\n\n\n\nBefore exploring the code, build and run the app to familiarize yourself with the different visual results the app generates when you select different source and reference images.\n\n### Perform histogram specification using pixel buffers\n\nThe [doc:\/\/com.apple.accelerate\/documentation\/Accelerate\/vImage\/PixelBuffer] structure provides a simple API to calculate and specify a histogram. The [doc:\/\/com.apple.accelerate\/documentation\/Accelerate\/vImage\/PixelBuffer\/histogram()-30tsp] function returns the histogram of a pixel buffer, and the [doc:\/\/com.apple.accelerate\/documentation\/Accelerate\/vImage\/PixelBuffer\/specifyHistogram(_:destination:)-qeqr] function performs the histogram specification operation.\n\nThe following code creates the pixel buffers that the operation requires, performs the specification, and returns a Core Graphics image that contains the result:\n\n### Calculate the reference histogram using vImage buffers\n\nIf you’re creating apps for older operating systems that don’t support the [doc:\/\/com.apple.accelerate\/documentation\/Accelerate\/vImage\/PixelBuffer] API, the sample code project also includes source code for performing histogram specification using [doc:\/\/com.apple.accelerate\/documentation\/Accelerate\/vImage_Buffer] structures.\n\nThe [doc:\/\/com.apple.accelerate\/documentation\/Accelerate\/vImageHistogramCalculation_ARGB8888(_:_:_:)] calculates and stores histogram data in four arrays — one for each channel — where the value of each element is the number of pixels in the reference image with that color value. In an 8-bit-per-channel image, each color channel can hold 256 different values, and the sample code defines each array with a count of 256.\n\nThe following code calculates the histogram of the `histogramSource` [doc:\/\/com.apple.accelerate\/documentation\/Accelerate\/vImage_Buffer] structure:\n\nOn return, the four arrays contain the histogram data from the `histogramSource`.\n\n### Specify the image histogram using vImage buffers\n\nThe [doc:\/\/com.apple.accelerate\/documentation\/Accelerate\/vImageHistogramSpecification_ARGB8888(_:_:_:_:)] performs the histogram specification operation. The following code matches the histogram of the reference image to the input image:\n\nOn return, `destinationBuffer` contains the original input image with the histogram that the reference image specified.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/Accelerate\/specifying-histograms-with-vimage\ncrawled: 2025-12-02T15:28:03Z\n---\n\n# Specifying histograms with vImage\n\n**Sample Code**\n\nCalculate the histogram of one image, and apply it to a second image.\n\n## Overview\n\n*Histogram specification* is an image-processing operation that calculates the histogram of a reference image and applies it to an input image. The operation changes the colors and tones of the input image to match those of the reference image.\n\nThe example below shows a source image (bottom left) and a histogram reference image (top left), with the histogram specification output on the right.\n\n\n\nBefore exploring the code, build and run the app to familiarize yourself with the different visual results the app generates when you select different source and reference images.\n\n### Perform histogram specification using pixel buffers\n\nThe [doc:\/\/com.apple.accelerate\/documentation\/Accelerate\/vImage\/PixelBuffer] structure provides a simple API to calculate and specify a histogram. The [doc:\/\/com.apple.accelerate\/documentation\/Accelerate\/vImage\/PixelBuffer\/histogram()-30tsp] function returns the histogram of a pixel buffer, and the [doc:\/\/com.apple.accelerate\/documentation\/Accelerate\/vImage\/PixelBuffer\/specifyHistogram(_:destination:)-qeqr] function performs the histogram specification operation.\n\nThe following code creates the pixel buffers that the operation requires, performs the specification, and returns a Core Graphics image that contains the result:\n\n```swift\n\/\/\/ Performs a histogram specification operation using `vImage.PixelBuffer` structures.\nstatic func applyHistogramSpecification_PixelBuffer(\n    histogramSourceImage: CGImage,\n    imageSourceImage: CGImage) -> CGImage {\n        \n        let histogramSource = try! vImage.PixelBuffer<vImage.Interleaved8x4>(\n            cgImage: histogramSourceImage,\n            cgImageFormat: &imageFormat)\n        \n        let imageSource = try! vImage.PixelBuffer<vImage.Interleaved8x4>(\n            cgImage: imageSourceImage,\n            cgImageFormat: &imageFormat)\n        \n        let destinationBuffer = vImage.PixelBuffer<vImage.Interleaved8x4>(\n            size: imageSource.size)\n        \n        let histogram = histogramSource.histogram()\n        \n        imageSource.specifyHistogram(histogram, destination: destinationBuffer)\n        \n        return destinationBuffer.makeCGImage(cgImageFormat: imageFormat)!\n    }\n```\n\n### Calculate the reference histogram using vImage buffers\n\nIf you’re creating apps for older operating systems that don’t support the [doc:\/\/com.apple.accelerate\/documentation\/Accelerate\/vImage\/PixelBuffer] API, the sample code project also includes source code for performing histogram specification using [doc:\/\/com.apple.accelerate\/documentation\/Accelerate\/vImage_Buffer] structures.\n\nThe [doc:\/\/com.apple.accelerate\/documentation\/Accelerate\/vImageHistogramCalculation_ARGB8888(_:_:_:)] calculates and stores histogram data in four arrays — one for each channel — where the value of each element is the number of pixels in the reference image with that color value. In an 8-bit-per-channel image, each color channel can hold 256 different values, and the sample code defines each array with a count of 256.\n\n```swift\nvar histogramBinZero = [vImagePixelCount](repeating: 0, count: 256)\nvar histogramBinOne = [vImagePixelCount](repeating: 0, count: 256)\nvar histogramBinTwo = [vImagePixelCount](repeating: 0, count: 256)\nvar histogramBinThree = [vImagePixelCount](repeating: 0, count: 256)\n```\n\nThe following code calculates the histogram of the `histogramSource` [doc:\/\/com.apple.accelerate\/documentation\/Accelerate\/vImage_Buffer] structure:\n\n```swift\nhistogramBinZero.withUnsafeMutableBufferPointer { zeroPtr in\n    histogramBinOne.withUnsafeMutableBufferPointer { onePtr in\n        histogramBinTwo.withUnsafeMutableBufferPointer { twoPtr in\n            histogramBinThree.withUnsafeMutableBufferPointer { threePtr in\n                \n                var histogramBins = [zeroPtr.baseAddress, onePtr.baseAddress,\n                                     twoPtr.baseAddress, threePtr.baseAddress]\n                \n                histogramBins.withUnsafeMutableBufferPointer { histogramBinsPtr in\n                    let error = vImageHistogramCalculation_ARGB8888(&histogramSource,\n                                                                    histogramBinsPtr.baseAddress!,\n                                                                    vImage_Flags(kvImageNoFlags))\n                    \n                    guard error == kvImageNoError else {\n                        fatalError(\"Error calculating histogram: \\(error)\")\n                    }\n                }\n            }\n        }\n    }\n}\n```\n\nOn return, the four arrays contain the histogram data from the `histogramSource`.\n\n### Specify the image histogram using vImage buffers\n\nThe [doc:\/\/com.apple.accelerate\/documentation\/Accelerate\/vImageHistogramSpecification_ARGB8888(_:_:_:_:)] performs the histogram specification operation. The following code matches the histogram of the reference image to the input image:\n\n```swift\nhistogramBinZero.withUnsafeBufferPointer { zeroPtr in\n    histogramBinOne.withUnsafeBufferPointer { onePtr in\n        histogramBinTwo.withUnsafeBufferPointer { twoPtr in\n            histogramBinThree.withUnsafeBufferPointer { threePtr in\n                \n                var histogramBins = [zeroPtr.baseAddress, onePtr.baseAddress,\n                                     twoPtr.baseAddress, threePtr.baseAddress]\n                \n                histogramBins.withUnsafeMutableBufferPointer { histogramBinsPtr in\n                    let error = vImageHistogramSpecification_ARGB8888(&imageSource,\n                                                                      &destinationBuffer,\n                                                                      histogramBinsPtr.baseAddress!,\n                                                                      vImage_Flags(kvImageNoFlags))\n                    \n                    guard error == kvImageNoError else {\n                        fatalError(\"Error specifying histogram: \\(error)\")\n                    }\n                }\n            }\n        }\n    }\n}\n```\n\nOn return, `destinationBuffer` contains the original input image with the histogram that the reference image specified.\n\n## Color and Tone Adjustment\n\n- **Adjusting the brightness and contrast of an image**: Use a gamma function to apply a linear or exponential curve.\n- **Adjusting saturation and applying tone mapping**: Convert an RGB image to discrete luminance and chrominance channels, and apply color and contrast treatments.\n- **Applying tone curve adjustments to images**: Use the vImage library’s polynomial transform to apply tone curve adjustments to images.\n- **Adjusting the hue of an image**: Convert an image to L*a*b* color space and apply hue adjustment.\n- **Enhancing image contrast with histogram manipulation**: Enhance and adjust the contrast of an image with histogram equalization and contrast stretching.\n- **Histogram**: Calculate or manipulate an image’s histogram.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Use a gamma function to apply a linear or exponential curve.",
          "name" : "Adjusting the brightness and contrast of an image",
          "url" : "https:\/\/developer.apple.com\/documentation\/Accelerate\/adjusting-the-brightness-and-contrast-of-an-image"
        },
        {
          "description" : "Convert an RGB image to discrete luminance and chrominance channels, and apply color and contrast treatments.",
          "name" : "Adjusting saturation and applying tone mapping",
          "url" : "https:\/\/developer.apple.com\/documentation\/Accelerate\/adjusting-saturation-and-applying-tone-mapping"
        },
        {
          "description" : "Use the vImage library’s polynomial transform to apply tone curve adjustments to images.",
          "name" : "Applying tone curve adjustments to images",
          "url" : "https:\/\/developer.apple.com\/documentation\/Accelerate\/applying-tone-curve-adjustments-to-images"
        },
        {
          "description" : "Convert an image to L*a*b* color space and apply hue adjustment.",
          "name" : "Adjusting the hue of an image",
          "url" : "https:\/\/developer.apple.com\/documentation\/Accelerate\/adjusting-the-hue-of-an-image"
        },
        {
          "description" : "Enhance and adjust the contrast of an image with histogram equalization and contrast stretching.",
          "name" : "Enhancing image contrast with histogram manipulation",
          "url" : "https:\/\/developer.apple.com\/documentation\/Accelerate\/enhancing-image-contrast-with-histogram-manipulation"
        },
        {
          "description" : "Calculate or manipulate an image’s histogram.",
          "name" : "Histogram",
          "url" : "https:\/\/developer.apple.com\/documentation\/Accelerate\/histogram"
        }
      ],
      "title" : "Color and Tone Adjustment"
    }
  ],
  "source" : "appleJSON",
  "title" : "Specifying histograms with vImage",
  "url" : "https:\/\/developer.apple.com\/documentation\/Accelerate\/specifying-histograms-with-vimage"
}