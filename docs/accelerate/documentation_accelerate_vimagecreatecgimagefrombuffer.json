{
  "abstract" : "Creates a Core Graphics image from a vImage buffer.",
  "codeExamples" : [
    {
      "code" : "static func passThrough(sourceImage: CGImage) throws -> CGImage? {\n    \n    let alignmentAndRowBytes = try vImage_Buffer.preferredAlignmentAndRowBytes(\n        width: sourceImage.width,\n        height: sourceImage.height,\n        bitsPerPixel: UInt32(sourceImage.bitsPerPixel))\n    \n    let data = UnsafeMutableRawPointer.allocate(\n        byteCount: alignmentAndRowBytes.rowBytes * alignmentAndRowBytes.rowBytes,\n        alignment: alignmentAndRowBytes.alignment)\n    \n    var buffer = vImage_Buffer(\n        data: data,\n        height: vImagePixelCount(sourceImage.height),\n        width: vImagePixelCount(sourceImage.width),\n        rowBytes: alignmentAndRowBytes.rowBytes)\n    \n    var format = vImage_CGImageFormat()\n    \n    vImageBuffer_InitWithCGImage(\n        &buffer,\n        &format,\n        nil,\n        sourceImage,\n        vImage_Flags(kvImageNoAllocate))\n\n    func callback(_: UnsafeMutableRawPointer?,\n                  bufferData: UnsafeMutableRawPointer?) {\n        bufferData?.deallocate()\n    }\n    \n    let destinationCGImage = vImageCreateCGImageFromBuffer(\n        &buffer,\n        &format,\n        callback,\n        nil,\n        vImage_Flags(kvImageNoAllocate),\n        nil)\n    \n    return destinationCGImage?.takeRetainedValue()\n}",
      "language" : "swift"
    }
  ],
  "contentHash" : "002cec86e323ea7ef88eff52ac425a39e73623e5be77c4047113e73078571a89",
  "crawledAt" : "2025-12-01T03:09:07Z",
  "declaration" : {
    "code" : "func vImageCreateCGImageFromBuffer(_ buf: UnsafePointer<vImage_Buffer>, _ format: UnsafePointer<vImage_CGImageFormat>, _ callback: ((UnsafeMutableRawPointer?, UnsafeMutableRawPointer?) -> Void)!, _ userData: UnsafeMutableRawPointer!, _ flags: vImage_Flags, _ error: UnsafeMutablePointer<vImage_Error>!) -> Unmanaged<CGImage>!",
    "language" : "swift"
  },
  "id" : "4C94C8F0-7A6F-43E8-8CC2-BB7C3D3545AE",
  "kind" : "function",
  "module" : "Accelerate",
  "overview" : "## Return Value\n\n[doc:\/\/com.apple.accelerate\/documentation\/Accelerate\/kvImageNoError]; otherwise, one of the error codes in [doc:\/\/com.apple.documentation\/documentation\/Accelerate\/data-types-and-constants].\n\n## Discussion\n\nThe following code shows a passthrough function that generates an output Core Graphics image using no-copy mode. The vImage buffer, `buffer`, and the Core Graphics image, `destinationCGImage`, share the same memory. In this example, the deallocation callback deallocates the memory that the `data` variable points to:",
  "platforms" : [
    "iOS",
    "iPadOS",
    "Mac Catalyst",
    "macOS",
    "tvOS",
    "visionOS",
    "watchOS"
  ],
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/Accelerate\/vImageCreateCGImageFromBuffer(_:_:_:_:_:_:)\ncrawled: 2025-12-01T03:09:07Z\n---\n\n# vImageCreateCGImageFromBuffer(_:_:_:_:_:_:)\n\n**Function**\n\nCreates a Core Graphics image from a vImage buffer.\n\n## Declaration\n\n```swift\nfunc vImageCreateCGImageFromBuffer(_ buf: UnsafePointer<vImage_Buffer>, _ format: UnsafePointer<vImage_CGImageFormat>, _ callback: ((UnsafeMutableRawPointer?, UnsafeMutableRawPointer?) -> Void)!, _ userData: UnsafeMutableRawPointer!, _ flags: vImage_Flags, _ error: UnsafeMutablePointer<vImage_Error>!) -> Unmanaged<CGImage>!\n```\n\n## Parameters\n\n- **buf**: The source vImage buffer.\n- **format**: The image format of the source vImage buffer. If the format’s color space is `nil`, the function uses sRGB. The new Core Graphics image retains the color space.\n- **callback**: A callback function that deallocates the source buffer’s data when the returned image no longer needs it. Pass this callback when you call this function in no-copy mode; that is, when you pass [doc:\/\/com.apple.accelerate\/documentation\/Accelerate\/kvImageNoAllocate] to `flags`. The system may call this function at any time — including before [doc:\/\/com.apple.accelerate\/documentation\/Accelerate\/vImageCreateCGImageFromBuffer(_:_:_:_:_:_:)] returns — and from any thread.\n- **userData**: The value that passes to the `callback` function’s `userData` parameter.\n- **flags**: The options to use when performing the operation. If your code implements its own tiling or its own multithreading, pass [doc:\/\/com.apple.accelerate\/documentation\/Accelerate\/kvImageDoNotTile]; otherwise, pass [doc:\/\/com.apple.accelerate\/documentation\/Accelerate\/kvImageNoFlags].\n\nPass [doc:\/\/com.apple.accelerate\/documentation\/Accelerate\/kvImageNoAllocate] to specify that the function runs in no-copy mode. In this case, the function passes the ownership of the source vImage buffer’s memory to the returned [doc:\/\/com.apple.documentation\/documentation\/CoreGraphics\/CGImage] instance. When you pass this flag, specify the callback function to manage the deallocation of the memory.\n\nPass [doc:\/\/com.apple.accelerate\/documentation\/Accelerate\/kvImageHighQualityResampling] to specify high-quality resampling if the function resamples the output image to a smaller size.\n\n## Return Value\n\n[doc:\/\/com.apple.accelerate\/documentation\/Accelerate\/kvImageNoError]; otherwise, one of the error codes in [doc:\/\/com.apple.documentation\/documentation\/Accelerate\/data-types-and-constants].\n\n## Discussion\n\nThe following code shows a passthrough function that generates an output Core Graphics image using no-copy mode. The vImage buffer, `buffer`, and the Core Graphics image, `destinationCGImage`, share the same memory. In this example, the deallocation callback deallocates the memory that the `data` variable points to:\n\n```swift\nstatic func passThrough(sourceImage: CGImage) throws -> CGImage? {\n    \n    let alignmentAndRowBytes = try vImage_Buffer.preferredAlignmentAndRowBytes(\n        width: sourceImage.width,\n        height: sourceImage.height,\n        bitsPerPixel: UInt32(sourceImage.bitsPerPixel))\n    \n    let data = UnsafeMutableRawPointer.allocate(\n        byteCount: alignmentAndRowBytes.rowBytes * alignmentAndRowBytes.rowBytes,\n        alignment: alignmentAndRowBytes.alignment)\n    \n    var buffer = vImage_Buffer(\n        data: data,\n        height: vImagePixelCount(sourceImage.height),\n        width: vImagePixelCount(sourceImage.width),\n        rowBytes: alignmentAndRowBytes.rowBytes)\n    \n    var format = vImage_CGImageFormat()\n    \n    vImageBuffer_InitWithCGImage(\n        &buffer,\n        &format,\n        nil,\n        sourceImage,\n        vImage_Flags(kvImageNoAllocate))\n\n    func callback(_: UnsafeMutableRawPointer?,\n                  bufferData: UnsafeMutableRawPointer?) {\n        bufferData?.deallocate()\n    }\n    \n    let destinationCGImage = vImageCreateCGImageFromBuffer(\n        &buffer,\n        &format,\n        callback,\n        nil,\n        vImage_Flags(kvImageNoAllocate),\n        nil)\n    \n    return destinationCGImage?.takeRetainedValue()\n}\n```\n\n",
  "sections" : [

  ],
  "source" : "appleJSON",
  "title" : "vImageCreateCGImageFromBuffer(_:_:_:_:_:_:)",
  "url" : "https:\/\/developer.apple.com\/documentation\/Accelerate\/vImageCreateCGImageFromBuffer(_:_:_:_:_:_:)"
}