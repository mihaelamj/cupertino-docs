{
  "abstract" : "Recreate a string from an archive file.",
  "codeExamples" : [
    {
      "code" : "let archiveFileName = \"lorem.aar\"\n\nlet archiveFilePath: FilePath = { \n    guard let downloadURL = FileManager.default.urls(for: .downloadsDirectory,\n                                                     in: .userDomainMask).first,\n          let archiveFilePath = FilePath(downloadURL.appendingPathComponent(archiveFileName)) else {\n        fatalError(\"Unable to create archive file path.\")\n    }\n    \n    return archiveFilePath\n}()",
      "language" : "swift"
    },
    {
      "code" : "guard let readFileStream = ArchiveByteStream.fileStream(\n        path: archiveFilePath,\n        mode: .readOnly,\n        options: [ ],\n        permissions: FilePermissions(rawValue: 0o644)) else {\n    print(\"can't create reading file stream\")\n    return\n}\ndefer {\n    try? readFileStream.close()\n}",
      "language" : "swift"
    },
    {
      "code" : "guard let decompressStream = ArchiveByteStream.decompressionStream(\n        readingFrom: readFileStream) else {\n    return\n}\ndefer {\n    try? decompressStream.close()\n}",
      "language" : "swift"
    },
    {
      "code" : "guard let decodeStream = ArchiveStream.decodeStream(\n        readingFrom: decompressStream) else {\n    return\n}\ndefer {\n    try? decodeStream.close()\n}",
      "language" : "swift"
    },
    {
      "code" : "guard\n    let header = try? decodeStream.readHeader(),\n    let datField = header.field(forKey: ArchiveHeader.FieldKey(\"DAT\")) else {\n    return\n}\n\nlet byteCount: UInt64\n\nswitch datField {\n    case .blob(_, let size, _):\n        byteCount = size\n    default:\n        byteCount = 0\n}\n\nguard byteCount != 0 else {\n    return\n}",
      "language" : "swift"
    },
    {
      "code" : "let rawBufferPtr = UnsafeMutableRawBufferPointer.allocate(\n        byteCount: Int(byteCount),\n        alignment: MemoryLayout<UTF8>.alignment)\n\ndefer {\n    rawBufferPtr.deallocate()\n}",
      "language" : "swift"
    },
    {
      "code" : "do {\n    try decodeStream.readBlob(key: ArchiveHeader.FieldKey(\"DAT\"),\n                              into: rawBufferPtr)\n} catch {\n    print(\"Unable to read from stream into `rawBufferPtr`.\")\n}",
      "language" : "swift"
    },
    {
      "code" : "let typedPtr = rawBufferPtr.bindMemory(to: CChar.self)\n\nlet decompressedString = String(cString: typedPtr.baseAddress!)\n\nprint(decompressedString)\n\n\/\/ prints:\n\/\/ Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam fermentum vestibulum est. Cras rhoncus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Sed quis tortor. Donec non ipsum. Mauris condimentum, odio nec porta tristique, ante neque malesuada massa, in dignissim eros velit at tellus. Donec et risus in ligula eleifend consectetur. Donec volutpat eleifend augue. Integer gravida sodales leo. Nunc vehicula neque ac erat. Vivamus non nisl. Fusce ac magna. Suspendisse euismod libero eget mauris.\n\/\/ [...]",
      "language" : "swift"
    }
  ],
  "contentHash" : "14fea88013edb3e6af835ab3f796fe6b876de27b5a05a381c8493438f54ba314",
  "crawledAt" : "2025-12-02T16:25:38Z",
  "id" : "799E4705-1CAB-4597-9405-5C1389D2F873",
  "kind" : "article",
  "language" : "swift",
  "module" : "Accelerate",
  "overview" : "## Overview\n\nIn this article, you’ll learn how to use AppleArchive to decompress and parse a previously compressed string.\n\nThe code below decompresses and parses the file generated using the steps explained in [doc:\/\/com.apple.documentation\/documentation\/Accelerate\/compressing-and-saving-a-string-to-the-file-system]. The operation obtains the contents of the `DAT` blob for the first file in the archive and creates a string from that data.\n\n### Specify the compressed file path\n\nCreate a [doc:\/\/com.apple.documentation\/documentation\/System\/FilePath] structure that specifies the file name and location of the AppleArchive file that stores the compressed data. You must add read and write file access to the Downloads folder in the Signing and Capabilities pane. To learn more about configuring the App Sandbox, see [https:\/\/help.apple.com\/xcode\/mac\/current\/#\/devbd04af149].\n\nThe following code creates a file path to `lorem.aar`:\n\n### Create the file stream to read the source archive\n\nThe [doc:\/\/com.apple.documentation\/documentation\/AppleArchive\/ArchiveByteStream] class provides static factory methods that create streams for different functions. In this case, use [doc:\/\/com.apple.documentation\/documentation\/AppleArchive\/ArchiveByteStream\/fileStream(path:mode:options:permissions:)] to create a byte stream that reads the source file:\n\n### Create the decompression stream\n\nCreate the decompression stream. Specify the file-reading stream as the input stream that provides the compressed data:\n\n### Create the decoding stream\n\nCreate a decoding stream that provides archive elements from the raw, decompressed data:\n\n### Derive the size of the uncompressed string\n\nUse the size of the `DAT` blob field that you specified in [doc:\/\/com.apple.documentation\/documentation\/Accelerate\/compressing-and-saving-a-string-to-the-file-system#Define-the-archive-header] to create a buffer to receive the uncompressed data. To access the size, read the DAT field of the decode stream’s header:\n\n### Decompress the archived string\n\nCreate an [doc:\/\/com.apple.documentation\/documentation\/Swift\/UnsafeMutableRawBufferPointer] structure and allocate to it it the size of the original string to receive the decompressed data:\n\nCall doc:\/\/com.apple.documentation\/documentation\/applearchive\/archivestream\/3589310-readblob to read the decompressed data from the `DAT` field and write it to the raw buffer pointer. The decode stream parses its input from the decompression stream that, in turn, decompresses its input from the AppleArchive file supplied by the file stream.\n\n### Create a string from the raw buffer pointer\n\nCreate a string from the raw buffer pointer by creating a typed pointer that’s bound to [doc:\/\/com.apple.documentation\/documentation\/Swift\/CChar], and use [doc:\/\/com.apple.documentation\/documentation\/Swift\/String\/init(cString:)-2p84k] to initialize the new string:",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/accelerate\/decompressing-and-parsing-an-archived-string\ncrawled: 2025-12-02T16:25:38Z\n---\n\n# Decompressing and parsing an archived string\n\n**Article**\n\nRecreate a string from an archive file.\n\n## Overview\n\nIn this article, you’ll learn how to use AppleArchive to decompress and parse a previously compressed string.\n\nThe code below decompresses and parses the file generated using the steps explained in [doc:\/\/com.apple.documentation\/documentation\/Accelerate\/compressing-and-saving-a-string-to-the-file-system]. The operation obtains the contents of the `DAT` blob for the first file in the archive and creates a string from that data.\n\n### Specify the compressed file path\n\nCreate a [doc:\/\/com.apple.documentation\/documentation\/System\/FilePath] structure that specifies the file name and location of the AppleArchive file that stores the compressed data. You must add read and write file access to the Downloads folder in the Signing and Capabilities pane. To learn more about configuring the App Sandbox, see [https:\/\/help.apple.com\/xcode\/mac\/current\/#\/devbd04af149].\n\nThe following code creates a file path to `lorem.aar`:\n\n```swift\nlet archiveFileName = \"lorem.aar\"\n\nlet archiveFilePath: FilePath = { \n    guard let downloadURL = FileManager.default.urls(for: .downloadsDirectory,\n                                                     in: .userDomainMask).first,\n          let archiveFilePath = FilePath(downloadURL.appendingPathComponent(archiveFileName)) else {\n        fatalError(\"Unable to create archive file path.\")\n    }\n    \n    return archiveFilePath\n}()\n```\n\n### Create the file stream to read the source archive\n\nThe [doc:\/\/com.apple.documentation\/documentation\/AppleArchive\/ArchiveByteStream] class provides static factory methods that create streams for different functions. In this case, use [doc:\/\/com.apple.documentation\/documentation\/AppleArchive\/ArchiveByteStream\/fileStream(path:mode:options:permissions:)] to create a byte stream that reads the source file:\n\n```swift\nguard let readFileStream = ArchiveByteStream.fileStream(\n        path: archiveFilePath,\n        mode: .readOnly,\n        options: [ ],\n        permissions: FilePermissions(rawValue: 0o644)) else {\n    print(\"can't create reading file stream\")\n    return\n}\ndefer {\n    try? readFileStream.close()\n}\n```\n\n### Create the decompression stream\n\nCreate the decompression stream. Specify the file-reading stream as the input stream that provides the compressed data:\n\n```swift\nguard let decompressStream = ArchiveByteStream.decompressionStream(\n        readingFrom: readFileStream) else {\n    return\n}\ndefer {\n    try? decompressStream.close()\n}\n```\n\n### Create the decoding stream\n\nCreate a decoding stream that provides archive elements from the raw, decompressed data:\n\n```swift\nguard let decodeStream = ArchiveStream.decodeStream(\n        readingFrom: decompressStream) else {\n    return\n}\ndefer {\n    try? decodeStream.close()\n}\n```\n\n### Derive the size of the uncompressed string\n\nUse the size of the `DAT` blob field that you specified in [doc:\/\/com.apple.documentation\/documentation\/Accelerate\/compressing-and-saving-a-string-to-the-file-system#Define-the-archive-header] to create a buffer to receive the uncompressed data. To access the size, read the DAT field of the decode stream’s header:\n\n```swift\nguard\n    let header = try? decodeStream.readHeader(),\n    let datField = header.field(forKey: ArchiveHeader.FieldKey(\"DAT\")) else {\n    return\n}\n\nlet byteCount: UInt64\n\nswitch datField {\n    case .blob(_, let size, _):\n        byteCount = size\n    default:\n        byteCount = 0\n}\n\nguard byteCount != 0 else {\n    return\n}\n```\n\n### Decompress the archived string\n\nCreate an [doc:\/\/com.apple.documentation\/documentation\/Swift\/UnsafeMutableRawBufferPointer] structure and allocate to it it the size of the original string to receive the decompressed data:\n\n```swift\nlet rawBufferPtr = UnsafeMutableRawBufferPointer.allocate(\n        byteCount: Int(byteCount),\n        alignment: MemoryLayout<UTF8>.alignment)\n\ndefer {\n    rawBufferPtr.deallocate()\n}\n```\n\nCall doc:\/\/com.apple.documentation\/documentation\/applearchive\/archivestream\/3589310-readblob to read the decompressed data from the `DAT` field and write it to the raw buffer pointer. The decode stream parses its input from the decompression stream that, in turn, decompresses its input from the AppleArchive file supplied by the file stream.\n\n```swift\ndo {\n    try decodeStream.readBlob(key: ArchiveHeader.FieldKey(\"DAT\"),\n                              into: rawBufferPtr)\n} catch {\n    print(\"Unable to read from stream into `rawBufferPtr`.\")\n}\n```\n\n### Create a string from the raw buffer pointer\n\nCreate a string from the raw buffer pointer by creating a typed pointer that’s bound to [doc:\/\/com.apple.documentation\/documentation\/Swift\/CChar], and use [doc:\/\/com.apple.documentation\/documentation\/Swift\/String\/init(cString:)-2p84k] to initialize the new string:\n\n```swift\nlet typedPtr = rawBufferPtr.bindMemory(to: CChar.self)\n\nlet decompressedString = String(cString: typedPtr.baseAddress!)\n\nprint(decompressedString)\n\n\/\/ prints:\n\/\/ Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam fermentum vestibulum est. Cras rhoncus. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Sed quis tortor. Donec non ipsum. Mauris condimentum, odio nec porta tristique, ante neque malesuada massa, in dignissim eros velit at tellus. Donec et risus in ligula eleifend consectetur. Donec volutpat eleifend augue. Integer gravida sodales leo. Nunc vehicula neque ac erat. Vivamus non nisl. Fusce ac magna. Suspendisse euismod libero eget mauris.\n\/\/ [...]\n```\n\n## Directories, Files, and Data Archives\n\n- **Compressing single files**: Compress a single file and store the result on the file system.\n- **Decompressing single files**: Recreate a single file from a compressed file.\n- **Compressing file system directories**: Compress the contents of an entire directory and store the result on the file system.\n- **Decompressing and extracting an archived directory**: Recreate an entire file system directory from an archive file.\n- **Compressing and saving a string to the file system**: Compress the contents of a Unicode string and store the result on the file system.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Compress a single file and store the result on the file system.",
          "name" : "Compressing single files",
          "url" : "https:\/\/developer.apple.com\/documentation\/Accelerate\/compressing-single-files"
        },
        {
          "description" : "Recreate a single file from a compressed file.",
          "name" : "Decompressing single files",
          "url" : "https:\/\/developer.apple.com\/documentation\/Accelerate\/decompressing-single-files"
        },
        {
          "description" : "Compress the contents of an entire directory and store the result on the file system.",
          "name" : "Compressing file system directories",
          "url" : "https:\/\/developer.apple.com\/documentation\/Accelerate\/compressing-file-system-directories"
        },
        {
          "description" : "Recreate an entire file system directory from an archive file.",
          "name" : "Decompressing and extracting an archived directory",
          "url" : "https:\/\/developer.apple.com\/documentation\/Accelerate\/decompressing-and-extracting-an-archived-directory"
        },
        {
          "description" : "Compress the contents of a Unicode string and store the result on the file system.",
          "name" : "Compressing and saving a string to the file system",
          "url" : "https:\/\/developer.apple.com\/documentation\/Accelerate\/compressing-and-saving-a-string-to-the-file-system"
        }
      ],
      "title" : "Directories, Files, and Data Archives"
    }
  ],
  "source" : "appleJSON",
  "title" : "Decompressing and parsing an archived string",
  "url" : "https:\/\/developer.apple.com\/documentation\/accelerate\/decompressing-and-parsing-an-archived-string"
}