{
  "abstract" : "Minimize the space and time that backups take to create by excluding purgeable and nonpurgeable data from backups.",
  "codeExamples" : [
    {
      "code" : "let manager = FileManager.default\n\n\/\/ Get the URL to the app container's 'tmp' directory.\nlet tmpDirectoryURL = manager.temporaryDirectory\n\n\/\/ Get the URL to the app container's 'Caches' directory.\nlet cachesDirectoryURL = try manager.url(for: .cachesDirectory,\n                                         in: .userDomainMask,\n                                         appropriateFor: nil,\n                                         create: false)",
      "language" : "swift"
    },
    {
      "code" : "func excludeItem(at url: URL) throws {\n    \/\/ Create the resource values for the specified URL.\n    var values = URLResourceValues()\n    values.isExcludedFromBackup = true\n\n    \/\/ Apply those values to the URL.\n    var url = url\n    try url.setResourceValues(values)\n}",
      "language" : "swift"
    },
    {
      "code" : "let manager = FileManager.default\n\n\/\/ Retrieve the app's bundle identifier.\nif let bundleIdentifier = Bundle.main.bundleIdentifier {\n    \n    \/\/ Get the URL to the app container's 'Library' directory.\n    var url = try manager.url(for: .libraryDirectory,\n                              in: .userDomainMask,\n                              appropriateFor: nil,\n                              create: false)\n    \n    \/\/ Append the bundle identifier to the retrieved URL.\n    url.appendPathComponent(bundleIdentifier, isDirectory: true)\n    \n    \/\/ Use the URL to create the new directory.\n    try manager.createDirectory(at: url,\n                                withIntermediateDirectories: true,\n                                attributes: nil)\n}",
      "language" : "swift"
    }
  ],
  "contentHash" : "55d023e197f4dcb9b213b5fa84573233ee90412b9213540912f15b3c1c1b98b6",
  "crawledAt" : "2025-12-03T07:34:47Z",
  "id" : "3AE8538A-F6BF-495F-BE55-64655DC20F07",
  "kind" : "article",
  "language" : "swift",
  "module" : "Foundation",
  "overview" : "## Overview\n\nWhen iCloud Backup is in an enabled state, it periodically creates a backup of the user’s device, including your app’s data. By storing purgeable data in specific directories and signaling to the system that backups can exclude certain nonpurgeable data, you can shorten the time it takes to create a backup and help reduce the amount of space that backup consumes.\n\n### Exclude Purgeable Data\n\n*Purgeable data* is app data that the system can delete without affecting the app’s execution and that the app can re-create if it needs. For example, your app might generate thumbnails of larger images for display in a collection view. If the app saves the thumbnails to disk, consider them purgeable data because, if the system deletes those files, the app can create them again from source.\n\nThe app container provides two directories for storing purgeable data:\n\nThe system periodically purges these directories, so iCloud Backup excludes them by default. If your app creates purgeable data, store it in one of these directories; otherwise, iCloud Backup may include that data, needlessly increasing the physical size of the backup with no benefit to the user. Don’t use these directories to exclude nonpurgeable data from iCloud Backup.\n\nTo retrieve the location of these system-provided directories, use the [doc:\/\/com.apple.foundation\/documentation\/Foundation\/FileManager] class, as the following example shows.\n\nConsider deleting purgeable data as soon as your app is done with it so that it doesn’t continue to consume space on the user’s device.\n\n### Mark Nonpurgeable Data as Excludable\n\n*Nonpurgeable data* is data the user creates, or data the app requires to function as the user expects. Some nonpurgeable data isn’t appropriate for backup.\n\nFor example, if your app downloads high-definition movies for offline viewing, exclude those files because they’re typically large in size and the user can download them again on a restored device, if necessary. Conversely, if your app allows the user to import arbitrary files such as PDFs, ebooks, and digital comics, don’t exclude those files because it might be difficult, even impossible, for the user to re-create them on a restored device.\n\nIf your app creates nonpurgeable data that isn’t appropriate for backup, you can indicate which files and directories the system can exclude by setting their [doc:\/\/com.apple.foundation\/documentation\/Foundation\/URLResourceValues\/isExcludedFromBackup] resource value to [doc:\/\/com.apple.documentation\/documentation\/Swift\/true], as the following example shows.\n\nThe [doc:\/\/com.apple.foundation\/documentation\/Foundation\/URLResourceValues\/isExcludedFromBackup] resource value exists only to provide guidance to the system about which files and directories it can exclude; it’s not a mechanism to guarantee those items never appear in a backup or on a restored device.\n\nTo indicate the system can exclude a group of related files from iCloud Backup, move those files into a directory and update the directory’s [doc:\/\/com.apple.foundation\/documentation\/Foundation\/URLResourceValues\/isExcludedFromBackup] resource value. If you create an excludable directory inside the app container’s `Library` directory, consider naming the directory with the app’s bundle identifier to avoid potential conflicts with directories the system may create there in the future.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/Foundation\/optimizing-your-app-s-data-for-icloud-backup\ncrawled: 2025-12-03T07:34:47Z\n---\n\n# Optimizing Your App’s Data for iCloud Backup\n\n**Article**\n\nMinimize the space and time that backups take to create by excluding purgeable and nonpurgeable data from backups.\n\n## Overview\n\nWhen iCloud Backup is in an enabled state, it periodically creates a backup of the user’s device, including your app’s data. By storing purgeable data in specific directories and signaling to the system that backups can exclude certain nonpurgeable data, you can shorten the time it takes to create a backup and help reduce the amount of space that backup consumes.\n\n### Exclude Purgeable Data\n\n*Purgeable data* is app data that the system can delete without affecting the app’s execution and that the app can re-create if it needs. For example, your app might generate thumbnails of larger images for display in a collection view. If the app saves the thumbnails to disk, consider them purgeable data because, if the system deletes those files, the app can create them again from source.\n\nThe app container provides two directories for storing purgeable data:\n\n- `\/tmp`\n- `\/Library\/Caches`\n\nThe system periodically purges these directories, so iCloud Backup excludes them by default. If your app creates purgeable data, store it in one of these directories; otherwise, iCloud Backup may include that data, needlessly increasing the physical size of the backup with no benefit to the user. Don’t use these directories to exclude nonpurgeable data from iCloud Backup.\n\nTo retrieve the location of these system-provided directories, use the [doc:\/\/com.apple.foundation\/documentation\/Foundation\/FileManager] class, as the following example shows.\n\n```swift\nlet manager = FileManager.default\n\n\/\/ Get the URL to the app container's 'tmp' directory.\nlet tmpDirectoryURL = manager.temporaryDirectory\n\n\/\/ Get the URL to the app container's 'Caches' directory.\nlet cachesDirectoryURL = try manager.url(for: .cachesDirectory,\n                                         in: .userDomainMask,\n                                         appropriateFor: nil,\n                                         create: false)\n```\n\nConsider deleting purgeable data as soon as your app is done with it so that it doesn’t continue to consume space on the user’s device.\n\n### Mark Nonpurgeable Data as Excludable\n\n*Nonpurgeable data* is data the user creates, or data the app requires to function as the user expects. Some nonpurgeable data isn’t appropriate for backup.\n\nFor example, if your app downloads high-definition movies for offline viewing, exclude those files because they’re typically large in size and the user can download them again on a restored device, if necessary. Conversely, if your app allows the user to import arbitrary files such as PDFs, ebooks, and digital comics, don’t exclude those files because it might be difficult, even impossible, for the user to re-create them on a restored device.\n\nIf your app creates nonpurgeable data that isn’t appropriate for backup, you can indicate which files and directories the system can exclude by setting their [doc:\/\/com.apple.foundation\/documentation\/Foundation\/URLResourceValues\/isExcludedFromBackup] resource value to [doc:\/\/com.apple.documentation\/documentation\/Swift\/true], as the following example shows.\n\n```swift\nfunc excludeItem(at url: URL) throws {\n    \/\/ Create the resource values for the specified URL.\n    var values = URLResourceValues()\n    values.isExcludedFromBackup = true\n\n    \/\/ Apply those values to the URL.\n    var url = url\n    try url.setResourceValues(values)\n}\n```\n\n\n\nThe [doc:\/\/com.apple.foundation\/documentation\/Foundation\/URLResourceValues\/isExcludedFromBackup] resource value exists only to provide guidance to the system about which files and directories it can exclude; it’s not a mechanism to guarantee those items never appear in a backup or on a restored device.\n\nTo indicate the system can exclude a group of related files from iCloud Backup, move those files into a directory and update the directory’s [doc:\/\/com.apple.foundation\/documentation\/Foundation\/URLResourceValues\/isExcludedFromBackup] resource value. If you create an excludable directory inside the app container’s `Library` directory, consider naming the directory with the app’s bundle identifier to avoid potential conflicts with directories the system may create there in the future.\n\n```swift\nlet manager = FileManager.default\n\n\/\/ Retrieve the app's bundle identifier.\nif let bundleIdentifier = Bundle.main.bundleIdentifier {\n    \n    \/\/ Get the URL to the app container's 'Library' directory.\n    var url = try manager.url(for: .libraryDirectory,\n                              in: .userDomainMask,\n                              appropriateFor: nil,\n                              create: false)\n    \n    \/\/ Append the bundle identifier to the retrieved URL.\n    url.appendPathComponent(bundleIdentifier, isDirectory: true)\n    \n    \/\/ Use the URL to create the new directory.\n    try manager.createDirectory(at: url,\n                                withIntermediateDirectories: true,\n                                attributes: nil)\n}\n```\n\n## Files and Data Persistence\n\n- **File System**: Create, read, write, and examine files and folders in the file system.\n- **Archives and Serialization**: Convert objects and values to and from property list, JSON, and other flat binary representations.\n- **Settings**: Configure your app using data you store persistently on the local disk or in iCloud.\n- **Spotlight**: Search for files and other items on the local device, and index your app’s content for searching.\n- **iCloud**: Manage files and key-value data that automatically synchronize among a user’s iCloud devices.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Create, read, write, and examine files and folders in the file system.",
          "name" : "File System",
          "url" : "https:\/\/developer.apple.com\/documentation\/Foundation\/file-system"
        },
        {
          "description" : "Convert objects and values to and from property list, JSON, and other flat binary representations.",
          "name" : "Archives and Serialization",
          "url" : "https:\/\/developer.apple.com\/documentation\/Foundation\/archives-and-serialization"
        },
        {
          "description" : "Configure your app using data you store persistently on the local disk or in iCloud.",
          "name" : "Settings",
          "url" : "https:\/\/developer.apple.com\/documentation\/Foundation\/settings"
        },
        {
          "description" : "Search for files and other items on the local device, and index your app’s content for searching.",
          "name" : "Spotlight",
          "url" : "https:\/\/developer.apple.com\/documentation\/Foundation\/spotlight"
        },
        {
          "description" : "Manage files and key-value data that automatically synchronize among a user’s iCloud devices.",
          "name" : "iCloud",
          "url" : "https:\/\/developer.apple.com\/documentation\/Foundation\/icloud"
        }
      ],
      "title" : "Files and Data Persistence"
    }
  ],
  "source" : "appleJSON",
  "title" : "Optimizing Your App’s Data for iCloud Backup",
  "url" : "https:\/\/developer.apple.com\/documentation\/Foundation\/optimizing-your-app-s-data-for-icloud-backup"
}