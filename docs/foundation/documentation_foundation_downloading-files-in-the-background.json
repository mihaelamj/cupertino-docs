{
  "abstract" : "Create tasks that download files while your app is inactive.",
  "codeExamples" : [
    {
      "code" : "private lazy var urlSession: URLSession = {\n    let config = URLSessionConfiguration.background(withIdentifier: \"MySession\")\n    config.isDiscretionary = true\n    config.sessionSendsLaunchEvents = true\n    return URLSession(configuration: config, delegate: self, delegateQueue: nil)\n}()",
      "language" : "swift"
    },
    {
      "code" : "let backgroundTask = urlSession.downloadTask(with: url)\nbackgroundTask.earliestBeginDate = Date().addingTimeInterval(60 * 60)\nbackgroundTask.countOfBytesClientExpectsToSend = 200\nbackgroundTask.countOfBytesClientExpectsToReceive = 500 * 1024\nbackgroundTask.resume()",
      "language" : "swift"
    },
    {
      "code" : "func application(_ application: UIApplication,\n                 handleEventsForBackgroundURLSession identifier: String,\n                 completionHandler: @escaping () -> Void) {\n        backgroundCompletionHandler = completionHandler\n}",
      "language" : "swift"
    },
    {
      "code" : "func urlSessionDidFinishEvents(forBackgroundURLSession session: URLSession) {\n    DispatchQueue.main.async {\n        guard let appDelegate = UIApplication.shared.delegate as? AppDelegate,\n            let backgroundCompletionHandler =\n            appDelegate.backgroundCompletionHandler else {\n                return\n        }\n        backgroundCompletionHandler()\n    }\n}",
      "language" : "swift"
    }
  ],
  "contentHash" : "8ca836d109442fae17640a68e831f64375b9749dc338fd4b6a7e5c906d38b839",
  "crawledAt" : "2025-12-04T16:24:35Z",
  "id" : "9C3C7631-125D-4335-B6EB-CE4BF7DDDDF1",
  "kind" : "article",
  "language" : "swift",
  "module" : "Foundation",
  "overview" : "## Overview\n\nFor long-running and nonurgent transfers, you can create tasks that run in the background. These tasks continue to run even when your app is suspended, allowing your app to access the downloaded file when the app is resumed.\n\n### Configure the background session\n\nTo perform a background download, configure a [doc:\/\/com.apple.foundation\/documentation\/Foundation\/URLSession] for background operation. The following example demonstrates this process.\n\nCreating a background URL session\n\n### Create and schedule the download task\n\nYou create download tasks from the session with either the [doc:\/\/com.apple.foundation\/documentation\/Foundation\/URLSession\/downloadTask(with:)-1onj] method that takes a URL, or the [doc:\/\/com.apple.foundation\/documentation\/Foundation\/URLSession\/downloadTask(with:)-3fb7s] method that takes a [doc:\/\/com.apple.foundation\/documentation\/Foundation\/URLRequest] instance.  You set properties on this method to help the system optimize its behavior.\n\nIn the following example, the task is set to begin at least one hour in the future and is configured to send around 200 bytes of data and receive around 500 KB.\n\nCreating a download task from a URL session\n\n### Handle app suspension\n\nDifferent app states affect how your app interacts with the background download. In iOS, your app could be in the foreground, suspended, or even terminated by the system. See [doc:\/\/com.apple.documentation\/documentation\/UIKit\/managing-your-app-s-life-cycle] for more information about these states.\n\nIf your app is in the background, the system may suspend your app while the download is performed in another process. In this case, when the download finishes, the system resumes the app and calls the [doc:\/\/com.apple.documentation\/documentation\/UIKit\/UIApplicationDelegate] method [doc:\/\/com.apple.documentation\/documentation\/UIKit\/UIApplicationDelegate\/application(_:handleEventsForBackgroundURLSession:completionHandler:)]. This method receives the session identifier you created in `Creating a background URL session` as its second parameter.\n\nThis delegate method also receives a completion handler as its final parameter. Immediately store this handler wherever it makes sense for your app, perhaps as a property of your app delegate, or of your class that implements [doc:\/\/com.apple.foundation\/documentation\/Foundation\/URLSessionDownloadDelegate]. In the following example, this completion handler is stored in an app delegate property called `backgroundCompletionHandler`.\n\nStoring the background download completion handler sent to the application delegate\n\nWhen all events have been delivered,  the system calls the [doc:\/\/com.apple.foundation\/documentation\/Foundation\/URLSessionDelegate\/urlSessionDidFinishEvents(forBackgroundURLSession:)] method of [doc:\/\/com.apple.foundation\/documentation\/Foundation\/URLSessionDelegate]. At this point, fetch  the `backgroundCompletionHandler` stored by the app delegate in the previous example and execute it. The following example shows this process.\n\nNote that because [doc:\/\/com.apple.foundation\/documentation\/Foundation\/URLSessionDelegate\/urlSessionDidFinishEvents(forBackgroundURLSession:)] may be called on a secondary queue, it needs to explicitly execute the handler (which was received from a UIKit method) on the main queue.\n\nExecuting the background URL session completion handler on the main queue\n\n### Access the file, or move it to a permanent location\n\nOnce your resumed app calls the completion handler, the download task finishes its work and calls the delegate’s [doc:\/\/com.apple.foundation\/documentation\/Foundation\/URLSessionDownloadDelegate\/urlSession(_:downloadTask:didFinishDownloadingTo:)] method. At this point, the file is fully downloaded, and will be available until your delegate method returns. If you only need to read it once, you can access the file immediately in its temporary location. If you want to preserve the file, move it to a permanent location like the `Documents` directory, as described in [doc:\/\/com.apple.foundation\/documentation\/Foundation\/downloading-files-from-websites].\n\n### Recreate the session if the app was terminated\n\nIf the system terminated the app while it was suspended, the system relaunches the app in the background. As part of your launch time setup, recreate the background session (see `Creating a background URL session`), using the same session identifier as before, to allow the system to reassociate the background download task with your session. You do this so your background session is ready to go whether the app was launched by the user or by the system. Once the app relaunches, the series of events is the same as if the app had been suspended and resumed, as discussed earlier in [doc:\/\/com.apple.foundation\/documentation\/Foundation\/downloading-files-in-the-background#Handle-app-suspension].\n\n### Comply with background transfer limitations\n\nWith background sessions, the actual transfer is performed by a process that is separate from your app’s process. Because restarting your app’s process is fairly expensive, a few features are unavailable, resulting in the following limitations:\n\n### Use background sessions efficiently\n\nWhen the system resumes or relaunches your app, it uses a rate limiter to prevent abuse of background downloads. When your app starts a new download task while in the background, the task doesn’t begin until the delay expires. The delay increases each time the system resumes or relaunches your app.\n\nAs a result, if your app starts a single background download, gets resumed when the download completes, and then starts a new download, it will greatly increase the delay. Instead, use a small number of background sessions — ideally just one — and use these sessions to start many download tasks at once. This allows the system to perform multiple downloads at once, and resume your app when they have completed.\n\nKeep in mind, though, that each task has its own overhead. If you find you need to launch thousands of download tasks, change your design to perform fewer, larger transfers.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/Foundation\/downloading-files-in-the-background\ncrawled: 2025-12-04T16:24:35Z\n---\n\n# Downloading files in the background\n\n**Article**\n\nCreate tasks that download files while your app is inactive.\n\n## Overview\n\nFor long-running and nonurgent transfers, you can create tasks that run in the background. These tasks continue to run even when your app is suspended, allowing your app to access the downloaded file when the app is resumed.\n\n\n\n### Configure the background session\n\nTo perform a background download, configure a [doc:\/\/com.apple.foundation\/documentation\/Foundation\/URLSession] for background operation. The following example demonstrates this process.\n\n1. Create a background [doc:\/\/com.apple.foundation\/documentation\/Foundation\/URLSessionConfiguration] object with the class method [doc:\/\/com.apple.foundation\/documentation\/Foundation\/URLSessionConfiguration\/background(withIdentifier:)] of [doc:\/\/com.apple.foundation\/documentation\/Foundation\/URLSession], providing a session identifier that is unique within your app. Because most apps need only a few background sessions (usually one), you can use a fixed string for the identifier, rather than a dynamically generated identifier. The identifier doesn’t need to be unique globally.\n2. To have the system to wake up your app when a task completes and the app is in the background, make sure the [doc:\/\/com.apple.foundation\/documentation\/Foundation\/URLSessionConfiguration\/sessionSendsLaunchEvents] property is set to `true` (the default).\n3. For time-insensitive tasks, enable the [doc:\/\/com.apple.foundation\/documentation\/Foundation\/URLSessionConfiguration\/isDiscretionary] property, so the system can wait for optimal conditions to perform the transfer, such as when the device is plugged in or connected to Wi-Fi.\n4. Use the [doc:\/\/com.apple.foundation\/documentation\/Foundation\/URLSessionConfiguration] instance to create a [doc:\/\/com.apple.foundation\/documentation\/Foundation\/URLSession] instance. Provide a delegate, to receive events from the background transfer.\n\nCreating a background URL session\n\n```swift\nprivate lazy var urlSession: URLSession = {\n    let config = URLSessionConfiguration.background(withIdentifier: \"MySession\")\n    config.isDiscretionary = true\n    config.sessionSendsLaunchEvents = true\n    return URLSession(configuration: config, delegate: self, delegateQueue: nil)\n}()\n```\n\n\n\n### Create and schedule the download task\n\nYou create download tasks from the session with either the [doc:\/\/com.apple.foundation\/documentation\/Foundation\/URLSession\/downloadTask(with:)-1onj] method that takes a URL, or the [doc:\/\/com.apple.foundation\/documentation\/Foundation\/URLSession\/downloadTask(with:)-3fb7s] method that takes a [doc:\/\/com.apple.foundation\/documentation\/Foundation\/URLRequest] instance.  You set properties on this method to help the system optimize its behavior.\n\n1. As shown in the following example, create a download task with [doc:\/\/com.apple.foundation\/documentation\/Foundation\/URLSession\/downloadTask(with:)-1onj].\n2. Optionally, set the [doc:\/\/com.apple.foundation\/documentation\/Foundation\/URLSessionTask\/earliestBeginDate] property to schedule the download to begin at a particular point in the future. The download isn’t guaranteed to begin at precisely this time, but it won’t start sooner.\n3. To help the system schedule network activity efficiently, set the properties [doc:\/\/com.apple.foundation\/documentation\/Foundation\/URLSessionTask\/countOfBytesClientExpectsToSend] and [doc:\/\/com.apple.foundation\/documentation\/Foundation\/URLSessionTask\/countOfBytesClientExpectsToReceive]. These values are best-guess upper bounds on the expected byte count, and should account for headers as well as body data.\n4. To start the task, call [doc:\/\/com.apple.foundation\/documentation\/Foundation\/URLSessionTask\/resume()].\n\nIn the following example, the task is set to begin at least one hour in the future and is configured to send around 200 bytes of data and receive around 500 KB.\n\nCreating a download task from a URL session\n\n```swift\nlet backgroundTask = urlSession.downloadTask(with: url)\nbackgroundTask.earliestBeginDate = Date().addingTimeInterval(60 * 60)\nbackgroundTask.countOfBytesClientExpectsToSend = 200\nbackgroundTask.countOfBytesClientExpectsToReceive = 500 * 1024\nbackgroundTask.resume()\n```\n\n### Handle app suspension\n\nDifferent app states affect how your app interacts with the background download. In iOS, your app could be in the foreground, suspended, or even terminated by the system. See [doc:\/\/com.apple.documentation\/documentation\/UIKit\/managing-your-app-s-life-cycle] for more information about these states.\n\nIf your app is in the background, the system may suspend your app while the download is performed in another process. In this case, when the download finishes, the system resumes the app and calls the [doc:\/\/com.apple.documentation\/documentation\/UIKit\/UIApplicationDelegate] method [doc:\/\/com.apple.documentation\/documentation\/UIKit\/UIApplicationDelegate\/application(_:handleEventsForBackgroundURLSession:completionHandler:)]. This method receives the session identifier you created in `Creating a background URL session` as its second parameter.\n\nThis delegate method also receives a completion handler as its final parameter. Immediately store this handler wherever it makes sense for your app, perhaps as a property of your app delegate, or of your class that implements [doc:\/\/com.apple.foundation\/documentation\/Foundation\/URLSessionDownloadDelegate]. In the following example, this completion handler is stored in an app delegate property called `backgroundCompletionHandler`.\n\nStoring the background download completion handler sent to the application delegate\n\n```swift\nfunc application(_ application: UIApplication,\n                 handleEventsForBackgroundURLSession identifier: String,\n                 completionHandler: @escaping () -> Void) {\n        backgroundCompletionHandler = completionHandler\n}\n```\n\nWhen all events have been delivered,  the system calls the [doc:\/\/com.apple.foundation\/documentation\/Foundation\/URLSessionDelegate\/urlSessionDidFinishEvents(forBackgroundURLSession:)] method of [doc:\/\/com.apple.foundation\/documentation\/Foundation\/URLSessionDelegate]. At this point, fetch  the `backgroundCompletionHandler` stored by the app delegate in the previous example and execute it. The following example shows this process.\n\nNote that because [doc:\/\/com.apple.foundation\/documentation\/Foundation\/URLSessionDelegate\/urlSessionDidFinishEvents(forBackgroundURLSession:)] may be called on a secondary queue, it needs to explicitly execute the handler (which was received from a UIKit method) on the main queue.\n\nExecuting the background URL session completion handler on the main queue\n\n```swift\nfunc urlSessionDidFinishEvents(forBackgroundURLSession session: URLSession) {\n    DispatchQueue.main.async {\n        guard let appDelegate = UIApplication.shared.delegate as? AppDelegate,\n            let backgroundCompletionHandler =\n            appDelegate.backgroundCompletionHandler else {\n                return\n        }\n        backgroundCompletionHandler()\n    }\n}\n```\n\n### Access the file, or move it to a permanent location\n\nOnce your resumed app calls the completion handler, the download task finishes its work and calls the delegate’s [doc:\/\/com.apple.foundation\/documentation\/Foundation\/URLSessionDownloadDelegate\/urlSession(_:downloadTask:didFinishDownloadingTo:)] method. At this point, the file is fully downloaded, and will be available until your delegate method returns. If you only need to read it once, you can access the file immediately in its temporary location. If you want to preserve the file, move it to a permanent location like the `Documents` directory, as described in [doc:\/\/com.apple.foundation\/documentation\/Foundation\/downloading-files-from-websites].\n\n### Recreate the session if the app was terminated\n\nIf the system terminated the app while it was suspended, the system relaunches the app in the background. As part of your launch time setup, recreate the background session (see `Creating a background URL session`), using the same session identifier as before, to allow the system to reassociate the background download task with your session. You do this so your background session is ready to go whether the app was launched by the user or by the system. Once the app relaunches, the series of events is the same as if the app had been suspended and resumed, as discussed earlier in [doc:\/\/com.apple.foundation\/documentation\/Foundation\/downloading-files-in-the-background#Handle-app-suspension].\n\n\n\n### Comply with background transfer limitations\n\nWith background sessions, the actual transfer is performed by a process that is separate from your app’s process. Because restarting your app’s process is fairly expensive, a few features are unavailable, resulting in the following limitations:\n\n- The session *must* provide a delegate for event delivery. (For uploads and downloads, the delegates behave the same as for in-process transfers.)\n- Only HTTP and HTTPS protocols are supported (no custom protocols).\n- Redirects are always followed. As a result, even if you have implemented [doc:\/\/com.apple.foundation\/documentation\/Foundation\/URLSessionTaskDelegate\/urlSession(_:task:willPerformHTTPRedirection:newRequest:completionHandler:)], it is *not* called.\n- Only upload tasks from a file are supported (uploads from data instances or a stream fail after the app exits).\n\n### Use background sessions efficiently\n\nWhen the system resumes or relaunches your app, it uses a rate limiter to prevent abuse of background downloads. When your app starts a new download task while in the background, the task doesn’t begin until the delay expires. The delay increases each time the system resumes or relaunches your app.\n\nAs a result, if your app starts a single background download, gets resumed when the download completes, and then starts a new download, it will greatly increase the delay. Instead, use a small number of background sessions — ideally just one — and use these sessions to start many download tasks at once. This allows the system to perform multiple downloads at once, and resume your app when they have completed.\n\nKeep in mind, though, that each task has its own overhead. If you find you need to launch thousands of download tasks, change your design to perform fewer, larger transfers.\n\n\n\n## Downloading\n\n- **Downloading files from websites**: Download files directly to the filesystem.\n- **Pausing and resuming downloads**: Allow the user to resume a download without starting over.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Download files directly to the filesystem.",
          "name" : "Downloading files from websites",
          "url" : "https:\/\/developer.apple.com\/documentation\/Foundation\/downloading-files-from-websites"
        },
        {
          "description" : "Allow the user to resume a download without starting over.",
          "name" : "Pausing and resuming downloads",
          "url" : "https:\/\/developer.apple.com\/documentation\/Foundation\/pausing-and-resuming-downloads"
        }
      ],
      "title" : "Downloading"
    }
  ],
  "source" : "appleJSON",
  "title" : "Downloading files in the background",
  "url" : "https:\/\/developer.apple.com\/documentation\/Foundation\/downloading-files-in-the-background"
}