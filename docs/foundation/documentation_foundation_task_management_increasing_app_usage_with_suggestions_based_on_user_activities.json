{
  "abstract" : "Provide a continuous user experience by capturing information from your app and displaying this information as proactive suggestions across the system.",
  "codeExamples" : [
    {
      "code" : "<key>NSUserActivityTypes<\/key>\n<array>\n<string>com.example.apple-samplecode.ProactiveToolbox.view-location<\/string>\n<\/array>",
      "language" : "swift"
    },
    {
      "code" : "\/*\n Provide just enough information in the `userInfo` dictionary to be able to restore state.\n The larger the dictionary, the longer it takes to deliver that payload and resume the activity.\n *\/\nvar userInfo = [String: Any]()\ndo {\n    let data = try NSKeyedArchiver.archivedData(withRootObject: mapItem.placemark, requiringSecureCoding: true)\n    userInfo[\"placemark\"] = data\n} catch {\n    os_log(\"Could not encode placemark data\", type: .error)\n}\n\nif let phoneNumber = mapItem.phoneNumber {\n    userInfo[\"phoneNumber\"] = phoneNumber\n}\n\nactivity.addUserInfoEntries(from: userInfo)",
      "language" : "swift"
    },
    {
      "code" : "\/\/ The following properties enable the activity to be indexed in Search.\nactivity.isEligibleForPublicIndexing = true\nactivity.isEligibleForSearch = true\nactivity.title = mapItem?.name\nactivity.keywords = [\"pizza\"]",
      "language" : "swift"
    },
    {
      "code" : "\/\/ Provide additional searchable attributes.\nactivity.contentAttributeSet?.supportsNavigation = true\nactivity.contentAttributeSet?.supportsPhoneCall = true\nactivity.contentAttributeSet?.thumbnailData = #imageLiteral(resourceName: \"pizza\").pngData()",
      "language" : "swift"
    },
    {
      "code" : "\/\/ The following properties enable the activity to be used as a shortcut with Siri.\nactivity.isEligibleForPrediction = true\nactivity.suggestedInvocationPhrase = \"Show my favorite pizzeria\"",
      "language" : "swift"
    },
    {
      "code" : "\/\/ Enable sharing this location by telling Siri to \"share this\".\nactivity.webpageURL = mapItem?.url",
      "language" : "swift"
    },
    {
      "code" : "func application(_ application: UIApplication,\n                 continue userActivity: NSUserActivity,\n                 restorationHandler: @escaping ([UIUserActivityRestoring]?) -> Void) -> Bool {\n    \n    guard userActivity.activityType == \"com.example.apple-samplecode.ProactiveToolbox.view-location\",\n        let tabBarController = window?.rootViewController as? UITabBarController,\n        let navigationController = tabBarController.viewControllers?.first as? UINavigationController\n        else { return false }\n    \n    tabBarController.selectedIndex = 0\n    \n    \/*\n     Calling the restoration handler is optional and is only needed\n     when specific objects are capable of continuing the activity.\n     *\/\n    restorationHandler(navigationController.viewControllers)\n    \n    return true\n}",
      "language" : "swift"
    },
    {
      "code" : "override func restoreUserActivityState(_ activity: NSUserActivity) {\n    super.restoreUserActivityState(activity)\n    \n    do {\n        guard let userInfo = activity.userInfo,\n            let url = activity.webpageURL,\n            let phoneNumber = userInfo[\"phoneNumber\"] as? String,\n            let placemarkData = userInfo[\"placemark\"] as? Data,\n            let placemark = try NSKeyedUnarchiver.unarchivedObject(ofClass: MKPlacemark.self, from: placemarkData)\n            else { return }\n        \n        let mapItem = MKMapItem(placemark: placemark)\n        mapItem.name = activity.title\n        \n        if navigationController?.visibleViewController == self {\n            restoreMapItem(mapItem, url: url, phoneNumber: phoneNumber)\n        } else if let modalController = navigationController?.visibleViewController as? LocationViewController {\n            modalController.restoreMapItem(mapItem, url: url, phoneNumber: phoneNumber)\n        }\n    } catch {\n        os_log(\"Could not convert user activity placemark data to placemark object\", type: .error)\n    }\n}",
      "language" : "swift"
    },
    {
      "code" : "\/\/ These properties can also be set on the field in Interface Builder.\nnameTextField.textContentType = .organizationName\nstreetAddressLine1TextField.textContentType = .streetAddressLine1\nstreetAddressLine2TextField.textContentType = .streetAddressLine2\ncityTextField.textContentType = .addressCity\nstateTextField.textContentType = .addressState\npostalCodeTextField.textContentType = .postalCode\ncountryOrRegionTextField.textContentType = .countryName",
      "language" : "swift"
    }
  ],
  "contentHash" : "446a7966567f5c2188a0b2e4fadd89e48d7adc884e25b0c14200eba0224549c1",
  "crawledAt" : "2025-12-02T15:46:27Z",
  "id" : "97EF2EBF-0502-4062-A93A-00C758818A45",
  "kind" : "unknown",
  "language" : "swift",
  "module" : "Foundation",
  "overview" : "## Overview\n\nThis sample app shows a list of pizza restaurants, near your current location, in a table view. Select a restaurant from the table view to donate its location information to the system as a user activity object. The system then displays the registered location information proactively as suggestions, such as in Search, used with Siri Shortcuts.\n\nWhen a user interacts with a proactive suggestion, the system continues the activity by associating the object’s activity type with the sample app.\n\nWhen donating location information, this sample app also verifies whether the previously captured information appears, as QuickType keyboard suggestions, within other apps installed on a device.\n\n### Declare a User Activity Type\n\nYou implement proactive suggestions by determining specific activities that a user can perform in your app, and whose state you can recreate at a later time. The sample app has one user activity, `view-location`, which represents the user viewing details of a specific restaurant location.\n\nIn the sample app, the target includes the `view-location` activity in its [doc:\/\/com.apple.bundleresources\/documentation\/BundleResources\/Information-Property-List] file, as an entry with the key name ``. The type of this entry is `Array`, and each member is a `String` representing a supported user activity in reverse DNS notation.\n\n### Manage a User Activity\n\nAt runtime, you represent a user activity with the [doc:\/\/com.apple.foundation\/documentation\/Foundation\/NSUserActivity] object. You initialize a user activity object with a string identifier, the same one declared earlier in the `Info.plist` file.\n\nIn the sample app, `LocationViewController` manages a single `NSUserActivity` object, representing the `view-location` activity type. When you select a restaurant, the view controller sets its [doc:\/\/com.apple.uikit\/documentation\/UIKit\/UIResponder\/userActivity] property to the `view-location` activity—registering the user activity object as the current activity, replacing any other activity previously sent to Siri or the system.\n\nThe view controller also sets [doc:\/\/com.apple.foundation\/documentation\/Foundation\/NSUserActivity\/needsSave] to `true`, indicating that the activity will be updated with new data in the future, which eventually results in a callback to the [doc:\/\/com.apple.uikit\/documentation\/UIKit\/UIResponder\/updateUserActivityState(_:)] method. This is the app’s opportunity to refresh the activity object’s [doc:\/\/com.apple.foundation\/documentation\/Foundation\/NSUserActivity\/userInfo] property, with the minimal amount of information needed to restore the state of the app, before Siri or the system receives the activity.\n\n\n\n### Provide Support for Improved Search Results\n\nIf your user activity objects contain information that the user might want to search for later, you can have Search index those objects and consider them during subsequent on-device searches.\n\nTo enable support for Search on a user activity object, set the [doc:\/\/com.apple.foundation\/documentation\/Foundation\/NSUserActivity\/isEligibleForSearch] property to `true`. Additionally, you can make an activity object publicly accessible to all iOS users by setting the [doc:\/\/com.apple.foundation\/documentation\/Foundation\/NSUserActivity\/isEligibleForPublicIndexing] property to `true`.\n\n\n\nProvide the activity object with as much rich information about the activity as possible, by configuring the [doc:\/\/com.apple.foundation\/documentation\/Foundation\/NSUserActivity\/contentAttributeSet], [doc:\/\/com.apple.foundation\/documentation\/Foundation\/NSUserActivity\/keywords], or [doc:\/\/com.apple.foundation\/documentation\/Foundation\/NSUserActivity\/webpageURL] properties so that the system can index the object. The app must also maintain a strong reference to any activity objects that the system uses for search results.\n\n\n\nTo learn more about Search, see [link-3333146].\n\n### Provide Support for Shortcuts\n\nSiri learns about the shortcuts available to your app through donations that your app makes to Siri. You can make donations from a user activity when the action involves a view within your app, such as the sample app, which displays a list of nearby restaurants.\n\nThe sample app enables support for Siri Shortcuts on a user activity object by setting the [doc:\/\/com.apple.foundation\/documentation\/Foundation\/NSUserActivity\/isEligibleForPrediction] property to `true`. The app suggests an invocation phrase, which is displayed to the user when they create a shortcut, by setting a short, memorable phrase to the [doc:\/\/com.apple.foundation\/documentation\/Foundation\/NSUserActivity\/suggestedInvocationPhrase] property.\n\n\n\nDuring development, the system provides developer settings to modify the display behavior of shortcuts, and force sync shortcuts to an Apple Watch from an iPhone device. Go to Settings > Developer on the iPhone device to test an app’s behavior with Siri Shortcuts.\n\nFor more information, see [doc:\/\/com.apple.sirikit\/documentation\/SiriKit\/donating-shortcuts].\n\n### Provide Support for Sharing\n\nIf your user-activity object contains information about a webpage, your users can share that webpage with others through Siri. For example, the user can share the pizza restaurant they’re viewing by asking Siri to “share this”, to send a message that contains the webpage URL to another user. Siri uses the URL stored by the app in the [doc:\/\/com.apple.foundation\/documentation\/Foundation\/NSUserActivity\/webpageURL] on the user activity.\n\n### Handle Activities\n\nWhen a user interacts with a proactive suggestion for your app, such as through Siri Shortcuts, the system restores your app to the foreground, receives data associated with its user activity, and calls [doc:\/\/com.apple.uikit\/documentation\/UIKit\/UIApplicationDelegate\/application(_:continue:restorationHandler:)].\n\nTo give `SearchViewController` a chance to perform its state restoration operation through [doc:\/\/com.apple.uikit\/documentation\/UIKit\/UIResponder\/restoreUserActivityState(_:)], the sample app verifies the activity type of the user activity object, and passes the first tab’s view controller hierarchy to the `restorationHandler` block parameter.\n\n\n\nThe sample app validates the user activity, consumes any necessary information from the `userInfo` dictionary, and updates its UI to continue the requested activity from where the user left off.\n\n\n\n### Verify QuickType Keyboard Integration\n\nText fields describe the intended purpose of input data, like a region’s name or postal code, via the [doc:\/\/com.apple.uikit\/documentation\/UIKit\/UITextInputTraits\/textContentType] property. If any app on the device recently donated information matching the expected text content type, that information is suggested in the QuickType keyboard as the user types in the text field.\n\nFor example, in the sample app, a user selects a pizza restaurant, and its address is suggested in Messages or a search field in Apple Maps.\n\nTo verify this behavior, select a point of interest in Apple Maps, then return to this sample app to see the donated information populated in the QuickType keyboard.\n\n",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/foundation\/task_management\/increasing_app_usage_with_suggestions_based_on_user_activities\ncrawled: 2025-12-02T15:46:27Z\n---\n\n# Increasing App Usage with Suggestions Based on User Activities\n\n**Sample Code**\n\nProvide a continuous user experience by capturing information from your app and displaying this information as proactive suggestions across the system.\n\n## Overview\n\nThis sample app shows a list of pizza restaurants, near your current location, in a table view. Select a restaurant from the table view to donate its location information to the system as a user activity object. The system then displays the registered location information proactively as suggestions, such as in Search, used with Siri Shortcuts.\n\nWhen a user interacts with a proactive suggestion, the system continues the activity by associating the object’s activity type with the sample app.\n\nWhen donating location information, this sample app also verifies whether the previously captured information appears, as QuickType keyboard suggestions, within other apps installed on a device.\n\n### Declare a User Activity Type\n\nYou implement proactive suggestions by determining specific activities that a user can perform in your app, and whose state you can recreate at a later time. The sample app has one user activity, `view-location`, which represents the user viewing details of a specific restaurant location.\n\nIn the sample app, the target includes the `view-location` activity in its [doc:\/\/com.apple.bundleresources\/documentation\/BundleResources\/Information-Property-List] file, as an entry with the key name ``. The type of this entry is `Array`, and each member is a `String` representing a supported user activity in reverse DNS notation.\n\n```swift\n<key>NSUserActivityTypes<\/key>\n<array>\n<string>com.example.apple-samplecode.ProactiveToolbox.view-location<\/string>\n<\/array>\n```\n\n### Manage a User Activity\n\nAt runtime, you represent a user activity with the [doc:\/\/com.apple.foundation\/documentation\/Foundation\/NSUserActivity] object. You initialize a user activity object with a string identifier, the same one declared earlier in the `Info.plist` file.\n\nIn the sample app, `LocationViewController` manages a single `NSUserActivity` object, representing the `view-location` activity type. When you select a restaurant, the view controller sets its [doc:\/\/com.apple.uikit\/documentation\/UIKit\/UIResponder\/userActivity] property to the `view-location` activity—registering the user activity object as the current activity, replacing any other activity previously sent to Siri or the system.\n\n\n\nThe view controller also sets [doc:\/\/com.apple.foundation\/documentation\/Foundation\/NSUserActivity\/needsSave] to `true`, indicating that the activity will be updated with new data in the future, which eventually results in a callback to the [doc:\/\/com.apple.uikit\/documentation\/UIKit\/UIResponder\/updateUserActivityState(_:)] method. This is the app’s opportunity to refresh the activity object’s [doc:\/\/com.apple.foundation\/documentation\/Foundation\/NSUserActivity\/userInfo] property, with the minimal amount of information needed to restore the state of the app, before Siri or the system receives the activity.\n\n```swift\n\/*\n Provide just enough information in the `userInfo` dictionary to be able to restore state.\n The larger the dictionary, the longer it takes to deliver that payload and resume the activity.\n *\/\nvar userInfo = [String: Any]()\ndo {\n    let data = try NSKeyedArchiver.archivedData(withRootObject: mapItem.placemark, requiringSecureCoding: true)\n    userInfo[\"placemark\"] = data\n} catch {\n    os_log(\"Could not encode placemark data\", type: .error)\n}\n\nif let phoneNumber = mapItem.phoneNumber {\n    userInfo[\"phoneNumber\"] = phoneNumber\n}\n\nactivity.addUserInfoEntries(from: userInfo)\n```\n\n\n\n### Provide Support for Improved Search Results\n\nIf your user activity objects contain information that the user might want to search for later, you can have Search index those objects and consider them during subsequent on-device searches.\n\nTo enable support for Search on a user activity object, set the [doc:\/\/com.apple.foundation\/documentation\/Foundation\/NSUserActivity\/isEligibleForSearch] property to `true`. Additionally, you can make an activity object publicly accessible to all iOS users by setting the [doc:\/\/com.apple.foundation\/documentation\/Foundation\/NSUserActivity\/isEligibleForPublicIndexing] property to `true`.\n\n```swift\n\/\/ The following properties enable the activity to be indexed in Search.\nactivity.isEligibleForPublicIndexing = true\nactivity.isEligibleForSearch = true\nactivity.title = mapItem?.name\nactivity.keywords = [\"pizza\"]\n```\n\n\n\nProvide the activity object with as much rich information about the activity as possible, by configuring the [doc:\/\/com.apple.foundation\/documentation\/Foundation\/NSUserActivity\/contentAttributeSet], [doc:\/\/com.apple.foundation\/documentation\/Foundation\/NSUserActivity\/keywords], or [doc:\/\/com.apple.foundation\/documentation\/Foundation\/NSUserActivity\/webpageURL] properties so that the system can index the object. The app must also maintain a strong reference to any activity objects that the system uses for search results.\n\n```swift\n\/\/ Provide additional searchable attributes.\nactivity.contentAttributeSet?.supportsNavigation = true\nactivity.contentAttributeSet?.supportsPhoneCall = true\nactivity.contentAttributeSet?.thumbnailData = #imageLiteral(resourceName: \"pizza\").pngData()\n```\n\n\n\nTo learn more about Search, see [link-3333146].\n\n### Provide Support for Shortcuts\n\nSiri learns about the shortcuts available to your app through donations that your app makes to Siri. You can make donations from a user activity when the action involves a view within your app, such as the sample app, which displays a list of nearby restaurants.\n\nThe sample app enables support for Siri Shortcuts on a user activity object by setting the [doc:\/\/com.apple.foundation\/documentation\/Foundation\/NSUserActivity\/isEligibleForPrediction] property to `true`. The app suggests an invocation phrase, which is displayed to the user when they create a shortcut, by setting a short, memorable phrase to the [doc:\/\/com.apple.foundation\/documentation\/Foundation\/NSUserActivity\/suggestedInvocationPhrase] property.\n\n```swift\n\/\/ The following properties enable the activity to be used as a shortcut with Siri.\nactivity.isEligibleForPrediction = true\nactivity.suggestedInvocationPhrase = \"Show my favorite pizzeria\"\n```\n\n\n\nDuring development, the system provides developer settings to modify the display behavior of shortcuts, and force sync shortcuts to an Apple Watch from an iPhone device. Go to Settings > Developer on the iPhone device to test an app’s behavior with Siri Shortcuts.\n\nFor more information, see [doc:\/\/com.apple.sirikit\/documentation\/SiriKit\/donating-shortcuts].\n\n### Provide Support for Sharing\n\nIf your user-activity object contains information about a webpage, your users can share that webpage with others through Siri. For example, the user can share the pizza restaurant they’re viewing by asking Siri to “share this”, to send a message that contains the webpage URL to another user. Siri uses the URL stored by the app in the [doc:\/\/com.apple.foundation\/documentation\/Foundation\/NSUserActivity\/webpageURL] on the user activity.\n\n```swift\n\/\/ Enable sharing this location by telling Siri to \"share this\".\nactivity.webpageURL = mapItem?.url\n```\n\n### Handle Activities\n\nWhen a user interacts with a proactive suggestion for your app, such as through Siri Shortcuts, the system restores your app to the foreground, receives data associated with its user activity, and calls [doc:\/\/com.apple.uikit\/documentation\/UIKit\/UIApplicationDelegate\/application(_:continue:restorationHandler:)].\n\nTo give `SearchViewController` a chance to perform its state restoration operation through [doc:\/\/com.apple.uikit\/documentation\/UIKit\/UIResponder\/restoreUserActivityState(_:)], the sample app verifies the activity type of the user activity object, and passes the first tab’s view controller hierarchy to the `restorationHandler` block parameter.\n\n```swift\nfunc application(_ application: UIApplication,\n                 continue userActivity: NSUserActivity,\n                 restorationHandler: @escaping ([UIUserActivityRestoring]?) -> Void) -> Bool {\n    \n    guard userActivity.activityType == \"com.example.apple-samplecode.ProactiveToolbox.view-location\",\n        let tabBarController = window?.rootViewController as? UITabBarController,\n        let navigationController = tabBarController.viewControllers?.first as? UINavigationController\n        else { return false }\n    \n    tabBarController.selectedIndex = 0\n    \n    \/*\n     Calling the restoration handler is optional and is only needed\n     when specific objects are capable of continuing the activity.\n     *\/\n    restorationHandler(navigationController.viewControllers)\n    \n    return true\n}\n```\n\n\n\nThe sample app validates the user activity, consumes any necessary information from the `userInfo` dictionary, and updates its UI to continue the requested activity from where the user left off.\n\n```swift\noverride func restoreUserActivityState(_ activity: NSUserActivity) {\n    super.restoreUserActivityState(activity)\n    \n    do {\n        guard let userInfo = activity.userInfo,\n            let url = activity.webpageURL,\n            let phoneNumber = userInfo[\"phoneNumber\"] as? String,\n            let placemarkData = userInfo[\"placemark\"] as? Data,\n            let placemark = try NSKeyedUnarchiver.unarchivedObject(ofClass: MKPlacemark.self, from: placemarkData)\n            else { return }\n        \n        let mapItem = MKMapItem(placemark: placemark)\n        mapItem.name = activity.title\n        \n        if navigationController?.visibleViewController == self {\n            restoreMapItem(mapItem, url: url, phoneNumber: phoneNumber)\n        } else if let modalController = navigationController?.visibleViewController as? LocationViewController {\n            modalController.restoreMapItem(mapItem, url: url, phoneNumber: phoneNumber)\n        }\n    } catch {\n        os_log(\"Could not convert user activity placemark data to placemark object\", type: .error)\n    }\n}\n```\n\n\n\n### Verify QuickType Keyboard Integration\n\nText fields describe the intended purpose of input data, like a region’s name or postal code, via the [doc:\/\/com.apple.uikit\/documentation\/UIKit\/UITextInputTraits\/textContentType] property. If any app on the device recently donated information matching the expected text content type, that information is suggested in the QuickType keyboard as the user types in the text field.\n\nFor example, in the sample app, a user selects a pizza restaurant, and its address is suggested in Messages or a search field in Apple Maps.\n\n```swift\n\/\/ These properties can also be set on the field in Interface Builder.\nnameTextField.textContentType = .organizationName\nstreetAddressLine1TextField.textContentType = .streetAddressLine1\nstreetAddressLine2TextField.textContentType = .streetAddressLine2\ncityTextField.textContentType = .addressCity\nstateTextField.textContentType = .addressState\npostalCodeTextField.textContentType = .postalCode\ncountryOrRegionTextField.textContentType = .countryName\n```\n\nTo verify this behavior, select a point of interest in Apple Maps, then return to this sample app to see the donated information populated in the QuickType keyboard.\n\n\n\n## Activity Sharing\n\n- **Implementing Handoff in Your App**: Create, send, and receive user activities directly.\n- **NSUserActivity**: A representation of the state of your app at a moment in time.\n- **NSUserActivityDelegate**: The interface through which a user activity instance notifies its delegate of updates.\n- **Continuing User Activities with Handoff**: Define and manage which of your app’s activities can be continued between devices.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Create, send, and receive user activities directly.",
          "name" : "Implementing Handoff in Your App",
          "url" : "https:\/\/developer.apple.com\/documentation\/Foundation\/implementing-handoff-in-your-app"
        },
        {
          "description" : "A representation of the state of your app at a moment in time.",
          "name" : "NSUserActivity",
          "url" : "https:\/\/developer.apple.com\/documentation\/foundation\/nsuseractivity"
        },
        {
          "description" : "The interface through which a user activity instance notifies its delegate of updates.",
          "name" : "NSUserActivityDelegate",
          "url" : "https:\/\/developer.apple.com\/documentation\/foundation\/nsuseractivitydelegate"
        },
        {
          "description" : "Define and manage which of your app’s activities can be continued between devices.",
          "name" : "Continuing User Activities with Handoff",
          "url" : "https:\/\/developer.apple.com\/documentation\/foundation\/task_management\/continuing_user_activities_with_handoff"
        }
      ],
      "title" : "Activity Sharing"
    }
  ],
  "source" : "appleJSON",
  "title" : "Increasing App Usage with Suggestions Based on User Activities",
  "url" : "https:\/\/developer.apple.com\/documentation\/foundation\/task_management\/increasing_app_usage_with_suggestions_based_on_user_activities"
}