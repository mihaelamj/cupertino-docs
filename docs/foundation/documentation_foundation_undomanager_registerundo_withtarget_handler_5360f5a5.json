{
  "abstract" : "Registers the specified closure to implement a single undo operation that the target receives.",
  "codeExamples" : [
    {
      "code" : "var manager = UndoManager()\nvar bouquetSelection: NSMutableArray = [\"lilac\", \"lavender\"]\nfunc pull(flower: String) {\n    bouquetSelection.remove(flower)\n    manager.registerUndo(withTarget: bouquetSelection) { $0.add(flower) }\n}\npull(flower: \"lilac\")\n\/\/ bouquetSelection == [\"lavender\"]\nmanager.undo()\n\/\/ bouquetSelection == [\"lavender\", \"lilac\"]",
      "language" : "swift"
    }
  ],
  "contentHash" : "285f326b523436ee99bd9a255bce8d7657b037a5dd269f1644cd324ad259c24f",
  "crawledAt" : "2025-12-05T22:30:00Z",
  "declaration" : {
    "code" : "@MainActor @preconcurrency func registerUndo<TargetType>(withTarget target: TargetType, handler: @escaping @MainActor (TargetType) -> Void) where TargetType : AnyObject",
    "language" : "swift"
  },
  "id" : "7080ED25-62CC-4171-B530-9406345CFEF2",
  "kind" : "method",
  "language" : "swift",
  "module" : "Foundation",
  "overview" : "## Discussion\n\nUse [doc:\/\/com.apple.foundation\/documentation\/Foundation\/UndoManager\/registerUndo(withTarget:handler:)] to register a closure as an undo operation on the undo stack. The registered closure is then executed when `undo` is called and the undo operation occurs. The target needs to be a reference type so that its state can be undone or redone by the undo manager.\n\nThe following example demonstrates how you can use this method to register an undo operation that adds an element back into a mutable array.\n\nTo avoid retain cycles with the target, operate on the closure parameter rather than on variables in an outer scope that reference the same target. For example, in the code listing above, the closure operates on the `$0` parameter rather than directly on `bouquetSelection`.",
  "platforms" : [
    "iOS",
    "iPadOS",
    "Mac Catalyst",
    "macOS",
    "tvOS",
    "visionOS",
    "watchOS"
  ],
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/Foundation\/UndoManager\/registerUndo(withTarget:handler:)\ncrawled: 2025-12-05T22:30:00Z\n---\n\n# registerUndo(withTarget:handler:)\n\n**Instance Method**\n\nRegisters the specified closure to implement a single undo operation that the target receives.\n\n## Declaration\n\n```swift\n@MainActor @preconcurrency func registerUndo<TargetType>(withTarget target: TargetType, handler: @escaping @MainActor (TargetType) -> Void) where TargetType : AnyObject\n```\n\n## Parameters\n\n- **target**: The target of the undo operation.\n\nThe undo manager maintains an unowned reference to the `target` to prevent retain cycles.\n- **handler**: A closure to execute when an operation is undone.\n\nThe closure takes a single argument, the target of the undo operation.\n\n## Discussion\n\nUse [doc:\/\/com.apple.foundation\/documentation\/Foundation\/UndoManager\/registerUndo(withTarget:handler:)] to register a closure as an undo operation on the undo stack. The registered closure is then executed when `undo` is called and the undo operation occurs. The target needs to be a reference type so that its state can be undone or redone by the undo manager.\n\nThe following example demonstrates how you can use this method to register an undo operation that adds an element back into a mutable array.\n\n```swift\nvar manager = UndoManager()\nvar bouquetSelection: NSMutableArray = [\"lilac\", \"lavender\"]\nfunc pull(flower: String) {\n    bouquetSelection.remove(flower)\n    manager.registerUndo(withTarget: bouquetSelection) { $0.add(flower) }\n}\npull(flower: \"lilac\")\n\/\/ bouquetSelection == [\"lavender\"]\nmanager.undo()\n\/\/ bouquetSelection == [\"lavender\", \"lilac\"]\n```\n\nTo avoid retain cycles with the target, operate on the closure parameter rather than on variables in an outer scope that reference the same target. For example, in the code listing above, the closure operates on the `$0` parameter rather than directly on `bouquetSelection`.\n\n## Related Documentation\n\n- **Introduction to Undo Architecture**\n\n## Registering undo operations\n\n- **registerUndo(withTarget:selector:object:)**: Registers the selector of the specified target to implement a single undo operation that the target receives.\n- **prepare(withInvocationTarget:)**: Prepares the undo manager for invocation-based undo with the given target as the subject of the next undo operation.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "name" : "Introduction to Undo Architecture"
        }
      ],
      "title" : "Related Documentation"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "Registers the selector of the specified target to implement a single undo operation that the target receives.",
          "name" : "registerUndo(withTarget:selector:object:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Foundation\/UndoManager\/registerUndo(withTarget:selector:object:)"
        },
        {
          "description" : "Prepares the undo manager for invocation-based undo with the given target as the subject of the next undo operation.",
          "name" : "prepare(withInvocationTarget:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Foundation\/UndoManager\/prepare(withInvocationTarget:)"
        }
      ],
      "title" : "Registering undo operations"
    }
  ],
  "source" : "appleJSON",
  "title" : "registerUndo(withTarget:handler:)",
  "url" : "https:\/\/developer.apple.com\/documentation\/Foundation\/UndoManager\/registerUndo(withTarget:handler:)"
}