{
  "abstract" : "Use high-level APIs to get the most out of Apple File System.",
  "codeExamples" : [
    {
      "code" : "let origin = URL(fileURLWithPath: \"\/path\/to\/origin\")\nlet destination = URL(fileURLWithPath: \"\/path\/to\/destination\")\ndo {\n    \/\/ Creates a clone for Apple File System volumes, or makes\n    \/\/ a copy immediately for other file systems.\n    try FileManager.default.copyItem(at: origin, to: destination)\n} catch {\n    \/\/ ... Handle the error ...\n}",
      "language" : "swift"
    },
    {
      "code" : "if let attributes = try? FileManager.default.attributesOfFileSystem(forPath: \"\/\") {\n    let availableFreeSpace = attributes[.systemFreeSize] \n}",
      "language" : "swift"
    }
  ],
  "contentHash" : "6c2baa3d0d3fe5da59bbacc3c101010d73edbcf18f454597c59a8fd633625402",
  "crawledAt" : "2025-12-04T16:24:15Z",
  "id" : "F21EE07A-E704-4BDB-9AEC-20DF2C852757",
  "kind" : "article",
  "language" : "swift",
  "module" : "Foundation",
  "overview" : "## Overview\n\nApple File System replaces HFS Plus as the default file system for iOS 10.3 and later, and for macOS High Sierra and later. Apple File System offers improved file system fundamentals as well as several new features, including cloning, snapshots, space sharing, fast directory sizing, atomic safe-save, and sparse files.\n\nUsing high-level APIs in Foundation, such as [doc:\/\/com.apple.foundation\/documentation\/Foundation\/FileManager] and [doc:\/\/com.apple.foundation\/documentation\/Foundation\/FileHandle], to interact with files takes advantage of the new behavior provided by Apple File System automatically, without requiring changes your code.\n\nIf you need to interact with the file system directly, without using any frameworks or the operating system, read [https:\/\/developer.apple.com\/go\/?id=apfs-file-format-spec].\n\n### Clones Reduce the Cost of Copying\n\nA clone is a copy of a file or directory that occupies no additional space on disk. Clones let you make fast, power-efficient file copies on the same volume. The [doc:\/\/com.apple.foundation\/documentation\/Foundation\/FileManager\/copyItem(at:to:)] and [doc:\/\/com.apple.foundation\/documentation\/Foundation\/FileManager\/copyItem(atPath:toPath:)] methods of [doc:\/\/com.apple.foundation\/documentation\/Foundation\/FileManager] automatically create a clone for Apple File System volumes, as shown in the listing below.\n\nModifications to the data are written elsewhere, and both files continue to share the unmodified blocks. You can use this behavior, for example, to reduce storage space required for document revisions and copies. The figure below shows a file named “My file” and its copy “My file copy” that have two blocks in common and one block that varies between them. On file systems like HFS Plus, they’d each need three on-disk blocks, but on an Apple File System volume, the two common blocks are shared.\n\n\n\n### Free Space Is Shared Between Volumes\n\nMany files systems, including HFS Plus, support only a single volume per partition. Because free space can’t be shared across partitions, each volume’s size is set when partitioning the storage device, and each volume can only grow into its available free space. In contrast, Apple File System supports multiple volumes within a single partition, which allows all of those volumes to share their free space. All of the volumes in an Apple File System partition can grow and shrink independently; space that’s freed when one volume shrinks can be used when another volume grows.\n\n\n\nEach volume in the container can use the shared free space, so they all include that amount when reporting the available free space. For example, when you call [doc:\/\/com.apple.foundation\/documentation\/Foundation\/FileManager\/attributesOfFileSystem(forPath:)] method of [doc:\/\/com.apple.foundation\/documentation\/Foundation\/FileManager], the amount that’s reported includes all of the shared free space.\n\nComputing the sum of each volume’s available free space isn’t a reliable way to determine the total free space within a partition. In general, check whether the space required to perform a particular operation is available on the volume, rather than trying to calculate the partition’s total free space.\n\n### Sparse Files Don’t Allocate Empty Blocks\n\nIn file systems that support sparse files, including Apple File System, on-disk blocks are allocated only when those blocks are actually written to. This behavior lets files that contain blank sections, such as disk images and database dumps, be saved on disk more efficiently.\n\nWhen you use the [doc:\/\/com.apple.foundation\/documentation\/Foundation\/FileHandle] class to create a new write handle, a sparse file is created automatically. For example, if you write a block of data, then seek one block by calling [doc:\/\/com.apple.foundation\/documentation\/Foundation\/FileHandle\/seek(toFileOffset:)], and then write another block, the data stored on disk is organized as follows:\n\n\n\nHFS Plus and other formats that don’t support sparse files allocate three blocks for the file, one for each block that was written, and one empty block in the middle. With support for sparse files, only two blocks are allocated, and the empty block is omitted.\n\nBecause the sparse file in the Apple File system example above doesn’t contain a blank second block on disk, writing to the second block later results in blocks that are out of order, as shown in the figure below. High-level APIs like [doc:\/\/com.apple.foundation\/documentation\/Foundation\/FileHandle] handle this fragmentation for you, and the performance loss due to fragmentation isn’t usually significant.\n\n\n\nYou can’t use [doc:\/\/com.apple.foundation\/documentation\/Foundation\/FileHandle] to create a sparse file from an existing file that has blank data already stored on disk.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/Foundation\/about-apple-file-system\ncrawled: 2025-12-04T16:24:15Z\n---\n\n# About Apple File System\n\n**Article**\n\nUse high-level APIs to get the most out of Apple File System.\n\n## Overview\n\nApple File System replaces HFS Plus as the default file system for iOS 10.3 and later, and for macOS High Sierra and later. Apple File System offers improved file system fundamentals as well as several new features, including cloning, snapshots, space sharing, fast directory sizing, atomic safe-save, and sparse files.\n\nUsing high-level APIs in Foundation, such as [doc:\/\/com.apple.foundation\/documentation\/Foundation\/FileManager] and [doc:\/\/com.apple.foundation\/documentation\/Foundation\/FileHandle], to interact with files takes advantage of the new behavior provided by Apple File System automatically, without requiring changes your code.\n\nIf you need to interact with the file system directly, without using any frameworks or the operating system, read [https:\/\/developer.apple.com\/go\/?id=apfs-file-format-spec].\n\n### Clones Reduce the Cost of Copying\n\nA clone is a copy of a file or directory that occupies no additional space on disk. Clones let you make fast, power-efficient file copies on the same volume. The [doc:\/\/com.apple.foundation\/documentation\/Foundation\/FileManager\/copyItem(at:to:)] and [doc:\/\/com.apple.foundation\/documentation\/Foundation\/FileManager\/copyItem(atPath:toPath:)] methods of [doc:\/\/com.apple.foundation\/documentation\/Foundation\/FileManager] automatically create a clone for Apple File System volumes, as shown in the listing below.\n\n```swift\nlet origin = URL(fileURLWithPath: \"\/path\/to\/origin\")\nlet destination = URL(fileURLWithPath: \"\/path\/to\/destination\")\ndo {\n    \/\/ Creates a clone for Apple File System volumes, or makes\n    \/\/ a copy immediately for other file systems.\n    try FileManager.default.copyItem(at: origin, to: destination)\n} catch {\n    \/\/ ... Handle the error ...\n}\n```\n\nModifications to the data are written elsewhere, and both files continue to share the unmodified blocks. You can use this behavior, for example, to reduce storage space required for document revisions and copies. The figure below shows a file named “My file” and its copy “My file copy” that have two blocks in common and one block that varies between them. On file systems like HFS Plus, they’d each need three on-disk blocks, but on an Apple File System volume, the two common blocks are shared.\n\n\n\n### Free Space Is Shared Between Volumes\n\nMany files systems, including HFS Plus, support only a single volume per partition. Because free space can’t be shared across partitions, each volume’s size is set when partitioning the storage device, and each volume can only grow into its available free space. In contrast, Apple File System supports multiple volumes within a single partition, which allows all of those volumes to share their free space. All of the volumes in an Apple File System partition can grow and shrink independently; space that’s freed when one volume shrinks can be used when another volume grows.\n\n\n\nEach volume in the container can use the shared free space, so they all include that amount when reporting the available free space. For example, when you call [doc:\/\/com.apple.foundation\/documentation\/Foundation\/FileManager\/attributesOfFileSystem(forPath:)] method of [doc:\/\/com.apple.foundation\/documentation\/Foundation\/FileManager], the amount that’s reported includes all of the shared free space.\n\n```swift\nif let attributes = try? FileManager.default.attributesOfFileSystem(forPath: \"\/\") {\n    let availableFreeSpace = attributes[.systemFreeSize] \n}\n```\n\nComputing the sum of each volume’s available free space isn’t a reliable way to determine the total free space within a partition. In general, check whether the space required to perform a particular operation is available on the volume, rather than trying to calculate the partition’s total free space.\n\n### Sparse Files Don’t Allocate Empty Blocks\n\nIn file systems that support sparse files, including Apple File System, on-disk blocks are allocated only when those blocks are actually written to. This behavior lets files that contain blank sections, such as disk images and database dumps, be saved on disk more efficiently.\n\nWhen you use the [doc:\/\/com.apple.foundation\/documentation\/Foundation\/FileHandle] class to create a new write handle, a sparse file is created automatically. For example, if you write a block of data, then seek one block by calling [doc:\/\/com.apple.foundation\/documentation\/Foundation\/FileHandle\/seek(toFileOffset:)], and then write another block, the data stored on disk is organized as follows:\n\n\n\nHFS Plus and other formats that don’t support sparse files allocate three blocks for the file, one for each block that was written, and one empty block in the middle. With support for sparse files, only two blocks are allocated, and the empty block is omitted.\n\nBecause the sparse file in the Apple File system example above doesn’t contain a blank second block on disk, writing to the second block later results in blocks that are out of order, as shown in the figure below. High-level APIs like [doc:\/\/com.apple.foundation\/documentation\/Foundation\/FileHandle] handle this fragmentation for you, and the performance loss due to fragmentation isn’t usually significant.\n\n\n\nYou can’t use [doc:\/\/com.apple.foundation\/documentation\/Foundation\/FileHandle] to create a sparse file from an existing file that has blank data already stored on disk.\n\n## File system operations\n\n- **Improving performance and stability when accessing the file system**: Prevent data loss and app crashes by interacting with the file system in a coordinated, asynchronous manner and by avoiding unnecessary disk I\/O.\n- **Using the file system effectively**: Gain access to benefits like automatic backup or purging by using purpose-built directories provided by the system.\n- **FileManager**: A convenient interface to the contents of the file system, and the primary means of interacting with it.\n- **FileManagerDelegate**: The interface a file manager’s delegate uses to intervene during operations or if an error occurs.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Prevent data loss and app crashes by interacting with the file system in a coordinated, asynchronous manner and by avoiding unnecessary disk I\/O.",
          "name" : "Improving performance and stability when accessing the file system",
          "url" : "https:\/\/developer.apple.com\/documentation\/Foundation\/improving-performance-and-stability-when-accessing-the-file-system"
        },
        {
          "description" : "Gain access to benefits like automatic backup or purging by using purpose-built directories provided by the system.",
          "name" : "Using the file system effectively",
          "url" : "https:\/\/developer.apple.com\/documentation\/Foundation\/using-the-file-system-effectively"
        },
        {
          "description" : "A convenient interface to the contents of the file system, and the primary means of interacting with it.",
          "name" : "FileManager",
          "url" : "https:\/\/developer.apple.com\/documentation\/Foundation\/FileManager"
        },
        {
          "description" : "The interface a file manager’s delegate uses to intervene during operations or if an error occurs.",
          "name" : "FileManagerDelegate",
          "url" : "https:\/\/developer.apple.com\/documentation\/Foundation\/FileManagerDelegate"
        }
      ],
      "title" : "File system operations"
    }
  ],
  "source" : "appleJSON",
  "title" : "About Apple File System",
  "url" : "https:\/\/developer.apple.com\/documentation\/Foundation\/about-apple-file-system"
}