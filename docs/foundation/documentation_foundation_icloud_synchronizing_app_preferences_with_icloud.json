{
  "abstract" : "Store app preferences in iCloud and share them among instances of your app running on a user’s connected devices.",
  "codeExamples" : [
    {
      "code" : "NotificationCenter.default.addObserver(self,\n    selector: #selector(ubiquitousKeyValueStoreDidChange(_:)),\n    name: NSUbiquitousKeyValueStore.didChangeExternallyNotification,\n    object: NSUbiquitousKeyValueStore.default)",
      "language" : "swift"
    },
    {
      "code" : "guard let userInfo = notification.userInfo else { return }\n      \n\/\/ Get the reason for the notification (initial download, external change or quota violation change).\nguard let reasonForChange = userInfo[NSUbiquitousKeyValueStoreChangeReasonKey] as? Int else { return }",
      "language" : "swift"
    },
    {
      "code" : "guard let keys =\n          userInfo[NSUbiquitousKeyValueStoreChangedKeysKey] as? [String] else { return }",
      "language" : "swift"
    },
    {
      "code" : "let possibleColorIndexFromiCloud =\n          NSUbiquitousKeyValueStore.default.longLong(forKey: gBackgroundColorKey)",
      "language" : "swift"
    }
  ],
  "contentHash" : "a8b0ed518686ce40c70a3c210657aa42bd67f0ee969292d362573b84f9e74968",
  "crawledAt" : "2025-12-02T15:28:21Z",
  "id" : "472FE17E-F68E-4FB0-AF58-28AD6E242C4A",
  "kind" : "unknown",
  "language" : "swift",
  "module" : "Foundation",
  "overview" : "## Overview\n\nThis sample demonstrates how to store preference, configuration, and app-state data in the iCloud key-value store using the [doc:\/\/com.apple.foundation\/documentation\/Foundation\/NSUbiquitousKeyValueStore] class. You can then share this data with every instance of your app on every device connected to a userʼs iCloud account.\n\nIn this sample the user picks a background color. App instances running on other devices that are logged in with the same iCloud account are then notified of the color to match.\n\nThe key-value store is not a replacement for [doc:\/\/com.apple.foundation\/documentation\/Foundation\/UserDefaults] or other local techniques for saving the same data. The key-value store’s purpose is to synchronize key-value data between app instances running on different devices of the same user. If iCloud is not enabled or is not available on a given device, the app still keeps a local copy of the data in `NSUserDefaults`.\n\n### Configure the Sample Code Project\n\nTo configure your Xcode project first you need change the Bundle Identifiers for both macOS and iOS targets to match your own. Next, to work with iCloud and `NSUbiquitousKeyValueStore`, you need set up an iCloud key-value store ID for both targets. This sample already has the both targets’ iCloud capabilities set up, with the `PrefsInCloud.entitlements` file already created. You need to fill in your own key-value store IDs in those entitlement files to complete the configurations.\n\nFor each target (iOS and macOS):\n\nIn addition to configuring the project, you need to configure the devices in which the project runs.\n\nTo configure the iOS and macOS devices, verify that iCloud Drive is turned on. Then log into both devices with the same iCloud account.\n\nBuild and run the app to install it on both devices, and then do the following:\n\nThe desired color represents a value (numbered 0 to 3) which is uploaded to iCloud. App instances running on the other devices logged into the same iCloud account are notified to match that specific background color.\n\n### Register to Respond to Key-Value Store Changes\n\nThe sample uses [doc:\/\/com.apple.foundation\/documentation\/Foundation\/NotificationCenter] to register as an observer to the notification [doc:\/\/com.apple.foundation\/documentation\/Foundation\/NSUbiquitousKeyValueStore\/didChangeExternallyNotification]. The following example installs the app as the observer to respond to the key-value store changes:\n\nImmediately following the call to `addObserver`, obtain the key-value store changes since last launch by calling `synchronize()`. The operating system controls when keys and values are uploaded to iCloud. Calling `synchronize()` simply stores a local cache of them and notifies iCloud of new data waiting to be uploaded.\n\n### Respond to Key-Value Store Changes\n\nThe sample uses `NSNotificationCenter` to register as an observer to the notification [doc:\/\/com.apple.foundation\/documentation\/Foundation\/NSUbiquitousKeyValueStore\/didChangeExternallyNotification] to detect for value changes in iCloud.\n\nThe sample implements the function `ubiquitousKeyValueStoreDidChange` for listening for key-value notification changes. This function is called when the key-value store in the cloud has changed externally. It replaces the old key-value color with the new one. Additionally, this function updates the `NSUserDefaults` key-value.\n\nThis sample examines the reason for the change through the use the [doc:\/\/com.apple.foundation\/documentation\/Foundation\/NSUbiquitousKeyValueStoreChangeReasonKey] from the notification’s `userInfo`.\n\nThe reason for the key-value notification change is one of the following:\n\nTo obtain key-values that have changed, use the key [doc:\/\/com.apple.foundation\/documentation\/Foundation\/NSUbiquitousKeyValueStoreChangedKeysKey] from the notification’s  `userInfo`.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/foundation\/icloud\/synchronizing_app_preferences_with_icloud\ncrawled: 2025-12-02T15:28:21Z\n---\n\n# Synchronizing App Preferences with iCloud\n\n**Sample Code**\n\nStore app preferences in iCloud and share them among instances of your app running on a user’s connected devices.\n\n## Overview\n\nThis sample demonstrates how to store preference, configuration, and app-state data in the iCloud key-value store using the [doc:\/\/com.apple.foundation\/documentation\/Foundation\/NSUbiquitousKeyValueStore] class. You can then share this data with every instance of your app on every device connected to a userʼs iCloud account.\n\nIn this sample the user picks a background color. App instances running on other devices that are logged in with the same iCloud account are then notified of the color to match.\n\n\n\nThe key-value store is not a replacement for [doc:\/\/com.apple.foundation\/documentation\/Foundation\/UserDefaults] or other local techniques for saving the same data. The key-value store’s purpose is to synchronize key-value data between app instances running on different devices of the same user. If iCloud is not enabled or is not available on a given device, the app still keeps a local copy of the data in `NSUserDefaults`.\n\n### Configure the Sample Code Project\n\nTo configure your Xcode project first you need change the Bundle Identifiers for both macOS and iOS targets to match your own. Next, to work with iCloud and `NSUbiquitousKeyValueStore`, you need set up an iCloud key-value store ID for both targets. This sample already has the both targets’ iCloud capabilities set up, with the `PrefsInCloud.entitlements` file already created. You need to fill in your own key-value store IDs in those entitlement files to complete the configurations.\n\nFor each target (iOS and macOS):\n\n1. In the Xcode project, open the target’s `PrefsInCloud.entitlements` file.\n2. In that file, go to `com.apple.developer.ubiquity-kvstore-identifier` entitlement and replace `$(CFBundleIdenfier)` with your key-value store ID (i.e. `$(TeamIdentifierPrefix)<your key-value_store ID>`). For example if your key-value store ID is “com.mycompany.myKeyValueStoreID” it would look like this: `$(TeamIdentifierPrefix)com.mycompany.myKeyValueStoreID`. It’s important that the key-value store ID portions are the same between both targets.\n\nIn addition to configuring the project, you need to configure the devices in which the project runs.\n\nTo configure the iOS and macOS devices, verify that iCloud Drive is turned on. Then log into both devices with the same iCloud account.\n\nBuild and run the app to install it on both devices, and then do the following:\n\n- iOS: Tap the action button at the top right to pick the desired background color.\n- macOS: Choose the desired background color from window’s popup menu.\n\nThe desired color represents a value (numbered 0 to 3) which is uploaded to iCloud. App instances running on the other devices logged into the same iCloud account are notified to match that specific background color.\n\n\n\n### Register to Respond to Key-Value Store Changes\n\nThe sample uses [doc:\/\/com.apple.foundation\/documentation\/Foundation\/NotificationCenter] to register as an observer to the notification [doc:\/\/com.apple.foundation\/documentation\/Foundation\/NSUbiquitousKeyValueStore\/didChangeExternallyNotification]. The following example installs the app as the observer to respond to the key-value store changes:\n\n```swift\nNotificationCenter.default.addObserver(self,\n    selector: #selector(ubiquitousKeyValueStoreDidChange(_:)),\n    name: NSUbiquitousKeyValueStore.didChangeExternallyNotification,\n    object: NSUbiquitousKeyValueStore.default)\n```\n\nImmediately following the call to `addObserver`, obtain the key-value store changes since last launch by calling `synchronize()`. The operating system controls when keys and values are uploaded to iCloud. Calling `synchronize()` simply stores a local cache of them and notifies iCloud of new data waiting to be uploaded.\n\n### Respond to Key-Value Store Changes\n\nThe sample uses `NSNotificationCenter` to register as an observer to the notification [doc:\/\/com.apple.foundation\/documentation\/Foundation\/NSUbiquitousKeyValueStore\/didChangeExternallyNotification] to detect for value changes in iCloud.\n\nThe sample implements the function `ubiquitousKeyValueStoreDidChange` for listening for key-value notification changes. This function is called when the key-value store in the cloud has changed externally. It replaces the old key-value color with the new one. Additionally, this function updates the `NSUserDefaults` key-value.\n\nThis sample examines the reason for the change through the use the [doc:\/\/com.apple.foundation\/documentation\/Foundation\/NSUbiquitousKeyValueStoreChangeReasonKey] from the notification’s `userInfo`.\n\n```swift\nguard let userInfo = notification.userInfo else { return }\n      \n\/\/ Get the reason for the notification (initial download, external change or quota violation change).\nguard let reasonForChange = userInfo[NSUbiquitousKeyValueStoreChangeReasonKey] as? Int else { return }\n```\n\nThe reason for the key-value notification change is one of the following:\n\n- `NSUbiquitousKeyValueStoreServerChange`: Value(s) were changed externally from other users\/devices.\n- `NSUbiquitousKeyValueStoreInitialSyncChange`: Initial downloads happen the first time a device is connected to an iCloud account, and when a user switches their primary iCloud account.\n- `NSUbiquitousKeyValueStoreQuotaViolationChange`: The app’s key-value store has exceeded its space quota on the iCloud server.\n- `NSUbiquitousKeyValueStoreAccountChange`: The user has changed the primary iCloud account.\n\nTo obtain key-values that have changed, use the key [doc:\/\/com.apple.foundation\/documentation\/Foundation\/NSUbiquitousKeyValueStoreChangedKeysKey] from the notification’s  `userInfo`.\n\n```swift\nguard let keys =\n          userInfo[NSUbiquitousKeyValueStoreChangedKeysKey] as? [String] else { return }\n```\n\n```swift\nlet possibleColorIndexFromiCloud =\n          NSUbiquitousKeyValueStore.default.longLong(forKey: gBackgroundColorKey)\n```\n\n## App Preferences\n\n- **NSUbiquitousKeyValueStore**: An iCloud-based container of key-value pairs you use to share data among instances of your app running on a user’s connected devices.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "An iCloud-based container of key-value pairs you use to share data among instances of your app running on a user’s connected devices.",
          "name" : "NSUbiquitousKeyValueStore",
          "url" : "https:\/\/developer.apple.com\/documentation\/foundation\/nsubiquitouskeyvaluestore"
        }
      ],
      "title" : "App Preferences"
    }
  ],
  "source" : "appleJSON",
  "title" : "Synchronizing App Preferences with iCloud",
  "url" : "https:\/\/developer.apple.com\/documentation\/foundation\/icloud\/synchronizing_app_preferences_with_icloud"
}