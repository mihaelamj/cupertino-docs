{
  "abstract" : "Encrypt a single file and save the result to the file system, then decrypt and recreate the original file from the archive file using Apple Encrypted Archive.",
  "codeExamples" : [
    {
      "code" : "\/\/ The sample defines a `FilePath` structure that represents the path of\n\/\/ the source file. Before running the same, you must have a file in\n\/\/ your temporary directory named `file.txt`.\nlet sourceFilePath = FilePath(NSTemporaryDirectory() + \"file.txt\")\n\n\/\/ The sample writes the encrypted source file to the path defined by\n\/\/ the `encryptedFilePath` file path structure.\nlet encryptedFilePath = FilePath(NSTemporaryDirectory() + \"file.encrypted\")\n\n\/\/ The sample defines a `FilePath` structure that represents the path of\n\/\/ the decrypted recreation of the original file.\nlet decryptedFilePath = FilePath(NSTemporaryDirectory() + \"file.decrypted.txt\")",
      "language" : "swift"
    },
    {
      "code" : "let key = SymmetricKey(size: SymmetricKeySize.bits256)",
      "language" : "swift"
    },
    {
      "code" : "let context = ArchiveEncryptionContext(profile: .hkdf_sha256_aesctr_hmac__symmetric__none,\n                                       compressionAlgorithm: .lzfse)\ntry context.setSymmetricKey(key)",
      "language" : "swift"
    },
    {
      "code" : "guard let sourceFileStream = ArchiveByteStream.fileStream(\n        path: sourceFilePath,\n        mode: .readOnly,\n        options: [ ],\n        permissions: FilePermissions(rawValue: 0o644)),\n      let destinationFileStream = ArchiveByteStream.fileStream(\n        path: destinationFilePath,\n        mode: .writeOnly,\n        options: [ .create, .truncate ],\n        permissions: FilePermissions(rawValue: 0o644)) else {\n    throw Error.unableToCreateFileStream\n}",
      "language" : "swift"
    },
    {
      "code" : "guard let encryptionStream = ArchiveByteStream.encryptionStream(\n        writingTo: destinationFileStream,\n        encryptionContext: context) else {\n    throw Error.unableToCreateEncryptionStream\n}",
      "language" : "swift"
    },
    {
      "code" : "_ = try ArchiveByteStream.process(readingFrom: sourceFileStream,\n                                  writingTo: encryptionStream)",
      "language" : "swift"
    },
    {
      "code" : "guard let sourceFileStream = ArchiveByteStream.fileStream(\n        path: sourceFilePath,\n        mode: .readOnly,\n        options: [ ],\n        permissions: FilePermissions(rawValue: 0o644)) else {\n    throw Error.unableToCreateFileStream\n}",
      "language" : "swift"
    },
    {
      "code" : "guard let decryptionContext = ArchiveEncryptionContext(from: sourceFileStream) else {\n    throw Error.unableToCreateDecryptionContext\n}\n\n\/\/ Set the key on the context.\ntry decryptionContext.setSymmetricKey(key)",
      "language" : "swift"
    },
    {
      "code" : "guard let decryptionStream = ArchiveByteStream.decryptionStream(\n    readingFrom: sourceFileStream,\n    encryptionContext: decryptionContext) else {\n    throw Error.unableToCreateFileStream\n}",
      "language" : "swift"
    },
    {
      "code" : "guard let decryptedFileStream = ArchiveByteStream.fileStream(\n    path: destinationFilePath,\n    mode: .writeOnly,\n    options: [ .create, .truncate ],\n    permissions: FilePermissions(rawValue: 0o644)) else {\n    throw Error.unableToCreateFileStream\n}",
      "language" : "swift"
    },
    {
      "code" : "_ = try ArchiveByteStream.process(readingFrom: decryptionStream,\n                                  writingTo: decryptedFileStream)",
      "language" : "swift"
    }
  ],
  "contentHash" : "cf3f9235e817d777c5d46144b106fe3efec15281eb3443dc5f12ed5510e2bb14",
  "crawledAt" : "2025-12-05T03:34:37Z",
  "id" : "4148BBB2-327E-469A-8694-63B5006F1911",
  "kind" : "unknown",
  "language" : "swift",
  "module" : "Apple Archive",
  "overview" : "## Overview\n\nThis sample code project implements the Apple Encrypted Archive library to compress and encrypt the contents of a single file using a [doc:\/\/com.apple.documentation\/documentation\/CryptoKit\/SymmetricKey]. The sample saves the encrypted file to the user’s temporary directory and then calls a second function that decrypts the contents of the archive and recreates the original file.\n\n### Configure the Sample Code Project\n\nBefore running the sample code project in Xcode, ensure you have a file in your temporary directory (see: [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSTemporaryDirectory()]) named `file.txt`.\n\n### Define File Paths\n\nThe sample code project defines [doc:\/\/com.apple.documentation\/documentation\/System\/FilePath] structures that represent the locations of the source file, the encrypted version of the source file, and the recreated, unencrypted version of the source file.\n\n### Generate a Symmetric Key\n\nThe sample imports the [doc:\/\/com.apple.documentation\/documentation\/CryptoKit] framework to generate the symmetric cryptographic key.\n\nThe sample uses the same key for encryption and decryption.\n\n### Create a Context for Encryption\n\nAn `ArchiveEncryptionContext` object contains the parameters, keys, and other data that the Apple Encrypted Archive library requires to open an encrypted archive for encryption and decryption streams. The sample initializes the context with a profile and compression algorithm, and its symmetric key set for encryption.\n\n### Open Source and Destination File Streams\n\nThe sample creates a [doc:\/\/com.apple.documentation\/documentation\/System\/FileDescriptor\/AccessMode\/readOnly] file stream to read the source file, and a [doc:\/\/com.apple.documentation\/documentation\/System\/FileDescriptor\/AccessMode\/writeOnly] file stream to write the encrypted file to the file system.\n\n### Create the Encryption Stream\n\nThe encryption stream uses the encryption context and the destination file stream to write the encrypted string to the file system.\n\n### Encrypt the File\n\nThe [doc:\/\/com.apple.documentation\/documentation\/AppleArchive\/ArchiveByteStream\/process(readingFrom:writingTo:)] function sends the output of the file-reading stream to the encryption stream. In turn, the compression stream sends its output to the file-writing stream and writes the encrypted file to the file system.\n\n### Open the Source File Stream\n\nThe sample creates a source file stream to open the encrypted file.\n\n### Create a Context for Decryption\n\nThe  `ArchiveEncryptionContext` object for decryption derives its parameters, keys, and other data from the encrypted source file, and the sample sets the decryption context with the same symmetric key that was used for encryption.\n\n### Create the Decryption Stream\n\nThe decryption stream uses the encryption context and the source file stream to read the encrypted string from the file system.\n\n### Open the Destination File Stream\n\nThe destination file stream writes the encrypted file to the file system. In this case, the file stream’s mode is [doc:\/\/com.apple.documentation\/documentation\/System\/FileDescriptor\/AccessMode\/writeOnly].  The options specify that the stream creates the file if it doesn’t exist, and that if the file does exist, it should be truncated to zero bytes before the stream performs any operations.\n\n### Decrypt the Source Archive\n\nThe [doc:\/\/com.apple.applearchive\/documentation\/AppleArchive\/ArchiveByteStream\/process(readingFrom:writingTo:)] method writes the output of the decryption stream to the file-writing stream.\n\nOn return, `file.decrypted.txt` exists in [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSTemporaryDirectory()] and contains the decrypted contents of `file.encrypted`.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/applearchive\/encrypting-and-decrypting-a-single-file\ncrawled: 2025-12-05T03:34:37Z\n---\n\n# Encrypting and Decrypting a Single File\n\n**Sample Code**\n\nEncrypt a single file and save the result to the file system, then decrypt and recreate the original file from the archive file using Apple Encrypted Archive.\n\n## Overview\n\nThis sample code project implements the Apple Encrypted Archive library to compress and encrypt the contents of a single file using a [doc:\/\/com.apple.documentation\/documentation\/CryptoKit\/SymmetricKey]. The sample saves the encrypted file to the user’s temporary directory and then calls a second function that decrypts the contents of the archive and recreates the original file.\n\n### Configure the Sample Code Project\n\nBefore running the sample code project in Xcode, ensure you have a file in your temporary directory (see: [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSTemporaryDirectory()]) named `file.txt`.\n\n### Define File Paths\n\nThe sample code project defines [doc:\/\/com.apple.documentation\/documentation\/System\/FilePath] structures that represent the locations of the source file, the encrypted version of the source file, and the recreated, unencrypted version of the source file.\n\n```swift\n\/\/ The sample defines a `FilePath` structure that represents the path of\n\/\/ the source file. Before running the same, you must have a file in\n\/\/ your temporary directory named `file.txt`.\nlet sourceFilePath = FilePath(NSTemporaryDirectory() + \"file.txt\")\n\n\/\/ The sample writes the encrypted source file to the path defined by\n\/\/ the `encryptedFilePath` file path structure.\nlet encryptedFilePath = FilePath(NSTemporaryDirectory() + \"file.encrypted\")\n\n\/\/ The sample defines a `FilePath` structure that represents the path of\n\/\/ the decrypted recreation of the original file.\nlet decryptedFilePath = FilePath(NSTemporaryDirectory() + \"file.decrypted.txt\")\n```\n\n### Generate a Symmetric Key\n\nThe sample imports the [doc:\/\/com.apple.documentation\/documentation\/CryptoKit] framework to generate the symmetric cryptographic key.\n\n```swift\nlet key = SymmetricKey(size: SymmetricKeySize.bits256)\n```\n\nThe sample uses the same key for encryption and decryption.\n\n### Create a Context for Encryption\n\nAn `ArchiveEncryptionContext` object contains the parameters, keys, and other data that the Apple Encrypted Archive library requires to open an encrypted archive for encryption and decryption streams. The sample initializes the context with a profile and compression algorithm, and its symmetric key set for encryption.\n\n```swift\nlet context = ArchiveEncryptionContext(profile: .hkdf_sha256_aesctr_hmac__symmetric__none,\n                                       compressionAlgorithm: .lzfse)\ntry context.setSymmetricKey(key)\n```\n\n### Open Source and Destination File Streams\n\nThe sample creates a [doc:\/\/com.apple.documentation\/documentation\/System\/FileDescriptor\/AccessMode\/readOnly] file stream to read the source file, and a [doc:\/\/com.apple.documentation\/documentation\/System\/FileDescriptor\/AccessMode\/writeOnly] file stream to write the encrypted file to the file system.\n\n```swift\nguard let sourceFileStream = ArchiveByteStream.fileStream(\n        path: sourceFilePath,\n        mode: .readOnly,\n        options: [ ],\n        permissions: FilePermissions(rawValue: 0o644)),\n      let destinationFileStream = ArchiveByteStream.fileStream(\n        path: destinationFilePath,\n        mode: .writeOnly,\n        options: [ .create, .truncate ],\n        permissions: FilePermissions(rawValue: 0o644)) else {\n    throw Error.unableToCreateFileStream\n}\n```\n\n### Create the Encryption Stream\n\nThe encryption stream uses the encryption context and the destination file stream to write the encrypted string to the file system.\n\n```swift\nguard let encryptionStream = ArchiveByteStream.encryptionStream(\n        writingTo: destinationFileStream,\n        encryptionContext: context) else {\n    throw Error.unableToCreateEncryptionStream\n}\n```\n\n### Encrypt the File\n\nThe [doc:\/\/com.apple.documentation\/documentation\/AppleArchive\/ArchiveByteStream\/process(readingFrom:writingTo:)] function sends the output of the file-reading stream to the encryption stream. In turn, the compression stream sends its output to the file-writing stream and writes the encrypted file to the file system.\n\n```swift\n_ = try ArchiveByteStream.process(readingFrom: sourceFileStream,\n                                  writingTo: encryptionStream)\n```\n\n### Open the Source File Stream\n\nThe sample creates a source file stream to open the encrypted file.\n\n```swift\nguard let sourceFileStream = ArchiveByteStream.fileStream(\n        path: sourceFilePath,\n        mode: .readOnly,\n        options: [ ],\n        permissions: FilePermissions(rawValue: 0o644)) else {\n    throw Error.unableToCreateFileStream\n}\n```\n\n### Create a Context for Decryption\n\nThe  `ArchiveEncryptionContext` object for decryption derives its parameters, keys, and other data from the encrypted source file, and the sample sets the decryption context with the same symmetric key that was used for encryption.\n\n```swift\nguard let decryptionContext = ArchiveEncryptionContext(from: sourceFileStream) else {\n    throw Error.unableToCreateDecryptionContext\n}\n\n\/\/ Set the key on the context.\ntry decryptionContext.setSymmetricKey(key)\n```\n\n### Create the Decryption Stream\n\nThe decryption stream uses the encryption context and the source file stream to read the encrypted string from the file system.\n\n```swift\nguard let decryptionStream = ArchiveByteStream.decryptionStream(\n    readingFrom: sourceFileStream,\n    encryptionContext: decryptionContext) else {\n    throw Error.unableToCreateFileStream\n}\n```\n\n### Open the Destination File Stream\n\nThe destination file stream writes the encrypted file to the file system. In this case, the file stream’s mode is [doc:\/\/com.apple.documentation\/documentation\/System\/FileDescriptor\/AccessMode\/writeOnly].  The options specify that the stream creates the file if it doesn’t exist, and that if the file does exist, it should be truncated to zero bytes before the stream performs any operations.\n\n```swift\nguard let decryptedFileStream = ArchiveByteStream.fileStream(\n    path: destinationFilePath,\n    mode: .writeOnly,\n    options: [ .create, .truncate ],\n    permissions: FilePermissions(rawValue: 0o644)) else {\n    throw Error.unableToCreateFileStream\n}\n```\n\n### Decrypt the Source Archive\n\nThe [doc:\/\/com.apple.applearchive\/documentation\/AppleArchive\/ArchiveByteStream\/process(readingFrom:writingTo:)] method writes the output of the decryption stream to the file-writing stream.\n\n```swift\n_ = try ArchiveByteStream.process(readingFrom: decryptionStream,\n                                  writingTo: decryptedFileStream)\n```\n\nOn return, `file.decrypted.txt` exists in [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSTemporaryDirectory()] and contains the decrypted contents of `file.encrypted`.\n\n## Apple Encrypted Archive essentials\n\n- **Encrypting and Decrypting a String**: Encrypt the contents of a string and save the result to the file system, then decrypt and recreate the string from the archive file using Apple Encrypted Archive.\n- **Encrypting and Decrypting Directories**: Compress and encrypt the contents of an entire directory or decompress and decrypt an archived directory  using Apple Encrypted Archive.\n- **ArchiveEncryptionContext**: An object that encapsulates all parameters, keys, and data necessary to open an encrypted archive for both encryption and decryption streams.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Encrypt the contents of a string and save the result to the file system, then decrypt and recreate the string from the archive file using Apple Encrypted Archive.",
          "name" : "Encrypting and Decrypting a String",
          "url" : "https:\/\/developer.apple.com\/documentation\/AppleArchive\/encrypting-and-decrypting-a-string"
        },
        {
          "description" : "Compress and encrypt the contents of an entire directory or decompress and decrypt an archived directory  using Apple Encrypted Archive.",
          "name" : "Encrypting and Decrypting Directories",
          "url" : "https:\/\/developer.apple.com\/documentation\/AppleArchive\/encrypting-and-decrypting-directories"
        },
        {
          "description" : "An object that encapsulates all parameters, keys, and data necessary to open an encrypted archive for both encryption and decryption streams.",
          "name" : "ArchiveEncryptionContext",
          "url" : "https:\/\/developer.apple.com\/documentation\/AppleArchive\/ArchiveEncryptionContext"
        }
      ],
      "title" : "Apple Encrypted Archive essentials"
    }
  ],
  "source" : "appleJSON",
  "title" : "Encrypting and Decrypting a Single File",
  "url" : "https:\/\/developer.apple.com\/documentation\/applearchive\/encrypting-and-decrypting-a-single-file"
}