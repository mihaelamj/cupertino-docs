{
  "abstract" : "Fetches the thumbnails for items that have been enumerated by the file provider.",
  "codeExamples" : [
    {
      "code" : "override func fetchThumbnails(for itemIdentifiers: [NSFileProviderItemIdentifier], requestedSize size: CGSize, perThumbnailCompletionHandler: @escaping (NSFileProviderItemIdentifier, Data?, Error?) -> Void, completionHandler: @escaping (Error?) -> Void) -> Progress {\n    \n    let urlSession = URLSession(configuration: URLSessionConfiguration.default)\n    let progress = Progress(totalUnitCount: Int64(itemIdentifiers.count))\n    \n    for identifier in itemIdentifiers {\n        \n        \/\/ Create a request for the thumbnail from your server.\n        let request = myURLRequestForThumbnail(identifier: identifier, size: size)\n        \n        \/\/ Download the thumbnail to disk\n        \/\/ For simplicity, this sample downloads each thumbnail separately;\n        \/\/ however, if possible, you should batch download all the thumbnails at once.\n        let downloadTask = urlSession.downloadTask(with: request, completionHandler: { (tempURL, response, error) in\n            \n            guard progress.isCancelled != true else {\n                return\n            }\n            \n            var myErrorOrNil = error\n            var mappedDataOrNil: Data? = nil\n            \n            \/\/ If the download succeeds, map a data object to the file\n            if let fileURL = tempURL  {\n                do {\n                    mappedDataOrNil = try Data(contentsOf:fileURL, options: Data.ReadingOptions.alwaysMapped)\n                }\n                catch let mappingError {\n                    myErrorOrNil = mappingError\n                }\n            }\n            \n            \/\/ Call the per thumbnail completion handler for each thumbnail requested.\n            perThumbnailCompletionHandler(identifier, mappedDataOrNil, myErrorOrNil)\n            \n            DispatchQueue.main.async {\n\n                if progress.isFinished {\n                    \n                    \/\/ Call this completion handler once all thumbnails are complete\n                    completionHandler(nil)\n                }\n            }\n        })\n        \n        \/\/ Add the download task's progress as a child to the overall progress.\n        progress.addChild(downloadTask.progress, withPendingUnitCount: 1)\n        \n        \/\/ Start the download task.\n        downloadTask.resume()\n    }\n    \n    return progress\n}\n",
      "language" : "swift"
    }
  ],
  "contentHash" : "63efe046de21ade89f5fa7b4148e75aa5d0d52cbd1e3ffd32a5483d75be275fc",
  "crawledAt" : "2025-12-04T11:43:34Z",
  "declaration" : {
    "code" : "func fetchThumbnails(for itemIdentifiers: [NSFileProviderItemIdentifier], requestedSize size: CGSize, perThumbnailCompletionHandler: @escaping (NSFileProviderItemIdentifier, Data?, (any Error)?) -> Void, completionHandler: @escaping ((any Error)?) -> Void) -> Progress",
    "language" : "swift"
  },
  "id" : "0AAB2E86-E04A-461B-9FAD-53695660BBD2",
  "kind" : "method",
  "language" : "swift",
  "module" : "File Provider",
  "overview" : "## Return Value\n\nAn object that reports the progress of this request. If the thumbnails are no longer needed, the system can cancel this request by calling the progress object’s [doc:\/\/com.apple.documentation\/documentation\/Foundation\/Progress\/cancel()] method.\n\n## Discussion\n\nFor local files, the system automatically provides thumbnails for supported content types, and calls a Quick Look Preview extension to get thumbnails for custom types.\n\nHowever, the system cannot generate thumbnails for remote items. Instead, it calls this method to request thumbnails for items stored on a remote sever. The system caches these thumbnails, and only requests thumbnails for new items as they are needed. Thumbnails are cached based on the item’s [doc:\/\/com.apple.fileprovider\/documentation\/FileProvider\/NSFileProviderItemProtocol\/versionIdentifier] property. To update an item’s thumbnail, update the item’s version identifier.\n\nIn your implementation, call the `perThumbnailCompletionHandler` block once for each item in the `itemIdentifiers` array. Call the `completionHandler` block only after calling `perThumbnailCompletionHandler` for each item.\n\nIf a global error occurs, you do not have to call  `perThumbnailCompletionHandler` on each item. Instead, call the `completionHandler` block, and pass in the global error. The system applies this error to all outstanding items.\n\nIf a given item does not have a thumbnail, call the `perThumbnailCompletionHandler` block and pass `nil` for both the `imageData` and `error` parameters.\n\nListing 1 shows an example implementation.\n\nListing 1. Fetching thumbnails from a remote server.",
  "platforms" : [
    "iOS",
    "iPadOS",
    "Mac Catalyst",
    "visionOS"
  ],
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/FileProvider\/NSFileProviderExtension\/fetchThumbnails(for:requestedSize:perThumbnailCompletionHandler:completionHandler:)\ncrawled: 2025-12-04T11:43:34Z\n---\n\n# fetchThumbnails(for:requestedSize:perThumbnailCompletionHandler:completionHandler:)\n\n**Instance Method**\n\nFetches the thumbnails for items that have been enumerated by the file provider.\n\n## Declaration\n\n```swift\nfunc fetchThumbnails(for itemIdentifiers: [NSFileProviderItemIdentifier], requestedSize size: CGSize, perThumbnailCompletionHandler: @escaping (NSFileProviderItemIdentifier, Data?, (any Error)?) -> Void, completionHandler: @escaping ((any Error)?) -> Void) -> Progress\n```\n\n## Parameters\n\n- **itemIdentifiers**: The identifiers of the items that need thumbnails.\n- **size**: The size of the thumbnails, in pixels.\n- **perThumbnailCompletionHandler**: The completion handler for each thumbnail. Call this block once for each thumbnail returned. This completion handler takes the following parameters:\n\n\n- **completionHandler**: The completion handler for the entire request. Call this block after all thumbnails have been returned. This completion handler takes the following parameter:\n\n\n\n## Return Value\n\nAn object that reports the progress of this request. If the thumbnails are no longer needed, the system can cancel this request by calling the progress object’s [doc:\/\/com.apple.documentation\/documentation\/Foundation\/Progress\/cancel()] method.\n\n## Discussion\n\nFor local files, the system automatically provides thumbnails for supported content types, and calls a Quick Look Preview extension to get thumbnails for custom types.\n\nHowever, the system cannot generate thumbnails for remote items. Instead, it calls this method to request thumbnails for items stored on a remote sever. The system caches these thumbnails, and only requests thumbnails for new items as they are needed. Thumbnails are cached based on the item’s [doc:\/\/com.apple.fileprovider\/documentation\/FileProvider\/NSFileProviderItemProtocol\/versionIdentifier] property. To update an item’s thumbnail, update the item’s version identifier.\n\nIn your implementation, call the `perThumbnailCompletionHandler` block once for each item in the `itemIdentifiers` array. Call the `completionHandler` block only after calling `perThumbnailCompletionHandler` for each item.\n\nIf a global error occurs, you do not have to call  `perThumbnailCompletionHandler` on each item. Instead, call the `completionHandler` block, and pass in the global error. The system applies this error to all outstanding items.\n\nIf a given item does not have a thumbnail, call the `perThumbnailCompletionHandler` block and pass `nil` for both the `imageData` and `error` parameters.\n\nListing 1 shows an example implementation.\n\nListing 1. Fetching thumbnails from a remote server.\n\n```swift\noverride func fetchThumbnails(for itemIdentifiers: [NSFileProviderItemIdentifier], requestedSize size: CGSize, perThumbnailCompletionHandler: @escaping (NSFileProviderItemIdentifier, Data?, Error?) -> Void, completionHandler: @escaping (Error?) -> Void) -> Progress {\n    \n    let urlSession = URLSession(configuration: URLSessionConfiguration.default)\n    let progress = Progress(totalUnitCount: Int64(itemIdentifiers.count))\n    \n    for identifier in itemIdentifiers {\n        \n        \/\/ Create a request for the thumbnail from your server.\n        let request = myURLRequestForThumbnail(identifier: identifier, size: size)\n        \n        \/\/ Download the thumbnail to disk\n        \/\/ For simplicity, this sample downloads each thumbnail separately;\n        \/\/ however, if possible, you should batch download all the thumbnails at once.\n        let downloadTask = urlSession.downloadTask(with: request, completionHandler: { (tempURL, response, error) in\n            \n            guard progress.isCancelled != true else {\n                return\n            }\n            \n            var myErrorOrNil = error\n            var mappedDataOrNil: Data? = nil\n            \n            \/\/ If the download succeeds, map a data object to the file\n            if let fileURL = tempURL  {\n                do {\n                    mappedDataOrNil = try Data(contentsOf:fileURL, options: Data.ReadingOptions.alwaysMapped)\n                }\n                catch let mappingError {\n                    myErrorOrNil = mappingError\n                }\n            }\n            \n            \/\/ Call the per thumbnail completion handler for each thumbnail requested.\n            perThumbnailCompletionHandler(identifier, mappedDataOrNil, myErrorOrNil)\n            \n            DispatchQueue.main.async {\n\n                if progress.isFinished {\n                    \n                    \/\/ Call this completion handler once all thumbnails are complete\n                    completionHandler(nil)\n                }\n            }\n        })\n        \n        \/\/ Add the download task's progress as a child to the overall progress.\n        progress.addChild(downloadTask.progress, withPendingUnitCount: 1)\n        \n        \/\/ Start the download task.\n        downloadTask.resume()\n    }\n    \n    return progress\n}\n\n```\n\n",
  "sections" : [

  ],
  "source" : "appleJSON",
  "title" : "fetchThumbnails(for:requestedSize:perThumbnailCompletionHandler:completionHandler:)",
  "url" : "https:\/\/developer.apple.com\/documentation\/FileProvider\/NSFileProviderExtension\/fetchThumbnails(for:requestedSize:perThumbnailCompletionHandler:completionHandler:)"
}