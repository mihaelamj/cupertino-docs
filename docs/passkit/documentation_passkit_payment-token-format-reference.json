{
  "abstract" : "Verify an Apple Pay payment token and validate a transaction.",
  "codeExamples" : [

  ],
  "contentHash" : "c59d91fd4e28bdfb89bb4631efe28a44810366c6c233a1d6c6fe92de58d91de7",
  "crawledAt" : "2025-12-02T16:45:32Z",
  "id" : "38A13A5C-5DEB-4220-9080-278B8B5D9796",
  "kind" : "collection",
  "language" : "swift",
  "module" : "PassKit (Apple Pay and Wallet)",
  "overview" : "## Overview\n\nApple Pay is available on all iOS devices with a Secure Element — an industry-standard, certified chip designed to store payment information safely. In macOS, users must have an iPhone or Apple Watch that supports Apple Pay to authorize the payment, or have a Mac with Touch ID. The Secure Element creates a payment object when an app or website that uses Apple Pay sends a payment request.\n\nThe payment object has a nested structure that contains a payment token with encrypted payment data, as shown in the figure below.\n\n\n\nThe Secure Element encrypts the token’s payment data using either elliptic curve cryptography (ECC) or RSA encryption. The Secure Element selects the encryption algorithm based on the merchant capabilities that the payment request indicates. Most regions use ECC encryption. Other regions use RSA encryption if ECC encryption is unavailable due to regulatory concerns.\n\n### Verify the signature and decrypt the payment data\n\nThe following steps describe the process of validating a transaction by verifying the signature, decrypting the payment data, and verifying additional transaction details. Refer to the reference tables to identify keys and values.\n\nStep 1: Verify the signature as follows:\n\nStep 2: Use the value of the `publicKeyHash` key to determine which merchant public key Apple used, and then retrieve the corresponding merchant public key certificate and private key.\n\nStep 3: Restore the symmetric key. For instructions, see [doc:\/\/com.apple.documentation\/documentation\/PassKit\/restoring-the-symmetric-key].\n\nStep 4: Use the symmetric key to decrypt the value of the `data` key:\n\nAfter you complete Step 4, the payment data in the `data` value of the payment token structure is decrypted. Use the decrypted payment data and information you have about the transaction to validate that transaction.\n\nStep 5: Confirm that you haven’t already credited this payment by verifying that no payment with the same `transactionId` shows as processed. For efficiency, consider only those payments with a transaction time that’s within the 5-minute time window of the current `transactionId`, as explained in the last bullet point of Step 1.\n\nStep 6: Verify the transaction details using information from the merchant about the Apple Pay payment request and other transaction information:\n\nStep 7: If the signature is valid, the hash values match, and your transaction validation passes, use the decrypted payment data to process the payment. Otherwise, ignore the transaction.\n\n### Payment token format reference\n\nThe following tables describe the keys and values of the payment token structure.\n\n#### Payment token structure\n\nThe [doc:\/\/com.apple.passkit\/documentation\/PassKit\/PKPaymentToken\/paymentData] property of [doc:\/\/com.apple.passkit\/documentation\/PassKit\/PKPaymentToken] (or the [doc:\/\/com.apple.documentation\/documentation\/apple_pay_on_the_web\/applepaypaymenttoken\/1916115-paymentdata] property of [doc:\/\/com.apple.documentation\/documentation\/ApplePayontheWeb\/ApplePayPaymentToken], for Apple Pay on the Web) contains a UTF-8 serialization of a plaintext JSON dictionary with the following keys and values:\n\n#### Header keys and values\n\nThe `header` contains the following keys and values:\n\nFor more information about the application data and the original payment request, see [doc:\/\/com.apple.passkit\/documentation\/PassKit\/PKPaymentRequest\/applicationData] and [doc:\/\/com.apple.passkit\/documentation\/PassKit\/PKPaymentRequest]. For transactions using Apple Pay on the Web, see [doc:\/\/com.apple.documentation\/documentation\/apple_pay_on_the_web\/applepayrequest\/2951834-applicationdata] and [doc:\/\/com.apple.documentation\/documentation\/ApplePayontheWeb\/ApplePayRequest], and [doc:\/\/com.apple.documentation\/documentation\/apple_pay_on_the_web\/applepaypaymentrequest\/2577137-applicationdata] and [doc:\/\/com.apple.documentation\/documentation\/ApplePayontheWeb\/ApplePayPaymentRequest].\n\n#### Payment data keys\n\nThe decrypted payment data in the `data` value contains the following keys and values:\n\n#### Detailed payment data keys (3D Secure)\n\nIf the `paymentDataType` value is `\"3DSecure\"` in the Payment Data Keys information, the payment data dictionary in `paymentData` contains the following keys and values:\n\n#### Detailed payment data keys (EMV)\n\nIf the `paymentDataType` value is `“EMV”` in the Payment Data Keys information, the payment data dictionary in `paymentData` contains the following keys and values:\n\n#### Authentication response\n\nThe dictionary for the `authenticationResponses` in the Payment Data Keys information contains the following keys and values:",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/PassKit\/payment-token-format-reference\ncrawled: 2025-12-02T16:45:32Z\n---\n\n# Payment token format reference\n\nVerify an Apple Pay payment token and validate a transaction.\n\n## Overview\n\nApple Pay is available on all iOS devices with a Secure Element — an industry-standard, certified chip designed to store payment information safely. In macOS, users must have an iPhone or Apple Watch that supports Apple Pay to authorize the payment, or have a Mac with Touch ID. The Secure Element creates a payment object when an app or website that uses Apple Pay sends a payment request.\n\nThe payment object has a nested structure that contains a payment token with encrypted payment data, as shown in the figure below.\n\n\n\nThe Secure Element encrypts the token’s payment data using either elliptic curve cryptography (ECC) or RSA encryption. The Secure Element selects the encryption algorithm based on the merchant capabilities that the payment request indicates. Most regions use ECC encryption. Other regions use RSA encryption if ECC encryption is unavailable due to regulatory concerns.\n\n### Verify the signature and decrypt the payment data\n\nThe following steps describe the process of validating a transaction by verifying the signature, decrypting the payment data, and verifying additional transaction details. Refer to the reference tables to identify keys and values.\n\nStep 1: Verify the signature as follows:\n\n- Ensure that the certificates contain the correct custom OIDs: 1.2.840.113635.100.6.29 for the leaf certificate and 1.2.840.113635.100.6.2.14 for the intermediate CA. The value for these marker OIDs doesn’t matter, only their presence.\n- Ensure that the root CA is the Apple Root CA - G3. This certificate is available from [https:\/\/www.apple.com\/certificateauthority].\n- Ensure that there’s a valid X.509 chain of trust from the signature to the root CA. Specifically, ensure that the signature was created using the private key that corresponds to the leaf certificate, that the leaf certificate is signed by the intermediate CA, and that the intermediate CA is signed by the Apple Root CA - G3.\n- Validate the token’s signature. For ECC (EC_v1), ensure that the signature is a valid Ellyptical Curve Digital Signature Algorithm (ECDSA) signature (ecdsa-with-SHA256 1.2.840.10045.4.3.2) of the concatenated values of the `ephemeralPublicKey`, `data`, `transactionId`, and `applicationData` keys. For RSA (RSA_v1), ensure that the signature is a valid RSA signature (RSA-with-SHA256 1.2.840.113549.1.1.11) of the concatenated values of the `wrappedKey`, `data`, `transactionId`, and `applicationData` keys.\n- Inspect the Cryptographic Message Syntax (CMS) signing time of the signature, as defined by section 11.3 of RFC 5652. If the time signature and the transaction time differ by more than 5 minutes, the token may be a replay attack.\n\n\n\nStep 2: Use the value of the `publicKeyHash` key to determine which merchant public key Apple used, and then retrieve the corresponding merchant public key certificate and private key.\n\nStep 3: Restore the symmetric key. For instructions, see [doc:\/\/com.apple.documentation\/documentation\/PassKit\/restoring-the-symmetric-key].\n\nStep 4: Use the symmetric key to decrypt the value of the `data` key:\n\n- For ECC (EC_v1), decrypt the data key using AES–256 (id-aes256-GCM 2.16.840.1.101.3.4.1.46), with an initialization vector of 16 null bytes and no associated authentication data.\n- For RSA (RSA_v1), decrypt the data key using AES–128 (id-aes128-GCM 2.16.840.1.101.3.4.1.6), with an initialization vector of 16 null bytes and no associated authentication data.\n\nAfter you complete Step 4, the payment data in the `data` value of the payment token structure is decrypted. Use the decrypted payment data and information you have about the transaction to validate that transaction.\n\nStep 5: Confirm that you haven’t already credited this payment by verifying that no payment with the same `transactionId` shows as processed. For efficiency, consider only those payments with a transaction time that’s within the 5-minute time window of the current `transactionId`, as explained in the last bullet point of Step 1.\n\nStep 6: Verify the transaction details using information from the merchant about the Apple Pay payment request and other transaction information:\n\n- Check that the `currencyCode` matches the currency code in the original Apple Pay payment request.\n- Check that the `transactionAmount` is correct, as compared with the total charge of the transaction.\n- Check that the `applicationData` field matches the hash of the data the original payment request used, and that the data is correct. For example, check that an order number in the data from the original payment request is the order number to which you, the payment processor, are applying this payment. For more information, see [doc:\/\/com.apple.passkit\/documentation\/PassKit\/PKPaymentRequest\/applicationData] in [doc:\/\/com.apple.passkit\/documentation\/PassKit\/PKPaymentRequest]. For transactions that initiate in Apple Pay on the Web, see [doc:\/\/com.apple.documentation\/documentation\/apple_pay_on_the_web\/applepaypaymentrequest\/2577137-applicationdata] in [doc:\/\/com.apple.documentation\/documentation\/ApplePayontheWeb\/ApplePayPaymentRequest] and [doc:\/\/com.apple.documentation\/documentation\/apple_pay_on_the_web\/applepayrequest\/2951834-applicationdata] in [doc:\/\/com.apple.documentation\/documentation\/ApplePayontheWeb\/ApplePayRequest].\n\nStep 7: If the signature is valid, the hash values match, and your transaction validation passes, use the decrypted payment data to process the payment. Otherwise, ignore the transaction.\n\n### Payment token format reference\n\nThe following tables describe the keys and values of the payment token structure.\n\n#### Payment token structure\n\nThe [doc:\/\/com.apple.passkit\/documentation\/PassKit\/PKPaymentToken\/paymentData] property of [doc:\/\/com.apple.passkit\/documentation\/PassKit\/PKPaymentToken] (or the [doc:\/\/com.apple.documentation\/documentation\/apple_pay_on_the_web\/applepaypaymenttoken\/1916115-paymentdata] property of [doc:\/\/com.apple.documentation\/documentation\/ApplePayontheWeb\/ApplePayPaymentToken], for Apple Pay on the Web) contains a UTF-8 serialization of a plaintext JSON dictionary with the following keys and values:\n\n\n\n#### Header keys and values\n\nThe `header` contains the following keys and values:\n\n\n\nFor more information about the application data and the original payment request, see [doc:\/\/com.apple.passkit\/documentation\/PassKit\/PKPaymentRequest\/applicationData] and [doc:\/\/com.apple.passkit\/documentation\/PassKit\/PKPaymentRequest]. For transactions using Apple Pay on the Web, see [doc:\/\/com.apple.documentation\/documentation\/apple_pay_on_the_web\/applepayrequest\/2951834-applicationdata] and [doc:\/\/com.apple.documentation\/documentation\/ApplePayontheWeb\/ApplePayRequest], and [doc:\/\/com.apple.documentation\/documentation\/apple_pay_on_the_web\/applepaypaymentrequest\/2577137-applicationdata] and [doc:\/\/com.apple.documentation\/documentation\/ApplePayontheWeb\/ApplePayPaymentRequest].\n\n#### Payment data keys\n\nThe decrypted payment data in the `data` value contains the following keys and values:\n\n\n\n#### Detailed payment data keys (3D Secure)\n\nIf the `paymentDataType` value is `\"3DSecure\"` in the Payment Data Keys information, the payment data dictionary in `paymentData` contains the following keys and values:\n\n\n\n#### Detailed payment data keys (EMV)\n\nIf the `paymentDataType` value is `“EMV”` in the Payment Data Keys information, the payment data dictionary in `paymentData` contains the following keys and values:\n\n\n\n#### Authentication response\n\nThe dictionary for the `authenticationResponses` in the Payment Data Keys information contains the following keys and values:\n\n\n\n## Symmetric keys\n\n- **Restoring the symmetric key**: Restore the symmetric key you use to verify payment data.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Restore the symmetric key you use to verify payment data.",
          "name" : "Restoring the symmetric key",
          "url" : "https:\/\/developer.apple.com\/documentation\/PassKit\/restoring-the-symmetric-key"
        }
      ],
      "title" : "Symmetric keys"
    }
  ],
  "source" : "appleJSON",
  "title" : "Payment token format reference",
  "url" : "https:\/\/developer.apple.com\/documentation\/PassKit\/payment-token-format-reference"
}