{
  "abstract" : "Collect payments with iPhone and Apple Watch using Apple Pay.",
  "codeExamples" : [
    {
      "code" : "static let supportedNetworks: [PKPaymentNetwork] = [\n    .amex,\n    .discover,\n    .masterCard,\n    .visa\n]\n\nclass func applePayStatus() -> (canMakePayments: Bool, canSetupCards: Bool) {\n    return (PKPaymentAuthorizationController.canMakePayments(),\n            PKPaymentAuthorizationController.canMakePayments(usingNetworks: supportedNetworks))\n}",
      "language" : "swift"
    },
    {
      "code" : "let result = PaymentHandler.applePayStatus()\nvar button: UIButton?\n\nif result.canMakePayments {\n    button = PKPaymentButton(paymentButtonType: .book, paymentButtonStyle: .black)\n    button?.addTarget(self, action: #selector(ViewController.payPressed), for: .touchUpInside)\n} else if result.canSetupCards {\n    button = PKPaymentButton(paymentButtonType: .setUp, paymentButtonStyle: .black)\n    button?.addTarget(self, action: #selector(ViewController.setupPressed), for: .touchUpInside)\n}\n\nif let applePayButton = button {\n    let constraints = [\n        applePayButton.centerXAnchor.constraint(equalTo: applePayView.centerXAnchor),\n        applePayButton.centerYAnchor.constraint(equalTo: applePayView.centerYAnchor)\n    ]\n    applePayButton.translatesAutoresizingMaskIntoConstraints = false\n    applePayView.addSubview(applePayButton)\n    NSLayoutConstraint.activate(constraints)\n}",
      "language" : "swift"
    },
    {
      "code" : "func shippingMethodCalculator() -> [PKShippingMethod] {\n    \/\/ Calculate the pickup date.\n    \n    let today = Date()\n    let calendar = Calendar.current\n    \n    let shippingStart = calendar.date(byAdding: .day, value: 3, to: today)!\n    let shippingEnd = calendar.date(byAdding: .day, value: 5, to: today)!\n    \n    let startComponents = calendar.dateComponents([.calendar, .year, .month, .day], from: shippingStart)\n    let endComponents = calendar.dateComponents([.calendar, .year, .month, .day], from: shippingEnd)\n     \n    let shippingDelivery = PKShippingMethod(label: \"Delivery\", amount: NSDecimalNumber(string: \"0.00\"))\n    shippingDelivery.dateComponentsRange = PKDateComponentsRange(start: startComponents, end: endComponents)\n    shippingDelivery.detail = \"Ticket sent to you address\"\n    shippingDelivery.identifier = \"DELIVERY\"\n    \n    let shippingCollection = PKShippingMethod(label: \"Collection\", amount: NSDecimalNumber(string: \"0.00\"))\n    shippingCollection.detail = \"Collect ticket at festival\"\n    shippingCollection.identifier = \"COLLECTION\"\n    \n    return [shippingDelivery, shippingCollection]\n}",
      "language" : "swift"
    },
    {
      "code" : "let ticket = PKPaymentSummaryItem(label: \"Festival Entry\", amount: NSDecimalNumber(string: \"9.99\"), type: .final)\nlet tax = PKPaymentSummaryItem(label: \"Tax\", amount: NSDecimalNumber(string: \"1.00\"), type: .final)\nlet total = PKPaymentSummaryItem(label: \"Total\", amount: NSDecimalNumber(string: \"10.99\"), type: .final)\npaymentSummaryItems = [ticket, tax, total]",
      "language" : "swift"
    },
    {
      "code" : "let paymentRequest = PKPaymentRequest()\npaymentRequest.paymentSummaryItems = paymentSummaryItems\npaymentRequest.merchantIdentifier = Configuration.Merchant.identifier\npaymentRequest.merchantCapabilities = .capability3DS\npaymentRequest.countryCode = \"US\"\npaymentRequest.currencyCode = \"USD\"\npaymentRequest.supportedNetworks = PaymentHandler.supportedNetworks\npaymentRequest.shippingType = .delivery\npaymentRequest.shippingMethods = shippingMethodCalculator()\npaymentRequest.requiredShippingContactFields = [.name, .postalAddress]\n#if !os(watchOS)\npaymentRequest.supportsCouponCode = true\n#endif",
      "language" : "swift"
    },
    {
      "code" : "paymentController = PKPaymentAuthorizationController(paymentRequest: paymentRequest)\npaymentController?.delegate = self\npaymentController?.present(completion: { (presented: Bool) in\n    if presented {\n        debugPrint(\"Presented payment controller\")\n    } else {\n        debugPrint(\"Failed to present payment controller\")\n        self.completionHandler(false)\n    }\n})",
      "language" : "swift"
    },
    {
      "code" : "#if !os(watchOS)\n\nfunc paymentAuthorizationController(_ controller: PKPaymentAuthorizationController,\n                                    didChangeCouponCode couponCode: String,\n                                    handler completion: @escaping (PKPaymentRequestCouponCodeUpdate) -> Void) {\n    \/\/ The `didChangeCouponCode` delegate method allows you to make changes when the user enters or updates a coupon code.\n    \n    func applyDiscount(items: [PKPaymentSummaryItem]) -> [PKPaymentSummaryItem] {\n        let tickets = items.first!\n        let couponDiscountItem = PKPaymentSummaryItem(label: \"Coupon Code Applied\", amount: NSDecimalNumber(string: \"-2.00\"))\n        let updatedTax = PKPaymentSummaryItem(label: \"Tax\", amount: NSDecimalNumber(string: \"0.80\"), type: .final)\n        let updatedTotal = PKPaymentSummaryItem(label: \"Total\", amount: NSDecimalNumber(string: \"8.80\"), type: .final)\n        let discountedItems = [tickets, couponDiscountItem, updatedTax, updatedTotal]\n        return discountedItems\n    }\n    \n    if couponCode.uppercased() == \"FESTIVAL\" {\n        \/\/ If the coupon code is valid, update the summary items.\n        let couponCodeSummaryItems = applyDiscount(items: paymentSummaryItems)\n        completion(PKPaymentRequestCouponCodeUpdate(paymentSummaryItems: applyDiscount(items: couponCodeSummaryItems)))\n        return\n    } else if couponCode.isEmpty {\n        \/\/ If the user doesn't enter a code, return the current payment summary items.\n        completion(PKPaymentRequestCouponCodeUpdate(paymentSummaryItems: paymentSummaryItems))\n        return\n    } else {\n        \/\/ If the user enters a code, but it's not valid, we can display an error.\n        let couponError = PKPaymentRequest.paymentCouponCodeInvalidError(localizedDescription: \"Coupon code is not valid.\")\n        completion(PKPaymentRequestCouponCodeUpdate(errors: [couponError], paymentSummaryItems: paymentSummaryItems, shippingMethods: shippingMethodCalculator()))\n        return\n    }\n}\n\n#endif",
      "language" : "swift"
    },
    {
      "code" : "func paymentAuthorizationController(_ controller: PKPaymentAuthorizationController, didAuthorizePayment payment: PKPayment, handler completion: @escaping (PKPaymentAuthorizationResult) -> Void) {\n    \n    \/\/ Perform basic validation on the provided contact information.\n    var errors = [Error]()\n    var status = PKPaymentAuthorizationStatus.success\n    if payment.shippingContact?.postalAddress?.isoCountryCode != \"US\" {\n        let pickupError = PKPaymentRequest.paymentShippingAddressUnserviceableError(withLocalizedDescription: \"Sample App only available in the United States\")\n        let countryError = PKPaymentRequest.paymentShippingAddressInvalidError(withKey: CNPostalAddressCountryKey, localizedDescription: \"Invalid country\")\n        errors.append(pickupError)\n        errors.append(countryError)\n        status = .failure\n    } else {\n        \/\/ Send the payment token to your server or payment provider to process here.\n        \/\/ Once processed, return an appropriate status in the completion handler (success, failure, and so on).\n    }\n    \n    self.paymentStatus = status\n    completion(PKPaymentAuthorizationResult(status: status, errors: errors))\n}",
      "language" : "swift"
    },
    {
      "code" : "@objc func payPressed(sender: AnyObject) {\n    paymentHandler.startPayment() { (success) in\n        if success {\n            self.performSegue(withIdentifier: \"Confirmation\", sender: self)\n        }\n    }\n}",
      "language" : "swift"
    }
  ],
  "contentHash" : "4ea488b4f2a4291292f2fe03430df1b1b4631b28d718931ce289fcc53c99fc47",
  "crawledAt" : "2025-12-02T15:47:06Z",
  "id" : "ABC8BF5C-1905-4924-A76E-EE99B783A71A",
  "kind" : "unknown",
  "language" : "swift",
  "module" : "PassKit (Apple Pay and Wallet)",
  "overview" : "## Overview\n\nThis sample shows the implementation of an integrated Apple Pay eCommerce experience across iOS and watchOS. The sample app demonstrates how to use the Apple Pay button, display the Apple Pay payment sheet, make payment requests, and accept coupon codes.\n\nThe sample ticket booking app implements buying a ticket using Apple Pay in:\n\nA shared `PaymentHandler` class handles payment in each of the apps.\n\n### Configure the Sample Code Project\n\nTest Apple Pay payments with this sample by configuring the bundle identifiers and Apple Pay configuration items in Xcode. Doing this requires an Apple developer account. Before building the app, complete these four steps:\n\nRunning this app on an iPhone or Apple Watch requires an Apple Pay card. Running in Simulator doesn’t require a card.\n\nFor more information about processing an Apple Pay payment using a payment platform or merchant bank, see [https:\/\/developer.apple.com\/apple-pay]. To set up your sandbox environment for testing, see [https:\/\/developer.apple.com\/apple-pay\/sandbox-testing\/].\n\n### Add the Apple Pay Button\n\nApple Pay includes pre-built buttons to start a payment interaction, or to set up payment methods. The iOS app displays the payment button if the device can make payments, and it contains at least one payment card; otherwise it displays the button to add a payment.\n\nThis sample checks for the ability to make payments using [doc:\/\/com.apple.passkit\/documentation\/PassKit\/PKPaymentAuthorizationController\/canMakePayments()], and checks for available payment cards using [doc:\/\/com.apple.passkit\/documentation\/PassKit\/PKPaymentAuthorizationController\/canMakePayments(usingNetworks:)]. Both of these methods are part of [doc:\/\/com.apple.passkit\/documentation\/PassKit\/PKPaymentAuthorizationController].\n\nThe iOS app displays the payment button by adding an instance of [doc:\/\/com.apple.passkit\/documentation\/PassKit\/PKPaymentButton].\n\nThe watchOS app adds the button to the storyboard as an instance of [doc:\/\/com.apple.documentation\/documentation\/WatchKit\/WKInterfacePaymentButton].\n\n### Define the Shipping Methods\n\nThe app defines two shipping methods: delivery with estimated shipping dates and on-site collection. The payment sheet displays the delivery information for the chosen shipping method, including estimated delivery dates. Configuring the dates requires a calendar, start date components, and end date components\n\n### Start the Payment Process\n\nBoth iOS and watchOS implementations start the payment process by calling the `startPayment` method of the shared `PaymentHandler`. Updates to the payment sheet use the completion handlers implemented by both apps. The `startPayment` method stores the completion handlers because the Apple Pay functionality is asynchronous; and then the method creates an array of [doc:\/\/com.apple.passkit\/documentation\/PassKit\/PKPaymentSummaryItem] to display the charges on the payment sheet.\n\nThe app configures a [doc:\/\/com.apple.passkit\/documentation\/PassKit\/PKPaymentRequest] using the list of payment items and other details.\n\nNext the app displays the payment sheet by calling [doc:\/\/com.apple.passkit\/documentation\/PassKit\/PKPaymentAuthorizationController] with the payment request. Both apps present the payment sheet using `present(completion:)`.\n\nThe payment sheet handles all user interactions, including payment confirmation. It requests updates using the completion handlers stored by the `startPayment` method when a user updates the sheet.\n\n### Respond to Coupon Code Entry\n\nThe `PaymentHandler` class handles coupons by implementing the [doc:\/\/com.apple.passkit\/documentation\/PassKit\/PKPaymentAuthorizationControllerDelegate] protocol method [doc:\/\/com.apple.passkit\/documentation\/PassKit\/PKPaymentAuthorizationControllerDelegate\/paymentAuthorizationController(_:didSelectPaymentMethod:handler:)].\n\nAfter the user enters an accepted coupon code, the method adds a new `PKPaymentSummaryItem` displaying the discount, and adjusts the `PKPaymentSummaryItem` with the discounted total.\n\n### Handle Payment Success or Failure\n\nWhen the user authorizes the payment, the system calls the [doc:\/\/com.apple.passkit\/documentation\/PassKit\/PKPaymentAuthorizationControllerDelegate\/paymentAuthorizationController(_:didAuthorizePayment:handler:)] method of the [doc:\/\/com.apple.passkit\/documentation\/PassKit\/PKPaymentAuthorizationControllerDelegate] protocol. Your handler confirms that the shipping address meets the criteria needed, and then calls the completion handler to report success or failure of the payment.\n\nThe sample code contains a comment at the place you add code for processing the payment.\n\nOnce the sample app calls the completion handler in the [doc:\/\/com.apple.passkit\/documentation\/PassKit\/PKPaymentAuthorizationControllerDelegate\/paymentAuthorizationController(_:didAuthorizePayment:handler:)] method, Apple Pay tells the app it can dismiss the payment sheet by calling [doc:\/\/com.apple.passkit\/documentation\/PassKit\/PKPaymentAuthorizationControllerDelegate\/paymentAuthorizationControllerDidFinish(_:)]. iOS and watchOS both handle dismissing the sheet as appropriate for each platform. In the iOS app, if payment succeeds the completion handler performs a segue to display a new view controller. If the payment fails, it remains on the payment sheet so the user can attempt payment with a different card or correct any issues.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/PassKit\/offering-apple-pay-in-your-app\ncrawled: 2025-12-02T15:47:06Z\n---\n\n# Offering Apple Pay in Your App\n\n**Sample Code**\n\nCollect payments with iPhone and Apple Watch using Apple Pay.\n\n## Overview\n\nThis sample shows the implementation of an integrated Apple Pay eCommerce experience across iOS and watchOS. The sample app demonstrates how to use the Apple Pay button, display the Apple Pay payment sheet, make payment requests, and accept coupon codes.\n\nThe sample ticket booking app implements buying a ticket using Apple Pay in:\n\n- An iOS app.\n- A watchOS app.\n\nA shared `PaymentHandler` class handles payment in each of the apps.\n\n\n\n### Configure the Sample Code Project\n\nTest Apple Pay payments with this sample by configuring the bundle identifiers and Apple Pay configuration items in Xcode. Doing this requires an Apple developer account. Before building the app, complete these four steps:\n\n1. Change the bundle ID for each target so that it’s unique for your developer account; change `example` in the bundle ID to something that represents you or your organization.\n2. In the build settings, update the value of the user-defined `OFFERING_APPLE_PAY_BUNDLE_PREFIX` setting to match the prefix of the bundle IDs you changed in step 1. For example, if you changed `example` in each bundle ID to your organization name, change `example` in `OFFERING_APPLE_PAY_BUNDLE_PREFIX` to the same organization name. Xcode configures the required merchant ID for Apple Pay in each target when you build the project.\n3. Set up the Apple Pay Merchant Identity and Apple Pay Payment Processing certificates. For more information on setting up a merchant identity and processing certificates, see [doc:\/\/com.apple.documentation\/documentation\/PassKit\/setting-up-apple-pay].\n4. Set the signing option for the iOS app to “Automatically manage signing.”\n\nRunning this app on an iPhone or Apple Watch requires an Apple Pay card. Running in Simulator doesn’t require a card.\n\n\n\nFor more information about processing an Apple Pay payment using a payment platform or merchant bank, see [https:\/\/developer.apple.com\/apple-pay]. To set up your sandbox environment for testing, see [https:\/\/developer.apple.com\/apple-pay\/sandbox-testing\/].\n\n### Add the Apple Pay Button\n\nApple Pay includes pre-built buttons to start a payment interaction, or to set up payment methods. The iOS app displays the payment button if the device can make payments, and it contains at least one payment card; otherwise it displays the button to add a payment.\n\nThis sample checks for the ability to make payments using [doc:\/\/com.apple.passkit\/documentation\/PassKit\/PKPaymentAuthorizationController\/canMakePayments()], and checks for available payment cards using [doc:\/\/com.apple.passkit\/documentation\/PassKit\/PKPaymentAuthorizationController\/canMakePayments(usingNetworks:)]. Both of these methods are part of [doc:\/\/com.apple.passkit\/documentation\/PassKit\/PKPaymentAuthorizationController].\n\n```swift\nstatic let supportedNetworks: [PKPaymentNetwork] = [\n    .amex,\n    .discover,\n    .masterCard,\n    .visa\n]\n\nclass func applePayStatus() -> (canMakePayments: Bool, canSetupCards: Bool) {\n    return (PKPaymentAuthorizationController.canMakePayments(),\n            PKPaymentAuthorizationController.canMakePayments(usingNetworks: supportedNetworks))\n}\n```\n\nThe iOS app displays the payment button by adding an instance of [doc:\/\/com.apple.passkit\/documentation\/PassKit\/PKPaymentButton].\n\n\n\n```swift\nlet result = PaymentHandler.applePayStatus()\nvar button: UIButton?\n\nif result.canMakePayments {\n    button = PKPaymentButton(paymentButtonType: .book, paymentButtonStyle: .black)\n    button?.addTarget(self, action: #selector(ViewController.payPressed), for: .touchUpInside)\n} else if result.canSetupCards {\n    button = PKPaymentButton(paymentButtonType: .setUp, paymentButtonStyle: .black)\n    button?.addTarget(self, action: #selector(ViewController.setupPressed), for: .touchUpInside)\n}\n\nif let applePayButton = button {\n    let constraints = [\n        applePayButton.centerXAnchor.constraint(equalTo: applePayView.centerXAnchor),\n        applePayButton.centerYAnchor.constraint(equalTo: applePayView.centerYAnchor)\n    ]\n    applePayButton.translatesAutoresizingMaskIntoConstraints = false\n    applePayView.addSubview(applePayButton)\n    NSLayoutConstraint.activate(constraints)\n}\n```\n\nThe watchOS app adds the button to the storyboard as an instance of [doc:\/\/com.apple.documentation\/documentation\/WatchKit\/WKInterfacePaymentButton].\n\n### Define the Shipping Methods\n\nThe app defines two shipping methods: delivery with estimated shipping dates and on-site collection. The payment sheet displays the delivery information for the chosen shipping method, including estimated delivery dates. Configuring the dates requires a calendar, start date components, and end date components\n\n```swift\nfunc shippingMethodCalculator() -> [PKShippingMethod] {\n    \/\/ Calculate the pickup date.\n    \n    let today = Date()\n    let calendar = Calendar.current\n    \n    let shippingStart = calendar.date(byAdding: .day, value: 3, to: today)!\n    let shippingEnd = calendar.date(byAdding: .day, value: 5, to: today)!\n    \n    let startComponents = calendar.dateComponents([.calendar, .year, .month, .day], from: shippingStart)\n    let endComponents = calendar.dateComponents([.calendar, .year, .month, .day], from: shippingEnd)\n     \n    let shippingDelivery = PKShippingMethod(label: \"Delivery\", amount: NSDecimalNumber(string: \"0.00\"))\n    shippingDelivery.dateComponentsRange = PKDateComponentsRange(start: startComponents, end: endComponents)\n    shippingDelivery.detail = \"Ticket sent to you address\"\n    shippingDelivery.identifier = \"DELIVERY\"\n    \n    let shippingCollection = PKShippingMethod(label: \"Collection\", amount: NSDecimalNumber(string: \"0.00\"))\n    shippingCollection.detail = \"Collect ticket at festival\"\n    shippingCollection.identifier = \"COLLECTION\"\n    \n    return [shippingDelivery, shippingCollection]\n}\n```\n\n### Start the Payment Process\n\nBoth iOS and watchOS implementations start the payment process by calling the `startPayment` method of the shared `PaymentHandler`. Updates to the payment sheet use the completion handlers implemented by both apps. The `startPayment` method stores the completion handlers because the Apple Pay functionality is asynchronous; and then the method creates an array of [doc:\/\/com.apple.passkit\/documentation\/PassKit\/PKPaymentSummaryItem] to display the charges on the payment sheet.\n\n```swift\nlet ticket = PKPaymentSummaryItem(label: \"Festival Entry\", amount: NSDecimalNumber(string: \"9.99\"), type: .final)\nlet tax = PKPaymentSummaryItem(label: \"Tax\", amount: NSDecimalNumber(string: \"1.00\"), type: .final)\nlet total = PKPaymentSummaryItem(label: \"Total\", amount: NSDecimalNumber(string: \"10.99\"), type: .final)\npaymentSummaryItems = [ticket, tax, total]\n```\n\nThe app configures a [doc:\/\/com.apple.passkit\/documentation\/PassKit\/PKPaymentRequest] using the list of payment items and other details.\n\n```swift\nlet paymentRequest = PKPaymentRequest()\npaymentRequest.paymentSummaryItems = paymentSummaryItems\npaymentRequest.merchantIdentifier = Configuration.Merchant.identifier\npaymentRequest.merchantCapabilities = .capability3DS\npaymentRequest.countryCode = \"US\"\npaymentRequest.currencyCode = \"USD\"\npaymentRequest.supportedNetworks = PaymentHandler.supportedNetworks\npaymentRequest.shippingType = .delivery\npaymentRequest.shippingMethods = shippingMethodCalculator()\npaymentRequest.requiredShippingContactFields = [.name, .postalAddress]\n#if !os(watchOS)\npaymentRequest.supportsCouponCode = true\n#endif\n```\n\nNext the app displays the payment sheet by calling [doc:\/\/com.apple.passkit\/documentation\/PassKit\/PKPaymentAuthorizationController] with the payment request. Both apps present the payment sheet using `present(completion:)`.\n\nThe payment sheet handles all user interactions, including payment confirmation. It requests updates using the completion handlers stored by the `startPayment` method when a user updates the sheet.\n\n```swift\npaymentController = PKPaymentAuthorizationController(paymentRequest: paymentRequest)\npaymentController?.delegate = self\npaymentController?.present(completion: { (presented: Bool) in\n    if presented {\n        debugPrint(\"Presented payment controller\")\n    } else {\n        debugPrint(\"Failed to present payment controller\")\n        self.completionHandler(false)\n    }\n})\n```\n\n### Respond to Coupon Code Entry\n\nThe `PaymentHandler` class handles coupons by implementing the [doc:\/\/com.apple.passkit\/documentation\/PassKit\/PKPaymentAuthorizationControllerDelegate] protocol method [doc:\/\/com.apple.passkit\/documentation\/PassKit\/PKPaymentAuthorizationControllerDelegate\/paymentAuthorizationController(_:didSelectPaymentMethod:handler:)].\n\nAfter the user enters an accepted coupon code, the method adds a new `PKPaymentSummaryItem` displaying the discount, and adjusts the `PKPaymentSummaryItem` with the discounted total.\n\n\n\n```swift\n#if !os(watchOS)\n\nfunc paymentAuthorizationController(_ controller: PKPaymentAuthorizationController,\n                                    didChangeCouponCode couponCode: String,\n                                    handler completion: @escaping (PKPaymentRequestCouponCodeUpdate) -> Void) {\n    \/\/ The `didChangeCouponCode` delegate method allows you to make changes when the user enters or updates a coupon code.\n    \n    func applyDiscount(items: [PKPaymentSummaryItem]) -> [PKPaymentSummaryItem] {\n        let tickets = items.first!\n        let couponDiscountItem = PKPaymentSummaryItem(label: \"Coupon Code Applied\", amount: NSDecimalNumber(string: \"-2.00\"))\n        let updatedTax = PKPaymentSummaryItem(label: \"Tax\", amount: NSDecimalNumber(string: \"0.80\"), type: .final)\n        let updatedTotal = PKPaymentSummaryItem(label: \"Total\", amount: NSDecimalNumber(string: \"8.80\"), type: .final)\n        let discountedItems = [tickets, couponDiscountItem, updatedTax, updatedTotal]\n        return discountedItems\n    }\n    \n    if couponCode.uppercased() == \"FESTIVAL\" {\n        \/\/ If the coupon code is valid, update the summary items.\n        let couponCodeSummaryItems = applyDiscount(items: paymentSummaryItems)\n        completion(PKPaymentRequestCouponCodeUpdate(paymentSummaryItems: applyDiscount(items: couponCodeSummaryItems)))\n        return\n    } else if couponCode.isEmpty {\n        \/\/ If the user doesn't enter a code, return the current payment summary items.\n        completion(PKPaymentRequestCouponCodeUpdate(paymentSummaryItems: paymentSummaryItems))\n        return\n    } else {\n        \/\/ If the user enters a code, but it's not valid, we can display an error.\n        let couponError = PKPaymentRequest.paymentCouponCodeInvalidError(localizedDescription: \"Coupon code is not valid.\")\n        completion(PKPaymentRequestCouponCodeUpdate(errors: [couponError], paymentSummaryItems: paymentSummaryItems, shippingMethods: shippingMethodCalculator()))\n        return\n    }\n}\n\n#endif\n```\n\n### Handle Payment Success or Failure\n\nWhen the user authorizes the payment, the system calls the [doc:\/\/com.apple.passkit\/documentation\/PassKit\/PKPaymentAuthorizationControllerDelegate\/paymentAuthorizationController(_:didAuthorizePayment:handler:)] method of the [doc:\/\/com.apple.passkit\/documentation\/PassKit\/PKPaymentAuthorizationControllerDelegate] protocol. Your handler confirms that the shipping address meets the criteria needed, and then calls the completion handler to report success or failure of the payment.\n\nThe sample code contains a comment at the place you add code for processing the payment.\n\n```swift\nfunc paymentAuthorizationController(_ controller: PKPaymentAuthorizationController, didAuthorizePayment payment: PKPayment, handler completion: @escaping (PKPaymentAuthorizationResult) -> Void) {\n    \n    \/\/ Perform basic validation on the provided contact information.\n    var errors = [Error]()\n    var status = PKPaymentAuthorizationStatus.success\n    if payment.shippingContact?.postalAddress?.isoCountryCode != \"US\" {\n        let pickupError = PKPaymentRequest.paymentShippingAddressUnserviceableError(withLocalizedDescription: \"Sample App only available in the United States\")\n        let countryError = PKPaymentRequest.paymentShippingAddressInvalidError(withKey: CNPostalAddressCountryKey, localizedDescription: \"Invalid country\")\n        errors.append(pickupError)\n        errors.append(countryError)\n        status = .failure\n    } else {\n        \/\/ Send the payment token to your server or payment provider to process here.\n        \/\/ Once processed, return an appropriate status in the completion handler (success, failure, and so on).\n    }\n    \n    self.paymentStatus = status\n    completion(PKPaymentAuthorizationResult(status: status, errors: errors))\n}\n```\n\nOnce the sample app calls the completion handler in the [doc:\/\/com.apple.passkit\/documentation\/PassKit\/PKPaymentAuthorizationControllerDelegate\/paymentAuthorizationController(_:didAuthorizePayment:handler:)] method, Apple Pay tells the app it can dismiss the payment sheet by calling [doc:\/\/com.apple.passkit\/documentation\/PassKit\/PKPaymentAuthorizationControllerDelegate\/paymentAuthorizationControllerDidFinish(_:)]. iOS and watchOS both handle dismissing the sheet as appropriate for each platform. In the iOS app, if payment succeeds the completion handler performs a segue to display a new view controller. If the payment fails, it remains on the payment sheet so the user can attempt payment with a different card or correct any issues.\n\n```swift\n@objc func payPressed(sender: AnyObject) {\n    paymentHandler.startPayment() { (success) in\n        if success {\n            self.performSegue(withIdentifier: \"Confirmation\", sender: self)\n        }\n    }\n}\n```\n\n## Apple Pay setup\n\n- **Setting up Apple Pay**: Fulfill the requirements to provide Apple Pay as a payment option on your website or in your app.\n- **Complying with regional regulations**: Check regional regulations for possible requirements for your Apple Pay-based implementation.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Fulfill the requirements to provide Apple Pay as a payment option on your website or in your app.",
          "name" : "Setting up Apple Pay",
          "url" : "https:\/\/developer.apple.com\/documentation\/PassKit\/setting-up-apple-pay"
        },
        {
          "description" : "Check regional regulations for possible requirements for your Apple Pay-based implementation.",
          "name" : "Complying with regional regulations",
          "url" : "https:\/\/developer.apple.com\/documentation\/PassKit\/complying-with-regional-regulations"
        }
      ],
      "title" : "Apple Pay setup"
    }
  ],
  "source" : "appleJSON",
  "title" : "Offering Apple Pay in Your App",
  "url" : "https:\/\/developer.apple.com\/documentation\/PassKit\/offering-apple-pay-in-your-app"
}