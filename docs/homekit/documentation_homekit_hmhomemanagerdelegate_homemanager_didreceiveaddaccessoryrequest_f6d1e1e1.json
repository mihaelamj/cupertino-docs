{
  "abstract" : "Tells the delegate to add an accessory to a home by using a setup payload.",
  "codeExamples" : [
    {
      "code" : "let data = negotiateTokenData(accessory: request.accessoryName)\nguard let token = HMAccessoryOwnershipToken(data: data) else { return }",
      "language" : "swift"
    },
    {
      "code" : "var payload: HMAccessorySetupPayload?\nif request.requiresSetupPayloadURL {\n    let payloadURL = getPayloadURL(accessory: request.accessoryName)\n    payload = request.makePayload(url: payloadURL, ownershipToken: token)\n} else {\n    payload = request.makePayload(ownershipToken: token)\n}",
      "language" : "swift"
    },
    {
      "code" : "if let payload = payload {\n    request.home.addAndSetupAccessories(with: payload) { accessories, error in\n        \/\/ Handle errors.\n    }\n}",
      "language" : "swift"
    }
  ],
  "contentHash" : "5b0e023a10c9cd2a1fb71183504d9dfb1193c01091dffe3cbd042cd175940d83",
  "crawledAt" : "2025-12-03T09:37:52Z",
  "declaration" : {
    "code" : "optional func homeManager(_ manager: HMHomeManager, didReceiveAddAccessoryRequest request: HMAddAccessoryRequest)",
    "language" : "swift"
  },
  "id" : "7564E5A1-5F97-453B-8969-BCB0907897F5",
  "kind" : "method",
  "language" : "swift",
  "module" : "HomeKit",
  "overview" : "## Discussion\n\nHomeKit calls this method when it needs help adding an accessory to a home, which typically occurs when the accessory requires explicit user authentication that HomeKit can’t negotiate. HomeKit asks the accessory manufacturer’s app, which it locates using information provided by the accessory, to complete the authentication.\n\nIf you manufacture an accessory like this, handle the [doc:\/\/com.apple.homekit\/documentation\/HomeKit\/HMHomeManagerDelegate\/homeManager(_:didReceiveAddAccessoryRequest:)] call in your app by creating an [doc:\/\/com.apple.homekit\/documentation\/HomeKit\/HMAccessoryOwnershipToken] instance in a way that’s appropriate for your accessory, outside of HomeKit:\n\nUse the resulting token to create an [doc:\/\/com.apple.homekit\/documentation\/HomeKit\/HMAccessorySetupPayload] instance. If the request’s [doc:\/\/com.apple.homekit\/documentation\/HomeKit\/HMAddAccessoryRequest\/requiresSetupPayloadURL] flag is `true`, get the payload URL corresponding to the named accessory, and include that in the setup payload as well:\n\nComplete the setup by calling the home’s [doc:\/\/com.apple.homekit\/documentation\/HomeKit\/HMHome\/addAndSetupAccessories(with:completionHandler:)] method with the payload:",
  "platforms" : [
    "iOS",
    "iPadOS",
    "visionOS"
  ],
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/HomeKit\/HMHomeManagerDelegate\/homeManager(_:didReceiveAddAccessoryRequest:)\ncrawled: 2025-12-03T09:37:52Z\n---\n\n# homeManager(_:didReceiveAddAccessoryRequest:)\n\n**Instance Method**\n\nTells the delegate to add an accessory to a home by using a setup payload.\n\n## Declaration\n\n```swift\noptional func homeManager(_ manager: HMHomeManager, didReceiveAddAccessoryRequest request: HMAddAccessoryRequest)\n```\n\n## Parameters\n\n- **manager**: The home manager making the request.\n- **request**: A description of the accessory to add.\n\n## Discussion\n\nHomeKit calls this method when it needs help adding an accessory to a home, which typically occurs when the accessory requires explicit user authentication that HomeKit can’t negotiate. HomeKit asks the accessory manufacturer’s app, which it locates using information provided by the accessory, to complete the authentication.\n\nIf you manufacture an accessory like this, handle the [doc:\/\/com.apple.homekit\/documentation\/HomeKit\/HMHomeManagerDelegate\/homeManager(_:didReceiveAddAccessoryRequest:)] call in your app by creating an [doc:\/\/com.apple.homekit\/documentation\/HomeKit\/HMAccessoryOwnershipToken] instance in a way that’s appropriate for your accessory, outside of HomeKit:\n\n```swift\nlet data = negotiateTokenData(accessory: request.accessoryName)\nguard let token = HMAccessoryOwnershipToken(data: data) else { return }\n```\n\nUse the resulting token to create an [doc:\/\/com.apple.homekit\/documentation\/HomeKit\/HMAccessorySetupPayload] instance. If the request’s [doc:\/\/com.apple.homekit\/documentation\/HomeKit\/HMAddAccessoryRequest\/requiresSetupPayloadURL] flag is `true`, get the payload URL corresponding to the named accessory, and include that in the setup payload as well:\n\n```swift\nvar payload: HMAccessorySetupPayload?\nif request.requiresSetupPayloadURL {\n    let payloadURL = getPayloadURL(accessory: request.accessoryName)\n    payload = request.makePayload(url: payloadURL, ownershipToken: token)\n} else {\n    payload = request.makePayload(ownershipToken: token)\n}\n```\n\nComplete the setup by calling the home’s [doc:\/\/com.apple.homekit\/documentation\/HomeKit\/HMHome\/addAndSetupAccessories(with:completionHandler:)] method with the payload:\n\n```swift\nif let payload = payload {\n    request.home.addAndSetupAccessories(with: payload) { accessories, error in\n        \/\/ Handle errors.\n    }\n}\n```\n\n## Adding accessories\n\n- **HMAddAccessoryRequest**: A request to add an accessory to a particular home.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "A request to add an accessory to a particular home.",
          "name" : "HMAddAccessoryRequest",
          "url" : "https:\/\/developer.apple.com\/documentation\/HomeKit\/HMAddAccessoryRequest"
        }
      ],
      "title" : "Adding accessories"
    }
  ],
  "source" : "appleJSON",
  "title" : "homeManager(_:didReceiveAddAccessoryRequest:)",
  "url" : "https:\/\/developer.apple.com\/documentation\/HomeKit\/HMHomeManagerDelegate\/homeManager(_:didReceiveAddAccessoryRequest:)"
}