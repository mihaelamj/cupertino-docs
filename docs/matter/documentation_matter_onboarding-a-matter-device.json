{
  "abstract" : "Prepare your app to discover and control a Matter device.",
  "codeExamples" : [
    {
      "code" : "class MyStorage : NSObject, MTRStorage {\n    func storageData(forKey key: String) -> Data? {\n        \/\/ Return the data for the given key, if any.\n    }\n\n    func setStorageData(_ value: Data, forKey key: String) -> Bool {\n        \/\/ Store the data for the given key. Return true on success,\n        \/\/ false on failure.\n    }\n\n    func removeStorageData(forKey key: String) -> Bool {\n        \/\/ Remove the given key from the storage. Return true on success,\n        \/\/ false on failure.\n    }\n}\n\n\/\/ Obtain the controller factory.\nlet factory = MTRDeviceControllerFactory.sharedInstance()\n\nlet storage = MyStorage()\nlet factoryParams = MTRDeviceControllerFactoryParams(storage: storage)\n\n\/\/ Set `factoryParams.productAttestationAuthorityCertificates` to an\n\/\/ array of trusted Matter PAA certificates.\n\ndo {\n    \/\/ Start the controller factory.\n    try factory.start(factoryParams)\n} catch {\n    \/\/ Handle any errors.\n}",
      "language" : "swift"
    },
    {
      "code" : "guard let ipk = NSMutableData(length: 16) else {\n    return\n}\n\nlet status = SecRandomCopyBytes(kSecRandomDefault, ipk.count, ipk.mutableBytes)\n\nif status != errSecSuccess {\n    \/\/ Handle any errors.\n} else {\n    \/\/ Save the IPK in the keychain.\n}",
      "language" : "swift"
    },
    {
      "code" : "class MyCertificateIssuer : NSObject, MTROperationalCertificateIssuer\n{\n    func issueOperationalCertificate(forRequest csrInfo: MTROperationalCSRInfo, attestationInfo: MTRDeviceAttestationInfo, controller: MTRDeviceController) async throws -> MTROperationalCertificateChain {\n        \/\/ Issue your certificates here.\n    }\n    \n    var shouldSkipAttestationCertificateValidation: Bool = false    \n}\n\nlet params = MTRDeviceControllerStartupParams(ipk: ipk, operationalKeypair: myKeypair, operationalCertificate: operationalCertificate, intermediateCertificate: nil, rootCertificate: rootCertificate)\nparams.operationalCertificateIssuer = MyCertificateIssuer()\nparams.operationalCertificateIssuerQueue = DispatchQueue(label: \"Certificate issuer queue\")",
      "language" : "swift"
    },
    {
      "code" : "let params = MTRDeviceControllerStartupParams(ipk: ipk, \nfabricID: fabricID, nocSigner: myRootKeypair)",
      "language" : "swift"
    },
    {
      "code" : "let controller: MTRDeviceController\ndo {\n    controller = try factory.createController(onNewFabric: params)\n} catch {\n    do {\n        controller = try factory.createController(onExistingFabric: params)\n    } catch {\n        \/\/ Handle errors.\n    }\n}",
      "language" : "swift"
    },
    {
      "code" : "let nodeID = 1\n\nclass MyControllerDelegate : NSObject, MTRDeviceControllerDelegate {\n    func controller(_ controller: MTRDeviceController, \nstatusUpdate status: MTRCommissioningStatus) {\n        \/\/ Check for `MTRCommissioningStatus.failed`, and if so, handle it.\n    }\n\n    func controller(_ controller: MTRDeviceController, \ncommissioningSessionEstablishmentDone error: Error?) {\n        \/\/ Check for error and handle it.\n        do {\n            \/\/ `myDesiredNodeID` must match the node ID passed to \n            \/\/ `setupCommissioningSessionWithPayload`.\n            try controller.commissionNode(withID: nodeID,\ncommissioningParams: MTRCommissioningParameters())\n        } catch {\n            \/\/ Handle failure to start commissioning the node.\n        }\n\n        \/\/ Keep waiting for `commissioningComplete`.\n    }\n\n    func controller(_ controller: MTRDeviceController, \ncommissioningComplete error: Error?,\nnodeID: NSNumber?) {\n        \/\/ Check for error and handle it.\n        \/\/ If no error, node is commissioned with `nodeID` as its node ID.\n    }\n}\n\n\/\/ Create the delegate and set it.\nlet myDelegate = MyControllerDelegate()\ncontroller.setDevicecontrollerDelegate(myDelegate, queue: )\n\n\/\/ Create the `MTRSetupPayload` then start the commissioning.\nlet payload = MTRSetupPayload.init(onboardingPayload:onboardingPayload)\ncontroller.setupCommissioningSession(with: payload, newNodeID: nodeID)",
      "language" : "swift"
    }
  ],
  "contentHash" : "a39726638f52d6f4f8758c824e89e755ee48a897ffd274e1f942c62d20d6c2d6",
  "crawledAt" : "2025-12-06T03:06:33Z",
  "id" : "F979046E-9EFB-4EA4-ADFC-F1004E65E4D1",
  "kind" : "article",
  "language" : "swift",
  "module" : "Matter",
  "overview" : "## Overview\n\nIf you want your app to interact with a Matter device, you need to commission it. *Commissioning* a Matter device makes it a part of your *fabric*, which is a collection of Matter devices that communicate with each other.\n\nYou can securely commission a Matter device using certificates. Generate your own certificates using [doc:\/\/com.apple.matter\/documentation\/Matter\/MTRCertificates] or another process. Alternatively, you can provide a root [doc:\/\/com.apple.matter\/documentation\/Matter\/MTRKeypair], and the Matter framework generates certificates for you.\n\n### Obtain the onboarding payload\n\nThe [doc:\/\/com.apple.documentation\/documentation\/MatterSupport] framework provides an onboarding payload that you use to discover a device. Implement [doc:\/\/com.apple.documentation\/documentation\/MatterSupport\/MatterAddDeviceExtensionRequestHandler\/commissionDevice(in:onboardingPayload:commissioningID:)] to obtain the onboarding payload, then securely commission a Matter device using [doc:\/\/com.apple.matter\/documentation\/Matter\/MTRDeviceController]. For more information, see [doc:\/\/com.apple.documentation\/documentation\/MatterSupport\/Adding-Matter-support-to-your-ecosystem].\n\n### Provide persistent storage\n\nImplement [doc:\/\/com.apple.matter\/documentation\/Matter\/MTRStorage] so that the Matter framework can store and retrieve persistent data, then create an instance of that object and pass it to an instance of [doc:\/\/com.apple.matter\/documentation\/Matter\/MTRDeviceControllerFactoryParams]. Set the factory parameter object’s [doc:\/\/com.apple.matter\/documentation\/Matter\/MTRDeviceControllerFactoryParams\/productAttestationAuthorityCertificates] to an array of trusted Matter certificates.\n\nObtain a [doc:\/\/com.apple.matter\/documentation\/Matter\/MTRDeviceControllerFactory] shared instance, then call [doc:\/\/com.apple.matter\/documentation\/Matter\/MTRDeviceControllerFactory\/start(_:)] and handle any errors that may occur.\n\n### Set up security for the commissioning\n\nCreate an Identity Protection Key (IPK) and save it to iCloud Keychain. You need this IPK every time you start the controller for this fabric.\n\nNext, create [doc:\/\/com.apple.matter\/documentation\/Matter\/MTRDeviceControllerStartupParams]. If you’re providing your own operational, intermediate, and root certificates, implement [doc:\/\/com.apple.matter\/documentation\/Matter\/MTROperationalCertificateIssuer] and provide it to the controller so you can issue certificates to devices you commission.\n\nOtherwise, pass in the IPK, a fabric identifier of your choosing, and the root [doc:\/\/com.apple.matter\/documentation\/Matter\/MTRKeypair] you created earlier. In this case, the Matter framework creates the certificates.\n\nIn either case, set `params.vendorID` to your Connectivity Standards Alliance-assigned vendor identifier.\n\n### Commission the Matter device\n\nBefore you start commissioning, create a controller. If you’re creating a controller for this fabric for the first time, call [doc:\/\/com.apple.matter\/documentation\/Matter\/MTRDeviceControllerFactory\/createController(onNewFabric:)]; otherwise, call [doc:\/\/com.apple.matter\/documentation\/Matter\/MTRDeviceControllerFactory\/createController(onExistingFabric:)].\n\nImplement the delegate methods to receive callbacks as the commissioning progresses, then call [doc:\/\/com.apple.matter\/documentation\/Matter\/MTRDeviceController\/setDeviceControllerDelegate(_:queue:)] to register the delegate.\n\nCreate an [doc:\/\/com.apple.matter\/documentation\/Matter\/MTRSetupPayload] with [doc:\/\/com.apple.matter\/documentation\/Matter\/MTRSetupPayload\/init(onboardingPayload:)], then call [doc:\/\/com.apple.matter\/documentation\/Matter\/MTRDeviceController\/setupCommissioningSession(with:newNodeID:)] with the [doc:\/\/com.apple.matter\/documentation\/Matter\/MTRSetupPayload] object and the node ID to assign to the device. When the commissioning session is set up, the framework calls [doc:\/\/com.apple.matter\/documentation\/Matter\/MTRDeviceControllerDelegate\/controller(_:commissioningSessionEstablishmentDone:)].\n\nCall [doc:\/\/com.apple.matter\/documentation\/Matter\/MTRDeviceController\/commissionNode(withID:commissioningParams:)] with the node ID and commissioning parameters. When commissioning completes, the framework notifies your delegate with [doc:\/\/com.apple.matter\/documentation\/Matter\/MTRDevicePairingDelegate\/onCommissioningComplete(_:)].",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/Matter\/onboarding-a-matter-device\ncrawled: 2025-12-06T03:06:33Z\n---\n\n# Onboarding a Matter device\n\n**Article**\n\nPrepare your app to discover and control a Matter device.\n\n## Overview\n\nIf you want your app to interact with a Matter device, you need to commission it. *Commissioning* a Matter device makes it a part of your *fabric*, which is a collection of Matter devices that communicate with each other.\n\nYou can securely commission a Matter device using certificates. Generate your own certificates using [doc:\/\/com.apple.matter\/documentation\/Matter\/MTRCertificates] or another process. Alternatively, you can provide a root [doc:\/\/com.apple.matter\/documentation\/Matter\/MTRKeypair], and the Matter framework generates certificates for you.\n\n### Obtain the onboarding payload\n\nThe [doc:\/\/com.apple.documentation\/documentation\/MatterSupport] framework provides an onboarding payload that you use to discover a device. Implement [doc:\/\/com.apple.documentation\/documentation\/MatterSupport\/MatterAddDeviceExtensionRequestHandler\/commissionDevice(in:onboardingPayload:commissioningID:)] to obtain the onboarding payload, then securely commission a Matter device using [doc:\/\/com.apple.matter\/documentation\/Matter\/MTRDeviceController]. For more information, see [doc:\/\/com.apple.documentation\/documentation\/MatterSupport\/Adding-Matter-support-to-your-ecosystem].\n\n### Provide persistent storage\n\nImplement [doc:\/\/com.apple.matter\/documentation\/Matter\/MTRStorage] so that the Matter framework can store and retrieve persistent data, then create an instance of that object and pass it to an instance of [doc:\/\/com.apple.matter\/documentation\/Matter\/MTRDeviceControllerFactoryParams]. Set the factory parameter object’s [doc:\/\/com.apple.matter\/documentation\/Matter\/MTRDeviceControllerFactoryParams\/productAttestationAuthorityCertificates] to an array of trusted Matter certificates.\n\nObtain a [doc:\/\/com.apple.matter\/documentation\/Matter\/MTRDeviceControllerFactory] shared instance, then call [doc:\/\/com.apple.matter\/documentation\/Matter\/MTRDeviceControllerFactory\/start(_:)] and handle any errors that may occur.\n\n```swift\nclass MyStorage : NSObject, MTRStorage {\n    func storageData(forKey key: String) -> Data? {\n        \/\/ Return the data for the given key, if any.\n    }\n\n    func setStorageData(_ value: Data, forKey key: String) -> Bool {\n        \/\/ Store the data for the given key. Return true on success,\n        \/\/ false on failure.\n    }\n\n    func removeStorageData(forKey key: String) -> Bool {\n        \/\/ Remove the given key from the storage. Return true on success,\n        \/\/ false on failure.\n    }\n}\n\n\/\/ Obtain the controller factory.\nlet factory = MTRDeviceControllerFactory.sharedInstance()\n\nlet storage = MyStorage()\nlet factoryParams = MTRDeviceControllerFactoryParams(storage: storage)\n\n\/\/ Set `factoryParams.productAttestationAuthorityCertificates` to an\n\/\/ array of trusted Matter PAA certificates.\n\ndo {\n    \/\/ Start the controller factory.\n    try factory.start(factoryParams)\n} catch {\n    \/\/ Handle any errors.\n}\n```\n\n### Set up security for the commissioning\n\nCreate an Identity Protection Key (IPK) and save it to iCloud Keychain. You need this IPK every time you start the controller for this fabric.\n\n```swift\nguard let ipk = NSMutableData(length: 16) else {\n    return\n}\n\nlet status = SecRandomCopyBytes(kSecRandomDefault, ipk.count, ipk.mutableBytes)\n\nif status != errSecSuccess {\n    \/\/ Handle any errors.\n} else {\n    \/\/ Save the IPK in the keychain.\n}\n```\n\nNext, create [doc:\/\/com.apple.matter\/documentation\/Matter\/MTRDeviceControllerStartupParams]. If you’re providing your own operational, intermediate, and root certificates, implement [doc:\/\/com.apple.matter\/documentation\/Matter\/MTROperationalCertificateIssuer] and provide it to the controller so you can issue certificates to devices you commission.\n\n```swift\nclass MyCertificateIssuer : NSObject, MTROperationalCertificateIssuer\n{\n    func issueOperationalCertificate(forRequest csrInfo: MTROperationalCSRInfo, attestationInfo: MTRDeviceAttestationInfo, controller: MTRDeviceController) async throws -> MTROperationalCertificateChain {\n        \/\/ Issue your certificates here.\n    }\n    \n    var shouldSkipAttestationCertificateValidation: Bool = false    \n}\n\nlet params = MTRDeviceControllerStartupParams(ipk: ipk, operationalKeypair: myKeypair, operationalCertificate: operationalCertificate, intermediateCertificate: nil, rootCertificate: rootCertificate)\nparams.operationalCertificateIssuer = MyCertificateIssuer()\nparams.operationalCertificateIssuerQueue = DispatchQueue(label: \"Certificate issuer queue\")\n```\n\nOtherwise, pass in the IPK, a fabric identifier of your choosing, and the root [doc:\/\/com.apple.matter\/documentation\/Matter\/MTRKeypair] you created earlier. In this case, the Matter framework creates the certificates.\n\n```swift\nlet params = MTRDeviceControllerStartupParams(ipk: ipk, \nfabricID: fabricID, nocSigner: myRootKeypair)\n```\n\n\n\nIn either case, set `params.vendorID` to your Connectivity Standards Alliance-assigned vendor identifier.\n\n### Commission the Matter device\n\nBefore you start commissioning, create a controller. If you’re creating a controller for this fabric for the first time, call [doc:\/\/com.apple.matter\/documentation\/Matter\/MTRDeviceControllerFactory\/createController(onNewFabric:)]; otherwise, call [doc:\/\/com.apple.matter\/documentation\/Matter\/MTRDeviceControllerFactory\/createController(onExistingFabric:)].\n\n```swift\nlet controller: MTRDeviceController\ndo {\n    controller = try factory.createController(onNewFabric: params)\n} catch {\n    do {\n        controller = try factory.createController(onExistingFabric: params)\n    } catch {\n        \/\/ Handle errors.\n    }\n}\n```\n\nImplement the delegate methods to receive callbacks as the commissioning progresses, then call [doc:\/\/com.apple.matter\/documentation\/Matter\/MTRDeviceController\/setDeviceControllerDelegate(_:queue:)] to register the delegate.\n\nCreate an [doc:\/\/com.apple.matter\/documentation\/Matter\/MTRSetupPayload] with [doc:\/\/com.apple.matter\/documentation\/Matter\/MTRSetupPayload\/init(onboardingPayload:)], then call [doc:\/\/com.apple.matter\/documentation\/Matter\/MTRDeviceController\/setupCommissioningSession(with:newNodeID:)] with the [doc:\/\/com.apple.matter\/documentation\/Matter\/MTRSetupPayload] object and the node ID to assign to the device. When the commissioning session is set up, the framework calls [doc:\/\/com.apple.matter\/documentation\/Matter\/MTRDeviceControllerDelegate\/controller(_:commissioningSessionEstablishmentDone:)].\n\nCall [doc:\/\/com.apple.matter\/documentation\/Matter\/MTRDeviceController\/commissionNode(withID:commissioningParams:)] with the node ID and commissioning parameters. When commissioning completes, the framework notifies your delegate with [doc:\/\/com.apple.matter\/documentation\/Matter\/MTRDevicePairingDelegate\/onCommissioningComplete(_:)].\n\n```swift\nlet nodeID = 1\n\nclass MyControllerDelegate : NSObject, MTRDeviceControllerDelegate {\n    func controller(_ controller: MTRDeviceController, \nstatusUpdate status: MTRCommissioningStatus) {\n        \/\/ Check for `MTRCommissioningStatus.failed`, and if so, handle it.\n    }\n\n    func controller(_ controller: MTRDeviceController, \ncommissioningSessionEstablishmentDone error: Error?) {\n        \/\/ Check for error and handle it.\n        do {\n            \/\/ `myDesiredNodeID` must match the node ID passed to \n            \/\/ `setupCommissioningSessionWithPayload`.\n            try controller.commissionNode(withID: nodeID,\ncommissioningParams: MTRCommissioningParameters())\n        } catch {\n            \/\/ Handle failure to start commissioning the node.\n        }\n\n        \/\/ Keep waiting for `commissioningComplete`.\n    }\n\n    func controller(_ controller: MTRDeviceController, \ncommissioningComplete error: Error?,\nnodeID: NSNumber?) {\n        \/\/ Check for error and handle it.\n        \/\/ If no error, node is commissioned with `nodeID` as its node ID.\n    }\n}\n\n\/\/ Create the delegate and set it.\nlet myDelegate = MyControllerDelegate()\ncontroller.setDevicecontrollerDelegate(myDelegate, queue: )\n\n\/\/ Create the `MTRSetupPayload` then start the commissioning.\nlet payload = MTRSetupPayload.init(onboardingPayload:onboardingPayload)\ncontroller.setupCommissioningSession(with: payload, newNodeID: nodeID)\n```\n\n",
  "sections" : [

  ],
  "source" : "appleJSON",
  "title" : "Onboarding a Matter device",
  "url" : "https:\/\/developer.apple.com\/documentation\/Matter\/onboarding-a-matter-device"
}