{
  "abstract" : "An object to create and manage the tunnel provider’s VPN configuration.",
  "codeExamples" : [
    {
      "code" : "  <key>NETestAppMapping<\/key\n  <dict>\n      <key>3D7A07D8-97D0-4E5A-BB04-1EB82DD12A35<\/key>\n      <array>\n          <string>my.greatenterprise.SuperApp<\/string>\n      <\/array>\n  <dict>",
      "language" : "xml"
    }
  ],
  "conformsTo" : [
    "CVarArg",
    "CustomDebugStringConvertible",
    "CustomStringConvertible",
    "Equatable",
    "Hashable",
    "NSObjectProtocol"
  ],
  "contentHash" : "bb2981c19a4fbcfcefcff20749aa871148901225fd4033f57ffabb43b23ca563",
  "crawledAt" : "2025-12-04T09:17:16Z",
  "declaration" : {
    "code" : "class NETunnelProviderManager",
    "language" : "swift"
  },
  "id" : "72B00116-7E28-424B-BA04-2831D735564F",
  "inheritedBy" : [
    "NEAppProxyProviderManager"
  ],
  "kind" : "class",
  "language" : "swift",
  "module" : "Network Extension",
  "overview" : "## Overview\n\nLike its superclass [doc:\/\/com.apple.networkextension\/documentation\/NetworkExtension\/NEVPNManager], you use the [doc:\/\/com.apple.networkextension\/documentation\/NetworkExtension\/NETunnelProviderManager] class to configure and control VPN connections. The difference is that [doc:\/\/com.apple.networkextension\/documentation\/NetworkExtension\/NETunnelProviderManager] is used to to configure and control VPN connections that use a custom VPN protocol. The client side of the custom protocol implementation is implemented as a Packet Tunnel Provider extension. The Packet Tunnel Provider extension’s containing app uses [doc:\/\/com.apple.networkextension\/documentation\/NetworkExtension\/NETunnelProviderManager] to create and manage VPN configurations that use the custom protocol, and to control the VPN connections specified by the configurations.\n\nThe [doc:\/\/com.apple.networkextension\/documentation\/NetworkExtension\/NETunnelProviderManager] class inherits most of its functionality from the [doc:\/\/com.apple.networkextension\/documentation\/NetworkExtension\/NEVPNManager] class. The key differences to be aware of when using [doc:\/\/com.apple.networkextension\/documentation\/NetworkExtension\/NETunnelProviderManager] are:\n\n### Configuration Model\n\nEach [doc:\/\/com.apple.networkextension\/documentation\/NetworkExtension\/NETunnelProviderManager] instance corresponds to a single VPN configuration stored in the Network Extension preferences. Multiple VPN configurations can be created and managed by creating multiple [doc:\/\/com.apple.networkextension\/documentation\/NetworkExtension\/NETunnelProviderManager] instances.\n\nEach VPN configuration is associated with the app that created it. The app’s view of the Network Extension preferences is limited to include only the configurations that were created by the app.\n\nVPN configurations created using [doc:\/\/com.apple.networkextension\/documentation\/NetworkExtension\/NETunnelProviderManager] are classified as regular enterprise VPN configurations (as opposed to the Personal VPN configurations created by `NEVPNManager`). Only one enterprise VPN configuration can be enabled on the system at a time. If both a Personal VPN and an enterprise VPN are active on the system simultaneously, the enterprise VPN takes precedence, meaning that if the routes for the two VPNs conflict then the routes for the enterprise VPN will take precedence. The Personal VPN will remain active and connected while the enterprise VPN is active and connected, and any traffic that is routed to the Personal VPN and is not routed to the enterprise VPN will continue to traverse the Personal VPN.\n\n### Profile Configuration\n\nIt is possible to create Packet Tunnel Provider configurations using configuration profiles. See the `com.apple.vpn.managed` and `com.apple.vpn.managed.applayer` payload types in [https:\/\/developer.apple.com\/library\/archive\/featuredarticles\/iPhoneConfigurationProfileRef\/Introduction\/Introduction.html#\/\/apple_ref\/doc\/uid\/TP40010206]. To specify that a configuration created via a profile payload is associated with a particular app (and therefore allow the app to use `NETunnelProviderManager` to manage the configuration), the app’s bundle identifier must be set as the value of the `VPNSubType` field in the profile payload.\n\nCredential Storage\n\nVPN credentials such as private keys and passwords that are imported into the system via configuration profiles are stored in the keychain in a special access group called `com.apple.managed.vpn.shared`. In order to use these credentials the app and Packet Tunnel Provider extension must have the `com.apple.managed.vpn.shared` keychain access group entitlement.\n\n### Routing Network Data to the VPN\n\nThere are two ways or methods by which network data is routed to the VPN:\n\nRouting by Destination IP\n\nThis is the default routing method. The IP routes are specified by the Packet Tunnel Provider extension at the time that the VPN tunnel is fully established. See [doc:\/\/com.apple.networkextension\/documentation\/NetworkExtension\/NETunnelProvider] for more details.\n\nPer-App VPN\n\nThe only way to configure Per-App VPN is by enrolling the device in a Mobile Device Management (MDM) system, and then linking apps that are managed by the MDM system with a VPN configuration created from a `com.apple.vpn.managed.applayer` configuration profile payload. Here are some details about how this works:\n\nThe MDM client running on the device creates one app rule in the VPN configuration for each managed app that is linked to the VPN configuration via the `VPNUUID` app attribute.\n\nPer-App VPN On Demand\n\nThe Per-App VPN app rules serve as both routing rules and VPN On Demand rules. This is in contrast to IP destination-based routing, where the VPN On Demand rules are configured separately from the routing rules. When the `onDemandEnabled` property is set to [doc:\/\/com.apple.documentation\/documentation\/Swift\/true] and an app that matches the Per-App VPN rules attempts to communicate over the network, the VPN will be started automatically.\n\nIt is possible to set regular VPN On Demand rules in a Per-App VPN configuration via the [doc:\/\/com.apple.networkextension\/documentation\/NetworkExtension\/NEVPNManager\/onDemandRules] property, but only [doc:\/\/com.apple.networkextension\/documentation\/NetworkExtension\/NEOnDemandRuleDisconnect] rules will be used. When a `NEOnDemandRuleDisconnect` rule matches, apps which match the Per-App VPN rules will bypass the VPN.\n\nTesting Per-App VPN\n\nAs described above, an MDM server is required to configure Per-App VPN for VPN apps distributed via the App Store. To make testing Per-App VPN easier, it is possible to configure Per-App VPN without an MDM server during development by using the `NETestAppMapping` `Info.plist` key.\n\nHere is what you need to do to make use of this capability:\n\nThe system will create one app rule in the VPN configuration for each bundle identifier listed in the array in the `NETestAppMapping` dictionary corresponding to the value of the `VPNUUID` field in the `com.apple.vpn.managed.applayer` payload.",
  "platforms" : [
    "iOS",
    "iPadOS",
    "Mac Catalyst",
    "macOS",
    "tvOS",
    "visionOS"
  ],
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/NetworkExtension\/NETunnelProviderManager\ncrawled: 2025-12-04T09:17:16Z\n---\n\n# NETunnelProviderManager\n\n**Class**\n\nAn object to create and manage the tunnel provider’s VPN configuration.\n\n## Declaration\n\n```swift\nclass NETunnelProviderManager\n```\n\n## Overview\n\nLike its superclass [doc:\/\/com.apple.networkextension\/documentation\/NetworkExtension\/NEVPNManager], you use the [doc:\/\/com.apple.networkextension\/documentation\/NetworkExtension\/NETunnelProviderManager] class to configure and control VPN connections. The difference is that [doc:\/\/com.apple.networkextension\/documentation\/NetworkExtension\/NETunnelProviderManager] is used to to configure and control VPN connections that use a custom VPN protocol. The client side of the custom protocol implementation is implemented as a Packet Tunnel Provider extension. The Packet Tunnel Provider extension’s containing app uses [doc:\/\/com.apple.networkextension\/documentation\/NetworkExtension\/NETunnelProviderManager] to create and manage VPN configurations that use the custom protocol, and to control the VPN connections specified by the configurations.\n\nThe [doc:\/\/com.apple.networkextension\/documentation\/NetworkExtension\/NETunnelProviderManager] class inherits most of its functionality from the [doc:\/\/com.apple.networkextension\/documentation\/NetworkExtension\/NEVPNManager] class. The key differences to be aware of when using [doc:\/\/com.apple.networkextension\/documentation\/NetworkExtension\/NETunnelProviderManager] are:\n\n- The [doc:\/\/com.apple.networkextension\/documentation\/NetworkExtension\/NEVPNManager\/protocolConfiguration] property can only be set to instances of the [doc:\/\/com.apple.networkextension\/documentation\/NetworkExtension\/NETunnelProviderProtocol] class\n- The [doc:\/\/com.apple.networkextension\/documentation\/NetworkExtension\/NEVPNManager\/connection] read-only property is set to an instance of the [doc:\/\/com.apple.networkextension\/documentation\/NetworkExtension\/NETunnelProviderSession] class.\n\n\n\n### Configuration Model\n\nEach [doc:\/\/com.apple.networkextension\/documentation\/NetworkExtension\/NETunnelProviderManager] instance corresponds to a single VPN configuration stored in the Network Extension preferences. Multiple VPN configurations can be created and managed by creating multiple [doc:\/\/com.apple.networkextension\/documentation\/NetworkExtension\/NETunnelProviderManager] instances.\n\nEach VPN configuration is associated with the app that created it. The app’s view of the Network Extension preferences is limited to include only the configurations that were created by the app.\n\nVPN configurations created using [doc:\/\/com.apple.networkextension\/documentation\/NetworkExtension\/NETunnelProviderManager] are classified as regular enterprise VPN configurations (as opposed to the Personal VPN configurations created by `NEVPNManager`). Only one enterprise VPN configuration can be enabled on the system at a time. If both a Personal VPN and an enterprise VPN are active on the system simultaneously, the enterprise VPN takes precedence, meaning that if the routes for the two VPNs conflict then the routes for the enterprise VPN will take precedence. The Personal VPN will remain active and connected while the enterprise VPN is active and connected, and any traffic that is routed to the Personal VPN and is not routed to the enterprise VPN will continue to traverse the Personal VPN.\n\n### Profile Configuration\n\nIt is possible to create Packet Tunnel Provider configurations using configuration profiles. See the `com.apple.vpn.managed` and `com.apple.vpn.managed.applayer` payload types in [https:\/\/developer.apple.com\/library\/archive\/featuredarticles\/iPhoneConfigurationProfileRef\/Introduction\/Introduction.html#\/\/apple_ref\/doc\/uid\/TP40010206]. To specify that a configuration created via a profile payload is associated with a particular app (and therefore allow the app to use `NETunnelProviderManager` to manage the configuration), the app’s bundle identifier must be set as the value of the `VPNSubType` field in the profile payload.\n\nCredential Storage\n\nVPN credentials such as private keys and passwords that are imported into the system via configuration profiles are stored in the keychain in a special access group called `com.apple.managed.vpn.shared`. In order to use these credentials the app and Packet Tunnel Provider extension must have the `com.apple.managed.vpn.shared` keychain access group entitlement.\n\n\n\n### Routing Network Data to the VPN\n\nThere are two ways or methods by which network data is routed to the VPN:\n\n- By destination IP address\n- By source application (Per-App VPN)\n\nRouting by Destination IP\n\nThis is the default routing method. The IP routes are specified by the Packet Tunnel Provider extension at the time that the VPN tunnel is fully established. See [doc:\/\/com.apple.networkextension\/documentation\/NetworkExtension\/NETunnelProvider] for more details.\n\nPer-App VPN\n\nThe only way to configure Per-App VPN is by enrolling the device in a Mobile Device Management (MDM) system, and then linking apps that are managed by the MDM system with a VPN configuration created from a `com.apple.vpn.managed.applayer` configuration profile payload. Here are some details about how this works:\n\n- The MDM server creates a configuration profile containing a `com.apple.vpn.managed.applayer` payload. The `com.apple.vpn.managed.applayer` payload contains all of the usual VPN configuration profile payload fields, and also must contain a `VPNUUID` field, containing a unique string defined by the MDM server.\n- If the VPN provider extension is a Packet Tunnel Provider extension, then the `ProviderType` field in the `com.apple.vpn.managed.applayer` payload should be set to `packet-tunnel`. If the VPN provider extension is an App Proxy Provider extension, then the `ProviderType` field in the `com.apple.vpn.managed.applayer` should be set to `app-proxy`.\n- The MDM server adds a `VPNUUID` key to the attributes dictionary of all of the managed apps that will use the VPN. The value of the `VPNUUID` key must be set to the same unique string contained in the `VPNUUID` field in the `com.apple.vpn.managed.applayer` payload.\n- The MDM server pushes the configuration profile and the managed apps to the iOS device using the MDM protocol.\n\nThe MDM client running on the device creates one app rule in the VPN configuration for each managed app that is linked to the VPN configuration via the `VPNUUID` app attribute.\n\n\n\nPer-App VPN On Demand\n\nThe Per-App VPN app rules serve as both routing rules and VPN On Demand rules. This is in contrast to IP destination-based routing, where the VPN On Demand rules are configured separately from the routing rules. When the `onDemandEnabled` property is set to [doc:\/\/com.apple.documentation\/documentation\/Swift\/true] and an app that matches the Per-App VPN rules attempts to communicate over the network, the VPN will be started automatically.\n\nIt is possible to set regular VPN On Demand rules in a Per-App VPN configuration via the [doc:\/\/com.apple.networkextension\/documentation\/NetworkExtension\/NEVPNManager\/onDemandRules] property, but only [doc:\/\/com.apple.networkextension\/documentation\/NetworkExtension\/NEOnDemandRuleDisconnect] rules will be used. When a `NEOnDemandRuleDisconnect` rule matches, apps which match the Per-App VPN rules will bypass the VPN.\n\nTesting Per-App VPN\n\nAs described above, an MDM server is required to configure Per-App VPN for VPN apps distributed via the App Store. To make testing Per-App VPN easier, it is possible to configure Per-App VPN without an MDM server during development by using the `NETestAppMapping` `Info.plist` key.\n\n\n\nHere is what you need to do to make use of this capability:\n\n- Create a configuration profile containing a `com.apple.vpn.managed.applayer` payload as described in [https:\/\/developer.apple.com\/library\/archive\/featuredarticles\/iPhoneConfigurationProfileRef\/Introduction\/Introduction.html#\/\/apple_ref\/doc\/uid\/TP40010206]. In addition to all of the usual VPN configuration payload fields, the payload must also contain a `VPNUUID` field, containing a unique string defined by you.\n- Add the `NETestAppMapping` key to your app’s `Info.plist`. The value of this key should be a dictionary that maps `VPNUUID` values to arrays of app bundle identifiers. Here is a sample:\n\n```xml\n  <key>NETestAppMapping<\/key\n  <dict>\n      <key>3D7A07D8-97D0-4E5A-BB04-1EB82DD12A35<\/key>\n      <array>\n          <string>my.greatenterprise.SuperApp<\/string>\n      <\/array>\n  <dict>\n```\n\n- Rebuild the app.\n- Install the app and the configuration profile on the device.\n\nThe system will create one app rule in the VPN configuration for each bundle identifier listed in the array in the `NETestAppMapping` dictionary corresponding to the value of the `VPNUUID` field in the `com.apple.vpn.managed.applayer` payload.\n\n## Managing tunnel configurations\n\n- **loadAllFromPreferences(completionHandler:)**: Read all of the VPN configurations created by the calling app that have previously been saved to the Network Extension preferences.\n- **copyAppRules()**: Returns a copy of the app rules currently set in the configuration.\n\n## Getting tunnel configuration properties\n\n- **routingMethod**: The method that the system uses to route network traffic to the tunnel.\n- **NETunnelProviderRoutingMethod**\n\n## Configuring a per-app VPN\n\n- **forPerAppVPN()**: Returns a tunnel provider manager for managing a per-app VPN configuration.\n- **appRules**: The rules for specific apps in a per-app VPN.\n- **excludedDomains**: The domains that the system excludes from a per-app VPN.\n- **associatedDomains**: The domains that the system routes network traffic through for a per-app VPN.\n- **calendarDomains**: The calendar servers that the system routes connections from the Calendar app through for a per-app VPN.\n- **contactsDomains**: The contacts servers that the system routes connections from the Contacts app through for a per-app VPN.\n- **mailDomains**: The mail servers that the system routes connections from the Mail app through for a per-app VPN.\n- **safariDomains**: The website domains that the system routes connections from the Safari app through a per-app VPN.\n\n## VPN configuration\n\n- **NEAppProxyProviderManager**: An object to create and manage the app proxy provider’s VPN configuration.\n- **NEVPNManager**: An object to create and manage a Personal VPN configuration.\n- **NETunnelProviderProtocol**: Configuration parameters for a VPN tunnel.\n- **NEAppRule**: The identity of an app whose traffic is to be routed through the tunnel.\n- **VPN On Demand Rules**: Set up VPN On Demand.\n\n## Inherits From\n\n- NEVPNManager\n\n## Inherited By\n\n- NEAppProxyProviderManager\n\n## Conforms To\n\n- CVarArg\n- CustomDebugStringConvertible\n- CustomStringConvertible\n- Equatable\n- Hashable\n- NSObjectProtocol\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Read all of the VPN configurations created by the calling app that have previously been saved to the Network Extension preferences.",
          "name" : "loadAllFromPreferences(completionHandler:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/NetworkExtension\/NETunnelProviderManager\/loadAllFromPreferences(completionHandler:)"
        },
        {
          "description" : "Returns a copy of the app rules currently set in the configuration.",
          "name" : "copyAppRules()",
          "url" : "https:\/\/developer.apple.com\/documentation\/NetworkExtension\/NETunnelProviderManager\/copyAppRules()"
        }
      ],
      "title" : "Managing tunnel configurations"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "The method that the system uses to route network traffic to the tunnel.",
          "name" : "routingMethod",
          "url" : "https:\/\/developer.apple.com\/documentation\/NetworkExtension\/NETunnelProviderManager\/routingMethod"
        },
        {
          "description" : "",
          "name" : "NETunnelProviderRoutingMethod",
          "url" : "https:\/\/developer.apple.com\/documentation\/NetworkExtension\/NETunnelProviderRoutingMethod"
        }
      ],
      "title" : "Getting tunnel configuration properties"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "Returns a tunnel provider manager for managing a per-app VPN configuration.",
          "name" : "forPerAppVPN()",
          "url" : "https:\/\/developer.apple.com\/documentation\/NetworkExtension\/NETunnelProviderManager\/forPerAppVPN()"
        },
        {
          "description" : "The rules for specific apps in a per-app VPN.",
          "name" : "appRules",
          "url" : "https:\/\/developer.apple.com\/documentation\/NetworkExtension\/NETunnelProviderManager\/appRules"
        },
        {
          "description" : "The domains that the system excludes from a per-app VPN.",
          "name" : "excludedDomains",
          "url" : "https:\/\/developer.apple.com\/documentation\/NetworkExtension\/NETunnelProviderManager\/excludedDomains"
        },
        {
          "description" : "The domains that the system routes network traffic through for a per-app VPN.",
          "name" : "associatedDomains",
          "url" : "https:\/\/developer.apple.com\/documentation\/NetworkExtension\/NETunnelProviderManager\/associatedDomains"
        },
        {
          "description" : "The calendar servers that the system routes connections from the Calendar app through for a per-app VPN.",
          "name" : "calendarDomains",
          "url" : "https:\/\/developer.apple.com\/documentation\/NetworkExtension\/NETunnelProviderManager\/calendarDomains"
        },
        {
          "description" : "The contacts servers that the system routes connections from the Contacts app through for a per-app VPN.",
          "name" : "contactsDomains",
          "url" : "https:\/\/developer.apple.com\/documentation\/NetworkExtension\/NETunnelProviderManager\/contactsDomains"
        },
        {
          "description" : "The mail servers that the system routes connections from the Mail app through for a per-app VPN.",
          "name" : "mailDomains",
          "url" : "https:\/\/developer.apple.com\/documentation\/NetworkExtension\/NETunnelProviderManager\/mailDomains"
        },
        {
          "description" : "The website domains that the system routes connections from the Safari app through a per-app VPN.",
          "name" : "safariDomains",
          "url" : "https:\/\/developer.apple.com\/documentation\/NetworkExtension\/NETunnelProviderManager\/safariDomains"
        }
      ],
      "title" : "Configuring a per-app VPN"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "An object to create and manage the app proxy provider’s VPN configuration.",
          "name" : "NEAppProxyProviderManager",
          "url" : "https:\/\/developer.apple.com\/documentation\/NetworkExtension\/NEAppProxyProviderManager"
        },
        {
          "description" : "An object to create and manage a Personal VPN configuration.",
          "name" : "NEVPNManager",
          "url" : "https:\/\/developer.apple.com\/documentation\/NetworkExtension\/NEVPNManager"
        },
        {
          "description" : "Configuration parameters for a VPN tunnel.",
          "name" : "NETunnelProviderProtocol",
          "url" : "https:\/\/developer.apple.com\/documentation\/NetworkExtension\/NETunnelProviderProtocol"
        },
        {
          "description" : "The identity of an app whose traffic is to be routed through the tunnel.",
          "name" : "NEAppRule",
          "url" : "https:\/\/developer.apple.com\/documentation\/NetworkExtension\/NEAppRule"
        },
        {
          "description" : "Set up VPN On Demand.",
          "name" : "VPN On Demand Rules",
          "url" : "https:\/\/developer.apple.com\/documentation\/NetworkExtension\/vpn-on-demand-rules"
        }
      ],
      "title" : "VPN configuration"
    },
    {
      "content" : "",
      "items" : [
        {
          "name" : "NEVPNManager"
        }
      ],
      "title" : "Inherits From"
    }
  ],
  "source" : "appleJSON",
  "title" : "NETunnelProviderManager",
  "url" : "https:\/\/developer.apple.com\/documentation\/NetworkExtension\/NETunnelProviderManager"
}