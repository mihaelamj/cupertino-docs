{
  "abstract" : "Correlate GPU events with CPU timelines by calculating the CPU time equivalents for GPU timestamps.",
  "codeExamples" : [

  ],
  "contentHash" : "a4812a255d5d35ca2ebf87a2dfd196e99798e25f7fbdc8a1cf0e8d7b49d4b6be",
  "crawledAt" : "2025-12-02T19:36:16Z",
  "id" : "3041A07A-4BCF-4FA2-B8B2-59F5B2806927",
  "kind" : "article",
  "language" : "swift",
  "module" : "Metal",
  "overview" : "## Overview\n\nSampling runtime data from a GPU can provide a valuable insight to your app’s GPU performance (see [doc:\/\/com.apple.metal\/documentation\/Metal\/sampling-gpu-data-into-counter-sample-buffers]). GPU timestamps in particular can isolate runtime issues by showing what the GPU is working on relative to what the CPU is doing. However, the timestamp values your app samples from a GPU don’t typically match a CPU’s timestamps because each uses different hardware to measure time. This means you can’t always compare GPU timestamps directly with CPU timestamps.\n\nYour app can convert a GPU’s timestamps to CPU time by sampling both clocks at the same time to establish a common baseline of time. Establish that baseline by sampling both the GPU and CPU clocks at least twice. Typically, apps sample the timestamps at least twice, once before and once after the GPU stores its timestamp data in an [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCounterSampleBuffer]. Your app needs the baseline to accurately convert the GPU’s timestamp data it *resolves* from a counter sample buffer. See [doc:\/\/com.apple.metal\/documentation\/Metal\/converting-a-gpus-counter-data-into-a-readable-format] for instructions about resolving data within a counter sample buffer.\n\n### Create a reference baseline in time by sampling the CPU and GPU timestamps twice\n\nYou can sample timestamps from the GPU and CPU at the same time by calling [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLDevice] instance’s [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLDevice\/sampleTimestamps()] method in Swift, or the [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLDevice\/sampleTimestamps:gpuTimestamp:] method in Objective-C.\n\nYou can sample the initial timestamps any time before a pass, such as at launch time or when your app creates a command buffer.\n\nCalculate the time span by sampling the GPU and CPU timestamps again after the command buffer completes.\n\nThe span of time establishes a baseline that your app needs to convert timestamps from a counter sample buffer into real-world time values.\n\nFor example, the code below samples the GPU and CPU timestamps before and immediately after the GPU runs the command buffer.\n\nYou can find implmentations for the methods that this code example refers to in this article, except for the `resolveSampleBuffer` method, which comes from an earlier article in this series, [doc:\/\/com.apple.metal\/documentation\/Metal\/converting-a-gpus-counter-data-into-a-readable-format].\n\n### Convert GPU timestamps to CPU time\n\nCalculate the CPU time equivalent of a GPU timestamp by mathematically converting it using two sets of your app’s reference GPU and CPU timestamps.\n\nConvert a GPU timestamp by following these steps:\n\nThe method returns a value in microseconds, but you can convert the value to a unit of time that you prefer.\n\nSimilarly, you can calculate the CPU time equivalent between two GPU timestamps by applying the latter calculations to the time span between them.\n\nThis method is useful to show the duration between the beginning and end of an event window. For example, you might use this to see the duration of the vertex and fragment stages of a render pass.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/Metal\/converting-gpu-timestamps-into-cpu-time\ncrawled: 2025-12-02T19:36:16Z\n---\n\n# Converting GPU timestamps into CPU time\n\n**Article**\n\nCorrelate GPU events with CPU timelines by calculating the CPU time equivalents for GPU timestamps.\n\n## Overview\n\nSampling runtime data from a GPU can provide a valuable insight to your app’s GPU performance (see [doc:\/\/com.apple.metal\/documentation\/Metal\/sampling-gpu-data-into-counter-sample-buffers]). GPU timestamps in particular can isolate runtime issues by showing what the GPU is working on relative to what the CPU is doing. However, the timestamp values your app samples from a GPU don’t typically match a CPU’s timestamps because each uses different hardware to measure time. This means you can’t always compare GPU timestamps directly with CPU timestamps.\n\nYour app can convert a GPU’s timestamps to CPU time by sampling both clocks at the same time to establish a common baseline of time. Establish that baseline by sampling both the GPU and CPU clocks at least twice. Typically, apps sample the timestamps at least twice, once before and once after the GPU stores its timestamp data in an [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCounterSampleBuffer]. Your app needs the baseline to accurately convert the GPU’s timestamp data it *resolves* from a counter sample buffer. See [doc:\/\/com.apple.metal\/documentation\/Metal\/converting-a-gpus-counter-data-into-a-readable-format] for instructions about resolving data within a counter sample buffer.\n\n### Create a reference baseline in time by sampling the CPU and GPU timestamps twice\n\nYou can sample timestamps from the GPU and CPU at the same time by calling [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLDevice] instance’s [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLDevice\/sampleTimestamps()] method in Swift, or the [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLDevice\/sampleTimestamps:gpuTimestamp:] method in Objective-C.\n\n\n\nYou can sample the initial timestamps any time before a pass, such as at launch time or when your app creates a command buffer.\n\n\n\nCalculate the time span by sampling the GPU and CPU timestamps again after the command buffer completes.\n\n\n\nThe span of time establishes a baseline that your app needs to convert timestamps from a counter sample buffer into real-world time values.\n\n\n\nFor example, the code below samples the GPU and CPU timestamps before and immediately after the GPU runs the command buffer.\n\n\n\nYou can find implmentations for the methods that this code example refers to in this article, except for the `resolveSampleBuffer` method, which comes from an earlier article in this series, [doc:\/\/com.apple.metal\/documentation\/Metal\/converting-a-gpus-counter-data-into-a-readable-format].\n\n### Convert GPU timestamps to CPU time\n\nCalculate the CPU time equivalent of a GPU timestamp by mathematically converting it using two sets of your app’s reference GPU and CPU timestamps.\n\n\n\nConvert a GPU timestamp by following these steps:\n\n1. Subtract the GPU reference starting time from the GPU timestamp.\n2. Divide the difference by the total GPU reference time span.\n3. Multiply the product by the total CPU reference time span.\n4. Add the starting CPU reference time.\n\n\n\nThe method returns a value in microseconds, but you can convert the value to a unit of time that you prefer.\n\nSimilarly, you can calculate the CPU time equivalent between two GPU timestamps by applying the latter calculations to the time span between them.\n\n\n\nThis method is useful to show the duration between the beginning and end of an event window. For example, you might use this to see the duration of the vertex and fragment stages of a render pass.\n\n\n\n## Timestamp data\n\n- **MTLTimestamp**: The number of nanoseconds for a point in absolute time or Mach absolute time.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "The number of nanoseconds for a point in absolute time or Mach absolute time.",
          "name" : "MTLTimestamp",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTLTimestamp"
        }
      ],
      "title" : "Timestamp data"
    }
  ],
  "source" : "appleJSON",
  "title" : "Converting GPU timestamps into CPU time",
  "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/converting-gpu-timestamps-into-cpu-time"
}