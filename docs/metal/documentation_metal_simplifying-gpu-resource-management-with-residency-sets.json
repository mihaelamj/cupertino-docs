{
  "abstract" : "Organize your resources into groups and influence when they become accessible to the GPU.",
  "codeExamples" : [

  ],
  "contentHash" : "90cf30c9fbd6c84a62b8917b01cc0b7326d0ed7149c74b6feac55e89cf78517f",
  "crawledAt" : "2025-12-04T00:47:30Z",
  "id" : "F71E9504-7186-4DEA-AC56-C39E591ACBF7",
  "kind" : "article",
  "language" : "swift",
  "module" : "Metal",
  "overview" : "## Overview\n\nMetal apps typically create resources, such as textures and buffers, so that their shaders can work with data as they run on the GPU. These resources need to be in memory that’s accessible to the GPU, or *resident*, so the shaders can access their data.\n\nA *residency set* is one way you tell Metal which resources your app needs to make resident. You do this by creating [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLResidencySet] instances, managing which resource *allocations* they contain, and attaching them to command buffers or command queues. Resource allocation types conform to the [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLAllocation] protocol, including [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLBuffer], [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLTexture], and [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLHeap].\n\nThe other way to tell Metal which resources it needs to make resident is by calling a command encoder’s methods. However, these methods can impact an app’s runtime performance because each call incurs some CPU overhead. Additionally, Metal makes those resources resident right after your app commits the command buffer, which can delay when the GPU starts working on it. This overhead adds up as the number of resources increases, especially in apps that use many resources for each frame, such as games.\n\nResidency sets help you mitigate these performance issues and delays. With a residency set, your app can:\n\nYou can attach each residency set to a command buffer or an entire command queue. Attaching a residency set to a command buffer removes the need to tell each of its command encoders which resources they need to use. Similarly, attaching a residency set to a command queue removes the need to attach that residency set to each of its command buffers.\n\n### Make a residency set and add allocations to it\n\nCreate a residency set by configuring an [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLResidencySetDescriptor] instance and passing it to the [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLDevice\/makeResidencySet(descriptor:)] method of an [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLDevice].\n\nAdd an individual allocation to the [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLResidencySet] instance by calling its [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLResidencySet\/addAllocation(_:)] method, or add multiple allocations with its [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLResidencySet\/addAllocations(_:)] method.\n\nA residency set handles redundant allocations by ignoring instances that already have an entry in the set.\n\nFinalize and apply the pending changes to the residency set by calling its [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLResidencySet\/commit()] method.\n\nSee [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLResidencySet] for information about working with residency sets, including:\n\n### Attach a residency set to a command buffer\n\nConnect an [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandBuffer] instance to a residency set’s resource allocations by attaching the set to the command buffer with the [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandBuffer\/useResidencySet(_:)] or [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandBuffer\/useResidencySets(_:)] method. Every command buffer can maintain a list of up to 32 different residency sets.\n\nMetal makes the allocations in the set resident before the GPU runs the passes in the command buffer. This includes all resources that come from an [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLHeap] allocation that’s in the residency set.\n\nYou don’t need to call the following methods for any allocation in a residency set that you associate with the command buffer:\n\nAttaching a residency set to a command buffer takes less CPU runtime and overhead than calling these methods for each encoder within a command buffer.\n\n### Attach a residency set to a command queue and its command buffers\n\nConnect an [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandQueue] instance to a residency set’s resource allocations by attaching the set to the queue with its [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandQueue\/addResidencySet(_:)] or [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandQueue\/addResidencySets(_:)] method. Every command queue can maintain a list of up to 32 different residency sets.\n\nWhen your app calls a command buffer’s [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandBuffer\/commit()] method, Metal automatically attaches the owning queue’s current residency sets to the command buffer.\n\nAttaching a residency set to a command queue is more efficient than attaching that residency set to multiple command buffers from that queue.\n\n### Detach a residency set from a command queue\n\nWhen your command queue doesn’t need the resources of a residency set, disconnect it from the queue by calling the [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandQueue\/removeResidencySet(_:)] or [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandQueue\/removeResidencySets(_:)] method.\n\nThe residency set remains attached to any of the queue’s command buffers already in-flight with a status equal to [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandBufferStatus\/committed] or [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandBufferStatus\/scheduled].\n\n### Request residency ahead of time\n\nTo make allocations in a residency set resident (for allocations that aren’t already resident), the Metal framework needs to do some work on the CPU. By default, Metal does this work when you call the [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandBuffer\/commit()] method of the first command buffer that’s using the residency set. Making the allocations resident at this time can delay the graphics driver from submitting the command buffer to the GPU.\n\nTo help minimize the time between committing a command buffer and when the GPU starts working on it, ask Metal to do the work beforehand. You do this by calling a residency set’s [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLResidencySet\/requestResidency()] method.\n\nCall this method at any time before you commit the first command buffer that relies on the allocations in the residency set. This can be any noncritical moment when your app can afford the CPU time the framework needs to prepare the applicable allocations for residency. For example, you can call this method at launch or during an app state change.\n\n### Conclude residency for the resources\n\nWhen your app no longer needs a residency set’s allocations to be accessible to the GPU, call the [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLResidencySet\/endResidency()] method, which effectively releases them.\n\nThe method tells Metal that it can reuse the memory backing that residency set’s allocations for your app’s other residency sets, or for another app.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/Metal\/simplifying-gpu-resource-management-with-residency-sets\ncrawled: 2025-12-04T00:47:30Z\n---\n\n# Simplifying GPU resource management with residency sets\n\n**Article**\n\nOrganize your resources into groups and influence when they become accessible to the GPU.\n\n## Overview\n\nMetal apps typically create resources, such as textures and buffers, so that their shaders can work with data as they run on the GPU. These resources need to be in memory that’s accessible to the GPU, or *resident*, so the shaders can access their data.\n\nA *residency set* is one way you tell Metal which resources your app needs to make resident. You do this by creating [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLResidencySet] instances, managing which resource *allocations* they contain, and attaching them to command buffers or command queues. Resource allocation types conform to the [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLAllocation] protocol, including [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLBuffer], [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLTexture], and [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLHeap].\n\nThe other way to tell Metal which resources it needs to make resident is by calling a command encoder’s methods. However, these methods can impact an app’s runtime performance because each call incurs some CPU overhead. Additionally, Metal makes those resources resident right after your app commits the command buffer, which can delay when the GPU starts working on it. This overhead adds up as the number of resources increases, especially in apps that use many resources for each frame, such as games.\n\nResidency sets help you mitigate these performance issues and delays. With a residency set, your app can:\n\n- Add multiple allocations with less CPU overhead than with a command encoder’s methods\n- Make its allocations resident at the same time\n- Request that Metal make its resources resident ahead of time\n- Keep allocations resident indefinitely\n- Remove all allocations, or a selection of them, which Metal marks as candidates that it can make nonresident, if necessary\n\nYou can attach each residency set to a command buffer or an entire command queue. Attaching a residency set to a command buffer removes the need to tell each of its command encoders which resources they need to use. Similarly, attaching a residency set to a command queue removes the need to attach that residency set to each of its command buffers.\n\n### Make a residency set and add allocations to it\n\nCreate a residency set by configuring an [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLResidencySetDescriptor] instance and passing it to the [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLDevice\/makeResidencySet(descriptor:)] method of an [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLDevice].\n\n\n\nAdd an individual allocation to the [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLResidencySet] instance by calling its [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLResidencySet\/addAllocation(_:)] method, or add multiple allocations with its [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLResidencySet\/addAllocations(_:)] method.\n\n\n\nA residency set handles redundant allocations by ignoring instances that already have an entry in the set.\n\n\n\nFinalize and apply the pending changes to the residency set by calling its [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLResidencySet\/commit()] method.\n\n\n\nSee [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLResidencySet] for information about working with residency sets, including:\n\n- Inspecting current allocations\n- Adding and removing allocations over time\n- Accounting for resource hazards\n\n### Attach a residency set to a command buffer\n\nConnect an [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandBuffer] instance to a residency set’s resource allocations by attaching the set to the command buffer with the [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandBuffer\/useResidencySet(_:)] or [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandBuffer\/useResidencySets(_:)] method. Every command buffer can maintain a list of up to 32 different residency sets.\n\n\n\nMetal makes the allocations in the set resident before the GPU runs the passes in the command buffer. This includes all resources that come from an [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLHeap] allocation that’s in the residency set.\n\nYou don’t need to call the following methods for any allocation in a residency set that you associate with the command buffer:\n\n\n\nAttaching a residency set to a command buffer takes less CPU runtime and overhead than calling these methods for each encoder within a command buffer.\n\n### Attach a residency set to a command queue and its command buffers\n\nConnect an [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandQueue] instance to a residency set’s resource allocations by attaching the set to the queue with its [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandQueue\/addResidencySet(_:)] or [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandQueue\/addResidencySets(_:)] method. Every command queue can maintain a list of up to 32 different residency sets.\n\n\n\nWhen your app calls a command buffer’s [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandBuffer\/commit()] method, Metal automatically attaches the owning queue’s current residency sets to the command buffer.\n\n\n\nAttaching a residency set to a command queue is more efficient than attaching that residency set to multiple command buffers from that queue.\n\n### Detach a residency set from a command queue\n\nWhen your command queue doesn’t need the resources of a residency set, disconnect it from the queue by calling the [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandQueue\/removeResidencySet(_:)] or [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandQueue\/removeResidencySets(_:)] method.\n\n\n\nThe residency set remains attached to any of the queue’s command buffers already in-flight with a status equal to [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandBufferStatus\/committed] or [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandBufferStatus\/scheduled].\n\n### Request residency ahead of time\n\nTo make allocations in a residency set resident (for allocations that aren’t already resident), the Metal framework needs to do some work on the CPU. By default, Metal does this work when you call the [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandBuffer\/commit()] method of the first command buffer that’s using the residency set. Making the allocations resident at this time can delay the graphics driver from submitting the command buffer to the GPU.\n\nTo help minimize the time between committing a command buffer and when the GPU starts working on it, ask Metal to do the work beforehand. You do this by calling a residency set’s [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLResidencySet\/requestResidency()] method.\n\n\n\nCall this method at any time before you commit the first command buffer that relies on the allocations in the residency set. This can be any noncritical moment when your app can afford the CPU time the framework needs to prepare the applicable allocations for residency. For example, you can call this method at launch or during an app state change.\n\n\n\n### Conclude residency for the resources\n\nWhen your app no longer needs a residency set’s allocations to be accessible to the GPU, call the [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLResidencySet\/endResidency()] method, which effectively releases them.\n\n\n\nThe method tells Metal that it can reuse the memory backing that residency set’s allocations for your app’s other residency sets, or for another app.\n\n## Residency sets\n\n- **MTLResidencySet**: A collection of resource allocations that can move in and out of resident memory.\n- **MTLResidencySetDescriptor**: A configuration that customizes the behavior for a residency set.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "A collection of resource allocations that can move in and out of resident memory.",
          "name" : "MTLResidencySet",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTLResidencySet"
        },
        {
          "description" : "A configuration that customizes the behavior for a residency set.",
          "name" : "MTLResidencySetDescriptor",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTLResidencySetDescriptor"
        }
      ],
      "title" : "Residency sets"
    }
  ],
  "source" : "appleJSON",
  "title" : "Simplifying GPU resource management with residency sets",
  "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/simplifying-gpu-resource-management-with-residency-sets"
}