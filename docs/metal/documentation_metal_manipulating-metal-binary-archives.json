{
  "abstract" : "Split precompiled binaries into individual slices, and combine them back together for targeted distribution.",
  "codeExamples" : [
    {
      "code" : "% xcrun -sdk macosx metal-tt shaders.metallib shaders.mtlp-json -o shaders.binary.metallib\n% xcrun metal-lipo -archs render.binary.metallib\napplegpu_g15g applegpu_g13g applegpu_g14g applegpu_g15s applegpu_g14s applegpu_g14d applegpu_g13s applegpu_g13d amdgpu_gfx803 amdgpu_gfx802 amdgpu_gfx900 amdgpu_gfx904 amdgpu_gfx906 amdgpu_gfx1010_nsgc amdgpu_gfx1010 amdgpu_gfx1011 amdgpu_gfx1012 amdgpu_gfx1030 amdgpu_gfx1032 intelgpu_icl_1x6x8r7 intelgpu_icl_1x8x8r7 intelgpu_kbl_gt2r0 intelgpu_kbl_gt2r2 intelgpu_kbl_gt2r4 intelgpu_kbl_gt3r1 intelgpu_kbl_gt3r6\n% du -h render.binary.metallib\n696K    render.binary.metallib\n% du -h render.metallib\n8.0K    render.metallib\n",
      "language" : "shell"
    },
    {
      "code" : "% mkdir -p shaders\/macos\n% xcrun metal-lipo -archs render.binary.metallib | tr ' ' '\\n' | xargs -n 1 -I{} xcrun metal-lipo -thin {} -output shaders\/macos\/{}.binary.metallib render.binary.metallib\n% ls shaders\/macos\namdgpu_gfx1010.binary.metallib       amdgpu_gfx802.binary.metallib        applegpu_g15s.binary.metallib        applegpu_g14s.binary.metallib        intelgpu_kbl_gt3r1.binary.metallib\namdgpu_gfx1010_nsgc.binary.metallib  amdgpu_gfx803.binary.metallib        applegpu_g13d.binary.metallib        intelgpu_icl_1x6x8r7.binary.metallib intelgpu_kbl_gt3r6.binary.metallib\namdgpu_gfx1011.binary.metallib       amdgpu_gfx900.binary.metallib        applegpu_g13g.binary.metallib        intelgpu_icl_1x8x8r7.binary.metallib\namdgpu_gfx1012.binary.metallib       amdgpu_gfx904.binary.metallib        applegpu_g13s.binary.metallib        intelgpu_kbl_gt2r0.binary.metallib\namdgpu_gfx1030.binary.metallib       amdgpu_gfx906.binary.metallib        applegpu_g14d.binary.metallib        intelgpu_kbl_gt2r2.binary.metallib\namdgpu_gfx1032.binary.metallib       applegpu_g15g.binary.metallib        applegpu_g14g.binary.metallib        intelgpu_kbl_gt2r4.binary.metallib",
      "language" : "shell"
    },
    {
      "code" : "% mkdir -p shaders\/macos\/lib\n% xcrun -sdk macosx metal-lipo $(ls shaders\/macos\/applegpu*) -create -output shaders\/macos\/lib\/applegpu.binary.metallib\n% xcrun -sdk macosx metal-lipo $(ls shaders\/macos\/intelgpu*) -create -output shaders\/macos\/lib\/intelgpu.binary.metallib\n% xcrun -sdk macosx metal-lipo $(ls shaders\/macos\/amdgpu*) -create -output shaders\/macos\/lib\/amdgpu.binary.metallib\n% du -h shaders\/macos\/lib\/*\n180K    shaders\/macos\/lib\/amdgpu.binary.metallib\n124K    shaders\/macos\/lib\/applegpu.binary.metallib\n396K    shaders\/macos\/lib\/intelgpu.binary.metallib",
      "language" : "shell"
    }
  ],
  "contentHash" : "3411273f67e9a00eab31895ebf3926c72a821d62cba08b2b31fd2cd73f2398c2",
  "crawledAt" : "2025-12-01T19:35:33Z",
  "id" : "8CF4D97D-BEAC-4017-BF43-2D9B4ED16E34",
  "kind" : "article",
  "module" : "Metal",
  "overview" : "## Overview\n\nWhen distributing Metal binary archives, it’s useful to maintain individual slices for each GPU and only include binaries relevant for an individual targeted device. This allows for you to maintain the performance of a precompiled Metal binary while reducing it to a minimal size. Using this strategy in a build system allows you to distribute slim binaries over the air from a larger precompiled binary, or to ship a larger set of precompiled binaries for a platform that supports multiple GPUs.\n\nThe code examples in this article use the following files:\n\n### Extract slices from an existing binary archive\n\nUnless the configuration script or command-line options specify otherwise, the Metal translator builds for all supported GPU architectures, including those your app may not even target. For example, building a complete binary archive for the shaders in [doc:\/\/com.apple.metal\/documentation\/Metal\/drawing-a-triangle-with-metal-4], and then inspecting it, shows both a large number of binary slices and a significant size increase.\n\nUse the `metal-lipo` command-line tool for inspection and manipulation of Metal libraries, similar to the `lipo` tool for LLVM-compiled libraries. The `metal-lipo` command-line tool uses the parameter `-thin` to extract one specific GPU binary slice by architecture name. You can also extract every slice from the archive in Terminal by using the `tr` and `xargs` commands.\n\n### Combine individual slices into a new binary archive\n\nThe `metal-lipo` command-line tool also has a `-create` flag that performs the opposite of thinning. It combines binary archives to create a Metal library that contains each individual binary slice. Using this approach, you can create three new binary archives from a full set of binary archives: one for Intel-based Mac computers, one for AMD GPUs in an expansion slot, and one for Apple silicon.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/Metal\/manipulating-metal-binary-archives\ncrawled: 2025-12-01T19:35:33Z\n---\n\n# Manipulating Metal binary archives\n\n**Article**\n\nSplit precompiled binaries into individual slices, and combine them back together for targeted distribution.\n\n## Overview\n\nWhen distributing Metal binary archives, it’s useful to maintain individual slices for each GPU and only include binaries relevant for an individual targeted device. This allows for you to maintain the performance of a precompiled Metal binary while reducing it to a minimal size. Using this strategy in a build system allows you to distribute slim binaries over the air from a larger precompiled binary, or to ship a larger set of precompiled binaries for a platform that supports multiple GPUs.\n\nThe code examples in this article use the following files:\n\n- `shaders.metallib,`a Metal library you compile from Xcode or the `metal` command-line tool. To learn how to compile from the command-line, see [doc:\/\/com.apple.metal\/documentation\/Metal\/building-a-shader-library-by-precompiling-source-files].\n- `shaders.mtlp-json`, a Metal translator configuration script for use with the `shaders.metallib` library. To learn about creating configuration scripts, see [doc:\/\/com.apple.metal\/documentation\/Metal\/creating-binary-archives-from-device-built-pipeline-state-objects] or [doc:\/\/com.apple.metal\/documentation\/Metal\/compiling-binary-archives-from-a-custom-configuration-script].\n\n### Extract slices from an existing binary archive\n\nUnless the configuration script or command-line options specify otherwise, the Metal translator builds for all supported GPU architectures, including those your app may not even target. For example, building a complete binary archive for the shaders in [doc:\/\/com.apple.metal\/documentation\/Metal\/drawing-a-triangle-with-metal-4], and then inspecting it, shows both a large number of binary slices and a significant size increase.\n\n```shell\n% xcrun -sdk macosx metal-tt shaders.metallib shaders.mtlp-json -o shaders.binary.metallib\n% xcrun metal-lipo -archs render.binary.metallib\napplegpu_g15g applegpu_g13g applegpu_g14g applegpu_g15s applegpu_g14s applegpu_g14d applegpu_g13s applegpu_g13d amdgpu_gfx803 amdgpu_gfx802 amdgpu_gfx900 amdgpu_gfx904 amdgpu_gfx906 amdgpu_gfx1010_nsgc amdgpu_gfx1010 amdgpu_gfx1011 amdgpu_gfx1012 amdgpu_gfx1030 amdgpu_gfx1032 intelgpu_icl_1x6x8r7 intelgpu_icl_1x8x8r7 intelgpu_kbl_gt2r0 intelgpu_kbl_gt2r2 intelgpu_kbl_gt2r4 intelgpu_kbl_gt3r1 intelgpu_kbl_gt3r6\n% du -h render.binary.metallib\n696K    render.binary.metallib\n% du -h render.metallib\n8.0K    render.metallib\n\n```\n\nUse the `metal-lipo` command-line tool for inspection and manipulation of Metal libraries, similar to the `lipo` tool for LLVM-compiled libraries. The `metal-lipo` command-line tool uses the parameter `-thin` to extract one specific GPU binary slice by architecture name. You can also extract every slice from the archive in Terminal by using the `tr` and `xargs` commands.\n\n```shell\n% mkdir -p shaders\/macos\n% xcrun metal-lipo -archs render.binary.metallib | tr ' ' '\\n' | xargs -n 1 -I{} xcrun metal-lipo -thin {} -output shaders\/macos\/{}.binary.metallib render.binary.metallib\n% ls shaders\/macos\namdgpu_gfx1010.binary.metallib       amdgpu_gfx802.binary.metallib        applegpu_g15s.binary.metallib        applegpu_g14s.binary.metallib        intelgpu_kbl_gt3r1.binary.metallib\namdgpu_gfx1010_nsgc.binary.metallib  amdgpu_gfx803.binary.metallib        applegpu_g13d.binary.metallib        intelgpu_icl_1x6x8r7.binary.metallib intelgpu_kbl_gt3r6.binary.metallib\namdgpu_gfx1011.binary.metallib       amdgpu_gfx900.binary.metallib        applegpu_g13g.binary.metallib        intelgpu_icl_1x8x8r7.binary.metallib\namdgpu_gfx1012.binary.metallib       amdgpu_gfx904.binary.metallib        applegpu_g13s.binary.metallib        intelgpu_kbl_gt2r0.binary.metallib\namdgpu_gfx1030.binary.metallib       amdgpu_gfx906.binary.metallib        applegpu_g14d.binary.metallib        intelgpu_kbl_gt2r2.binary.metallib\namdgpu_gfx1032.binary.metallib       applegpu_g15g.binary.metallib        applegpu_g14g.binary.metallib        intelgpu_kbl_gt2r4.binary.metallib\n```\n\n\n\n### Combine individual slices into a new binary archive\n\nThe `metal-lipo` command-line tool also has a `-create` flag that performs the opposite of thinning. It combines binary archives to create a Metal library that contains each individual binary slice. Using this approach, you can create three new binary archives from a full set of binary archives: one for Intel-based Mac computers, one for AMD GPUs in an expansion slot, and one for Apple silicon.\n\n```shell\n% mkdir -p shaders\/macos\/lib\n% xcrun -sdk macosx metal-lipo $(ls shaders\/macos\/applegpu*) -create -output shaders\/macos\/lib\/applegpu.binary.metallib\n% xcrun -sdk macosx metal-lipo $(ls shaders\/macos\/intelgpu*) -create -output shaders\/macos\/lib\/intelgpu.binary.metallib\n% xcrun -sdk macosx metal-lipo $(ls shaders\/macos\/amdgpu*) -create -output shaders\/macos\/lib\/amdgpu.binary.metallib\n% du -h shaders\/macos\/lib\/*\n180K    shaders\/macos\/lib\/amdgpu.binary.metallib\n124K    shaders\/macos\/lib\/applegpu.binary.metallib\n396K    shaders\/macos\/lib\/intelgpu.binary.metallib\n```\n\n\n\n## Working with Metal binary archives\n\n- **Creating binary archives from device-built pipeline state objects**: Write your Metal pipeline states to a binary archive at app runtime, and build binaries for any supported GPU.\n- **Compiling binary archives from a custom configuration script**: Define how the Metal translator builds binary archives without precompiled binaries as a starting source.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Write your Metal pipeline states to a binary archive at app runtime, and build binaries for any supported GPU.",
          "name" : "Creating binary archives from device-built pipeline state objects",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/creating-binary-archives-from-device-built-pipeline-state-objects"
        },
        {
          "description" : "Define how the Metal translator builds binary archives without precompiled binaries as a starting source.",
          "name" : "Compiling binary archives from a custom configuration script",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/compiling-binary-archives-from-a-custom-configuration-script"
        }
      ],
      "title" : "Working with Metal binary archives"
    }
  ],
  "source" : "appleJSON",
  "title" : "Manipulating Metal binary archives",
  "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/manipulating-metal-binary-archives"
}