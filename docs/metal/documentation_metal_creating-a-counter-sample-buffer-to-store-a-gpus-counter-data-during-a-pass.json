{
  "abstract" : "Make a buffer that provides a place for a GPU to save its runtime performance metrics as it runs a pass.",
  "codeExamples" : [

  ],
  "contentHash" : "eaf2973bfb430015f4e1e1775aa5dce749933f00920d61b1a73e9d085f80eb28",
  "crawledAt" : "2025-12-02T19:36:09Z",
  "id" : "2524A02D-1CAF-45C9-8883-EBBD0AB08C89",
  "kind" : "article",
  "language" : "swift",
  "module" : "Metal",
  "overview" : "## Overview\n\nYou can create and use an [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCounterSampleBuffer] instance to store information from a GPU counter. To check whether a GPU produces data for a specific counter, see [doc:\/\/com.apple.metal\/documentation\/Metal\/confirming-which-counters-and-counter-sets-a-gpu-supports]. Each *counter sample buffer* represents memory that a GPU uses to save data from the counter as it runs a pass. Counter sample buffers provide the GPU a place to temporarily store sample data, which avoids the need to synchronize data with the CPU. However, your app has the option to *resolve* the sample data with the CPU after the pass completes. See [doc:\/\/com.apple.metal\/documentation\/Metal\/converting-a-gpus-counter-data-into-a-readable-format] for more information about resolving sample data.\n\nCreate a counter sample buffer for a GPU by:\n\nThe code example above gives the CPU access to the counter sample buffer by configuring the descriptor’s [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCounterSampleBufferDescriptor\/storageMode] property to [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLStorageMode\/shared]. Alternatively, you can set this property to [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLStorageMode\/private] if your app only uses the GPU to access its data. The example also sets the descriptor’s [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCounterSampleBufferDescriptor\/sampleCount] property to `4` to store the starting and completion timestamps for both the vertex and the fragment stages. The value for the descriptor’s sample count in this example is directly related to the following four properties of the [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLRenderPassSampleBufferAttachmentDescriptor] type:\n\nWhen your app has a counter sample buffer, it can then instruct the GPU to save its counter sample data to it during a pass. See [doc:\/\/com.apple.metal\/documentation\/Metal\/sampling-gpu-data-into-counter-sample-buffers] for more information.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/Metal\/creating-a-counter-sample-buffer-to-store-a-gpus-counter-data-during-a-pass\ncrawled: 2025-12-02T19:36:09Z\n---\n\n# Creating a counter sample buffer to store a GPU’s counter data during a pass\n\n**Article**\n\nMake a buffer that provides a place for a GPU to save its runtime performance metrics as it runs a pass.\n\n## Overview\n\nYou can create and use an [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCounterSampleBuffer] instance to store information from a GPU counter. To check whether a GPU produces data for a specific counter, see [doc:\/\/com.apple.metal\/documentation\/Metal\/confirming-which-counters-and-counter-sets-a-gpu-supports]. Each *counter sample buffer* represents memory that a GPU uses to save data from the counter as it runs a pass. Counter sample buffers provide the GPU a place to temporarily store sample data, which avoids the need to synchronize data with the CPU. However, your app has the option to *resolve* the sample data with the CPU after the pass completes. See [doc:\/\/com.apple.metal\/documentation\/Metal\/converting-a-gpus-counter-data-into-a-readable-format] for more information about resolving sample data.\n\nCreate a counter sample buffer for a GPU by:\n\n1. Confirming a GPU device supports the counter set you want to sample\n2. Retrieving the GPU’s instance of that counter set\n3. Creating an [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCounterSampleBufferDescriptor] instance and configuring its properties for the counter set\n4. Passing the descriptor to the GPU device’s [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLDevice\/makeCounterSampleBuffer(descriptor:)] factory method\n\n\n\nThe code example above gives the CPU access to the counter sample buffer by configuring the descriptor’s [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCounterSampleBufferDescriptor\/storageMode] property to [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLStorageMode\/shared]. Alternatively, you can set this property to [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLStorageMode\/private] if your app only uses the GPU to access its data. The example also sets the descriptor’s [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCounterSampleBufferDescriptor\/sampleCount] property to `4` to store the starting and completion timestamps for both the vertex and the fragment stages. The value for the descriptor’s sample count in this example is directly related to the following four properties of the [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLRenderPassSampleBufferAttachmentDescriptor] type:\n\n- [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLRenderPassSampleBufferAttachmentDescriptor\/startOfVertexSampleIndex]\n- [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLRenderPassSampleBufferAttachmentDescriptor\/endOfVertexSampleIndex]\n- [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLRenderPassSampleBufferAttachmentDescriptor\/startOfFragmentSampleIndex]\n- [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLRenderPassSampleBufferAttachmentDescriptor\/endOfFragmentSampleIndex]\n\n\n\nWhen your app has a counter sample buffer, it can then instruct the GPU to save its counter sample data to it during a pass. See [doc:\/\/com.apple.metal\/documentation\/Metal\/sampling-gpu-data-into-counter-sample-buffers] for more information.\n\n## Counter sample buffers\n\n- **MTLCounterSampleBufferDescriptor**: A group of properties that configures the counter sample buffers you create with it.\n- **MTLCounterSampleBuffer**: A specialized memory buffer that stores a GPU’s counter set data.\n- **Sampling GPU data into counter sample buffers**: Retrieve a GPU’s counter data at a time the GPU supports.\n- **MTLCounterDontSample**: A sentinel value that instructs an encoder to skip sampling a counter as the GPU runs the encoder’s pass.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "A group of properties that configures the counter sample buffers you create with it.",
          "name" : "MTLCounterSampleBufferDescriptor",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTLCounterSampleBufferDescriptor"
        },
        {
          "description" : "A specialized memory buffer that stores a GPU’s counter set data.",
          "name" : "MTLCounterSampleBuffer",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTLCounterSampleBuffer"
        },
        {
          "description" : "Retrieve a GPU’s counter data at a time the GPU supports.",
          "name" : "Sampling GPU data into counter sample buffers",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/sampling-gpu-data-into-counter-sample-buffers"
        },
        {
          "description" : "A sentinel value that instructs an encoder to skip sampling a counter as the GPU runs the encoder’s pass.",
          "name" : "MTLCounterDontSample",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTLCounterDontSample"
        }
      ],
      "title" : "Counter sample buffers"
    }
  ],
  "source" : "appleJSON",
  "title" : "Creating a counter sample buffer to store a GPU’s counter data during a pass",
  "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/creating-a-counter-sample-buffer-to-store-a-gpus-counter-data-during-a-pass"
}