{
  "abstract" : "Allocate memory for sparse textures by creating a sparse heap.",
  "codeExamples" : [

  ],
  "contentHash" : "101752c9748529e8d2a92fdca4011d6d70171cbf221666711969d25d7878514f",
  "crawledAt" : "2025-12-02T05:50:32Z",
  "id" : "62F99206-2DF0-4BFE-9D20-E0279365800D",
  "kind" : "article",
  "module" : "Metal",
  "overview" : "## Overview\n\n*Sparse heaps* are [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLHeap] instances that create sparse textures and provide memory for them. Unlike with a standard heap, you use a sparse heap only to create sparse textures and allocate storage for texture data. You allocate memory when you create the heap, and later, as needed, map or unmap portions of the heap’s memory to textures. Memory is mapped in larger chunks called *sparse tiles*. The size of sparse tiles (in bytes) is determined by the device instance.\n\n### Create a sparse heap\n\nCreate an [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLHeapDescriptor] instance and set its type to [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLHeapType\/sparse]. You need to allocate sparse heaps with the [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLStorageMode\/private] storage mode. Specify the heap’s size as a multiple of the sparse tile size. To get the tile size, read the [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLDevice\/sparseTileSizeInBytes] property on the [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLDevice] instance that you’re using to create the heap.\n\nThe code below creates a new sparse heap, rounding the heap size up to the tile size.\n\nSpecify a heap size that’s appropriate for your app, based on how many textures you’ve, how large those textures are, and your image-quality goals. You may need to experiment to determine the best size. The heap should be large enough that your app doesn’t need to unmap sparse tiles frequently and doesn’t suffer from image-quality problems. Unless you need finer-grained control of how different collections of textures are allocated in memory, allocate a single sparse heap and use it to manage all of your app’s texture memory.\n\n### Create a sparse texture\n\nAll textures that you create on a sparse heap are sparse textures. When you create textures on heaps, use the same storage mode as the sparse heap, similar to the example code below:\n\nWhen you create a sparse texture, no memory is allocated for it. It can’t store any pixel data until you map sparse tiles on the heap to regions inside the texture. For more information about mapping and unmapping sparse tiles, see [doc:\/\/com.apple.metal\/documentation\/Metal\/assigning-memory-to-sparse-textures]. For more information about how sparse textures behave when you access them, see [doc:\/\/com.apple.metal\/documentation\/Metal\/reading-and-writing-to-sparse-textures].",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/Metal\/creating-sparse-heaps-and-sparse-textures\ncrawled: 2025-12-02T05:50:32Z\n---\n\n# Creating sparse heaps and sparse textures\n\n**Article**\n\nAllocate memory for sparse textures by creating a sparse heap.\n\n## Overview\n\n*Sparse heaps* are [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLHeap] instances that create sparse textures and provide memory for them. Unlike with a standard heap, you use a sparse heap only to create sparse textures and allocate storage for texture data. You allocate memory when you create the heap, and later, as needed, map or unmap portions of the heap’s memory to textures. Memory is mapped in larger chunks called *sparse tiles*. The size of sparse tiles (in bytes) is determined by the device instance.\n\n### Create a sparse heap\n\nCreate an [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLHeapDescriptor] instance and set its type to [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLHeapType\/sparse]. You need to allocate sparse heaps with the [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLStorageMode\/private] storage mode. Specify the heap’s size as a multiple of the sparse tile size. To get the tile size, read the [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLDevice\/sparseTileSizeInBytes] property on the [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLDevice] instance that you’re using to create the heap.\n\nThe code below creates a new sparse heap, rounding the heap size up to the tile size.\n\n\n\nSpecify a heap size that’s appropriate for your app, based on how many textures you’ve, how large those textures are, and your image-quality goals. You may need to experiment to determine the best size. The heap should be large enough that your app doesn’t need to unmap sparse tiles frequently and doesn’t suffer from image-quality problems. Unless you need finer-grained control of how different collections of textures are allocated in memory, allocate a single sparse heap and use it to manage all of your app’s texture memory.\n\n### Create a sparse texture\n\nAll textures that you create on a sparse heap are sparse textures. When you create textures on heaps, use the same storage mode as the sparse heap, similar to the example code below:\n\n\n\nWhen you create a sparse texture, no memory is allocated for it. It can’t store any pixel data until you map sparse tiles on the heap to regions inside the texture. For more information about mapping and unmapping sparse tiles, see [doc:\/\/com.apple.metal\/documentation\/Metal\/assigning-memory-to-sparse-textures]. For more information about how sparse textures behave when you access them, see [doc:\/\/com.apple.metal\/documentation\/Metal\/reading-and-writing-to-sparse-textures].\n\n## Sparse textures\n\n- **Managing sparse texture memory**: Take direct control of memory allocation for texture data by using sparse textures.\n- **Converting between pixel regions and sparse tile regions**: Learn how a sparse texture’s contents are organized in memory.\n- **Assigning memory to sparse textures**: Use a resource state encoder to allocate and deallocate sparse tiles for a sparse texture.\n- **Reading and writing to sparse textures**: Decide how to handle access to unmapped texture regions.\n- **Estimating how often a texture region is accessed**: Use texture access patterns to determine when you need to map a texture region.\n- **MTLResourceStatePassDescriptor**: A configuration for a resource state pass, used to create a resource state command encoder.\n- **MTLResourceStatePassSampleBufferAttachmentDescriptor**: A description of where to store GPU counter information at the start and end of a resource state pass.\n- **MTLResourceStatePassSampleBufferAttachmentDescriptorArray**: An array of sample buffer attachments for a resource state pass.\n- **MTLResourceStateCommandEncoder**: An encoder that encodes commands that modify resource configurations.\n- **MTLMapIndirectArguments**: The data layout for mapping sparse texture regions when using indirect commands.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Take direct control of memory allocation for texture data by using sparse textures.",
          "name" : "Managing sparse texture memory",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/managing-sparse-texture-memory"
        },
        {
          "description" : "Learn how a sparse texture’s contents are organized in memory.",
          "name" : "Converting between pixel regions and sparse tile regions",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/converting-between-pixel-regions-and-sparse-tile-regions"
        },
        {
          "description" : "Use a resource state encoder to allocate and deallocate sparse tiles for a sparse texture.",
          "name" : "Assigning memory to sparse textures",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/assigning-memory-to-sparse-textures"
        },
        {
          "description" : "Decide how to handle access to unmapped texture regions.",
          "name" : "Reading and writing to sparse textures",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/reading-and-writing-to-sparse-textures"
        },
        {
          "description" : "Use texture access patterns to determine when you need to map a texture region.",
          "name" : "Estimating how often a texture region is accessed",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/estimating-how-often-a-texture-region-is-accessed"
        },
        {
          "description" : "A configuration for a resource state pass, used to create a resource state command encoder.",
          "name" : "MTLResourceStatePassDescriptor",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTLResourceStatePassDescriptor"
        },
        {
          "description" : "A description of where to store GPU counter information at the start and end of a resource state pass.",
          "name" : "MTLResourceStatePassSampleBufferAttachmentDescriptor",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTLResourceStatePassSampleBufferAttachmentDescriptor"
        },
        {
          "description" : "An array of sample buffer attachments for a resource state pass.",
          "name" : "MTLResourceStatePassSampleBufferAttachmentDescriptorArray",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTLResourceStatePassSampleBufferAttachmentDescriptorArray"
        },
        {
          "description" : "An encoder that encodes commands that modify resource configurations.",
          "name" : "MTLResourceStateCommandEncoder",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTLResourceStateCommandEncoder"
        },
        {
          "description" : "The data layout for mapping sparse texture regions when using indirect commands.",
          "name" : "MTLMapIndirectArguments",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTLMapIndirectArguments"
        }
      ],
      "title" : "Sparse textures"
    }
  ],
  "source" : "appleJSON",
  "title" : "Creating sparse heaps and sparse textures",
  "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/creating-sparse-heaps-and-sparse-textures"
}