{
  "abstract" : "Print debugging messages that a shader generates using shader logging.",
  "codeExamples" : [
    {
      "code" : "xcrun metal -std=metal3.2 -fmetal-enable-logging -o helloTriangle.metallib helloTriangle.metal",
      "language" : "shell"
    },
    {
      "code" : "MTLCompileOptions *options = [MTLCompileOptions new];\noptions.libraryType = MTLLibraryTypeExecutable;\noptions.enableLogging = true;\nid<MTLLibrary> myLibrary = newLibraryWithSource: (NSString *) myShaderPath\n                                        options: (MTLCompileOptions *) options\n                                          error: (NSError * _Nullable *) error;",
      "language" : "objective-c"
    },
    {
      "code" : "uint index [[thread_position_in_grid]];\n\n[[kernel]] void myKernel()\n{\n    if (index == 7)\n    {\n        metal::os_log_default.log_info(\"Hello There!\")\n    }\n}",
      "language" : "metal"
    },
    {
      "code" : "constant os_log logger(\/*subsystem=*\/\"com.metal.xyz\", \/*category=*\/\"abc\");\n\nuint index [[thread_position_in_grid]];\n\n[[kernel]] void myKernel()\n{\n    if (index == 7)\n    {\n        logger.log_info(\"Hello There!\");\n    }\n}",
      "language" : "metal"
    },
    {
      "code" : "MTLLogStateDescriptor *logStateDesc = [MTLLogStateDescriptor new];\nlogStateDesc.bufferSize = 2048;\nlogStateDesc.level = MTLLogLevelDebug;",
      "language" : "objective-c"
    },
    {
      "code" : "id<MTLLogState> logState = [device newLogStateWithDescriptor:logStateDesc error:&error];",
      "language" : "objective-c"
    },
    {
      "code" : "MTLCommandBufferDescriptor *cbufDesc = [MTLCommandBufferDescriptor new];\ncbufDesc.logState = logState;\nid<MTLCommandBuffer> cbuf = [queue commandBufferWithDescriptor:cbufDesc];",
      "language" : "objective-c"
    },
    {
      "code" : "MTLCommandQueueDescriptor *cqDesc = [MTLCommandQueueDescriptor new];\ncqDesc.logState = logState;\nid<MTLCommandQueue> cq = [device newCommandQueueWithDescriptor:cqDesc];",
      "language" : "objective-c"
    },
    {
      "code" : "[logState addLogHandler:^(NSString *substring, NSString *category,\n                          MTLLogLevel level, NSString *message)\n{\n    if ([substring isEqualToString:@\"com.metal.xyz\"] && \n        [category isEqualToString:@\"abc\"])\n    {\n        NSLog(@\"%@\", message);\n    }\n}];",
      "language" : "objective-c"
    }
  ],
  "contentHash" : "f99bd584af5bc1aa615fc4f21469a72db14de892bf0ef0dbe6f2a9713f3efcd5",
  "crawledAt" : "2025-12-02T15:53:47Z",
  "id" : "E480778D-EE7C-429F-9E5F-ABE5210163AC",
  "kind" : "article",
  "language" : "swift",
  "module" : "Metal",
  "overview" : "## Overview\n\nWith shader logging, you can print debugging messages directly from the shader in your app, to help identify issues you may not catch otherwise. You can view these messages from the Console app, the log command-line tool, or the Xcode debug area.\n\n### Enable shader logging\n\nTo enable shader logging, you first need to enable the compiler setting in [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCompileOptions]. You can either do this directly through Xcode, or while building your [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLLibrary]. Shader logging is only available in Metal 3.2 and later. It’s also only available in iOS 18 and later, iPadOS 18 and later, macOS 15 and later, tvOS 18 and later, and visionOS 2 and later.\n\nTo enable the compiler setting through Xcode:\n\nThe following image shows an Xcode project’s build settings with the compiler flag set:\n\n\n\nYou can also enable the same compiler setting through the command line:\n\nIf you’re creating a Metal Library by compiling source code using `newLibraryWithSource`, use the `MTLCompileOptions` instance’s [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCompileOptions\/enableLogging] property to set the compile option:\n\nAfter you set the compiler settings, set the app’s environment variables. The two environment variables that influence logging are `MTL_LOG_LEVEL` and `MTL_LOG_BUFFER_SIZE`. If you define only one of the variables, the other assumes its default value. The default value for `MTL_LOG_LEVEL` is `MTLLogLevelDebug`, and the default value for `MTL_LOG_BUFFER_SIZE` is 1024 bytes.\n\nTo set the environment variables:\n\nThe following image shows an Xcode project with both of the logging environment variables:\n\n\n\n`MTL_LOG_BUFFER_SIZE` is the storage capacity for the logging data, in bytes. Anticipating the volume of data can help you determine a buffer size to use. If the shader generates many logs, use a larger buffer size. The minimum capacity is 1 KB, and the maximum is 1 GB. When the log buffer reaches its capacity, the system discards any subsequent messages.\n\nDraining of the log buffer is heavily dependent on the duration of the command buffers, and only happens after the command buffer finishes. As a result, the system may not maintain the sequence of messages.\n\nThe `MTL_LOG_LEVEL` variable is the minimum logging level you want to use. The system doesn’t add any messages to the log buffer with a level lower than the one you set. The acceptable log level values are:\n\n### Generate and view the log messages\n\nAfter you enable shader logging, add `os_log` functions to your shader to begin generating the log messages:\n\nIf you want to filter the log messages you preview, use `os_log` functions along with subsystems and categories. To specify the subsystems and categories, create an `os_log` instance. You can then use this instance and call logging functions similarly to the code snippet above. The subsystem, category, and format strings should be less than 1024 characters per message. Exceeding this limit can result in truncated messages:\n\nLogging functions, like any other function, execute once per thread. In a multithreaded kernel, you’re responsible for limiting the logging to either a single or specific number of threads. Failing to do so causes you to call logging functions for each thread, which can quickly fill up the log buffer. This can lead to dropping messages, and a reduction in system performance.\n\nTo learn more about generating log messages, see [doc:\/\/com.apple.documentation\/documentation\/os\/generating-log-messages-from-your-code].\n\nYou can view the shader logs using the Console app, the log command-line tool, or through the Xcode debug area. If you’re using `log_info()` or `log_debug()`, make sure to include info or debug messages by selecting the appropriate option in the Console app. To show or hide these messages, select Action > Include Info Messages\/Include Debug Messages from the Console menu:\n\n\n\nTo view the logs through the Xcode debug console, set the environment variable `MTL_LOG_TO_STDERR` to 1.\n\n### Use shader logging via the API\n\nThe above methods enable shader logging for the entire app. However, if you want to enable logging for a specific command buffer or command queue, you can use the Metal API, [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLLogState].\n\nTo create an `MTLLogState`, first create an [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLLogStateDescriptor], and set its buffer size and log level:\n\nYou can then create the `MTLLogState` using the descriptor:\n\nThis `LogState` can attach to one or more command buffers by setting its `logState` property in the `CommandBufferDescriptor`. If you attach this same log state to multiple command buffers, they all share a single log buffer to store the log data:\n\nThrough a similar process, you can attach the log state to a command queue:\n\nMultiple instances of `MTLLogState` occupy separate memory. Avoid creating excessive log states with large log buffers, as this can lead to your app exceeding its memory limit. If you share a log state between buffers, the system may delay or block the draining of the buffer until all command buffers finish. If the buffer drains, you may see log messages that an unfinished buffer generated.\n\nBy default, you can still view all log messages through either the Console app or the `log` command-line tool. However, log handlers give you an alternative method to preview the logs. The [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLLogState\/addLogHandler(_:)] method allows you to add one or more log handlers to a log state. You can also filter and customize the way you preview the messages by using a subsystem and category:\n\nIn the absence of using log handlers, your CPU adds a default handler that internally calls `OSLog` functions to preview logging. For more information on viewing log messages, see [doc:\/\/com.apple.documentation\/documentation\/os\/viewing-log-messages].",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/Metal\/logging-shader-debug-messages\ncrawled: 2025-12-02T15:53:47Z\n---\n\n# Logging shader debug messages\n\n**Article**\n\nPrint debugging messages that a shader generates using shader logging.\n\n## Overview\n\nWith shader logging, you can print debugging messages directly from the shader in your app, to help identify issues you may not catch otherwise. You can view these messages from the Console app, the log command-line tool, or the Xcode debug area.\n\n### Enable shader logging\n\nTo enable shader logging, you first need to enable the compiler setting in [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCompileOptions]. You can either do this directly through Xcode, or while building your [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLLibrary]. Shader logging is only available in Metal 3.2 and later. It’s also only available in iOS 18 and later, iPadOS 18 and later, macOS 15 and later, tvOS 18 and later, and visionOS 2 and later.\n\nTo enable the compiler setting through Xcode:\n\n1. Choose your project in the Project Navigator and select the target you want to enable logging for. Click Build Settings at the top.\n2. Search for “Other Metal Compiler Flags”.\n3. Add `-fmetal-enable-logging` as a compile flag.\n\nThe following image shows an Xcode project’s build settings with the compiler flag set:\n\n\n\nYou can also enable the same compiler setting through the command line:\n\n```shell\nxcrun metal -std=metal3.2 -fmetal-enable-logging -o helloTriangle.metallib helloTriangle.metal\n```\n\nIf you’re creating a Metal Library by compiling source code using `newLibraryWithSource`, use the `MTLCompileOptions` instance’s [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCompileOptions\/enableLogging] property to set the compile option:\n\n```objective-c\nMTLCompileOptions *options = [MTLCompileOptions new];\noptions.libraryType = MTLLibraryTypeExecutable;\noptions.enableLogging = true;\nid<MTLLibrary> myLibrary = newLibraryWithSource: (NSString *) myShaderPath\n                                        options: (MTLCompileOptions *) options\n                                          error: (NSError * _Nullable *) error;\n```\n\nAfter you set the compiler settings, set the app’s environment variables. The two environment variables that influence logging are `MTL_LOG_LEVEL` and `MTL_LOG_BUFFER_SIZE`. If you define only one of the variables, the other assumes its default value. The default value for `MTL_LOG_LEVEL` is `MTLLogLevelDebug`, and the default value for `MTL_LOG_BUFFER_SIZE` is 1024 bytes.\n\nTo set the environment variables:\n\n1. Open your Xcode project.\n2. From the Xcode menu, select Product > Scheme > Edit Scheme.\n3. In the new window, select Run > Arguments.\n4. Add the variables by clicking the plus button under “Environment Variables”.\n\nThe following image shows an Xcode project with both of the logging environment variables:\n\n\n\n`MTL_LOG_BUFFER_SIZE` is the storage capacity for the logging data, in bytes. Anticipating the volume of data can help you determine a buffer size to use. If the shader generates many logs, use a larger buffer size. The minimum capacity is 1 KB, and the maximum is 1 GB. When the log buffer reaches its capacity, the system discards any subsequent messages.\n\nDraining of the log buffer is heavily dependent on the duration of the command buffers, and only happens after the command buffer finishes. As a result, the system may not maintain the sequence of messages.\n\nThe `MTL_LOG_LEVEL` variable is the minimum logging level you want to use. The system doesn’t add any messages to the log buffer with a level lower than the one you set. The acceptable log level values are:\n\n\n\n### Generate and view the log messages\n\nAfter you enable shader logging, add `os_log` functions to your shader to begin generating the log messages:\n\n```metal\nuint index [[thread_position_in_grid]];\n\n[[kernel]] void myKernel()\n{\n    if (index == 7)\n    {\n        metal::os_log_default.log_info(\"Hello There!\")\n    }\n}\n```\n\nIf you want to filter the log messages you preview, use `os_log` functions along with subsystems and categories. To specify the subsystems and categories, create an `os_log` instance. You can then use this instance and call logging functions similarly to the code snippet above. The subsystem, category, and format strings should be less than 1024 characters per message. Exceeding this limit can result in truncated messages:\n\n```metal\nconstant os_log logger(\/*subsystem=*\/\"com.metal.xyz\", \/*category=*\/\"abc\");\n\nuint index [[thread_position_in_grid]];\n\n[[kernel]] void myKernel()\n{\n    if (index == 7)\n    {\n        logger.log_info(\"Hello There!\");\n    }\n}\n```\n\nLogging functions, like any other function, execute once per thread. In a multithreaded kernel, you’re responsible for limiting the logging to either a single or specific number of threads. Failing to do so causes you to call logging functions for each thread, which can quickly fill up the log buffer. This can lead to dropping messages, and a reduction in system performance.\n\nTo learn more about generating log messages, see [doc:\/\/com.apple.documentation\/documentation\/os\/generating-log-messages-from-your-code].\n\nYou can view the shader logs using the Console app, the log command-line tool, or through the Xcode debug area. If you’re using `log_info()` or `log_debug()`, make sure to include info or debug messages by selecting the appropriate option in the Console app. To show or hide these messages, select Action > Include Info Messages\/Include Debug Messages from the Console menu:\n\n\n\nTo view the logs through the Xcode debug console, set the environment variable `MTL_LOG_TO_STDERR` to 1.\n\n### Use shader logging via the API\n\nThe above methods enable shader logging for the entire app. However, if you want to enable logging for a specific command buffer or command queue, you can use the Metal API, [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLLogState].\n\nTo create an `MTLLogState`, first create an [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLLogStateDescriptor], and set its buffer size and log level:\n\n```objective-c\nMTLLogStateDescriptor *logStateDesc = [MTLLogStateDescriptor new];\nlogStateDesc.bufferSize = 2048;\nlogStateDesc.level = MTLLogLevelDebug;\n```\n\nYou can then create the `MTLLogState` using the descriptor:\n\n```objective-c\nid<MTLLogState> logState = [device newLogStateWithDescriptor:logStateDesc error:&error];\n```\n\nThis `LogState` can attach to one or more command buffers by setting its `logState` property in the `CommandBufferDescriptor`. If you attach this same log state to multiple command buffers, they all share a single log buffer to store the log data:\n\n```objective-c\nMTLCommandBufferDescriptor *cbufDesc = [MTLCommandBufferDescriptor new];\ncbufDesc.logState = logState;\nid<MTLCommandBuffer> cbuf = [queue commandBufferWithDescriptor:cbufDesc];\n```\n\nThrough a similar process, you can attach the log state to a command queue:\n\n```objective-c\nMTLCommandQueueDescriptor *cqDesc = [MTLCommandQueueDescriptor new];\ncqDesc.logState = logState;\nid<MTLCommandQueue> cq = [device newCommandQueueWithDescriptor:cqDesc];\n```\n\nMultiple instances of `MTLLogState` occupy separate memory. Avoid creating excessive log states with large log buffers, as this can lead to your app exceeding its memory limit. If you share a log state between buffers, the system may delay or block the draining of the buffer until all command buffers finish. If the buffer drains, you may see log messages that an unfinished buffer generated.\n\nBy default, you can still view all log messages through either the Console app or the `log` command-line tool. However, log handlers give you an alternative method to preview the logs. The [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLLogState\/addLogHandler(_:)] method allows you to add one or more log handlers to a log state. You can also filter and customize the way you preview the messages by using a subsystem and category:\n\n```objective-c\n[logState addLogHandler:^(NSString *substring, NSString *category,\n                          MTLLogLevel level, NSString *message)\n{\n    if ([substring isEqualToString:@\"com.metal.xyz\"] && \n        [category isEqualToString:@\"abc\"])\n    {\n        NSLog(@\"%@\", message);\n    }\n}];\n```\n\nIn the absence of using log handlers, your CPU adds a default handler that internally calls `OSLog` functions to preview logging. For more information on viewing log messages, see [doc:\/\/com.apple.documentation\/documentation\/os\/viewing-log-messages].\n\n## Developer tools\n\n- **Supporting Simulator in a Metal app**: Configure alternative render paths in your Metal app to enable running your app in Simulator.\n- **Capturing Metal commands programmatically**: Invoke a Metal frame capture from your app, then save the resulting GPU trace to a file or view it in Xcode.\n- **Developing Metal apps that run in Simulator**: Prototype and test your Metal apps in Simulator.\n- **Improving your game’s graphics performance and settings**: Fix performance glitches and develop default settings for smooth experiences on Apple platforms using the powerful suite of Metal development tools.\n- **Metal debugger**: Debug and profile your Metal workload with a GPU trace.\n- **Metal developer workflows**: Locate and fix issues related to your app’s use of the Metal API and GPU functions.\n- **GPU counters and counter sample buffers**: Retrieve runtime data from a GPU device by sampling one or more of its counters.\n- **Metal debugging types**: Create capture managers and capture scopes, and review a GPU device’s log after it runs a command buffer.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Configure alternative render paths in your Metal app to enable running your app in Simulator.",
          "name" : "Supporting Simulator in a Metal app",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/supporting-simulator-in-a-metal-app"
        },
        {
          "description" : "Invoke a Metal frame capture from your app, then save the resulting GPU trace to a file or view it in Xcode.",
          "name" : "Capturing Metal commands programmatically",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/capturing-metal-commands-programmatically"
        },
        {
          "description" : "Prototype and test your Metal apps in Simulator.",
          "name" : "Developing Metal apps that run in Simulator",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/developing-metal-apps-that-run-in-simulator"
        },
        {
          "description" : "Fix performance glitches and develop default settings for smooth experiences on Apple platforms using the powerful suite of Metal development tools.",
          "name" : "Improving your game’s graphics performance and settings",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/improving-your-games-graphics-performance-and-settings"
        },
        {
          "description" : "Debug and profile your Metal workload with a GPU trace.",
          "name" : "Metal debugger",
          "url" : "https:\/\/developer.apple.com\/documentation\/Xcode\/Metal-debugger"
        },
        {
          "description" : "Locate and fix issues related to your app’s use of the Metal API and GPU functions.",
          "name" : "Metal developer workflows",
          "url" : "https:\/\/developer.apple.com\/documentation\/Xcode\/Metal-developer-workflows"
        },
        {
          "description" : "Retrieve runtime data from a GPU device by sampling one or more of its counters.",
          "name" : "GPU counters and counter sample buffers",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/gpu-counters-and-counter-sample-buffers"
        },
        {
          "description" : "Create capture managers and capture scopes, and review a GPU device’s log after it runs a command buffer.",
          "name" : "Metal debugging types",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/metal-debugging-types"
        }
      ],
      "title" : "Developer tools"
    }
  ],
  "source" : "appleJSON",
  "title" : "Logging shader debug messages",
  "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/logging-shader-debug-messages"
}