{
  "abstract" : "Encodes a compute pass and other memory operations into a command buffer.",
  "codeExamples" : [

  ],
  "contentHash" : "d4a32c4d23505ef22a575685807a8d493bf6d69734161f2d39138507cb881790",
  "crawledAt" : "2025-12-02T05:46:38Z",
  "declaration" : {
    "code" : "protocol MTL4ComputeCommandEncoder : MTL4CommandEncoder",
    "language" : "swift"
  },
  "id" : "018C00B4-AE25-4217-9CEC-6A27D36360B2",
  "kind" : "protocol",
  "module" : "Metal",
  "overview" : "## Overview\n\nUse instances of this abstraction to encode a compute pass into [doc:\/\/com.apple.metal\/documentation\/Metal\/MTL4CommandBuffer] instances, as well as commands that copy and modify the underlying memory of various Metal resources, and commands that build or refit acceleration structures.",
  "platforms" : [
    "iOS",
    "iPadOS",
    "Mac Catalyst",
    "macOS",
    "tvOS",
    "visionOS"
  ],
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/Metal\/MTL4ComputeCommandEncoder\ncrawled: 2025-12-02T05:46:38Z\n---\n\n# MTL4ComputeCommandEncoder\n\n**Protocol**\n\nEncodes a compute pass and other memory operations into a command buffer.\n\n## Declaration\n\n```swift\nprotocol MTL4ComputeCommandEncoder : MTL4CommandEncoder\n```\n\n## Overview\n\nUse instances of this abstraction to encode a compute pass into [doc:\/\/com.apple.metal\/documentation\/Metal\/MTL4CommandBuffer] instances, as well as commands that copy and modify the underlying memory of various Metal resources, and commands that build or refit acceleration structures.\n\n## Instance Methods\n\n- **build(destinationAccelerationStructure:descriptor:scratchBuffer:)**: Encodes an acceleration structure build into the command buffer.\n- **copy(sourceAccelerationStructure:destinationAccelerationStructure:)**: Encodes an acceleration structure copy operation into the command buffer.\n- **copy(sourceBuffer:sourceOffset:destinationBuffer:destinationOffset:size:)**: Encodes a command that copies data from a buffer instance into another.\n- **copy(sourceBuffer:sourceOffset:sourceBytesPerRow:sourceBytesPerImage:sourceSize:destinationTexture:destinationSlice:destinationLevel:destinationOrigin:options:)**: Encodes a command to copy image data from a buffer into a texture with options for special texture formats.\n- **copy(sourceTensor:sourceOrigin:sourceDimensions:destinationTensor:destinationOrigin:destinationDimensions:)**: Encodes a command to copy data from a tensor instance into another.\n- **copy(sourceTexture:destinationTexture:)**: Encodes a command that copies data from a texture to another.\n- **copy(sourceTexture:sourceSlice:sourceLevel:destinationTexture:destinationSlice:destinationLevel:sliceCount:levelCount:)**: Encodes a command that copies slices of a texture to slices of another texture.\n- **copy(sourceTexture:sourceSlice:sourceLevel:sourceOrigin:sourceSize:destinationBuffer:destinationOffset:destinationBytesPerRow:destinationBytesPerImage:options:)**: Encodes a command that copies image data from a slice of a texture instance to a buffer, with options for special texture formats.\n- **copy(sourceTexture:sourceSlice:sourceLevel:sourceOrigin:sourceSize:destinationTexture:destinationSlice:destinationLevel:destinationOrigin:)**: Encodes a command that copies image data from a slice of a texture into a slice of another texture.\n- **copyAndCompact(sourceAccelerationStructure:destinationAccelerationStructure:)**: Encodes a command to copy and compact an acceleration structure.\n- **copyCommands(sourceBuffer:sourceRange:destinationBuffer:destinationIndex:)**: Encodes a command that copies commands from one indirect command buffer into another.\n- **dispatchThreadgroups(indirectBuffer:threadsPerThreadgroup:)**: Encodes a compute dispatch command with a grid that aligns to threadgroup boundaries, using an indirect buffer for arguments.\n- **dispatchThreadgroups(threadgroupsPerGrid:threadsPerThreadgroup:)**: Encodes a compute dispatch command with a grid that aligns to threadgroup boundaries.\n- **dispatchThreads(indirectBuffer:)**: Encodes a compute dispatch command with an arbitrarily sized grid, using an indirect buffer for arguments.\n- **dispatchThreads(threadsPerGrid:threadsPerThreadgroup:)**: Encodes a compute dispatch command using an arbitrarily-sized grid.\n- **executeCommands(buffer:indirectBuffer:)**: Encodes an instruction to execute commands from an indirect command buffer, using an indirect buffer for arguments.\n- **executeCommands(buffer:range:)**: Encodes a command to execute commands from an indirect command buffer.\n- **fill(buffer:range:value:)**: Encodes a command that fills a buffer with a constant value for each byte.\n- **generateMipmaps(texture:)**: Encodes a command that generates mipmaps for a texture instance from the base mipmap level up to the highest mipmap level.\n- **optimizeCommands(buffer:range:)**: Encode a command to attempt to improve the performance of a range of commands within an indirect command buffer.\n- **optimizeContents(forCPUAccess:)**: Encodes a command that modifies the contents of a texture to improve the performance of CPU accesses to its contents.\n- **optimizeContents(forCPUAccess:slice:level:)**: Encodes a command that modifies the contents of a texture to improve the performance of CPU accesses to its contents in a specific region.\n- **optimizeContents(forGPUAccess:)**: Encodes a command that modifies the contents of a texture to improve the performance of GPU accesses to its contents.\n- **optimizeContents(forGPUAccess:slice:level:)**: Encodes a command that modifies the contents of a texture instance to improve the performance of GPU accesses to its contents in a specific region.\n- **refit(sourceAccelerationStructure:descriptor:destinationAccelerationStructure:scratchBuffer:options:)**: Encodes an acceleration structure refit operation into the command buffer, providing additional options.\n- **resetCommands(buffer:range:)**: Encodes a command that resets a range of commands in an indirect command buffer.\n- **setArgumentTable(_:)**: Sets an argument table for the compute shader stage of this pipeline.\n- **setComputePipelineState(_:)**: Configures this encoder with a compute pipeline state that applies to your subsequent dispatch commands.\n- **setImageblockSize(width:height:)**: Specifies the size, in pixels, of imageblock data in tile memory.\n- **setThreadgroupMemoryLength(_:index:)**: Configures the size of a threadgroup memory buffer for a threadgroup argument in the compute shader function.\n- **stages()**: Queries a bitmask representing the shader stages on which commands currently present in this command encoder operate.\n- **writeCompactedSize(sourceAccelerationStructure:destinationBuffer:)**: Encodes a command to compute the size an acceleration structure can compact into, writing the result into a buffer.\n- **writeTimestamp(granularity:counterHeap:index:)**: Writes a GPU timestamp into a heap.\n\n## Encoding a compute pass\n\n- **Creating threads and threadgroups**: Learn how Metal organizes compute-processing workloads.\n- **Calculating threadgroup and grid sizes**: Calculate the optimum sizes for threadgroups and grids when dispatching compute-processing workloads.\n- **MTLComputeCommandEncoder**: An interface for dispatching commands to encode in a compute pass.\n\n## Inherits From\n\n- MTL4CommandEncoder\n- NSObjectProtocol\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Encodes an acceleration structure build into the command buffer.",
          "name" : "build(destinationAccelerationStructure:descriptor:scratchBuffer:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTL4ComputeCommandEncoder\/build(destinationAccelerationStructure:descriptor:scratchBuffer:)"
        },
        {
          "description" : "Encodes an acceleration structure copy operation into the command buffer.",
          "name" : "copy(sourceAccelerationStructure:destinationAccelerationStructure:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTL4ComputeCommandEncoder\/copy(sourceAccelerationStructure:destinationAccelerationStructure:)"
        },
        {
          "description" : "Encodes a command that copies data from a buffer instance into another.",
          "name" : "copy(sourceBuffer:sourceOffset:destinationBuffer:destinationOffset:size:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTL4ComputeCommandEncoder\/copy(sourceBuffer:sourceOffset:destinationBuffer:destinationOffset:size:)"
        },
        {
          "description" : "Encodes a command to copy image data from a buffer into a texture with options for special texture formats.",
          "name" : "copy(sourceBuffer:sourceOffset:sourceBytesPerRow:sourceBytesPerImage:sourceSize:destinationTexture:destinationSlice:destinationLevel:destinationOrigin:options:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTL4ComputeCommandEncoder\/copy(sourceBuffer:sourceOffset:sourceBytesPerRow:sourceBytesPerImage:sourceSize:destinationTexture:destinationSlice:destinationLevel:destinationOrigin:options:)"
        },
        {
          "description" : "Encodes a command to copy data from a tensor instance into another.",
          "name" : "copy(sourceTensor:sourceOrigin:sourceDimensions:destinationTensor:destinationOrigin:destinationDimensions:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTL4ComputeCommandEncoder\/copy(sourceTensor:sourceOrigin:sourceDimensions:destinationTensor:destinationOrigin:destinationDimensions:)"
        },
        {
          "description" : "Encodes a command that copies data from a texture to another.",
          "name" : "copy(sourceTexture:destinationTexture:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTL4ComputeCommandEncoder\/copy(sourceTexture:destinationTexture:)"
        },
        {
          "description" : "Encodes a command that copies slices of a texture to slices of another texture.",
          "name" : "copy(sourceTexture:sourceSlice:sourceLevel:destinationTexture:destinationSlice:destinationLevel:sliceCount:levelCount:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTL4ComputeCommandEncoder\/copy(sourceTexture:sourceSlice:sourceLevel:destinationTexture:destinationSlice:destinationLevel:sliceCount:levelCount:)"
        },
        {
          "description" : "Encodes a command that copies image data from a slice of a texture instance to a buffer, with options for special texture formats.",
          "name" : "copy(sourceTexture:sourceSlice:sourceLevel:sourceOrigin:sourceSize:destinationBuffer:destinationOffset:destinationBytesPerRow:destinationBytesPerImage:options:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTL4ComputeCommandEncoder\/copy(sourceTexture:sourceSlice:sourceLevel:sourceOrigin:sourceSize:destinationBuffer:destinationOffset:destinationBytesPerRow:destinationBytesPerImage:options:)"
        },
        {
          "description" : "Encodes a command that copies image data from a slice of a texture into a slice of another texture.",
          "name" : "copy(sourceTexture:sourceSlice:sourceLevel:sourceOrigin:sourceSize:destinationTexture:destinationSlice:destinationLevel:destinationOrigin:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTL4ComputeCommandEncoder\/copy(sourceTexture:sourceSlice:sourceLevel:sourceOrigin:sourceSize:destinationTexture:destinationSlice:destinationLevel:destinationOrigin:)"
        },
        {
          "description" : "Encodes a command to copy and compact an acceleration structure.",
          "name" : "copyAndCompact(sourceAccelerationStructure:destinationAccelerationStructure:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTL4ComputeCommandEncoder\/copyAndCompact(sourceAccelerationStructure:destinationAccelerationStructure:)"
        },
        {
          "description" : "Encodes a command that copies commands from one indirect command buffer into another.",
          "name" : "copyCommands(sourceBuffer:sourceRange:destinationBuffer:destinationIndex:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTL4ComputeCommandEncoder\/copyCommands(sourceBuffer:sourceRange:destinationBuffer:destinationIndex:)"
        },
        {
          "description" : "Encodes a compute dispatch command with a grid that aligns to threadgroup boundaries, using an indirect buffer for arguments.",
          "name" : "dispatchThreadgroups(indirectBuffer:threadsPerThreadgroup:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTL4ComputeCommandEncoder\/dispatchThreadgroups(indirectBuffer:threadsPerThreadgroup:)"
        },
        {
          "description" : "Encodes a compute dispatch command with a grid that aligns to threadgroup boundaries.",
          "name" : "dispatchThreadgroups(threadgroupsPerGrid:threadsPerThreadgroup:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTL4ComputeCommandEncoder\/dispatchThreadgroups(threadgroupsPerGrid:threadsPerThreadgroup:)"
        },
        {
          "description" : "Encodes a compute dispatch command with an arbitrarily sized grid, using an indirect buffer for arguments.",
          "name" : "dispatchThreads(indirectBuffer:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTL4ComputeCommandEncoder\/dispatchThreads(indirectBuffer:)"
        },
        {
          "description" : "Encodes a compute dispatch command using an arbitrarily-sized grid.",
          "name" : "dispatchThreads(threadsPerGrid:threadsPerThreadgroup:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTL4ComputeCommandEncoder\/dispatchThreads(threadsPerGrid:threadsPerThreadgroup:)"
        },
        {
          "description" : "Encodes an instruction to execute commands from an indirect command buffer, using an indirect buffer for arguments.",
          "name" : "executeCommands(buffer:indirectBuffer:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTL4ComputeCommandEncoder\/executeCommands(buffer:indirectBuffer:)"
        },
        {
          "description" : "Encodes a command to execute commands from an indirect command buffer.",
          "name" : "executeCommands(buffer:range:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTL4ComputeCommandEncoder\/executeCommands(buffer:range:)"
        },
        {
          "description" : "Encodes a command that fills a buffer with a constant value for each byte.",
          "name" : "fill(buffer:range:value:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTL4ComputeCommandEncoder\/fill(buffer:range:value:)"
        },
        {
          "description" : "Encodes a command that generates mipmaps for a texture instance from the base mipmap level up to the highest mipmap level.",
          "name" : "generateMipmaps(texture:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTL4ComputeCommandEncoder\/generateMipmaps(texture:)"
        },
        {
          "description" : "Encode a command to attempt to improve the performance of a range of commands within an indirect command buffer.",
          "name" : "optimizeCommands(buffer:range:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTL4ComputeCommandEncoder\/optimizeCommands(buffer:range:)"
        },
        {
          "description" : "Encodes a command that modifies the contents of a texture to improve the performance of CPU accesses to its contents.",
          "name" : "optimizeContents(forCPUAccess:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTL4ComputeCommandEncoder\/optimizeContents(forCPUAccess:)"
        },
        {
          "description" : "Encodes a command that modifies the contents of a texture to improve the performance of CPU accesses to its contents in a specific region.",
          "name" : "optimizeContents(forCPUAccess:slice:level:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTL4ComputeCommandEncoder\/optimizeContents(forCPUAccess:slice:level:)"
        },
        {
          "description" : "Encodes a command that modifies the contents of a texture to improve the performance of GPU accesses to its contents.",
          "name" : "optimizeContents(forGPUAccess:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTL4ComputeCommandEncoder\/optimizeContents(forGPUAccess:)"
        },
        {
          "description" : "Encodes a command that modifies the contents of a texture instance to improve the performance of GPU accesses to its contents in a specific region.",
          "name" : "optimizeContents(forGPUAccess:slice:level:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTL4ComputeCommandEncoder\/optimizeContents(forGPUAccess:slice:level:)"
        },
        {
          "description" : "Encodes an acceleration structure refit operation into the command buffer, providing additional options.",
          "name" : "refit(sourceAccelerationStructure:descriptor:destinationAccelerationStructure:scratchBuffer:options:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTL4ComputeCommandEncoder\/refit(sourceAccelerationStructure:descriptor:destinationAccelerationStructure:scratchBuffer:options:)"
        },
        {
          "description" : "Encodes a command that resets a range of commands in an indirect command buffer.",
          "name" : "resetCommands(buffer:range:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTL4ComputeCommandEncoder\/resetCommands(buffer:range:)"
        },
        {
          "description" : "Sets an argument table for the compute shader stage of this pipeline.",
          "name" : "setArgumentTable(_:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTL4ComputeCommandEncoder\/setArgumentTable(_:)"
        },
        {
          "description" : "Configures this encoder with a compute pipeline state that applies to your subsequent dispatch commands.",
          "name" : "setComputePipelineState(_:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTL4ComputeCommandEncoder\/setComputePipelineState(_:)"
        },
        {
          "description" : "Specifies the size, in pixels, of imageblock data in tile memory.",
          "name" : "setImageblockSize(width:height:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTL4ComputeCommandEncoder\/setImageblockSize(width:height:)"
        },
        {
          "description" : "Configures the size of a threadgroup memory buffer for a threadgroup argument in the compute shader function.",
          "name" : "setThreadgroupMemoryLength(_:index:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTL4ComputeCommandEncoder\/setThreadgroupMemoryLength(_:index:)"
        },
        {
          "description" : "Queries a bitmask representing the shader stages on which commands currently present in this command encoder operate.",
          "name" : "stages()",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTL4ComputeCommandEncoder\/stages()"
        },
        {
          "description" : "Encodes a command to compute the size an acceleration structure can compact into, writing the result into a buffer.",
          "name" : "writeCompactedSize(sourceAccelerationStructure:destinationBuffer:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTL4ComputeCommandEncoder\/writeCompactedSize(sourceAccelerationStructure:destinationBuffer:)"
        },
        {
          "description" : "Writes a GPU timestamp into a heap.",
          "name" : "writeTimestamp(granularity:counterHeap:index:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTL4ComputeCommandEncoder\/writeTimestamp(granularity:counterHeap:index:)"
        }
      ],
      "title" : "Instance Methods"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "Learn how Metal organizes compute-processing workloads.",
          "name" : "Creating threads and threadgroups",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/creating-threads-and-threadgroups"
        },
        {
          "description" : "Calculate the optimum sizes for threadgroups and grids when dispatching compute-processing workloads.",
          "name" : "Calculating threadgroup and grid sizes",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/calculating-threadgroup-and-grid-sizes"
        },
        {
          "description" : "An interface for dispatching commands to encode in a compute pass.",
          "name" : "MTLComputeCommandEncoder",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTLComputeCommandEncoder"
        }
      ],
      "title" : "Encoding a compute pass"
    },
    {
      "content" : "",
      "items" : [
        {
          "name" : "MTL4CommandEncoder"
        },
        {
          "name" : "NSObjectProtocol"
        }
      ],
      "title" : "Inherits From"
    }
  ],
  "source" : "appleJSON",
  "title" : "MTL4ComputeCommandEncoder",
  "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTL4ComputeCommandEncoder"
}