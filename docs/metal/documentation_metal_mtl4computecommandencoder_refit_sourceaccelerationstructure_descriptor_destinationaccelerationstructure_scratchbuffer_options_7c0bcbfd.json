{
  "abstract" : "Encodes an acceleration structure refit operation into the command buffer, providing additional options.",
  "codeExamples" : [

  ],
  "contentHash" : "47e69aab78edd364f336492724e156e19cf5a167fff71b1204ace290c2fbfd00",
  "crawledAt" : "2025-12-05T10:20:19Z",
  "declaration" : {
    "code" : "func refit(sourceAccelerationStructure: any MTLAccelerationStructure, descriptor: MTL4AccelerationStructureDescriptor, destinationAccelerationStructure: (any MTLAccelerationStructure)?, scratchBuffer: MTL4BufferRange, options: MTLAccelerationStructureRefitOptions = [])",
    "language" : "swift"
  },
  "id" : "D7904A65-B354-4B2F-96AA-8B4695FEBD83",
  "kind" : "method",
  "language" : "swift",
  "module" : "Metal",
  "overview" : "## Discussion\n\nYou refit an acceleration structure to update it when the geometry it references changes. This operation is typically much faster than rebuilding the acceleration structure from scratch. The trade off is that after you refit the acceleration structure, its quality, as well as the performance of any subsequent ray tracing operation degrades, depending on how much the geometry changes.\n\nAfter certain operations, refitting an acceleration structure may not be possible, for example, after adding or removing geometry.\n\nWhen you refit an acceleration structure, you can do so in place, by specifying the same source and destination acceleration structures, or by providing a `nil` destination acceleration structure. If the source and destination acceleration structures aren’t the same, then you are responsible for ensuring they don’t overlap in memory.\n\nTypically, the destination acceleration structure is at least as large as the source acceleration structure, except in cases where you compact the source acceleration structure. In this case, you need to allocate the destination acceleration to be at least as large as the compacted size of the source acceleration structure.\n\nThe scratch buffer you provide for the refit operation needs to be at least as large as the size that the query [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLDevice\/accelerationStructureSizes(descriptor:)] returns. If the size this query returns is zero, you can omit providing a scratch buffer by passing `0` as the address to the `scratchBuffer` parameter.\n\nUse an instance of [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLResidencySet] to mark residency of the scratch buffer the `scratchBuffer` parameter references, as well as for all the instance and primitive acceleration structures you directly and indirectly reference.",
  "platforms" : [
    "iOS",
    "iPadOS",
    "Mac Catalyst",
    "macOS",
    "tvOS",
    "visionOS"
  ],
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/Metal\/MTL4ComputeCommandEncoder\/refit(sourceAccelerationStructure:descriptor:destinationAccelerationStructure:scratchBuffer:options:)\ncrawled: 2025-12-05T10:20:19Z\n---\n\n# refit(sourceAccelerationStructure:descriptor:destinationAccelerationStructure:scratchBuffer:options:)\n\n**Instance Method**\n\nEncodes an acceleration structure refit operation into the command buffer, providing additional options.\n\n## Declaration\n\n```swift\nfunc refit(sourceAccelerationStructure: any MTLAccelerationStructure, descriptor: MTL4AccelerationStructureDescriptor, destinationAccelerationStructure: (any MTLAccelerationStructure)?, scratchBuffer: MTL4BufferRange, options: MTLAccelerationStructureRefitOptions = [])\n```\n\n## Parameters\n\n- **sourceAccelerationStructure**: Acceleration structure to refit.\n- **descriptor**: A descriptor for the acceleration structure to refit.\n- **destinationAccelerationStructure**: Acceleration structure to store the refit result into. If `destinationAccelerationStructure` is `nil`, Metal performs an in-place refit operation of the `sourceAccelerationStructure`.\n- **scratchBuffer**: Scratch buffer Metal can use while refitting the acceleration structure. Metal may overwrite the contents of this buffer, and you should consider them “undefined” after the refit operation starts and completes.\n- **options**: Options specifying the elements of the acceleration structure to refit.\n\n## Discussion\n\nYou refit an acceleration structure to update it when the geometry it references changes. This operation is typically much faster than rebuilding the acceleration structure from scratch. The trade off is that after you refit the acceleration structure, its quality, as well as the performance of any subsequent ray tracing operation degrades, depending on how much the geometry changes.\n\nAfter certain operations, refitting an acceleration structure may not be possible, for example, after adding or removing geometry.\n\nWhen you refit an acceleration structure, you can do so in place, by specifying the same source and destination acceleration structures, or by providing a `nil` destination acceleration structure. If the source and destination acceleration structures aren’t the same, then you are responsible for ensuring they don’t overlap in memory.\n\nTypically, the destination acceleration structure is at least as large as the source acceleration structure, except in cases where you compact the source acceleration structure. In this case, you need to allocate the destination acceleration to be at least as large as the compacted size of the source acceleration structure.\n\nThe scratch buffer you provide for the refit operation needs to be at least as large as the size that the query [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLDevice\/accelerationStructureSizes(descriptor:)] returns. If the size this query returns is zero, you can omit providing a scratch buffer by passing `0` as the address to the `scratchBuffer` parameter.\n\nUse an instance of [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLResidencySet] to mark residency of the scratch buffer the `scratchBuffer` parameter references, as well as for all the instance and primitive acceleration structures you directly and indirectly reference.\n\n",
  "sections" : [

  ],
  "source" : "appleJSON",
  "title" : "refit(sourceAccelerationStructure:descriptor:destinationAccelerationStructure:scratchBuffer:options:)",
  "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTL4ComputeCommandEncoder\/refit(sourceAccelerationStructure:descriptor:destinationAccelerationStructure:scratchBuffer:options:)"
}