{
  "abstract" : "Create a shader library that you can add to an Xcode project with the Metal compiler tools in a command-line environment.",
  "codeExamples" : [
    {
      "code" : "% xcrun -sdk macosx metal -o Shadow.ir  -c Shadow.metal\n% xcrun -sdk macosx metal -o PointLights.ir  -c PointLights.metal\n% xcrun -sdk macosx metal -o DirectionalLight.ir  -c DirectionalLight.metal",
      "language" : "shell"
    },
    {
      "code" : "% xcrun -sdk macosx metal-ar -q Lights.metalar DirectionalLight.ir PointLights.ir",
      "language" : "shell"
    },
    {
      "code" : "% xcrun -sdk macosx metallib -o LightsAndShadow.metallib Lights.metalar Shadow.ir",
      "language" : "shell"
    }
  ],
  "contentHash" : "d0e3a1777b99bc3bde75bd95ac4e0a916149f3dc7e048d5eb14c89d8b3537153",
  "crawledAt" : "2025-12-03T14:30:33Z",
  "id" : "55862C82-9078-4C95-A144-B55E5182E912",
  "kind" : "article",
  "language" : "swift",
  "module" : "Metal",
  "overview" : "## Overview\n\nManually compile your Metal Shading Language (MSL) source files into a Metal shader library outside of an Xcode project with the Metal command-line tools. The `metal` compiler tool converts each shader source file into an intermediate representation file. The `metallib` and `metal-ar` tools then compile intermediate representation files into a library and a binary archive, respectively.\n\n\n\nYou can create a library from one or more intermediate representation files, one or more archive files, or a combination of both.\n\n### Compile a shader source file into a library\n\nThe simplest way to compile and build a single MSL source file into a library file is with two commands. The first command invokes the `metal` compiler tool, which compiles the source file into an intermediate representation file.\n\nThe `-o` option indicates the output file name and the `-c` option tells the tool to preprocess, compile, and assemble the source file.\n\nOptionally, you can combine several intermediate representation files into a single Metal archive with the `metal-ar` tool.\n\nThe `-q` option tells the tool to quickly append to its argument, which creates a new archive file if it doesn’t already exist.\n\nBuild a Metal library from one or more intermediate representation files, one or more archive files, or a combination of both with the `metallib` command.\n\nThe command produces a Metal library that your app can load at runtime. One way to do this is by adding it to your project’s build targets in Xcode.\n\n### Retrieve and load a library\n\nAt runtime, you can access a library by creating an [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLLibrary] instance with the [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLDevice\/makeLibrary(URL:)] method.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/Metal\/building-a-shader-library-by-precompiling-source-files\ncrawled: 2025-12-03T14:30:33Z\n---\n\n# Building a shader library by precompiling source files\n\n**Article**\n\nCreate a shader library that you can add to an Xcode project with the Metal compiler tools in a command-line environment.\n\n## Overview\n\nManually compile your Metal Shading Language (MSL) source files into a Metal shader library outside of an Xcode project with the Metal command-line tools. The `metal` compiler tool converts each shader source file into an intermediate representation file. The `metallib` and `metal-ar` tools then compile intermediate representation files into a library and a binary archive, respectively.\n\n\n\nYou can create a library from one or more intermediate representation files, one or more archive files, or a combination of both.\n\n### Compile a shader source file into a library\n\nThe simplest way to compile and build a single MSL source file into a library file is with two commands. The first command invokes the `metal` compiler tool, which compiles the source file into an intermediate representation file.\n\n```shell\n% xcrun -sdk macosx metal -o Shadow.ir  -c Shadow.metal\n% xcrun -sdk macosx metal -o PointLights.ir  -c PointLights.metal\n% xcrun -sdk macosx metal -o DirectionalLight.ir  -c DirectionalLight.metal\n```\n\nThe `-o` option indicates the output file name and the `-c` option tells the tool to preprocess, compile, and assemble the source file.\n\n\n\nOptionally, you can combine several intermediate representation files into a single Metal archive with the `metal-ar` tool.\n\n```shell\n% xcrun -sdk macosx metal-ar -q Lights.metalar DirectionalLight.ir PointLights.ir\n```\n\nThe `-q` option tells the tool to quickly append to its argument, which creates a new archive file if it doesn’t already exist.\n\nBuild a Metal library from one or more intermediate representation files, one or more archive files, or a combination of both with the `metallib` command.\n\n```shell\n% xcrun -sdk macosx metallib -o LightsAndShadow.metallib Lights.metalar Shadow.ir\n```\n\nThe command produces a Metal library that your app can load at runtime. One way to do this is by adding it to your project’s build targets in Xcode.\n\n\n\n### Retrieve and load a library\n\nAt runtime, you can access a library by creating an [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLLibrary] instance with the [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLDevice\/makeLibrary(URL:)] method.\n\n\n\n## Working with Metal intermediate representation libraries\n\n- **Minimizing the binary size of a shader library**: Reduce the storage footprint of your shaders, and potentially reduce their compile time, by selecting the Metal compiler’s size optimization option.\n- **Generating and loading a Metal library symbol file**: Debug your Metal shaders from your production apps by creating companion symbol files at compile time and loading them at debug time.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Reduce the storage footprint of your shaders, and potentially reduce their compile time, by selecting the Metal compiler’s size optimization option.",
          "name" : "Minimizing the binary size of a shader library",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/minimizing-the-binary-size-of-a-shader-library"
        },
        {
          "description" : "Debug your Metal shaders from your production apps by creating companion symbol files at compile time and loading them at debug time.",
          "name" : "Generating and loading a Metal library symbol file",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/generating-and-loading-a-metal-library-symbol-file"
        }
      ],
      "title" : "Working with Metal intermediate representation libraries"
    }
  ],
  "source" : "appleJSON",
  "title" : "Building a shader library by precompiling source files",
  "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/building-a-shader-library-by-precompiling-source-files"
}