{
  "abstract" : "Reduce the storage footprint of your shaders, and potentially reduce their compile time, by selecting the Metal compiler’s size optimization option.",
  "codeExamples" : [
    {
      "code" : "% xcrun -sdk macosx metal -Os Shadows.metal",
      "language" : "shell"
    }
  ],
  "contentHash" : "8a694088ad7e0b8b12f3e4d074507540d5389a40a406442380965ffad7f2bcaf",
  "crawledAt" : "2025-12-01T19:35:30Z",
  "id" : "30D8FCFE-CEE0-40B9-9F1D-967081A124A8",
  "kind" : "article",
  "module" : "Metal",
  "overview" : "## Overview\n\nBy default, the Metal compiler optimizes your shader code for runtime speed. For example, the compiler may use *inlining* or *loop unrolling*, techniques that make copies of executable code to avoid branch penalties at runtime. Depending on the specifics of your shader code, these runtime-optimization efforts can significantly increase your shader library’s binary size and your shaders’ compile time.\n\nYou can change the compiler’s optimization setting so that it prioritizes minimizing a binary’s size. The compiler avoids the techniques that duplicate code, minimizing your shader library’s size and typically shortening compile time as well.\n\nA shader library’s binary size, compile time performance, and runtime performance depend largely on the code’s complexity. Check to see which of the shader compiler’s optimization settings work best for your app and workflow. Consider using the Metal compiler’s size optimization option if the compilation generates binaries that are too big for your app or take too long to compile.\n\nYou can set the Metal compiler’s size optimization option in the following ways:\n\nThe simplest way to compile your shaders is to have Xcode compile them along with the rest of your app. As your shaders increase in complexity, size, or build time, you may consider precompiling them with the Metal command-line tools to avoid compiling them in Xcode. Some apps may need to compile shaders on the device, at runtime, with the Metal API.\n\n### Compile shaders at build time\n\nTo optimize for size while compiling shaders at build time, set the Metal compiler’s size optimization setting in Xcode:\n\n\n\nXcode passes this setting to the Metal compiler each time you build a target that includes shader code.\n\n### Precompile shaders on the command line\n\nFor apps that use numerous or complex shaders, consider precompiling your shaders outside of Xcode to save build time each time you compile your app. For more information on manually compiling your shader library, see [doc:\/\/com.apple.metal\/documentation\/Metal\/building-a-shader-library-by-precompiling-source-files].\n\nTo optimize for size when compiling a Metal shader source file in a command-line environment, such as Terminal, use the Metal compiler’s `-Os` optimization option.\n\n### Compile shaders at runtime\n\nIf you want to compile shaders at runtime, your app can configure the Metal API to optimize for size. For some apps, it may be more practical to compile a shader on the device when the app is running, typically to reduce the app’s storage size. You can also compile shaders at runtime for rapid prototyping and debugging.\n\nThis approach reduces your app’s build time by deferring its shader compilation to when your app runs on a person’s device, but your app may take noticeably longer to load on initial launches.\n\nTo minimize binary size when compiling a shader library on a device:",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/Metal\/minimizing-the-binary-size-of-a-shader-library\ncrawled: 2025-12-01T19:35:30Z\n---\n\n# Minimizing the binary size of a shader library\n\n**Article**\n\nReduce the storage footprint of your shaders, and potentially reduce their compile time, by selecting the Metal compiler’s size optimization option.\n\n## Overview\n\nBy default, the Metal compiler optimizes your shader code for runtime speed. For example, the compiler may use *inlining* or *loop unrolling*, techniques that make copies of executable code to avoid branch penalties at runtime. Depending on the specifics of your shader code, these runtime-optimization efforts can significantly increase your shader library’s binary size and your shaders’ compile time.\n\nYou can change the compiler’s optimization setting so that it prioritizes minimizing a binary’s size. The compiler avoids the techniques that duplicate code, minimizing your shader library’s size and typically shortening compile time as well.\n\nA shader library’s binary size, compile time performance, and runtime performance depend largely on the code’s complexity. Check to see which of the shader compiler’s optimization settings work best for your app and workflow. Consider using the Metal compiler’s size optimization option if the compilation generates binaries that are too big for your app or take too long to compile.\n\nYou can set the Metal compiler’s size optimization option in the following ways:\n\n- In Xcode 14 or later\n- From the command line\n- At runtime using the Metal API\n\nThe simplest way to compile your shaders is to have Xcode compile them along with the rest of your app. As your shaders increase in complexity, size, or build time, you may consider precompiling them with the Metal command-line tools to avoid compiling them in Xcode. Some apps may need to compile shaders on the device, at runtime, with the Metal API.\n\n### Compile shaders at build time\n\nTo optimize for size while compiling shaders at build time, set the Metal compiler’s size optimization setting in Xcode:\n\n1. Click a build target in your project.\n2. Click the Builds Settings tab, and filter for the Metal compiler.\n3. Under Metal Compiler - Build Options, set the Optimization Level to `Size [-Os]`.\n\n\n\nXcode passes this setting to the Metal compiler each time you build a target that includes shader code.\n\n### Precompile shaders on the command line\n\nFor apps that use numerous or complex shaders, consider precompiling your shaders outside of Xcode to save build time each time you compile your app. For more information on manually compiling your shader library, see [doc:\/\/com.apple.metal\/documentation\/Metal\/building-a-shader-library-by-precompiling-source-files].\n\nTo optimize for size when compiling a Metal shader source file in a command-line environment, such as Terminal, use the Metal compiler’s `-Os` optimization option.\n\n```shell\n% xcrun -sdk macosx metal -Os Shadows.metal\n```\n\n\n\n### Compile shaders at runtime\n\nIf you want to compile shaders at runtime, your app can configure the Metal API to optimize for size. For some apps, it may be more practical to compile a shader on the device when the app is running, typically to reduce the app’s storage size. You can also compile shaders at runtime for rapid prototyping and debugging.\n\nThis approach reduces your app’s build time by deferring its shader compilation to when your app runs on a person’s device, but your app may take noticeably longer to load on initial launches.\n\nTo minimize binary size when compiling a shader library on a device:\n\n1. Create an [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCompileOptions] instance.\n2. Set its [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCompileOptions\/optimizationLevel] property to [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLLibraryOptimizationLevel\/size].\n3. Compile your library with an [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLDevice] instance’s [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLDevice\/makeLibrary(source:options:)] or [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLDevice\/makeLibrary(source:options:completionHandler:)] method.\n\n## Working with Metal intermediate representation libraries\n\n- **Building a shader library by precompiling source files**: Create a shader library that you can add to an Xcode project with the Metal compiler tools in a command-line environment.\n- **Generating and loading a Metal library symbol file**: Debug your Metal shaders from your production apps by creating companion symbol files at compile time and loading them at debug time.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Create a shader library that you can add to an Xcode project with the Metal compiler tools in a command-line environment.",
          "name" : "Building a shader library by precompiling source files",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/building-a-shader-library-by-precompiling-source-files"
        },
        {
          "description" : "Debug your Metal shaders from your production apps by creating companion symbol files at compile time and loading them at debug time.",
          "name" : "Generating and loading a Metal library symbol file",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/generating-and-loading-a-metal-library-symbol-file"
        }
      ],
      "title" : "Working with Metal intermediate representation libraries"
    }
  ],
  "source" : "appleJSON",
  "title" : "Minimizing the binary size of a shader library",
  "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/minimizing-the-binary-size-of-a-shader-library"
}