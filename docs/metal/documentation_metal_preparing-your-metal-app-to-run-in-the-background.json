{
  "abstract" : "Prepare your app to move into the background by pausing future GPU use and ensuring previous work is scheduled.",
  "codeExamples" : [

  ],
  "contentHash" : "4e62df0641c30748d1d5acbe16769dd1f9551dd1b7c131fef646f1f47ae99f2f",
  "crawledAt" : "2025-12-03T12:52:31Z",
  "id" : "2C51737C-6F4A-4CF2-B4D4-7B5AFA8E87CE",
  "kind" : "article",
  "language" : "swift",
  "module" : "Metal",
  "overview" : "## Overview\n\niOS and tvOS restrict a background app’s access to the GPU, to guarantee foreground app performance. If a Metal command queue tries to schedule command buffers after the app moves in the background, the system prevents those commands from executing. When UIKit notifies you that your app is being suspended or moved into the background, your app needs to restrict its use of Metal.\n\nFor more information on the UIKit app life cycle, see [doc:\/\/com.apple.documentation\/documentation\/UIKit\/preparing-your-ui-to-run-in-the-background].\n\n### Disable code that commits new command buffers\n\nWhen your app is deactivated, stop sending work to Metal. Enable that code only after your app is reactivated.\n\nAfter the system notifies your app that it’s being deactivated, you’ve some time before the system restricts your app from using Metal. You can schedule additional commands if that work is critical to prepare your app to be in the background state. Similarly, if your app was already in the middle of encoding commands, your app can typically finish the current task before disabling further work. For example, if your app renders frames of animation to the screen, and you receive the notification while you’re encoding commands for a new frame, you can finish encoding that frame before disabling your rendering code.\n\n### Ensure all previous work is scheduled for execution\n\nWhen UIKit calls your app delegate’s [doc:\/\/com.apple.documentation\/documentation\/UIKit\/UIApplicationDelegate\/applicationDidEnterBackground(_:)] method, make sure Metal has scheduled all command buffers you’ve already committed before your app returns control to the system. On each command queue, if the last command buffer you queued isn’t already scheduled or complete, call [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandBuffer\/waitUntilScheduled()] to force it to be scheduled.\n\nIf you’re in the middle of encoding a new command buffer, you can combine these steps. Finish encoding commands to render the frame and commit the command buffer, then call [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandBuffer\/waitUntilScheduled()].\n\nAfter your app moves into the background, if Metal sees a new command buffer from your app, it returns an error, rather than scheduling the command buffer. To test for this error, add a completion handler by calling the [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandBuffer\/addCompletedHandler(_:)] method. In your completion handler, confirm the command buffer is in an error state by checking the following properties:",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/Metal\/preparing-your-metal-app-to-run-in-the-background\ncrawled: 2025-12-03T12:52:31Z\n---\n\n# Preparing your Metal app to run in the background\n\n**Article**\n\nPrepare your app to move into the background by pausing future GPU use and ensuring previous work is scheduled.\n\n## Overview\n\niOS and tvOS restrict a background app’s access to the GPU, to guarantee foreground app performance. If a Metal command queue tries to schedule command buffers after the app moves in the background, the system prevents those commands from executing. When UIKit notifies you that your app is being suspended or moved into the background, your app needs to restrict its use of Metal.\n\nFor more information on the UIKit app life cycle, see [doc:\/\/com.apple.documentation\/documentation\/UIKit\/preparing-your-ui-to-run-in-the-background].\n\n### Disable code that commits new command buffers\n\nWhen your app is deactivated, stop sending work to Metal. Enable that code only after your app is reactivated.\n\nAfter the system notifies your app that it’s being deactivated, you’ve some time before the system restricts your app from using Metal. You can schedule additional commands if that work is critical to prepare your app to be in the background state. Similarly, if your app was already in the middle of encoding commands, your app can typically finish the current task before disabling further work. For example, if your app renders frames of animation to the screen, and you receive the notification while you’re encoding commands for a new frame, you can finish encoding that frame before disabling your rendering code.\n\n### Ensure all previous work is scheduled for execution\n\nWhen UIKit calls your app delegate’s [doc:\/\/com.apple.documentation\/documentation\/UIKit\/UIApplicationDelegate\/applicationDidEnterBackground(_:)] method, make sure Metal has scheduled all command buffers you’ve already committed before your app returns control to the system. On each command queue, if the last command buffer you queued isn’t already scheduled or complete, call [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandBuffer\/waitUntilScheduled()] to force it to be scheduled.\n\nIf you’re in the middle of encoding a new command buffer, you can combine these steps. Finish encoding commands to render the frame and commit the command buffer, then call [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandBuffer\/waitUntilScheduled()].\n\nAfter your app moves into the background, if Metal sees a new command buffer from your app, it returns an error, rather than scheduling the command buffer. To test for this error, add a completion handler by calling the [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandBuffer\/addCompletedHandler(_:)] method. In your completion handler, confirm the command buffer is in an error state by checking the following properties:\n\n- The [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandBuffer\/status] property is equal to [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandBufferStatus\/error]\n- The [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandBuffer\/error] property is equal to [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandBufferError-swift.struct\/Code\/notPermitted]\n\n",
  "sections" : [

  ],
  "source" : "appleJSON",
  "title" : "Preparing your Metal app to run in the background",
  "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/preparing-your-metal-app-to-run-in-the-background"
}