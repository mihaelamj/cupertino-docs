{
  "abstract" : "Apply your own tone mapping to get the exact behavior you want.",
  "codeExamples" : [
    {
      "code" : "CAMetalLayer *metalLayer = [CAMetalLayer new];\nmetalLayer.wantsExtendedDynamicRangeContent = YES;\nmetalLayer.pixelFormat = MTLPixelFormatRGBA16Float;\nconst CFStringRef name = kCGColorSpaceExtendedLinearSRGB;\nCGColorSpaceRef colorspace = CGColorSpaceCreateWithName(name);\nmetalLayer.colorspace = colorspace;\nCGColorSpaceRelease(colorspace);",
      "language" : "objective-c"
    },
    {
      "code" : "id<MTLDrawable> drawable = metalLayer.nextDrawable;\nNSScreen *screen = view.window.screen;\nfloat maxEDR = screen.maximumExtendedDynamicRangeColorComponentValue;\n\/\/ <encode Metal commands to process the frame.",
      "language" : "objective-c"
    }
  ],
  "contentHash" : "6156e6ada39ec38cfe9d9613ca4d4b0e8e2d6c9c9800c8b34642297a6ab072e8",
  "crawledAt" : "2025-12-02T15:54:21Z",
  "id" : "B9EA9D16-3F67-40F4-9389-51E09A27085D",
  "kind" : "article",
  "language" : "swift",
  "module" : "Metal",
  "overview" : "## Overview\n\nTo perform your own EDR tone mapping, create a Metal layer, give it an extended linear color space, and set its [doc:\/\/com.apple.documentation\/documentation\/QuartzCore\/CAMetalLayer\/wantsExtendedDynamicRangeContent] property to [doc:\/\/com.apple.documentation\/documentation\/Swift\/true]. For example, the code below creates a Metal layer with an extended color space that linearly maps pixel values to luminance values:\n\n### Understand EDR pixel values\n\nOn Macs that support EDR, a `1.0` value for a pixel corresponds to the maximum standard dynamic range (SDR) brightness level, but this brightness level doesn’t have to correspond to the maximum brightness of the display. If the display can produce higher brightness levels, additional range (headroom) may be available.  The amount of headroom may vary, depending on the actual display characteristics:\n\n### Map your content to the available range\n\nThe actual upper bound on displayable values may vary from moment to moment. To determine the current upper bound, read the [doc:\/\/com.apple.documentation\/documentation\/AppKit\/NSScreen] object’s [doc:\/\/com.apple.documentation\/documentation\/AppKit\/NSScreen\/maximumExtendedDynamicRangeColorComponentValue] property. Note that even on a display that supports EDR, the current maximum might be 1.0, if the display is set to the maximum possible brightness.\n\nThe following code reads the [doc:\/\/com.apple.documentation\/documentation\/AppKit\/NSScreen\/maximumExtendedDynamicRangeColorComponentValue] property as part of the work it does to process a frame. When rendering the frame, map all values to be between `0` and the current maximum value. If you specify values above this value, the system clamps the value to be no higher than the current maximum value.\n\nRegister for the [doc:\/\/com.apple.documentation\/documentation\/AppKit\/NSApplication\/didChangeScreenParametersNotification] notification to be informed when the current maximum value changes for a display. Also, note that a user may move the content to a different display.\n\nIf you have content that exceeds the current capabilities of the display, decide how you want to present that to the user. For example, you might tone map the content into the available range (adapting the content each time you render a frame), or you might notify the user that some of the content is beyond the capability of the display. When users increase the brightness, they typically expect midtones to increase and highlights to be compressed to fit into the range of the display.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/Metal\/performing-your-own-tone-mapping\ncrawled: 2025-12-02T15:54:21Z\n---\n\n# Performing your own tone mapping\n\n**Article**\n\nApply your own tone mapping to get the exact behavior you want.\n\n## Overview\n\nTo perform your own EDR tone mapping, create a Metal layer, give it an extended linear color space, and set its [doc:\/\/com.apple.documentation\/documentation\/QuartzCore\/CAMetalLayer\/wantsExtendedDynamicRangeContent] property to [doc:\/\/com.apple.documentation\/documentation\/Swift\/true]. For example, the code below creates a Metal layer with an extended color space that linearly maps pixel values to luminance values:\n\n```objective-c\nCAMetalLayer *metalLayer = [CAMetalLayer new];\nmetalLayer.wantsExtendedDynamicRangeContent = YES;\nmetalLayer.pixelFormat = MTLPixelFormatRGBA16Float;\nconst CFStringRef name = kCGColorSpaceExtendedLinearSRGB;\nCGColorSpaceRef colorspace = CGColorSpaceCreateWithName(name);\nmetalLayer.colorspace = colorspace;\nCGColorSpaceRelease(colorspace);\n```\n\n### Understand EDR pixel values\n\nOn Macs that support EDR, a `1.0` value for a pixel corresponds to the maximum standard dynamic range (SDR) brightness level, but this brightness level doesn’t have to correspond to the maximum brightness of the display. If the display can produce higher brightness levels, additional range (headroom) may be available.  The amount of headroom may vary, depending on the actual display characteristics:\n\n- If the UI brightness level is at `100` nits and the panel is capable of a maximum brightness of `400` nits, then enabling EDR allows values up to `4.0` to be displayed at `400` nits.\n- On the same panel, if the user adjusts the UI brightness level to `200` nits, then 1.0 values are displayed at `200` nits, and `2.0` values are at `400` nits.\n\n### Map your content to the available range\n\nThe actual upper bound on displayable values may vary from moment to moment. To determine the current upper bound, read the [doc:\/\/com.apple.documentation\/documentation\/AppKit\/NSScreen] object’s [doc:\/\/com.apple.documentation\/documentation\/AppKit\/NSScreen\/maximumExtendedDynamicRangeColorComponentValue] property. Note that even on a display that supports EDR, the current maximum might be 1.0, if the display is set to the maximum possible brightness.\n\nThe following code reads the [doc:\/\/com.apple.documentation\/documentation\/AppKit\/NSScreen\/maximumExtendedDynamicRangeColorComponentValue] property as part of the work it does to process a frame. When rendering the frame, map all values to be between `0` and the current maximum value. If you specify values above this value, the system clamps the value to be no higher than the current maximum value.\n\n```objective-c\nid<MTLDrawable> drawable = metalLayer.nextDrawable;\nNSScreen *screen = view.window.screen;\nfloat maxEDR = screen.maximumExtendedDynamicRangeColorComponentValue;\n\/\/ <encode Metal commands to process the frame.\n```\n\nRegister for the [doc:\/\/com.apple.documentation\/documentation\/AppKit\/NSApplication\/didChangeScreenParametersNotification] notification to be informed when the current maximum value changes for a display. Also, note that a user may move the content to a different display.\n\nIf you have content that exceeds the current capabilities of the display, decide how you want to present that to the user. For example, you might tone map the content into the available range (adapting the content each time you render a frame), or you might notify the user that some of the content is beyond the capability of the display. When users increase the brightness, they typically expect midtones to increase and highlights to be compressed to fit into the range of the display.\n\n## High dynamic range content\n\n- **Processing HDR images with Metal**: Implement a post-processing pipeline using the latest features on Apple GPUs.\n- **Displaying HDR content in a Metal layer**: Bring your high dynamic range (HDR) content to compatible Mac displays.\n- **Determining support for EDR values**: Check whether a display supports EDR.\n- **Using color spaces to display HDR content**: Use a color space when you don’t need to edit or process the pixel data.\n- **Using system tone mapping on video content**: Use EDR metadata to apply the default system tone mapping to a layer.\n- **Implementing tone mapping on reference displays**: Detect reference displays and keep your content within the capabilities of the display hardware.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Implement a post-processing pipeline using the latest features on Apple GPUs.",
          "name" : "Processing HDR images with Metal",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/processing-hdr-images-with-metal"
        },
        {
          "description" : "Bring your high dynamic range (HDR) content to compatible Mac displays.",
          "name" : "Displaying HDR content in a Metal layer",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/displaying-hdr-content-in-a-metal-layer"
        },
        {
          "description" : "Check whether a display supports EDR.",
          "name" : "Determining support for EDR values",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/determining-support-for-edr-values"
        },
        {
          "description" : "Use a color space when you don’t need to edit or process the pixel data.",
          "name" : "Using color spaces to display HDR content",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/using-color-spaces-to-display-hdr-content"
        },
        {
          "description" : "Use EDR metadata to apply the default system tone mapping to a layer.",
          "name" : "Using system tone mapping on video content",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/using-system-tone-mapping-on-video-content"
        },
        {
          "description" : "Detect reference displays and keep your content within the capabilities of the display hardware.",
          "name" : "Implementing tone mapping on reference displays",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/implementing-tone-mapping-on-reference-displays"
        }
      ],
      "title" : "High dynamic range content"
    }
  ],
  "source" : "appleJSON",
  "title" : "Performing your own tone mapping",
  "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/performing-your-own-tone-mapping"
}