{
  "abstract" : "Encodes commands that build and refit acceleration structures for a single pass.",
  "codeExamples" : [

  ],
  "contentHash" : "6aeb610347421c5a69e6bca7f234ebcf104ec08b6577bc9f6bc4973c5a26c253",
  "crawledAt" : "2025-12-05T10:26:19Z",
  "declaration" : {
    "code" : "protocol MTLAccelerationStructureCommandEncoder : MTLCommandEncoder",
    "language" : "swift"
  },
  "id" : "1674B2C6-01FB-4F4A-80C4-ABA7550F7947",
  "kind" : "protocol",
  "language" : "swift",
  "module" : "Metal",
  "overview" : "## Overview\n\nCreate an acceleration structure encoder by calling one of the factory methods on an [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandBuffer] instance, such as [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandBuffer\/makeAccelerationStructureCommandEncoder()].\n\n### Command stages\n\nMost commands apply to one stage within a pass. The following table shows which stage applies to each command:\n\nFor more information about stages and synchronization, see [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLStages] and [doc:\/\/com.apple.metal\/documentation\/Metal\/resource-synchronization].",
  "platforms" : [
    "iOS",
    "iPadOS",
    "Mac Catalyst",
    "macOS",
    "tvOS",
    "visionOS"
  ],
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/metal\/mtlaccelerationstructurecommandencoder\ncrawled: 2025-12-05T10:26:19Z\n---\n\n# MTLAccelerationStructureCommandEncoder\n\n**Protocol**\n\nEncodes commands that build and refit acceleration structures for a single pass.\n\n## Declaration\n\n```swift\nprotocol MTLAccelerationStructureCommandEncoder : MTLCommandEncoder\n```\n\n## Overview\n\nCreate an acceleration structure encoder by calling one of the factory methods on an [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandBuffer] instance, such as [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandBuffer\/makeAccelerationStructureCommandEncoder()].\n\n### Command stages\n\nMost commands apply to one stage within a pass. The following table shows which stage applies to each command:\n\n\n\nFor more information about stages and synchronization, see [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLStages] and [doc:\/\/com.apple.metal\/documentation\/Metal\/resource-synchronization].\n\n## Building an acceleration structure\n\n- **build(accelerationStructure:descriptor:scratchBuffer:scratchBufferOffset:)**: Encodes a command to build a new acceleration structure.\n\n## Copying an acceleration structure\n\n- **copy(sourceAccelerationStructure:destinationAccelerationStructure:)**: Encodes a command to copy the data from one acceleration structure to another.\n- **writeCompactedSize(accelerationStructure:buffer:offset:)**: Encodes a command to calculate the compacted size of an acceleration structure.\n- **writeCompactedSize(accelerationStructure:buffer:offset:sizeDataType:)**: Encodes a command to calculate the compacted size of an acceleration structure, taking into account the size of the output data.\n- **copyAndCompact(sourceAccelerationStructure:destinationAccelerationStructure:)**: Encodes a command to compact an acceleration structure’s data and copy it into a different acceleration structure.\n\n## Refitting an acceleration structure\n\n- **refit(sourceAccelerationStructure:descriptor:destinationAccelerationStructure:scratchBuffer:scratchBufferOffset:)**: Updates an acceleration structure with new geometry or instance data.\n- **refit(sourceAccelerationStructure:descriptor:destinationAccelerationStructure:scratchBuffer:scratchBufferOffset:options:)**: Updates an acceleration structure with new geometry or instance data, with options that control the refitting process.\n\n## Preventing resource access conflicts\n\n- **updateFence(_:)**: Encodes a command that instructs the GPU to update a fence after the acceleration structure pass completes.\n- **waitForFence(_:)**: Encodes a command that instructs the GPU to pause the acceleration structure pass until another pass updates a fence.\n\n## Making indirect resources resident\n\n- **useHeap(_:)**: Makes the resources contained in the specified heap available to the acceleration structure pass.\n- **useHeaps(_:)**: Makes the resources contained in the specified heaps available to the acceleration structure pass.\n- **useResource(_:usage:)**: Makes a resource available to the acceleration structure pass.\n- **useResources(_:usage:)**: Makes multiple resources available to the acceleration structure pass.\n- **MTLResourceUsage**: Options that describe how a graphics or compute function uses an argument buffer’s resource.\n\n## Sampling counters\n\n- **sampleCounters(sampleBuffer:sampleIndex:barrier:)**: Encodes a command to sample hardware counters at this point in the acceleration structure pass and store the samples into a counter sample buffer.\n\n## Acceleration structures\n\n- **Improving ray-tracing data access using per-primitive data**: Simplify data access and improve GPU utilization by storing custom primitive data directly in the acceleration structure.\n- **MTLAccelerationStructure**: A collection of model data for GPU-accelerated intersection of rays with the model.\n- **MTL4AccelerationStructureDescriptor**: Base class for Metal 4 acceleration structure descriptors.\n- **MTLAccelerationStructureDescriptor**: A base class for classes that define the configuration for a new acceleration structure.\n- **MTL4PrimitiveAccelerationStructureDescriptor**: Descriptor for a primitive acceleration structure that directly references geometric shapes, such as triangles and bounding boxes.\n- **MTLPrimitiveAccelerationStructureDescriptor**: A description of an acceleration structure that contains geometry primitives.\n- **MTL4InstanceAccelerationStructureDescriptor**: Descriptor for an instance acceleration structure.\n- **MTLInstanceAccelerationStructureDescriptor**: A description of an acceleration structure that derives from instances of primitive acceleration structures.\n- **MTLAccelerationStructureUsage**: Options that affect how Metal builds an acceleration structure and the behavior of that acceleration structure.\n- **MTLAccelerationStructureRefitOptions**\n\n## Inherits From\n\n- MTLCommandEncoder\n- NSObjectProtocol\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Encodes a command to build a new acceleration structure.",
          "name" : "build(accelerationStructure:descriptor:scratchBuffer:scratchBufferOffset:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTLAccelerationStructureCommandEncoder\/build(accelerationStructure:descriptor:scratchBuffer:scratchBufferOffset:)"
        }
      ],
      "title" : "Building an acceleration structure"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "Encodes a command to copy the data from one acceleration structure to another.",
          "name" : "copy(sourceAccelerationStructure:destinationAccelerationStructure:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTLAccelerationStructureCommandEncoder\/copy(sourceAccelerationStructure:destinationAccelerationStructure:)"
        },
        {
          "description" : "Encodes a command to calculate the compacted size of an acceleration structure.",
          "name" : "writeCompactedSize(accelerationStructure:buffer:offset:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTLAccelerationStructureCommandEncoder\/writeCompactedSize(accelerationStructure:buffer:offset:)"
        },
        {
          "description" : "Encodes a command to calculate the compacted size of an acceleration structure, taking into account the size of the output data.",
          "name" : "writeCompactedSize(accelerationStructure:buffer:offset:sizeDataType:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTLAccelerationStructureCommandEncoder\/writeCompactedSize(accelerationStructure:buffer:offset:sizeDataType:)"
        },
        {
          "description" : "Encodes a command to compact an acceleration structure’s data and copy it into a different acceleration structure.",
          "name" : "copyAndCompact(sourceAccelerationStructure:destinationAccelerationStructure:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTLAccelerationStructureCommandEncoder\/copyAndCompact(sourceAccelerationStructure:destinationAccelerationStructure:)"
        }
      ],
      "title" : "Copying an acceleration structure"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "Updates an acceleration structure with new geometry or instance data.",
          "name" : "refit(sourceAccelerationStructure:descriptor:destinationAccelerationStructure:scratchBuffer:scratchBufferOffset:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTLAccelerationStructureCommandEncoder\/refit(sourceAccelerationStructure:descriptor:destinationAccelerationStructure:scratchBuffer:scratchBufferOffset:)"
        },
        {
          "description" : "Updates an acceleration structure with new geometry or instance data, with options that control the refitting process.",
          "name" : "refit(sourceAccelerationStructure:descriptor:destinationAccelerationStructure:scratchBuffer:scratchBufferOffset:options:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTLAccelerationStructureCommandEncoder\/refit(sourceAccelerationStructure:descriptor:destinationAccelerationStructure:scratchBuffer:scratchBufferOffset:options:)"
        }
      ],
      "title" : "Refitting an acceleration structure"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "Encodes a command that instructs the GPU to update a fence after the acceleration structure pass completes.",
          "name" : "updateFence(_:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTLAccelerationStructureCommandEncoder\/updateFence(_:)"
        },
        {
          "description" : "Encodes a command that instructs the GPU to pause the acceleration structure pass until another pass updates a fence.",
          "name" : "waitForFence(_:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTLAccelerationStructureCommandEncoder\/waitForFence(_:)"
        }
      ],
      "title" : "Preventing resource access conflicts"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "Makes the resources contained in the specified heap available to the acceleration structure pass.",
          "name" : "useHeap(_:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTLAccelerationStructureCommandEncoder\/useHeap(_:)"
        },
        {
          "description" : "Makes the resources contained in the specified heaps available to the acceleration structure pass.",
          "name" : "useHeaps(_:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTLAccelerationStructureCommandEncoder\/useHeaps(_:)"
        },
        {
          "description" : "Makes a resource available to the acceleration structure pass.",
          "name" : "useResource(_:usage:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTLAccelerationStructureCommandEncoder\/useResource(_:usage:)"
        },
        {
          "description" : "Makes multiple resources available to the acceleration structure pass.",
          "name" : "useResources(_:usage:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTLAccelerationStructureCommandEncoder\/useResources(_:usage:)"
        },
        {
          "description" : "Options that describe how a graphics or compute function uses an argument buffer’s resource.",
          "name" : "MTLResourceUsage",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTLResourceUsage"
        }
      ],
      "title" : "Making indirect resources resident"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "Encodes a command to sample hardware counters at this point in the acceleration structure pass and store the samples into a counter sample buffer.",
          "name" : "sampleCounters(sampleBuffer:sampleIndex:barrier:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTLAccelerationStructureCommandEncoder\/sampleCounters(sampleBuffer:sampleIndex:barrier:)"
        }
      ],
      "title" : "Sampling counters"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "Simplify data access and improve GPU utilization by storing custom primitive data directly in the acceleration structure.",
          "name" : "Improving ray-tracing data access using per-primitive data",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/improving-ray-tracing-data-access-using-per-primitive-data"
        },
        {
          "description" : "A collection of model data for GPU-accelerated intersection of rays with the model.",
          "name" : "MTLAccelerationStructure",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTLAccelerationStructure"
        },
        {
          "description" : "Base class for Metal 4 acceleration structure descriptors.",
          "name" : "MTL4AccelerationStructureDescriptor",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTL4AccelerationStructureDescriptor"
        },
        {
          "description" : "A base class for classes that define the configuration for a new acceleration structure.",
          "name" : "MTLAccelerationStructureDescriptor",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTLAccelerationStructureDescriptor"
        },
        {
          "description" : "Descriptor for a primitive acceleration structure that directly references geometric shapes, such as triangles and bounding boxes.",
          "name" : "MTL4PrimitiveAccelerationStructureDescriptor",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTL4PrimitiveAccelerationStructureDescriptor"
        },
        {
          "description" : "A description of an acceleration structure that contains geometry primitives.",
          "name" : "MTLPrimitiveAccelerationStructureDescriptor",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTLPrimitiveAccelerationStructureDescriptor"
        },
        {
          "description" : "Descriptor for an instance acceleration structure.",
          "name" : "MTL4InstanceAccelerationStructureDescriptor",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTL4InstanceAccelerationStructureDescriptor"
        },
        {
          "description" : "A description of an acceleration structure that derives from instances of primitive acceleration structures.",
          "name" : "MTLInstanceAccelerationStructureDescriptor",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTLInstanceAccelerationStructureDescriptor"
        },
        {
          "description" : "Options that affect how Metal builds an acceleration structure and the behavior of that acceleration structure.",
          "name" : "MTLAccelerationStructureUsage",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTLAccelerationStructureUsage"
        },
        {
          "description" : "",
          "name" : "MTLAccelerationStructureRefitOptions",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTLAccelerationStructureRefitOptions"
        }
      ],
      "title" : "Acceleration structures"
    },
    {
      "content" : "",
      "items" : [
        {
          "name" : "MTLCommandEncoder"
        },
        {
          "name" : "NSObjectProtocol"
        }
      ],
      "title" : "Inherits From"
    }
  ],
  "source" : "appleJSON",
  "title" : "MTLAccelerationStructureCommandEncoder",
  "url" : "https:\/\/developer.apple.com\/documentation\/metal\/mtlaccelerationstructurecommandencoder"
}