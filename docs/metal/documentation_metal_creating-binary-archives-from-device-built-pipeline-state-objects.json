{
  "abstract" : "Write your Metal pipeline states to a binary archive at app runtime, and build binaries for any supported GPU.",
  "codeExamples" : [
    {
      "code" : "$ xcrun -sdk macosx metal-lipo device.binary.metallib -archs\napplegpu_g13g air64_v26",
      "language" : "shell"
    },
    {
      "code" : "% xcrun metal-source -flatbuffers=json device-compiled.binary.metallib -o extracted-source",
      "language" : "shell"
    },
    {
      "code" : "% cp $(find extracted-source -type f -name '*.mtlp-json') .\/metal-build.mtlp-json",
      "language" : "shell"
    },
    {
      "code" : "  \"libraries\": {\n    \"paths\": [\n      {\n        \"label\": \"1D54EB2B266CDA015BA52C746856B43364E8204D7FB39B18E0C95882F132E4C0\",\n        \"path\": \".\/xcode-compiled-library.metallib\"\n      }\n    ]\n  },",
      "language" : "json"
    },
    {
      "code" : "% xcrun -sdk iphoneos metal-tt -target air64-apple-ios16.0 -gpu-family metal3 .\/metal-build.mtlp-json -o precompiled.binary.metallib",
      "language" : "shell"
    },
    {
      "code" : "% xcrun metal-lipo .\/precompiled.binary.metallib -archs\napplegpu_g12p applegpu_g13p applegpu_g13g applegpu_g14p applegpu_g14g applegpu_g16p applegpu_g15p",
      "language" : "shell"
    }
  ],
  "contentHash" : "49e0d1e087e617f6e77573b5eb6a56219d6e61604cc34265cde6398b98ea533a",
  "crawledAt" : "2025-12-01T19:35:32Z",
  "id" : "45BA9BB1-9385-4354-9B0D-910651689C3B",
  "kind" : "article",
  "module" : "Metal",
  "overview" : "## Overview\n\nWhen building your shaders at runtime, Metal uses pipeline state descriptors in addition to the Metal intermediate representation (IR) it compiles from your shader functions. To build binary archives for distribution, the compiler needs some information about your app’s Metal pipelines, and a way to interpret them. When serializing a binary archive to device storage from your app, Metal includes a pipeline configuration script with it. The Metal translator is the part of the compiler that reads these configurations, and enables GPU-specific compilation for platforms other than the host GPU. Invoke the translator with the `metal-tt` command in Terminal or from a build script.\n\n\n\nThis article explains how to serialize an [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLBinaryArchive] instance, extract the binary archive from an app you deploy to a device in Xcode, and provide it to the Metal translator to create GPU binaries for your project. You can use the code examples in this article with the app and shaders from the [doc:\/\/com.apple.metal\/documentation\/Metal\/drawing-a-triangle-with-metal-4] sample. Another common approach is to create a small command-line tool that loads and compiles your shaders to an initial binary archive in macOS, which you can integrate as part your app’s build scripts.\n\n### Create a Metal binary archive in your app\n\nCreate an instance of [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLBinaryArchive] from an [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLBinaryArchiveDescriptor] with a `nil` [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLBinaryArchiveDescriptor\/url] property. This instructs Metal to create, rather than load, a binary archive. After creating the archive, add all pipeline descriptors you use in your encoder to the binary archive. The following code example performs these steps for an [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLDevice] instance named `device` and an [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLRenderPipelineDescriptor] instance named `pipelineStateDescriptor`:\n\nAfter adding pipeline descriptors to the binary archive, serialize it to storage. The following code example shows how to serialize an [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLBinaryArchive] instance to device storage:\n\nRun your app on a device to create a Metal binary archive at the URL in your code.\n\n### Extract the binary archive from your app\n\nAfter running your app, the resulting binary archive contains a single binary slice for the GPU architecture of your target device. In macOS, you can access the archive directly on your development computer at the path `${HOME}\/Library\/Application Support\/${BUNDLE_ID}\/${LIBRARY_NAME}.binary.metallib`.\n\nFor archived binaries you produce on another type of device, retrieve them as follows:\n\n\n\nUse `metal-lipo -archs` to inspect a binary archive and display the compiled GPU architectures. For example, a MacBook M1 Pro produces an `applegpu_g13g` binary archive.\n\nNote that binary archives still contain a Metal IR slice, `air64_v26`. Metal may invalidate binaries when upgrading a device’s operating system, and shaders recompile from the Metal IR in the archive.\n\n### Copy and modify the configuration script\n\nThe pipeline state that Metal builds during binary serialization is a *pipeline configuration script*, a JSON file with the extension `mtlp-json`. This is the data you retrieve from the binary archive and modify to compile new binary slices. Start by extracting the Metal binaries and configuration script from the archive using the `metal-source` command-line tool in Terminal.\n\nWithin the `extracted-source` directory is the configuration script that Metal uses to drive compilation. This file has a generated name ending with the extension `mtlp-json`. Use the `find` command in Terminal to locate and copy the file to `metal-build.mtlp-json` in the current directory.\n\nYou also need the path to a library that contains a Metal IR slice for your shaders. Xcode compiles these shaders into the default Metal library when you build your app.\n\nIn the copied configuration script, you tell the Metal translator where to locate the Metal library from Xcode, and script a section that determines which GPUs to compile for. Open the created `metal-build.mtlp-json` file in a text editor and modify the `path` value to reference the path of your locally compiled library from Xcode.\n\nRun the `metal-tt` command-line tool in Terminal to generate a new archived binary. The following command builds for devices running iOS 16 that support Metal 3:\n\nAny compatible device can load the `precompiled.binary.metallib` and skip runtime compilation of shaders. Running the `metal-lipo` command-line tool shows the available architectures.\n\n### Add your compiled binary archive to your app\n\nTo use this newly created Metal binary archive, you need to add it to your Xcode project’s bundle resources. Add the `precompiled.binary.metallib` archive to your project’s Copy Bundle Resources build phase. For instructions, see [doc:\/\/com.apple.documentation\/documentation\/Xcode\/customizing-the-build-phases-of-a-target].\n\nFor Metal to take advantage of precompiled binaries, load them with [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLDevice\/makeBinaryArchive(descriptor:)] and provide an [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLBinaryArchiveDescriptor] with a [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLBinaryArchiveDescriptor\/url] pointing to the binary archive. Then add them to a pipeline descriptor instance’s [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLRenderPipelineDescriptor\/binaryArchives] property.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/Metal\/creating-binary-archives-from-device-built-pipeline-state-objects\ncrawled: 2025-12-01T19:35:32Z\n---\n\n# Creating binary archives from device-built pipeline state objects\n\n**Article**\n\nWrite your Metal pipeline states to a binary archive at app runtime, and build binaries for any supported GPU.\n\n## Overview\n\nWhen building your shaders at runtime, Metal uses pipeline state descriptors in addition to the Metal intermediate representation (IR) it compiles from your shader functions. To build binary archives for distribution, the compiler needs some information about your app’s Metal pipelines, and a way to interpret them. When serializing a binary archive to device storage from your app, Metal includes a pipeline configuration script with it. The Metal translator is the part of the compiler that reads these configurations, and enables GPU-specific compilation for platforms other than the host GPU. Invoke the translator with the `metal-tt` command in Terminal or from a build script.\n\n\n\nThis article explains how to serialize an [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLBinaryArchive] instance, extract the binary archive from an app you deploy to a device in Xcode, and provide it to the Metal translator to create GPU binaries for your project. You can use the code examples in this article with the app and shaders from the [doc:\/\/com.apple.metal\/documentation\/Metal\/drawing-a-triangle-with-metal-4] sample. Another common approach is to create a small command-line tool that loads and compiles your shaders to an initial binary archive in macOS, which you can integrate as part your app’s build scripts.\n\n\n\n### Create a Metal binary archive in your app\n\nCreate an instance of [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLBinaryArchive] from an [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLBinaryArchiveDescriptor] with a `nil` [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLBinaryArchiveDescriptor\/url] property. This instructs Metal to create, rather than load, a binary archive. After creating the archive, add all pipeline descriptors you use in your encoder to the binary archive. The following code example performs these steps for an [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLDevice] instance named `device` and an [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLRenderPipelineDescriptor] instance named `pipelineStateDescriptor`:\n\n\n\n\n\nAfter adding pipeline descriptors to the binary archive, serialize it to storage. The following code example shows how to serialize an [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLBinaryArchive] instance to device storage:\n\n\n\n\n\nRun your app on a device to create a Metal binary archive at the URL in your code.\n\n### Extract the binary archive from your app\n\nAfter running your app, the resulting binary archive contains a single binary slice for the GPU architecture of your target device. In macOS, you can access the archive directly on your development computer at the path `${HOME}\/Library\/Application Support\/${BUNDLE_ID}\/${LIBRARY_NAME}.binary.metallib`.\n\nFor archived binaries you produce on another type of device, retrieve them as follows:\n\n1. Connect your device with the app that contains the archived binary to your development computer.\n2. In Xcode, choose Window > Devices and Simulators.\n3. Click the Devices tab and select the device and app you want to extract the binary from.\n4. Click the More (…) icon, select Download Container, and save the container to a location on your development computer.\n5. In Finder, navigate to the container’s saved location, Control-click it, and select Show Package Contents to open it.\n6. Copy the binary archive located at `AppData\/Library\/Application Support\/${LIBRARY_NAME}.binary.metallib` to another directory.\n\n\n\nUse `metal-lipo -archs` to inspect a binary archive and display the compiled GPU architectures. For example, a MacBook M1 Pro produces an `applegpu_g13g` binary archive.\n\n```shell\n$ xcrun -sdk macosx metal-lipo device.binary.metallib -archs\napplegpu_g13g air64_v26\n```\n\nNote that binary archives still contain a Metal IR slice, `air64_v26`. Metal may invalidate binaries when upgrading a device’s operating system, and shaders recompile from the Metal IR in the archive.\n\n### Copy and modify the configuration script\n\nThe pipeline state that Metal builds during binary serialization is a *pipeline configuration script*, a JSON file with the extension `mtlp-json`. This is the data you retrieve from the binary archive and modify to compile new binary slices. Start by extracting the Metal binaries and configuration script from the archive using the `metal-source` command-line tool in Terminal.\n\n```shell\n% xcrun metal-source -flatbuffers=json device-compiled.binary.metallib -o extracted-source\n```\n\nWithin the `extracted-source` directory is the configuration script that Metal uses to drive compilation. This file has a generated name ending with the extension `mtlp-json`. Use the `find` command in Terminal to locate and copy the file to `metal-build.mtlp-json` in the current directory.\n\n```shell\n% cp $(find extracted-source -type f -name '*.mtlp-json') .\/metal-build.mtlp-json\n```\n\nYou also need the path to a library that contains a Metal IR slice for your shaders. Xcode compiles these shaders into the default Metal library when you build your app.\n\nIn the copied configuration script, you tell the Metal translator where to locate the Metal library from Xcode, and script a section that determines which GPUs to compile for. Open the created `metal-build.mtlp-json` file in a text editor and modify the `path` value to reference the path of your locally compiled library from Xcode.\n\n```json\n  \"libraries\": {\n    \"paths\": [\n      {\n        \"label\": \"1D54EB2B266CDA015BA52C746856B43364E8204D7FB39B18E0C95882F132E4C0\",\n        \"path\": \".\/xcode-compiled-library.metallib\"\n      }\n    ]\n  },\n```\n\n\n\nRun the `metal-tt` command-line tool in Terminal to generate a new archived binary. The following command builds for devices running iOS 16 that support Metal 3:\n\n```shell\n% xcrun -sdk iphoneos metal-tt -target air64-apple-ios16.0 -gpu-family metal3 .\/metal-build.mtlp-json -o precompiled.binary.metallib\n```\n\n\n\nAny compatible device can load the `precompiled.binary.metallib` and skip runtime compilation of shaders. Running the `metal-lipo` command-line tool shows the available architectures.\n\n```shell\n% xcrun metal-lipo .\/precompiled.binary.metallib -archs\napplegpu_g12p applegpu_g13p applegpu_g13g applegpu_g14p applegpu_g14g applegpu_g16p applegpu_g15p\n```\n\n### Add your compiled binary archive to your app\n\nTo use this newly created Metal binary archive, you need to add it to your Xcode project’s bundle resources. Add the `precompiled.binary.metallib` archive to your project’s Copy Bundle Resources build phase. For instructions, see [doc:\/\/com.apple.documentation\/documentation\/Xcode\/customizing-the-build-phases-of-a-target].\n\nFor Metal to take advantage of precompiled binaries, load them with [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLDevice\/makeBinaryArchive(descriptor:)] and provide an [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLBinaryArchiveDescriptor] with a [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLBinaryArchiveDescriptor\/url] pointing to the binary archive. Then add them to a pipeline descriptor instance’s [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLRenderPipelineDescriptor\/binaryArchives] property.\n\n\n\n\n\n## Working with Metal binary archives\n\n- **Manipulating Metal binary archives**: Split precompiled binaries into individual slices, and combine them back together for targeted distribution.\n- **Compiling binary archives from a custom configuration script**: Define how the Metal translator builds binary archives without precompiled binaries as a starting source.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Split precompiled binaries into individual slices, and combine them back together for targeted distribution.",
          "name" : "Manipulating Metal binary archives",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/manipulating-metal-binary-archives"
        },
        {
          "description" : "Define how the Metal translator builds binary archives without precompiled binaries as a starting source.",
          "name" : "Compiling binary archives from a custom configuration script",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/compiling-binary-archives-from-a-custom-configuration-script"
        }
      ],
      "title" : "Working with Metal binary archives"
    }
  ],
  "source" : "appleJSON",
  "title" : "Creating binary archives from device-built pipeline state objects",
  "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/creating-binary-archives-from-device-built-pipeline-state-objects"
}