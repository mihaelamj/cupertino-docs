{
  "abstract" : "A synchronization mechanism that orders memory operations between GPU passes.",
  "codeExamples" : [

  ],
  "contentHash" : "07193a3b625a83f21f0821dbca293a00bb4c10472ee7ff8f8ad790400e4a1d8d",
  "crawledAt" : "2025-12-01T09:02:29Z",
  "declaration" : {
    "code" : "protocol MTLFence : NSObjectProtocol, Sendable",
    "language" : "swift"
  },
  "id" : "6D87FB8A-6F4D-47DC-9E8A-9CF90E9A4815",
  "kind" : "protocol",
  "module" : "Metal",
  "overview" : "## Overview\n\nCreate a fence by calling the [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLDevice\/makeFence()] method.\n\nA fence instructs the GPU to finish running specific stages of a pass before starting stages from another pass. This is useful when a pass needs to wait before loading data from a resource until after another pass stores data to that resource. For example, to synchronize two passes where one modifies a texture and another reads it, use a fence with the following steps:\n\nApple family GPUs can update and respond to fences on a per-stage basis. This means a GPU can delay running the commands for specific stages that need to wait for another pass while it runs other stages from the same pass. For example, a GPU can run the vertex stage of a pass while the fragment stage waits until another pass updates a fence. For more information about Apple family GPUs, see the [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLDevice\/supportsFamily(_:)] method, and the [https:\/\/developer.apple.com\/metal\/Metal-Feature-Set-Tables.pdf] or the equivalent [https:\/\/developer.apple.com\/metal\/Metal-Feature-Set-Tables.zip].\n\nThe following encoder types support the [doc:\/\/com.apple.metal\/documentation\/Metal\/MTL4CommandEncoder\/updateFence(_:afterEncoderStages:)] and [doc:\/\/com.apple.metal\/documentation\/Metal\/MTL4CommandEncoder\/waitForFence(_:beforeEncoderStages:)] methods by conforming to the [doc:\/\/com.apple.metal\/documentation\/Metal\/MTL4CommandEncoder] protocol:\n\nThe encoder types that inherit the [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandEncoder] protocol each have methods for updating and waiting for fences.\n\n### Submit producing passes before consuming passes\n\nSend producing passes that update a fence to a queue before submitting consuming passes that wait for a fence. When encoding the producing and consuming passes into the same command buffer, encode the producing passes before the consuming passes. When submitting the producing and consuming passes in different command buffers, commit the command buffers with the producing passes before those with the consuming passes.\n\nFences can synchronize passes you submit to different queues, including [doc:\/\/com.apple.metal\/documentation\/Metal\/MTL4CommandQueue], [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandQueue], or a combination of both.",
  "platforms" : [
    "iOS",
    "iPadOS",
    "Mac Catalyst",
    "macOS",
    "tvOS",
    "visionOS"
  ],
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/Metal\/MTLFence\ncrawled: 2025-12-01T09:02:29Z\n---\n\n# MTLFence\n\n**Protocol**\n\nA synchronization mechanism that orders memory operations between GPU passes.\n\n## Declaration\n\n```swift\nprotocol MTLFence : NSObjectProtocol, Sendable\n```\n\n## Overview\n\nCreate a fence by calling the [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLDevice\/makeFence()] method.\n\nA fence instructs the GPU to finish running specific stages of a pass before starting stages from another pass. This is useful when a pass needs to wait before loading data from a resource until after another pass stores data to that resource. For example, to synchronize two passes where one modifies a texture and another reads it, use a fence with the following steps:\n\n1. Encode the producing pass and update a fence after the commands that modify the texture.\n2. Encode the consuming pass and wait for the same fence before the commands that read from that texture.\n\nApple family GPUs can update and respond to fences on a per-stage basis. This means a GPU can delay running the commands for specific stages that need to wait for another pass while it runs other stages from the same pass. For example, a GPU can run the vertex stage of a pass while the fragment stage waits until another pass updates a fence. For more information about Apple family GPUs, see the [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLDevice\/supportsFamily(_:)] method, and the [https:\/\/developer.apple.com\/metal\/Metal-Feature-Set-Tables.pdf] or the equivalent [https:\/\/developer.apple.com\/metal\/Metal-Feature-Set-Tables.zip].\n\nThe following encoder types support the [doc:\/\/com.apple.metal\/documentation\/Metal\/MTL4CommandEncoder\/updateFence(_:afterEncoderStages:)] and [doc:\/\/com.apple.metal\/documentation\/Metal\/MTL4CommandEncoder\/waitForFence(_:beforeEncoderStages:)] methods by conforming to the [doc:\/\/com.apple.metal\/documentation\/Metal\/MTL4CommandEncoder] protocol:\n\n- [doc:\/\/com.apple.metal\/documentation\/Metal\/MTL4RenderCommandEncoder]\n- [doc:\/\/com.apple.metal\/documentation\/Metal\/MTL4ComputeCommandEncoder]\n- [doc:\/\/com.apple.metal\/documentation\/Metal\/MTL4MachineLearningCommandEncoder]\n\nThe encoder types that inherit the [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandEncoder] protocol each have methods for updating and waiting for fences.\n\n\n\n\n\n### Submit producing passes before consuming passes\n\nSend producing passes that update a fence to a queue before submitting consuming passes that wait for a fence. When encoding the producing and consuming passes into the same command buffer, encode the producing passes before the consuming passes. When submitting the producing and consuming passes in different command buffers, commit the command buffers with the producing passes before those with the consuming passes.\n\n\n\nFences can synchronize passes you submit to different queues, including [doc:\/\/com.apple.metal\/documentation\/Metal\/MTL4CommandQueue], [doc:\/\/com.apple.metal\/documentation\/Metal\/MTLCommandQueue], or a combination of both.\n\n\n\n## Identifying a fence\n\n- **device**: The device object that created the fence.\n- **label**: A string that identifies the fence.\n\n## Selecting render stages\n\n- **MTLRenderStages**: The stages in a render pass that triggers a synchronization command.\n\n## Synchronizing with barriers and fences\n\n- **Synchronizing stages within a pass**: Block GPU stages in the a pass from running until other stages in the same pass finish.\n- **Synchronizing passes with a fence**: Block GPU stages in a pass until another pass unblocks it by signaling a fence.\n- **Synchronizing passes with consumer barriers**: Block GPU stages in a pass, and all subsequent passes, from running until stages from earlier passes finish.\n- **Synchronizing passes with producer barriers**: Block GPU stages in subsequent passes from running until stages in a pass, and earlier passes, finish.\n- **Synchronizing CPU and GPU work**: Avoid stalls between CPU and GPU work by using multiple instances of a resource.\n- **Implementing a multistage image filter using heaps and fences**: Use fences to synchronize access to resources allocated on a heap.\n- **MTLStages**: Describes stages of GPU work.\n- **MTLRenderStages**: The stages in a render pass that triggers a synchronization command.\n- **MTLBarrierScope**: Describes the types of resources that a barrier operates on.\n- **MTL4VisibilityOptions**: Memory consistency options for synchronization commands.\n\n## Inherits From\n\n- NSObjectProtocol\n- Sendable\n- SendableMetatype\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "The device object that created the fence.",
          "name" : "device",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTLFence\/device"
        },
        {
          "description" : "A string that identifies the fence.",
          "name" : "label",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTLFence\/label"
        }
      ],
      "title" : "Identifying a fence"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "The stages in a render pass that triggers a synchronization command.",
          "name" : "MTLRenderStages",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTLRenderStages"
        }
      ],
      "title" : "Selecting render stages"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "Block GPU stages in the a pass from running until other stages in the same pass finish.",
          "name" : "Synchronizing stages within a pass",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/synchronizing-stages-within-a-pass"
        },
        {
          "description" : "Block GPU stages in a pass until another pass unblocks it by signaling a fence.",
          "name" : "Synchronizing passes with a fence",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/synchronizing-passes-with-a-fence"
        },
        {
          "description" : "Block GPU stages in a pass, and all subsequent passes, from running until stages from earlier passes finish.",
          "name" : "Synchronizing passes with consumer barriers",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/synchronizing-passes-with-consumer-barriers"
        },
        {
          "description" : "Block GPU stages in subsequent passes from running until stages in a pass, and earlier passes, finish.",
          "name" : "Synchronizing passes with producer barriers",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/synchronizing-passes-with-producer-barriers"
        },
        {
          "description" : "Avoid stalls between CPU and GPU work by using multiple instances of a resource.",
          "name" : "Synchronizing CPU and GPU work",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/synchronizing-cpu-and-gpu-work"
        },
        {
          "description" : "Use fences to synchronize access to resources allocated on a heap.",
          "name" : "Implementing a multistage image filter using heaps and fences",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/implementing-a-multistage-image-filter-using-heaps-and-fences"
        },
        {
          "description" : "Describes stages of GPU work.",
          "name" : "MTLStages",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTLStages"
        },
        {
          "description" : "The stages in a render pass that triggers a synchronization command.",
          "name" : "MTLRenderStages",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTLRenderStages"
        },
        {
          "description" : "Describes the types of resources that a barrier operates on.",
          "name" : "MTLBarrierScope",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTLBarrierScope"
        },
        {
          "description" : "Memory consistency options for synchronization commands.",
          "name" : "MTL4VisibilityOptions",
          "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTL4VisibilityOptions"
        }
      ],
      "title" : "Synchronizing with barriers and fences"
    },
    {
      "content" : "",
      "items" : [
        {
          "name" : "NSObjectProtocol"
        },
        {
          "name" : "Sendable"
        },
        {
          "name" : "SendableMetatype"
        }
      ],
      "title" : "Inherits From"
    }
  ],
  "source" : "appleJSON",
  "title" : "MTLFence",
  "url" : "https:\/\/developer.apple.com\/documentation\/Metal\/MTLFence"
}