{
  "abstract" : "Figure out why App Transport Security denies a network connection.",
  "codeExamples" : [
    {
      "code" : "$ \/usr\/bin\/nscurl --ats-diagnostics --verbose https:\/\/example.com",
      "language" : "sh"
    },
    {
      "code" : "Starting ATS Diagnostics\n\nConfiguring ATS Info.plist keys and displaying the result of HTTPS loads to https:\/\/example.com.\nA test will \"PASS\" if URLSession:task:didCompleteWithError: returns a nil error.\n================================================================================\n\nDefault ATS Secure Connection\n---\nATS Default Connection\nATS Dictionary:\n{\n}\nResult : PASS\n---\n\n================================================================================\n\nAllowing Arbitrary Loads\n\n---\nAllow All Loads\nATS Dictionary:\n{\n    NSAllowsArbitraryLoads = true;\n}\nResult : PASS\n---\n\n...",
      "language" : "console"
    },
    {
      "code" : "...\n\nAllowing Arbitrary Loads\n\n---\nAllow All Loads\nATS Dictionary:\n{\n    NSAllowsArbitraryLoads = true;\n}\nResult : FAIL\nError : Error Domain=NSURLErrorDomain Code=-1202 \"The certificate for this server is invalid...\n\n...",
      "language" : "console"
    },
    {
      "code" : "{\n    NSExceptionDomains =     {\n        \"example.com\" =         {\n            NSExceptionRequiresForwardSecrecy = false;\n        };\n    };\n}",
      "language" : "console"
    }
  ],
  "contentHash" : "fc253fb83bf9028f199c2bba19d0c2f141d4df8c1310dd8ed67f938db3069625",
  "crawledAt" : "2025-12-04T19:18:27Z",
  "id" : "989FFB2F-1381-4571-B9C8-F67987506E21",
  "kind" : "article",
  "language" : "swift",
  "module" : "Security",
  "overview" : "## Overview\n\nIf your app experiences connectivity problems that you think might be related to App Transport Security (ATS), be sure that:\n\n### Check Combinations of ATS Exceptions\n\nThe `nscurl` command accepts the `--ats-diagnostics` flag that asks it to check how a particular server responds to combinations of ATS exceptions. For example, you can test the canonical example web site:\n\nIn addition to running with no exceptions at all, the tool tests the global exception key [doc:\/\/com.apple.documentation\/documentation\/BundleResources\/Information-Property-List\/NSAppTransportSecurity\/NSAllowsArbitraryLoads], as well as a variety of combinations of the exception domain keys [doc:\/\/com.apple.documentation\/documentation\/BundleResources\/Information-Property-List\/NSExceptionMinimumTLSVersion], [doc:\/\/com.apple.documentation\/documentation\/BundleResources\/Information-Property-List\/NSExceptionRequiresForwardSecrecy], and [doc:\/\/com.apple.documentation\/documentation\/BundleResources\/Information-Property-List\/NSExceptionAllowsInsecureHTTPLoads]. `nscurl` outputs the results of all these tests to the terminal:\n\n### Look for Basic Security Failures\n\nIf globally allowing arbitrary loads fails, the problem isn’t related to ATS. For example, if the server’s certificate doesn’t match the DNS name of the server, the connection fails default server trust evaluation before ATS has a chance to impose its extended security checks:\n\nWhen you see this failure, check that your certificate meets the default server trust evaluation requirements described in [doc:\/\/com.apple.security\/documentation\/Security\/preventing-insecure-network-connections#Ensure-the-Network-Server-Meets-Minimum-Requirements]. For example, make sure the certificate matches the DNS name of the server and that the certificate isn’t expired.\n\n### Consider Specific ATS Exceptions\n\nIf the ATS default test fails but the arbitrary loads test passes, you might need to reconfigure your server. Use the remaining tests to help pinpoint the problem. For example, consider the test with the following exceptions dictionary:\n\nIf simply disabling forward secrecy results in a passing test, you need to reconfigure your server to support perfect forward secrecy (PFS) through Elliptic Curve Diffie-Hellman Ephemeral (ECDHE) key exchange. If you can’t do that, you might need to add the [doc:\/\/com.apple.documentation\/documentation\/BundleResources\/Information-Property-List\/NSExceptionRequiresForwardSecrecy] exception to your app instead, as described in [doc:\/\/com.apple.security\/documentation\/Security\/preventing-insecure-network-connections#Configure-Exceptions-Only-When-Needed-Prefer-Server-Fixes].",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/Security\/identifying-the-source-of-blocked-connections\ncrawled: 2025-12-04T19:18:27Z\n---\n\n# Identifying the Source of Blocked Connections\n\n**Article**\n\nFigure out why App Transport Security denies a network connection.\n\n## Overview\n\nIf your app experiences connectivity problems that you think might be related to App Transport Security (ATS), be sure that:\n\n- You’re using high-level network frameworks and secure URLs, as described in [doc:\/\/com.apple.security\/documentation\/Security\/preventing-insecure-network-connections#Prefer-High-Level-Frameworks-in-Your-App].\n- Your server is properly configured. Use the `nscurl` command line tool on your Mac to check how the server’s configuration affects ATS behavior.\n\n### Check Combinations of ATS Exceptions\n\nThe `nscurl` command accepts the `--ats-diagnostics` flag that asks it to check how a particular server responds to combinations of ATS exceptions. For example, you can test the canonical example web site:\n\n```sh\n$ \/usr\/bin\/nscurl --ats-diagnostics --verbose https:\/\/example.com\n```\n\nIn addition to running with no exceptions at all, the tool tests the global exception key [doc:\/\/com.apple.documentation\/documentation\/BundleResources\/Information-Property-List\/NSAppTransportSecurity\/NSAllowsArbitraryLoads], as well as a variety of combinations of the exception domain keys [doc:\/\/com.apple.documentation\/documentation\/BundleResources\/Information-Property-List\/NSExceptionMinimumTLSVersion], [doc:\/\/com.apple.documentation\/documentation\/BundleResources\/Information-Property-List\/NSExceptionRequiresForwardSecrecy], and [doc:\/\/com.apple.documentation\/documentation\/BundleResources\/Information-Property-List\/NSExceptionAllowsInsecureHTTPLoads]. `nscurl` outputs the results of all these tests to the terminal:\n\n```console\nStarting ATS Diagnostics\n\nConfiguring ATS Info.plist keys and displaying the result of HTTPS loads to https:\/\/example.com.\nA test will \"PASS\" if URLSession:task:didCompleteWithError: returns a nil error.\n================================================================================\n\nDefault ATS Secure Connection\n---\nATS Default Connection\nATS Dictionary:\n{\n}\nResult : PASS\n---\n\n================================================================================\n\nAllowing Arbitrary Loads\n\n---\nAllow All Loads\nATS Dictionary:\n{\n    NSAllowsArbitraryLoads = true;\n}\nResult : PASS\n---\n\n...\n```\n\n### Look for Basic Security Failures\n\nIf globally allowing arbitrary loads fails, the problem isn’t related to ATS. For example, if the server’s certificate doesn’t match the DNS name of the server, the connection fails default server trust evaluation before ATS has a chance to impose its extended security checks:\n\n```console\n...\n\nAllowing Arbitrary Loads\n\n---\nAllow All Loads\nATS Dictionary:\n{\n    NSAllowsArbitraryLoads = true;\n}\nResult : FAIL\nError : Error Domain=NSURLErrorDomain Code=-1202 \"The certificate for this server is invalid...\n\n...\n```\n\nWhen you see this failure, check that your certificate meets the default server trust evaluation requirements described in [doc:\/\/com.apple.security\/documentation\/Security\/preventing-insecure-network-connections#Ensure-the-Network-Server-Meets-Minimum-Requirements]. For example, make sure the certificate matches the DNS name of the server and that the certificate isn’t expired.\n\n### Consider Specific ATS Exceptions\n\nIf the ATS default test fails but the arbitrary loads test passes, you might need to reconfigure your server. Use the remaining tests to help pinpoint the problem. For example, consider the test with the following exceptions dictionary:\n\n```console\n{\n    NSExceptionDomains =     {\n        \"example.com\" =         {\n            NSExceptionRequiresForwardSecrecy = false;\n        };\n    };\n}\n```\n\nIf simply disabling forward secrecy results in a passing test, you need to reconfigure your server to support perfect forward secrecy (PFS) through Elliptic Curve Diffie-Hellman Ephemeral (ECDHE) key exchange. If you can’t do that, you might need to add the [doc:\/\/com.apple.documentation\/documentation\/BundleResources\/Information-Property-List\/NSExceptionRequiresForwardSecrecy] exception to your app instead, as described in [doc:\/\/com.apple.security\/documentation\/Security\/preventing-insecure-network-connections#Configure-Exceptions-Only-When-Needed-Prefer-Server-Fixes].\n\n",
  "sections" : [

  ],
  "source" : "appleJSON",
  "title" : "Identifying the Source of Blocked Connections",
  "url" : "https:\/\/developer.apple.com\/documentation\/Security\/identifying-the-source-of-blocked-connections"
}