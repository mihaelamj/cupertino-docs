{
  "abstract" : "Notarize your app from the command line to handle special distribution cases.",
  "codeExamples" : [
    {
      "code" : "EXPORT_PATH=\"$TEMP_DIR\/Export\"\n\/usr\/bin\/xcodebuild -exportArchive -archivePath \"$ARCHIVE_PATH\" -exportOptionsPlist \"$SRCROOT\/ExportOptions.plist\" -exportPath \"$EXPORT_PATH\"",
      "language" : "sh"
    },
    {
      "code" : "APP_PATH=\"$EXPORT_PATH\/$PRODUCT_NAME.app\"\nZIP_PATH=\"$EXPORT_PATH\/$PRODUCT_NAME.zip\"\n\n# Create a ZIP archive suitable for notarization.\n\/usr\/bin\/ditto -c -k --keepParent \"$APP_PATH\" \"$ZIP_PATH\"\n\n# As a convenience, open the export folder in Finder.\n\/usr\/bin\/open \"$EXPORT_PATH\"",
      "language" : "sh"
    },
    {
      "code" : "% sudo xcode-select -s \/path\/to\/Xcode13.app",
      "language" : "sh"
    },
    {
      "code" : "% xcrun notarytool submit OvernightTextEditor_11.6.8.zip\n                   --keychain-profile \"notarytool-password\"\n                   --wait\n                   --webhook \"https:\/\/example.com\/notarization\"",
      "language" : "sh"
    },
    {
      "code" : "% xcrun notarytool store-credentials \"notarytool-password\"\n               --apple-id \"<AppleID>\"\n               --team-id <DeveloperTeamID>\n               --password <secret_2FA_password>",
      "language" : "sh"
    },
    {
      "code" : "Successfully uploaded file. \n id: 2efe2717-52ef-43a5-96dc-0797e4ca1041\n path: \/Users\/janea\/Desktop\/OvernightTextEditor_11.6.8.zip",
      "language" : "console"
    },
    {
      "code" : "% xcrun notarytool --help",
      "language" : "sh"
    },
    {
      "code" : "createdDate: 2021-04-29T01:38:09.498Z\nid: 2efe2717-52ef-43a5-96dc-0797e4ca1041\nname: OvernightTextEditor_11.6.8.zip\nstatus: Accepted",
      "language" : "console"
    },
    {
      "code" : "% xcrun notarytool log 2efe2717-52ef-43a5-96dc-0797e4ca1041 --keychain-profile \"notarytool-password\" developer_log.json",
      "language" : "sh"
    },
    {
      "code" : "Successfully downloaded submission log\n id: 2efe2717-52ef-43a5-96dc-0797e4ca1041\n location: \/Users\/ravipatel\/Desktop\/developer_log.json",
      "language" : "console"
    },
    {
      "code" : "{\n    \"archiveFilename\": \"Overnight TextEditor.app\",\n    \"issues\": [\n        {\n            \"message\": \"The signature of the binary is invalid.\",\n            \"path\": \"Overnight TextEditor.app\/Contents\/MacOS\/Overnight TextEditor\",\n            \"severity\": \"error\"\n        }\n    ],\n    \"jobId\": \"2EFE2717-52EF-43A5-96DC-0797E4CA1041\",\n    \"logFormatVersion\": 1,\n    \"status\": \"Invalid\",\n    \"statusSummary\": \"Archive contains critical validation errors\",\n    \"ticketContents\": null,\n    \"uploadDate\": \"2021-04-19T16:56:17Z\"\n}",
      "language" : "json"
    },
    {
      "code" : "% xcrun stapler staple \"Overnight TextEditor.app\"",
      "language" : "sh"
    },
    {
      "code" : "17.36.196.0\/22\n17.57.0.0\/22\n17.248.128.0\/17\n17.250.48.0\/20\n17.250.64.0\/18\n17.252.62.0\/23\n2403:300:a41::\/48\n2403:300:a50:100::\/56\n2403:300:1360::\/44\n2403:300:1502::\/48\n2620:149:a40::\/46\n2620:149:1360::\/44\n2a01:b740:984::\/56\n2a01:b740:984:100::\/64\n2a01:b740:a41::\/48\n2a01:b740:1360::\/44",
      "language" : "console"
    },
    {
      "code" : "% hdiutil verify <image>",
      "language" : "sh"
    }
  ],
  "contentHash" : "d4ce2b0710109686ff6229539a3661515045f248b5cbeaddb806e1730fc9dc16",
  "crawledAt" : "2025-12-02T16:46:31Z",
  "id" : "9E3A1963-030C-4C29-9F4C-477676F4ED94",
  "kind" : "collection",
  "language" : "swift",
  "module" : "Security",
  "overview" : "## Overview\n\nThe easiest way to notarize your app is through the Xcode user interface, as described in [doc:\/\/com.apple.security\/documentation\/Security\/notarizing-macos-software-before-distribution]. However, if you have a more complex scenario, you can use command line tools to manually notarize your app. This workflow can be useful in a number of cases, like when you need to:\n\n### Export a package for notarization\n\nTo prepare an app for notarization, you must export the app from Xcode. Using Xcode, you can export your archived app by clicking Distribute App in the Organizer window. But in a scripted build environment, you use the `xcodebuild` utility to perform the export. Because export directly follows archiving, the archive’s post-action script is a convenient place to perform the export from. You can edit the post-action from the scheme editor in Xcode.\n\n\n\nThe script begins by exporting the archive with `xcodebuild`:\n\nYou tell `xcodebuild` which archive to export using an environment variable automatically defined by Xcode, and provide a location for the output by defining the `EXPORT_PATH` variable. Use the `exportOptionsPlist` option to indicate an options property list that configures the export operation. You typically obtain this file by exporting from Xcode just once. The export options file appears alongside the app in the export directory:\n\n\n\nAlternatively, you can create a custom export options property list file with a text or property list editor.\n\nBecause you can’t upload the `.app` bundle directly to the notary service, you’ll need to create a compressed archive containing the app:\n\nFor a detailed example that shows how to automate notarization using post-action scripts, see [doc:\/\/com.apple.security\/documentation\/Security\/customizing-the-xcode-archive-process].\n\nAlternatively, you can put apps, kernel extensions, and other software in a container, like a disk image, and notarize the container. The notary service accepts disk images (UDIF format), signed flat installer packages, and ZIP archives. It processes nested containers as well, like packages inside a disk image.\n\n### Upload your app to the notarization service\n\nYou upload your app for notarization using `notarytool` command line tool. Xcode 13 or later supports this tool, so if you have more than one version of Xcode installed on your Mac, be sure to use the `xcode-select` utility to choose an appropriate version:\n\nUse `xcrun` to invoke the `notarytool` command with the `submit` option:\n\nThe notary service generates a ticket for the top-level file that you specify, as well as for each nested file. For example, if you submit a disk image that contains a signed installer package with an app bundle inside, the notarization service generates tickets for the disk image, installer package, and app bundle.\n\nUse the `wait` flag to tell `notarytool` to exit only after the Notary service finishes processing the submission. This eliminates the need to poll the service for status. Use the `webhook` flag if you want to specify a URL for the service to access after processing the submission.\n\nYou can add the `apple-id` and `password` options to supply your App Store Connect credentials. Because App Store Connect requires two-factor authentication (2FA) on all accounts, you must create an app-specific password for `notarytool`, as described in [https:\/\/support.apple.com\/en-us\/HT204397].\n\nAlternatively, to avoid including your password as cleartext in a script, you can provide a reference to a keychain item, as shown in the example above. This assumes the keychain holds a keychain item named `notarytool-password`. You can add a new keychain item for this purpose from the command line using the `notarytool` utility:\n\nIf notarization succeeds, `notarytool` prints a submission identifier:\n\nSave the `id` value to use later when checking the status of your request. For more information about `notarytool` and its options, see its manual page, or use the `help` option:\n\n### Check the status of your request\n\nAfter you upload your app, the notarization process typically takes less than an hour. If you use the `wait` flag that the previous section demonstrates, `notarytool` returns with the status of the request:\n\nTo download a log file that contains any errors or warnings that occurred during notarization, use `notarytool` with the `log` command:\n\nThe `log` command downloads JSON-formatted data and saves it to the specified file:\n\nThe file enumerates any issues that notarization found:\n\nFor information about how to deal with common problems, see [doc:\/\/com.apple.security\/documentation\/Security\/resolving-common-notarization-issues].\n\n### Staple the ticket to your distribution\n\nNotarization produces a ticket that tells Gatekeeper that your app is notarized. After notarization completes, the next time any user attempts to run your app on macOS 10.14 or later, Gatekeeper finds the ticket online. This includes users who downloaded your app before notarization.\n\nYou should also attach the ticket to your software using the `stapler` tool, so that future distributions include the ticket. This ensures that Gatekeeper can find the ticket even when a network connection isn’t available. To attach a ticket to your app, bundle, disk image, or flat installer package, use the `stapler` tool:\n\nWhile you can notarize a ZIP archive, you can’t staple to it directly. Instead, run `stapler` against each item that you added to the archive. Then create a new ZIP file containing the stapled items for distribution. Although tickets are created for standalone binaries, it’s not currently possible to staple tickets to them.\n\n### Ensure your build server has network access\n\nTo incorporate notarization into a custom workflow, your build server needs access to certain network resources.\n\nThe `notarytool` tool uses Amazon S3 Transfer Acceleration by default, which connects to `notary-submissions-prod.s3-accelerate.amazonaws.com`. Use the `no-s3-acceleration` flag during submission to use the `notary-submissions-prod.s3.us-west-2.amazonaws.com` endpoint instead. You can find the range of Internet Protocol (IP) addresses used by Amazon S3 in the documentation on [https:\/\/aws.amazon.com].\n\nIn addition, `stapler` uses [doc:\/\/com.apple.documentation\/documentation\/CloudKit] to download tickets, which requires access to the following IP address ranges, all on port 443:\n\n### Avoid long notarization response times and size limits\n\nNotarization completes for most software within 5 minutes, and for 98 percent of software within 15 minutes. However, notarization can take longer under certain conditions. Help to avoid long response times by following a few rules:\n\nFor large uploads, try to exclude non-executable data from notarization. For example, if you use an installer package, you could move all your non-executable data into a folder next to a notarized installer package. Put both the data and the notarized installer package into a single disk image, and ship the disk image without notarization. For the best user experience, staple the notarization ticket to the installer package.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/Security\/customizing-the-notarization-workflow\ncrawled: 2025-12-02T16:46:31Z\n---\n\n# Customizing the notarization workflow\n\nNotarize your app from the command line to handle special distribution cases.\n\n## Overview\n\nThe easiest way to notarize your app is through the Xcode user interface, as described in [doc:\/\/com.apple.security\/documentation\/Security\/notarizing-macos-software-before-distribution]. However, if you have a more complex scenario, you can use command line tools to manually notarize your app. This workflow can be useful in a number of cases, like when you need to:\n\n- Notarize software you’ve already shipped.\n- Notarize plug-ins for other software packages.\n- Notarize Xcode targets other than macOS app targets, including Aggregate and External Build System targets.\n- Create complex distributions, like disk images or installer packages.\n- Add the notarization process to a scripted build environment.\n\n### Export a package for notarization\n\nTo prepare an app for notarization, you must export the app from Xcode. Using Xcode, you can export your archived app by clicking Distribute App in the Organizer window. But in a scripted build environment, you use the `xcodebuild` utility to perform the export. Because export directly follows archiving, the archive’s post-action script is a convenient place to perform the export from. You can edit the post-action from the scheme editor in Xcode.\n\n\n\nThe script begins by exporting the archive with `xcodebuild`:\n\n```sh\nEXPORT_PATH=\"$TEMP_DIR\/Export\"\n\/usr\/bin\/xcodebuild -exportArchive -archivePath \"$ARCHIVE_PATH\" -exportOptionsPlist \"$SRCROOT\/ExportOptions.plist\" -exportPath \"$EXPORT_PATH\"\n```\n\nYou tell `xcodebuild` which archive to export using an environment variable automatically defined by Xcode, and provide a location for the output by defining the `EXPORT_PATH` variable. Use the `exportOptionsPlist` option to indicate an options property list that configures the export operation. You typically obtain this file by exporting from Xcode just once. The export options file appears alongside the app in the export directory:\n\n\n\nAlternatively, you can create a custom export options property list file with a text or property list editor.\n\n\n\nBecause you can’t upload the `.app` bundle directly to the notary service, you’ll need to create a compressed archive containing the app:\n\n```sh\nAPP_PATH=\"$EXPORT_PATH\/$PRODUCT_NAME.app\"\nZIP_PATH=\"$EXPORT_PATH\/$PRODUCT_NAME.zip\"\n\n# Create a ZIP archive suitable for notarization.\n\/usr\/bin\/ditto -c -k --keepParent \"$APP_PATH\" \"$ZIP_PATH\"\n\n# As a convenience, open the export folder in Finder.\n\/usr\/bin\/open \"$EXPORT_PATH\"\n```\n\nFor a detailed example that shows how to automate notarization using post-action scripts, see [doc:\/\/com.apple.security\/documentation\/Security\/customizing-the-xcode-archive-process].\n\nAlternatively, you can put apps, kernel extensions, and other software in a container, like a disk image, and notarize the container. The notary service accepts disk images (UDIF format), signed flat installer packages, and ZIP archives. It processes nested containers as well, like packages inside a disk image.\n\n\n\n### Upload your app to the notarization service\n\nYou upload your app for notarization using `notarytool` command line tool. Xcode 13 or later supports this tool, so if you have more than one version of Xcode installed on your Mac, be sure to use the `xcode-select` utility to choose an appropriate version:\n\n```sh\n% sudo xcode-select -s \/path\/to\/Xcode13.app\n```\n\n\n\nUse `xcrun` to invoke the `notarytool` command with the `submit` option:\n\n```sh\n% xcrun notarytool submit OvernightTextEditor_11.6.8.zip\n                   --keychain-profile \"notarytool-password\"\n                   --wait\n                   --webhook \"https:\/\/example.com\/notarization\"\n```\n\nThe notary service generates a ticket for the top-level file that you specify, as well as for each nested file. For example, if you submit a disk image that contains a signed installer package with an app bundle inside, the notarization service generates tickets for the disk image, installer package, and app bundle.\n\nUse the `wait` flag to tell `notarytool` to exit only after the Notary service finishes processing the submission. This eliminates the need to poll the service for status. Use the `webhook` flag if you want to specify a URL for the service to access after processing the submission.\n\nYou can add the `apple-id` and `password` options to supply your App Store Connect credentials. Because App Store Connect requires two-factor authentication (2FA) on all accounts, you must create an app-specific password for `notarytool`, as described in [https:\/\/support.apple.com\/en-us\/HT204397].\n\nAlternatively, to avoid including your password as cleartext in a script, you can provide a reference to a keychain item, as shown in the example above. This assumes the keychain holds a keychain item named `notarytool-password`. You can add a new keychain item for this purpose from the command line using the `notarytool` utility:\n\n```sh\n% xcrun notarytool store-credentials \"notarytool-password\"\n               --apple-id \"<AppleID>\"\n               --team-id <DeveloperTeamID>\n               --password <secret_2FA_password>\n```\n\nIf notarization succeeds, `notarytool` prints a submission identifier:\n\n```console\nSuccessfully uploaded file. \n id: 2efe2717-52ef-43a5-96dc-0797e4ca1041\n path: \/Users\/janea\/Desktop\/OvernightTextEditor_11.6.8.zip\n```\n\nSave the `id` value to use later when checking the status of your request. For more information about `notarytool` and its options, see its manual page, or use the `help` option:\n\n```sh\n% xcrun notarytool --help\n```\n\n\n\n### Check the status of your request\n\nAfter you upload your app, the notarization process typically takes less than an hour. If you use the `wait` flag that the previous section demonstrates, `notarytool` returns with the status of the request:\n\n```console\ncreatedDate: 2021-04-29T01:38:09.498Z\nid: 2efe2717-52ef-43a5-96dc-0797e4ca1041\nname: OvernightTextEditor_11.6.8.zip\nstatus: Accepted\n```\n\nTo download a log file that contains any errors or warnings that occurred during notarization, use `notarytool` with the `log` command:\n\n```sh\n% xcrun notarytool log 2efe2717-52ef-43a5-96dc-0797e4ca1041 --keychain-profile \"notarytool-password\" developer_log.json\n```\n\nThe `log` command downloads JSON-formatted data and saves it to the specified file:\n\n```console\nSuccessfully downloaded submission log\n id: 2efe2717-52ef-43a5-96dc-0797e4ca1041\n location: \/Users\/ravipatel\/Desktop\/developer_log.json\n```\n\nThe file enumerates any issues that notarization found:\n\n```json\n{\n    \"archiveFilename\": \"Overnight TextEditor.app\",\n    \"issues\": [\n        {\n            \"message\": \"The signature of the binary is invalid.\",\n            \"path\": \"Overnight TextEditor.app\/Contents\/MacOS\/Overnight TextEditor\",\n            \"severity\": \"error\"\n        }\n    ],\n    \"jobId\": \"2EFE2717-52EF-43A5-96DC-0797E4CA1041\",\n    \"logFormatVersion\": 1,\n    \"status\": \"Invalid\",\n    \"statusSummary\": \"Archive contains critical validation errors\",\n    \"ticketContents\": null,\n    \"uploadDate\": \"2021-04-19T16:56:17Z\"\n}\n```\n\n\n\nFor information about how to deal with common problems, see [doc:\/\/com.apple.security\/documentation\/Security\/resolving-common-notarization-issues].\n\n### Staple the ticket to your distribution\n\nNotarization produces a ticket that tells Gatekeeper that your app is notarized. After notarization completes, the next time any user attempts to run your app on macOS 10.14 or later, Gatekeeper finds the ticket online. This includes users who downloaded your app before notarization.\n\nYou should also attach the ticket to your software using the `stapler` tool, so that future distributions include the ticket. This ensures that Gatekeeper can find the ticket even when a network connection isn’t available. To attach a ticket to your app, bundle, disk image, or flat installer package, use the `stapler` tool:\n\n```sh\n% xcrun stapler staple \"Overnight TextEditor.app\"\n```\n\nWhile you can notarize a ZIP archive, you can’t staple to it directly. Instead, run `stapler` against each item that you added to the archive. Then create a new ZIP file containing the stapled items for distribution. Although tickets are created for standalone binaries, it’s not currently possible to staple tickets to them.\n\n### Ensure your build server has network access\n\nTo incorporate notarization into a custom workflow, your build server needs access to certain network resources.\n\nThe `notarytool` tool uses Amazon S3 Transfer Acceleration by default, which connects to `notary-submissions-prod.s3-accelerate.amazonaws.com`. Use the `no-s3-acceleration` flag during submission to use the `notary-submissions-prod.s3.us-west-2.amazonaws.com` endpoint instead. You can find the range of Internet Protocol (IP) addresses used by Amazon S3 in the documentation on [https:\/\/aws.amazon.com].\n\nIn addition, `stapler` uses [doc:\/\/com.apple.documentation\/documentation\/CloudKit] to download tickets, which requires access to the following IP address ranges, all on port 443:\n\n```console\n17.36.196.0\/22\n17.57.0.0\/22\n17.248.128.0\/17\n17.250.48.0\/20\n17.250.64.0\/18\n17.252.62.0\/23\n2403:300:a41::\/48\n2403:300:a50:100::\/56\n2403:300:1360::\/44\n2403:300:1502::\/48\n2620:149:a40::\/46\n2620:149:1360::\/44\n2a01:b740:984::\/56\n2a01:b740:984:100::\/64\n2a01:b740:a41::\/48\n2a01:b740:1360::\/44\n```\n\n### Avoid long notarization response times and size limits\n\nNotarization completes for most software within 5 minutes, and for 98 percent of software within 15 minutes. However, notarization can take longer under certain conditions. Help to avoid long response times by following a few rules:\n\n- Minimize the total number of files, even when the individual files are small.\n- Don’t save non-executable files in places that require code signatures, like `MyApp.app\/Content\/MacOS\/`. Instead, save these files to a directory that doesn’t require a code signature, like `MyApp.app\/Contents\/Resources\/`.\n- Don’t submit corrupted disk images. You can verify the integrity of a disk image by running the `hdiutil` utility:\n\n```sh\n% hdiutil verify <image>\n```\n\n- Avoid heavily compressed disk images.\n- Avoid huge, non-executable data files, especially when they change often.\n- Limit notarizations to 75 per day.\n\nFor large uploads, try to exclude non-executable data from notarization. For example, if you use an installer package, you could move all your non-executable data into a folder next to a notarized installer package. Put both the data and the notarized installer package into a single disk image, and ship the disk image without notarization. For the best user experience, staple the notarization ticket to the installer package.\n\n## Automation\n\n- **Customizing the Xcode archive process**: Archive, export, and notarize your app in one step using Xcode post-action build scripts.\n\n## Related Documentation\n\n- **Notary API**: Submit your macOS software for notarization through a web interface.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Archive, export, and notarize your app in one step using Xcode post-action build scripts.",
          "name" : "Customizing the Xcode archive process",
          "url" : "https:\/\/developer.apple.com\/documentation\/Security\/customizing-the-xcode-archive-process"
        }
      ],
      "title" : "Automation"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "Submit your macOS software for notarization through a web interface.",
          "name" : "Notary API",
          "url" : "https:\/\/developer.apple.com\/documentation\/NotaryAPI"
        }
      ],
      "title" : "Related Documentation"
    }
  ],
  "source" : "appleJSON",
  "title" : "Customizing the notarization workflow",
  "url" : "https:\/\/developer.apple.com\/documentation\/Security\/customizing-the-notarization-workflow"
}