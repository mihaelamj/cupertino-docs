{
  "abstract" : "Determine when your macOS app behaves incorrectly because of a sandbox violation, and fix sandbox-related issues.",
  "codeExamples" : [
    {
      "code" : "2022-10-25 14:14:45.543941+0100 SampleApp[12447:550451] dnssd_clientstub ConnectToServer: connect() failed path:\/var\/run\/mDNSResponder Socket:22 Err:-1 Errno:1 Operation not permitted\n2022-10-25 14:14:45.453414+0100 SampleApp[12447:550126] [] networkd_settings_read_from_file Sandbox is preventing this process from reading networkd settings file at \"\/Library\/Preferences\/com.apple.networkd.plist\", please add an exception.\n2022-10-25 14:14:45.542962+0100 SampleApp[12447:550451] [] nw_resolver_can_use_dns_xpc_block_invoke Sandbox does not allow access to com.apple.dnssd.service",
      "language" : "console"
    },
    {
      "code" : "type:error\nsubsystem:com.apple.sandbox.reporting\ncategory:violation",
      "language" : "console"
    },
    {
      "code" : "Sandbox: SampleApp(12447) deny(1) network-outbound \/private\/var\/run\/mDNSResponder\nViolation: deny(1) network-outbound \/private\/var\/run\/mDNSResponder\nProcess: SampleApp [12447]\nPath: \/Users\/meichen\/Library\/Developer\/Xcode\/DerivedData\/SampleApp-ejawvdggzjjsyxcmimtdyrrwepff\/Build\/Products\/Release\/SampleApp.app\/Contents\/MacOS\/SampleApp\nLoad Address: 0x1008f4000\nIdentifier: com.example.SampleApp\nVersion: 1 (1.0)\nCode Type: arm64 (Native)\nParent Process: SampleApp [1]\nResponsible: \/Users\/meichen\/Library\/Developer\/Xcode\/DerivedData\/SampleApp-ejawvdggzjjsyxcmimtdyrrwepff\/Build\/Products\/Release\/SampleApp.app\/Contents\/MacOS\/SampleApp\nUser ID: 501\n[…]\n\nThread 0 (id: 551548):\n0 libsystem_kernel.dylib 0x0000000180bfb188 __connect_nocancel + 20864 \n1 libsystem_dnssd.dylib 0x000000018c242e7c DNSServiceCreateConnection + 3628 \n2 Network 0x00000001871c8d8c nw_resolver_instantiate_dns_connection_for_parameters + 1203340 \n3 Network 0x00000001871c6340 nw_resolver_create_dns_service_locked + 1192492 \n4 Network 0x00000001871c1db0 __nw_resolver_set_update_handler_block_invoke + 1172360 \n5 Network 0x00000001879479d0 nw_queue_context_async_if_needed + 9062772 \n6 Network 0x00000001871c0eb0 nw_resolver_set_update_handler + 1170824 \n7 Network 0x0000000187533260 -[NWConcrete_nw_endpoint_resolver startWithHandler:] + 4782368 \n8 Network 0x0000000187548180 nw_endpoint_handler_path_change + 4855592 \n9 Network 0x0000000187550100 nw_endpoint_handler_start + 4902092 \n10 Network 0x0000000187b18758 nw_endpoint_flow_setup_protocols + 10961348 \n11 Network 0x0000000187b38f1c -[NWConcrete_nw_endpoint_flow startWithHandler:] + 11096344 \n12 Network 0x0000000187548180 nw_endpoint_handler_path_change + 4855592 \n13 Network 0x0000000187550100 nw_endpoint_handler_start + 4902092 \n14 Network 0x000000018748fb28 __nw_connection_start_block_invoke + 4113712 \n15 Network 0x000000018748f1bc nw_connection_start + 4112176 \n16 CFNetwork 0x00000001855d4670 ??? + 1348664 \n17 CFNetwork 0x00000001855cc9a8 ??? + 1316952 \n18 CFNetwork 0x00000001855cd8b4 ??? + 1319360 \n19 CFNetwork 0x000000018561a5b0 ??? + 1634820 \n20 CFNetwork 0x00000001855cc5f4 ??? + 1312804 \n21 CFNetwork 0x00000001854b2194 ??? + 159676 \n22 CFNetwork 0x0000000185619aac ??? + 1631212 \n23 CFNetwork 0x0000000185619c48 ??? + 1633316 \n24 libdispatch.dylib 0x0000000180aad9dc _dispatch_call_block_and_release + 10684 \n25 libdispatch.dylib 0x0000000180aaf504 _dispatch_client_callout + 17648 \n26 libdispatch.dylib 0x0000000180ab6bbc _dispatch_lane_serial_drain + 47388 \n27 libdispatch.dylib 0x0000000180ab773c _dispatch_lane_invoke + 50568 \n28 libdispatch.dylib 0x0000000180ab8a20 _dispatch_workloop_invoke + 54060 \n29 libdispatch.dylib 0x0000000180ac234c _dispatch_workloop_worker_thread + 94400 \n30 libsystem_pthread.dylib 0x0000000180c32100 _pthread_wqthread + 12256 \n31 libsystem_pthread.dylib 0x0000000180c30e20 start_wqthread + 7704",
      "language" : "console"
    }
  ],
  "contentHash" : "9ff0a8212d6b9cef0095dba8fd132517356325fcc27b972b5602eef0acd66732",
  "crawledAt" : "2025-12-05T07:23:31Z",
  "id" : "19E00EDC-C2CD-4FF0-BAE5-5182EF0894D3",
  "kind" : "article",
  "language" : "swift",
  "module" : "Security",
  "overview" : "## Overview\n\nApp Sandbox protects documents and system resources from malicious abuse by limiting your macOS app’s access to only capabilities you request in its entitlements file. If your app attempts to use capabilities that you didn’t request, it’ll fail to complete those operations even if you use the APIs correctly.\n\nIf you discover that your app’s failure to complete a task is due to a violation of its App Sandbox limitations, you can choose one of three approaches to resolve the issue:\n\n### Examine error output to identify where your app exceeds its privileges\n\nIf an App Sandbox constraint stops a system library from performing a task, that library may log a message to your app’s standard error stream to report the problem. To examine your app’s output, follow these steps:\n\n\n\nOutput such as the following indicates that the process encountered an App Sandbox violation.\n\n### Use Console to identify violations\n\nYou can use the Console app to discover whether a problem is due to an App Sandbox violation by following these steps:\n\n\n\nThe message names the process that violated the App Sandbox restrictions, the violating action, and provides additional information about the violation where possible. In the example below, the app’s attempt to make an outgoing network connection violates its App Sandbox restrictions.\n\nThe line in the Console message that starts with “Violation:” describes the app’s behavior that violated its App Sandbox restrictions. Use the backtrace to identify which thread in your app violated the App Sandbox restrictions, and locate the violating code. The backtrace is similar to a crash report, even though the system doesn’t terminate apps that violate App Sandbox restrictions. For more information on interpreting a backtrace, see [doc:\/\/com.apple.documentation\/documentation\/Xcode\/examining-the-fields-in-a-crash-report].\n\n### Extend your app’s sandbox to accommodate new features\n\nIf you’ve determined that your app needs to perform the task that leads to an App Sandbox violation, add the appropriate capability to the App Sandbox entitlement for your app in the Xcode entitlements editor. To review the available App Sandbox capabilities, see `Entitlements`.\n\n### Move potentially vulnerable operations to a separate helper tool\n\nBy separating your app into different components that have access to distinct subsets of the required capabilities, you can balance access to operating system resources with the good practice of protecting people’s devices from malicious attacks. As an example, if your app takes camera images, processes them using unsafe memory operations, and communicates with a network service, create separate components for these three features. Separating the features makes it harder for an attacker who compromises the app through the network to gain access to someone’s camera, or to exploit the potentially unsafe processing code.\n\nWhen an app that uses App Sandbox launches a helper tool directly using [doc:\/\/com.apple.documentation\/documentation\/Foundation\/Process] or fork and exec, the helper tool inherits the same sandbox capabilities as the launching app. To enable different capabilities in the app and the helper, use one of these designs:",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/Security\/discovering-and-diagnosing-app-sandbox-violations\ncrawled: 2025-12-05T07:23:31Z\n---\n\n# Discovering and diagnosing App Sandbox violations\n\n**Article**\n\nDetermine when your macOS app behaves incorrectly because of a sandbox violation, and fix sandbox-related issues.\n\n## Overview\n\nApp Sandbox protects documents and system resources from malicious abuse by limiting your macOS app’s access to only capabilities you request in its entitlements file. If your app attempts to use capabilities that you didn’t request, it’ll fail to complete those operations even if you use the APIs correctly.\n\nIf you discover that your app’s failure to complete a task is due to a violation of its App Sandbox limitations, you can choose one of three approaches to resolve the issue:\n\n- Extend the app’s capabilities to cover the attempted task, by adding a capability to the App Sandbox entitlement for the app executable.\n- Distribute a separate helper tool with your app that uses the additional capability.\n- Remove the code that accesses the additional capability if it’s not necessary for implementing your app’s feature set.\n\n### Examine error output to identify where your app exceeds its privileges\n\nIf an App Sandbox constraint stops a system library from performing a task, that library may log a message to your app’s standard error stream to report the problem. To examine your app’s output, follow these steps:\n\n1. In Xcode, run your app. Xcode automatically displays the Debug pane, shown in the figure below.\n2. Reproduce the problem in your app.\n3. Switch back to Xcode and check for output from your app in the Debug pane.\n\n\n\nOutput such as the following indicates that the process encountered an App Sandbox violation.\n\n```console\n2022-10-25 14:14:45.543941+0100 SampleApp[12447:550451] dnssd_clientstub ConnectToServer: connect() failed path:\/var\/run\/mDNSResponder Socket:22 Err:-1 Errno:1 Operation not permitted\n2022-10-25 14:14:45.453414+0100 SampleApp[12447:550126] [] networkd_settings_read_from_file Sandbox is preventing this process from reading networkd settings file at \"\/Library\/Preferences\/com.apple.networkd.plist\", please add an exception.\n2022-10-25 14:14:45.542962+0100 SampleApp[12447:550451] [] nw_resolver_can_use_dns_xpc_block_invoke Sandbox does not allow access to com.apple.dnssd.service\n```\n\n### Use Console to identify violations\n\nYou can use the Console app to discover whether a problem is due to an App Sandbox violation by following these steps:\n\n1. Open Console.\n2. Copy each of the lines below, one at a time, into the search field in the Console window.\n\n```console\ntype:error\nsubsystem:com.apple.sandbox.reporting\ncategory:violation\n```\n\n1. Click Save, and enter a name for the saved search.\n2. Click Start Streaming.\n3. Reproduce the problem in your app.\n4. Switch to Console.\n5. Look for a message relating to your app in the messages view, shown below.\n\n\n\nThe message names the process that violated the App Sandbox restrictions, the violating action, and provides additional information about the violation where possible. In the example below, the app’s attempt to make an outgoing network connection violates its App Sandbox restrictions.\n\n```console\nSandbox: SampleApp(12447) deny(1) network-outbound \/private\/var\/run\/mDNSResponder\nViolation: deny(1) network-outbound \/private\/var\/run\/mDNSResponder\nProcess: SampleApp [12447]\nPath: \/Users\/meichen\/Library\/Developer\/Xcode\/DerivedData\/SampleApp-ejawvdggzjjsyxcmimtdyrrwepff\/Build\/Products\/Release\/SampleApp.app\/Contents\/MacOS\/SampleApp\nLoad Address: 0x1008f4000\nIdentifier: com.example.SampleApp\nVersion: 1 (1.0)\nCode Type: arm64 (Native)\nParent Process: SampleApp [1]\nResponsible: \/Users\/meichen\/Library\/Developer\/Xcode\/DerivedData\/SampleApp-ejawvdggzjjsyxcmimtdyrrwepff\/Build\/Products\/Release\/SampleApp.app\/Contents\/MacOS\/SampleApp\nUser ID: 501\n[…]\n\nThread 0 (id: 551548):\n0 libsystem_kernel.dylib 0x0000000180bfb188 __connect_nocancel + 20864 \n1 libsystem_dnssd.dylib 0x000000018c242e7c DNSServiceCreateConnection + 3628 \n2 Network 0x00000001871c8d8c nw_resolver_instantiate_dns_connection_for_parameters + 1203340 \n3 Network 0x00000001871c6340 nw_resolver_create_dns_service_locked + 1192492 \n4 Network 0x00000001871c1db0 __nw_resolver_set_update_handler_block_invoke + 1172360 \n5 Network 0x00000001879479d0 nw_queue_context_async_if_needed + 9062772 \n6 Network 0x00000001871c0eb0 nw_resolver_set_update_handler + 1170824 \n7 Network 0x0000000187533260 -[NWConcrete_nw_endpoint_resolver startWithHandler:] + 4782368 \n8 Network 0x0000000187548180 nw_endpoint_handler_path_change + 4855592 \n9 Network 0x0000000187550100 nw_endpoint_handler_start + 4902092 \n10 Network 0x0000000187b18758 nw_endpoint_flow_setup_protocols + 10961348 \n11 Network 0x0000000187b38f1c -[NWConcrete_nw_endpoint_flow startWithHandler:] + 11096344 \n12 Network 0x0000000187548180 nw_endpoint_handler_path_change + 4855592 \n13 Network 0x0000000187550100 nw_endpoint_handler_start + 4902092 \n14 Network 0x000000018748fb28 __nw_connection_start_block_invoke + 4113712 \n15 Network 0x000000018748f1bc nw_connection_start + 4112176 \n16 CFNetwork 0x00000001855d4670 ??? + 1348664 \n17 CFNetwork 0x00000001855cc9a8 ??? + 1316952 \n18 CFNetwork 0x00000001855cd8b4 ??? + 1319360 \n19 CFNetwork 0x000000018561a5b0 ??? + 1634820 \n20 CFNetwork 0x00000001855cc5f4 ??? + 1312804 \n21 CFNetwork 0x00000001854b2194 ??? + 159676 \n22 CFNetwork 0x0000000185619aac ??? + 1631212 \n23 CFNetwork 0x0000000185619c48 ??? + 1633316 \n24 libdispatch.dylib 0x0000000180aad9dc _dispatch_call_block_and_release + 10684 \n25 libdispatch.dylib 0x0000000180aaf504 _dispatch_client_callout + 17648 \n26 libdispatch.dylib 0x0000000180ab6bbc _dispatch_lane_serial_drain + 47388 \n27 libdispatch.dylib 0x0000000180ab773c _dispatch_lane_invoke + 50568 \n28 libdispatch.dylib 0x0000000180ab8a20 _dispatch_workloop_invoke + 54060 \n29 libdispatch.dylib 0x0000000180ac234c _dispatch_workloop_worker_thread + 94400 \n30 libsystem_pthread.dylib 0x0000000180c32100 _pthread_wqthread + 12256 \n31 libsystem_pthread.dylib 0x0000000180c30e20 start_wqthread + 7704\n```\n\nThe line in the Console message that starts with “Violation:” describes the app’s behavior that violated its App Sandbox restrictions. Use the backtrace to identify which thread in your app violated the App Sandbox restrictions, and locate the violating code. The backtrace is similar to a crash report, even though the system doesn’t terminate apps that violate App Sandbox restrictions. For more information on interpreting a backtrace, see [doc:\/\/com.apple.documentation\/documentation\/Xcode\/examining-the-fields-in-a-crash-report].\n\n### Extend your app’s sandbox to accommodate new features\n\nIf you’ve determined that your app needs to perform the task that leads to an App Sandbox violation, add the appropriate capability to the App Sandbox entitlement for your app in the Xcode entitlements editor. To review the available App Sandbox capabilities, see `Entitlements`.\n\n### Move potentially vulnerable operations to a separate helper tool\n\nBy separating your app into different components that have access to distinct subsets of the required capabilities, you can balance access to operating system resources with the good practice of protecting people’s devices from malicious attacks. As an example, if your app takes camera images, processes them using unsafe memory operations, and communicates with a network service, create separate components for these three features. Separating the features makes it harder for an attacker who compromises the app through the network to gain access to someone’s camera, or to exploit the potentially unsafe processing code.\n\nWhen an app that uses App Sandbox launches a helper tool directly using [doc:\/\/com.apple.documentation\/documentation\/Foundation\/Process] or fork and exec, the helper tool inherits the same sandbox capabilities as the launching app. To enable different capabilities in the app and the helper, use one of these designs:\n\n- An [doc:\/\/com.apple.documentation\/documentation\/XPC] service\n- A login item\n- A helper app, which you can configure to run in the background by setting the [doc:\/\/com.apple.documentation\/documentation\/BundleResources\/Information-Property-List\/LSBackgroundOnly] key\n\n",
  "sections" : [

  ],
  "source" : "appleJSON",
  "title" : "Discovering and diagnosing App Sandbox violations",
  "url" : "https:\/\/developer.apple.com\/documentation\/Security\/discovering-and-diagnosing-app-sandbox-violations"
}