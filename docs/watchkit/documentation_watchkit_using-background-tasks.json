{
  "abstract" : "Handle scheduled update tasks in the background, and respond to background system interactions including Siri intents and incoming Bluetooth messages.",
  "codeExamples" : [
    {
      "code" : "import SwiftUI\n\n@main\nstruct MyApp_Watch_AppApp: App {\n    var body: some Scene {\n        WindowGroup {\n            ContentView()\n        }\n        .backgroundTask(.appRefresh(\"My_App_Updates\")) { context in\n            \/\/ Perform the background task here.\n        }\n    }\n}",
      "language" : "swift"
    },
    {
      "code" : "WKApplication.shared()\n    .scheduleBackgroundRefresh(\n        withPreferredDate: Date.init(timeIntervalSinceNow: 15.0 * 60.0),\n        userInfo: \"MY_FIRST_UPDATE\" as NSSecureCoding & NSObjectProtocol) { error in\n            if error != nil {\n                \/\/ Handle the scheduling error.\n                fatalError(\"*** An error occurred while scheduling the background refresh task. ***\")\n            }\n\n            print(\"*** Scheduled! ***\")\n        }",
      "language" : "swift"
    },
    {
      "code" : "import SwiftUI\n\n@main\nstruct MyApp_Watch_AppApp: App {\n    var body: some Scene {\n        WindowGroup {\n            ContentView()\n        }\n        .backgroundTask(.appRefresh(\"MY_FIRST_IDENTIFIER\")) { context in\n            \/\/ Handle tasks with the \"MY_FIRST_IDENTIFIER\" identifier.\n        }\n        .backgroundTask(.appRefresh(\"MY_SECOND_IDENTIFIER\")) { context in\n            \/\/ Handle tasks with the \"MY_SECOND_IDENTIFIER\" identifier.\n        }\n        .backgroundTask(.appRefresh) { context in\n            \/\/ Handles any other app refresh tasks.\n        }\n    }\n}",
      "language" : "swift"
    },
    {
      "code" : "WKApplication.shared()\n    .scheduleBackgroundRefresh(\n        withPreferredDate: Date.init(timeIntervalSinceNow: 15.0 * 60.0),\n        userInfo: nil { error in\n            if error != nil {\n                \/\/ Handle the scheduling error.\n                fatalError(\"*** An error occurred while scheduling the background refresh task. ***\")\n            }\n\n            print(\"*** Scheduled! ***\")\n        }\n",
      "language" : "swift"
    },
    {
      "code" : ".backgroundTask(.appRefresh) { context in\n    \/\/ Handles any other app refresh tasks.\n    await withTaskCancellationHandler {\n        \/\/ Handle the background refresh task.\n    } onCancel: {\n        \/\/ Clean up and prepare to become suspended.\n    }\n}",
      "language" : "swift"
    },
    {
      "code" : "task.expirationHandler =  {\n    \/\/ Clean up the background task and prepare\n    \/\/ for the system to suspend your app.\n}",
      "language" : "swift"
    }
  ],
  "contentHash" : "f7eb15926834b3c4d67049b37cd9374edf094b8c230f3b91a6ebb5ad319ad85f",
  "crawledAt" : "2025-12-02T16:45:22Z",
  "id" : "557549E8-0BC2-472C-A65C-16A46A622551",
  "kind" : "article",
  "language" : "swift",
  "module" : "WatchKit",
  "overview" : "## Overview\n\nwatchOS defines background tasks for specific features that your app may use, such as acquiring snapshots or handing Siri intents. All background tasks follow the same general procedure; first, the system wakes your app in the background. If your app is suspended, the system resumes execution in the background. If the system has purged your app from memory, your app launches in the background. For more information on app states and transitions, see [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/life-cycles].\n\nWhen the system wakes your app, there are two ways it can respond to the task:\n\n### Respond to  background tasks in SwiftUI\n\nYou can use SwiftUI’s [doc:\/\/com.apple.documentation\/documentation\/SwiftUI\/Scene\/backgroundTask(_:action:)] method to define a closure for a specific type of background task. The system executes this closure when your app receives a matching task.\n\nThe system gives your app a few seconds of background execution time to execute the closure you provided. Complete the task as quickly as possible.\n\nThe SwiftUI background tasks provide several advantages over the WatchKit background tasks:\n\nTo specify a particular identifier, pass a [doc:\/\/com.apple.documentation\/documentation\/Swift\/String] as the `userInfo` parameter for [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKApplication\/scheduleBackgroundRefresh(withPreferredDate:userInfo:scheduledCompletion:)].\n\nYou can then use [doc:\/\/com.apple.documentation\/documentation\/SwiftUI\/BackgroundTask\/appRefresh(_:)] to specify a task for each identifier you want to handle, and use [doc:\/\/com.apple.documentation\/documentation\/SwiftUI\/BackgroundTask\/appRefresh] for tasks that match any other background refresh tasks.\n\n### Implement the app delegate’s handle method\n\nSwiftUI Background tasks are the preferred way to handle background tasks and interactions. However, if your app uses an app delegate, and you aren’t ready to migrate to SwiftUI background tasks, you can use an app delegate to handle your background tasks. This approach requires you to handle and manually mark all incoming tasks as complete. To use an app delegate, add a [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKApplicationDelegate] to your app and implement its [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKApplicationDelegate\/handle(_:)-4vdjo] method. For more information about using an application delegate, see [doc:\/\/com.apple.documentation\/documentation\/watchOS-Apps\/building_a_watchos_app].\n\nThe system calls your app delegate’s [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKApplicationDelegate\/handle(_:)-4vdjo] method whenever it receives a background task. The system then passes a set that contains one or more background tasks. In response, your app needs to perform the following actions:\n\nBecause background tasks happen asynchronously, the system may call your [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKApplicationDelegate\/handle(_:)-4vdjo] method with multiple tasks. It can also call [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKApplicationDelegate\/handle(_:)-4vdjo] while you’re already handling other background tasks, or even while your app is running in the foreground. If watchOS calls your [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKApplicationDelegate\/handle(_:)-4vdjo] method while your app is in the foreground, you can ignore the tasks, call [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKRefreshBackgroundTask\/setTaskCompletedWithSnapshot(_:)], and return.\n\nIf you implement your delegate’s [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKApplicationDelegate\/handle(_:)-4vdjo] method, you receive all the background tasks, both those that you schedule and those that the system schedules. Some of your app’s other behaviors also change:\n\nFor some background tasks, the system calls other delegate methods or completion handlers in addition to calling [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKApplicationDelegate\/handle(_:)-4vdjo]. The call to your delegate’s [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKApplicationDelegate\/handle(_:)-4vdjo] method occurs before any other methods or handlers. To process these multistep procedures, first save the task. Then, after you finish processing all the delegate method calls, call the task’s [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKRefreshBackgroundTask\/setTaskCompletedWithSnapshot(_:)] method.\n\n### Request a background task\n\nYour app can request to run in the background by calling [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKExtension\/scheduleBackgroundRefresh(withPreferredDate:userInfo:scheduledCompletion:)].\n\nFor the system to allocate background execution time to your app, your app must have a complication on the active watch face. If the system gives your app background execution time, it attempts to trigger your background task no earlier than the time specified by the `withPreferredDate` parameter; however, depending on the watch’s state, the system can defer or throttle your tasks. Therefore, your app might not wake up exactly at the specified time.\n\nWhen designing your app, don’t expect the system to trigger every background task. Design a fallback mechanism so your app behaves correctly even when throttling occurs. For example, even if your app never receives any background tasks, it can still update its state whenever the user launches it in the foreground.\n\n### Budget your app’s background time\n\nThe delivery of background tasks and the allocation of background execution time are completely up to the system. When making a watchOS app, schedule background updates based on these limits, and prepare for background task throttling. Understanding the limits helps you better design your app’s background update strategy.\n\nTo prevent background tasks from using too many system resources or excessively draining the battery, watchOS controls how often and how long background tasks can run. When scheduling background tasks, the system may:\n\nWhen the system triggers a background task, it wakes your app and gives it a small amount of time to run in the background. You need to complete the task as quickly as possible. If the available background time expires before you finish processing the task, the system may terminate your app, triggering an `EXC_CRASH (SIGKILL)` crash. For more information, see [doc:\/\/com.apple.documentation\/documentation\/Xcode\/understanding-the-exception-types-in-a-crash-report].\n\nWhen using [doc:\/\/com.apple.documentation\/documentation\/SwiftUI\/BackgroundTask] instances that may run long, use a `withTaskCancellationHandler(operation:onCancel:)` function to detect when the system cancels the background task. Use this function to clean up your background task and prepare for your app to become suspended.\n\nWhen using [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKRefreshBackgroundTask], assign an [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKRefreshBackgroundTask\/expirationHandler] to the task. The system then calls the [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKRefreshBackgroundTask\/expirationHandler] when your task is running out of time. You can use this handler to clean up your tasks.\n\nFor example, you could try to download data synchronously during a background refresh task. Then, in the expiration handler, convert the download to a background URL session if necessary. This lets your [doc:\/\/com.apple.documentation\/documentation\/Foundation\/URLSession] continue downloading the requested content, even after your app suspends.\n\n### Handle Siri Intents\n\nTo handle Siri intents, the system wakes your app in the background and executes your handler. Then it calls your app delegate’s [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKExtensionDelegate\/handle(_:completionHandler:)] method. When using a [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKIntentDidRunRefreshBackgroundTask] task, you need to defer calling [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKRefreshBackgroundTask\/setTaskCompletedWithSnapshot(_:)] until after you finish handling the intent. Be sure to process the intent using the following steps:\n\n### Manage background URL sessions\n\nWhen you schedule a background [doc:\/\/com.apple.documentation\/documentation\/Foundation\/URLSession], the system can wake your app in the background to handle a variety of events, including authorization requests, errors, and a completed download. The system then calls the relevant methods on your session delegate.\n\nWhen using a [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKURLSessionRefreshBackgroundTask] task, you need to defer calling [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKRefreshBackgroundTask\/setTaskCompletedWithSnapshot(_:)] until after you finish handling the call to the session delegate. For example, to handle a basic download task, use the following steps:\n\nFor more complex interactions, the system may call other session delegate methods, such as [doc:\/\/com.apple.documentation\/documentation\/Foundation\/URLSessionTaskDelegate\/urlSession(_:task:didReceive:completionHandler:)], to handle authentication. These follow the same basic pattern: You handle the delegate call, and then call [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKRefreshBackgroundTask\/setTaskCompletedWithSnapshot(_:)] to end the background task.\n\n### Communicate using Watch Connectivity\n\nThe system can wake your app in the background to handle communication using [doc:\/\/com.apple.documentation\/documentation\/WatchConnectivity]. It calls your background task handler and then calls the relevant methods on your [doc:\/\/com.apple.documentation\/documentation\/WatchConnectivity\/WCSessionDelegate].\n\nWhen using a [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKWatchConnectivityRefreshBackgroundTask] task, you need to defer calling [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKRefreshBackgroundTask\/setTaskCompletedWithSnapshot(_:)] until after you finish handling the call to the session delegate. For example, to handle a basic download task, use the following steps:\n\n### Communicate over Bluetooth\n\nYour apps can connect to Bluetooth peripherals and communicate with those devices in the background. To perform any background Bluetooth tasks, add the `bluetooth-central` value to the [doc:\/\/com.apple.documentation\/documentation\/BundleResources\/Information-Property-List\/UIBackgroundModes] array in the Info tab of your Xcode project settings or in your app’s `Info.plist` file. In Xcode’s property list editor, add “App communicates using Core Bluetooth” to the “Required background modes” array.\n\nTypically, your app scans for the Bluetooth peripheral while running in the foreground. You can then perform the initial connection and pair the devices if necessary.\n\nIn watchOS 8 or later, you can reconnect with the Bluetooth peripheral and fetch additional data using a [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKApplicationRefreshBackgroundTask], [doc:\/\/com.apple.documentation\/documentation\/SwiftUI\/BackgroundTask], or [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKExtendedRuntimeSession]. In watchOS 9 or later, the system can retain your connection to the peripheral, even after suspending your app; therefore, you may not need to reconnect when your app wakes.\n\nIn watchOS 9 or later, your app can also receive [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKBluetoothAlertRefreshBackgroundTask] or [doc:\/\/com.apple.documentation\/documentation\/SwiftUI\/BackgroundTask\/bluetoothAlert] tasks to handle timely alerts in the background. To receive timely alerts, your peripheral must use Generic Attribute Profile (GATT) transactions. Call [doc:\/\/com.apple.documentation\/documentation\/CoreBluetooth\/CBPeripheral\/setNotifyValue(_:for:)] to enable notifications for the specified characteristic. Then, any change to the peripheral’s characteristic wakes your app and executes your handler. Use your handler to reconnect to the peripheral and handle the alert.\n\nIn watchOS 9 or later, your app can also scan for Bluetooth peripherals from the background. Background scanning shares a budget with the timely alert tasks, so your app can only perform a few background scans per day.\n\nWhen your app receives a timely alert and your budget has only one Bluetooth alert task remaining, the system raises a [doc:\/\/com.apple.documentation\/documentation\/CoreBluetooth\/CBError-swift.struct\/Code\/leGattNearBackgroundNotificationLimit] error. If you exceed the budget, the system raises a [doc:\/\/com.apple.documentation\/documentation\/CoreBluetooth\/CBError-swift.struct\/Code\/leGattExceededBackgroundNotificationLimit] error, and your app doesn’t receive any timely alerts and can’t perform any background scans until additional background budget is available.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/WatchKit\/using-background-tasks\ncrawled: 2025-12-02T16:45:22Z\n---\n\n# Using background tasks\n\n**Article**\n\nHandle scheduled update tasks in the background, and respond to background system interactions including Siri intents and incoming Bluetooth messages.\n\n## Overview\n\nwatchOS defines background tasks for specific features that your app may use, such as acquiring snapshots or handing Siri intents. All background tasks follow the same general procedure; first, the system wakes your app in the background. If your app is suspended, the system resumes execution in the background. If the system has purged your app from memory, your app launches in the background. For more information on app states and transitions, see [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/life-cycles].\n\nWhen the system wakes your app, there are two ways it can respond to the task:\n\n- Use SwiftUI’s [doc:\/\/com.apple.documentation\/documentation\/SwiftUI\/Scene\/backgroundTask(_:action:)] modifier to respond to the tasks you’re interested in.\n- Use an app delegate and implement the delegate’s [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKApplicationDelegate\/handle(_:)-4vdjo] method. This method must respond to all the background tasks generated by the system.\n\n### Respond to  background tasks in SwiftUI\n\nYou can use SwiftUI’s [doc:\/\/com.apple.documentation\/documentation\/SwiftUI\/Scene\/backgroundTask(_:action:)] method to define a closure for a specific type of background task. The system executes this closure when your app receives a matching task.\n\n```swift\nimport SwiftUI\n\n@main\nstruct MyApp_Watch_AppApp: App {\n    var body: some Scene {\n        WindowGroup {\n            ContentView()\n        }\n        .backgroundTask(.appRefresh(\"My_App_Updates\")) { context in\n            \/\/ Perform the background task here.\n        }\n    }\n}\n```\n\nThe system gives your app a few seconds of background execution time to execute the closure you provided. Complete the task as quickly as possible.\n\nThe SwiftUI background tasks provide several advantages over the WatchKit background tasks:\n\n- The system automatically sets the task as complete when your closure returns.\n- You only need to handle the background tasks relevant to your app.\n- For [doc:\/\/com.apple.documentation\/documentation\/SwiftUI\/BackgroundTask\/appRefresh(_:)] tasks, you can specify an identifier for each type of refresh task your app supports. You can then handle tasks with different identifiers separately.\n\nTo specify a particular identifier, pass a [doc:\/\/com.apple.documentation\/documentation\/Swift\/String] as the `userInfo` parameter for [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKApplication\/scheduleBackgroundRefresh(withPreferredDate:userInfo:scheduledCompletion:)].\n\n```swift\nWKApplication.shared()\n    .scheduleBackgroundRefresh(\n        withPreferredDate: Date.init(timeIntervalSinceNow: 15.0 * 60.0),\n        userInfo: \"MY_FIRST_UPDATE\" as NSSecureCoding & NSObjectProtocol) { error in\n            if error != nil {\n                \/\/ Handle the scheduling error.\n                fatalError(\"*** An error occurred while scheduling the background refresh task. ***\")\n            }\n\n            print(\"*** Scheduled! ***\")\n        }\n```\n\nYou can then use [doc:\/\/com.apple.documentation\/documentation\/SwiftUI\/BackgroundTask\/appRefresh(_:)] to specify a task for each identifier you want to handle, and use [doc:\/\/com.apple.documentation\/documentation\/SwiftUI\/BackgroundTask\/appRefresh] for tasks that match any other background refresh tasks.\n\n```swift\nimport SwiftUI\n\n@main\nstruct MyApp_Watch_AppApp: App {\n    var body: some Scene {\n        WindowGroup {\n            ContentView()\n        }\n        .backgroundTask(.appRefresh(\"MY_FIRST_IDENTIFIER\")) { context in\n            \/\/ Handle tasks with the \"MY_FIRST_IDENTIFIER\" identifier.\n        }\n        .backgroundTask(.appRefresh(\"MY_SECOND_IDENTIFIER\")) { context in\n            \/\/ Handle tasks with the \"MY_SECOND_IDENTIFIER\" identifier.\n        }\n        .backgroundTask(.appRefresh) { context in\n            \/\/ Handles any other app refresh tasks.\n        }\n    }\n}\n```\n\n### Implement the app delegate’s handle method\n\nSwiftUI Background tasks are the preferred way to handle background tasks and interactions. However, if your app uses an app delegate, and you aren’t ready to migrate to SwiftUI background tasks, you can use an app delegate to handle your background tasks. This approach requires you to handle and manually mark all incoming tasks as complete. To use an app delegate, add a [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKApplicationDelegate] to your app and implement its [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKApplicationDelegate\/handle(_:)-4vdjo] method. For more information about using an application delegate, see [doc:\/\/com.apple.documentation\/documentation\/watchOS-Apps\/building_a_watchos_app].\n\nThe system calls your app delegate’s [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKApplicationDelegate\/handle(_:)-4vdjo] method whenever it receives a background task. The system then passes a set that contains one or more background tasks. In response, your app needs to perform the following actions:\n\n1. For each task in the set, the app checks the task type and performs the appropriate action. If you schedule multiple tasks, provide user information to identify each task’s intended purpose. When the system schedules a task, it automatically sets the `userInfo` property to `nil`.\n2. After the task completes, the app calls the task’s [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKRefreshBackgroundTask\/setTaskCompletedWithSnapshot(_:)] method. The system suspends the app again as soon as all background tasks finish. The system gives your app only a few seconds of background execution time. Complete the background task and call [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKRefreshBackgroundTask\/setTaskCompletedWithSnapshot(_:)] as quickly as possible.\n\nBecause background tasks happen asynchronously, the system may call your [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKApplicationDelegate\/handle(_:)-4vdjo] method with multiple tasks. It can also call [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKApplicationDelegate\/handle(_:)-4vdjo] while you’re already handling other background tasks, or even while your app is running in the foreground. If watchOS calls your [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKApplicationDelegate\/handle(_:)-4vdjo] method while your app is in the foreground, you can ignore the tasks, call [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKRefreshBackgroundTask\/setTaskCompletedWithSnapshot(_:)], and return.\n\nIf you implement your delegate’s [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKApplicationDelegate\/handle(_:)-4vdjo] method, you receive all the background tasks, both those that you schedule and those that the system schedules. Some of your app’s other behaviors also change:\n\n- Background Watch Connectivity transfers wake your app, triggering a background watch connectivity task. Use this task to receive the data and update your app’s state.\n- Background [doc:\/\/com.apple.documentation\/documentation\/Foundation\/URLSession] transfers wake your app when the transfer needs authorization or when the transfer completes (successfully or not). Use this task to authorize the transfer or to update your app’s state.\n- The system doesn’t call your [doc:\/\/com.apple.documentation\/documentation\/ClockKit\/CLKComplicationDataSource] object’s [doc:\/\/com.apple.documentation\/documentation\/ClockKit\/CLKComplicationDataSource\/getNextRequestedUpdateDate(handler:)], [doc:\/\/com.apple.documentation\/documentation\/ClockKit\/CLKComplicationDataSource\/requestedUpdateDidBegin()], or [doc:\/\/com.apple.documentation\/documentation\/ClockKit\/CLKComplicationDataSource\/requestedUpdateBudgetExhausted()] methods. Instead, schedule a background app refresh task to update your complications.\n\nFor some background tasks, the system calls other delegate methods or completion handlers in addition to calling [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKApplicationDelegate\/handle(_:)-4vdjo]. The call to your delegate’s [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKApplicationDelegate\/handle(_:)-4vdjo] method occurs before any other methods or handlers. To process these multistep procedures, first save the task. Then, after you finish processing all the delegate method calls, call the task’s [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKRefreshBackgroundTask\/setTaskCompletedWithSnapshot(_:)] method.\n\n\n\n### Request a background task\n\nYour app can request to run in the background by calling [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKExtension\/scheduleBackgroundRefresh(withPreferredDate:userInfo:scheduledCompletion:)].\n\n```swift\nWKApplication.shared()\n    .scheduleBackgroundRefresh(\n        withPreferredDate: Date.init(timeIntervalSinceNow: 15.0 * 60.0),\n        userInfo: nil { error in\n            if error != nil {\n                \/\/ Handle the scheduling error.\n                fatalError(\"*** An error occurred while scheduling the background refresh task. ***\")\n            }\n\n            print(\"*** Scheduled! ***\")\n        }\n\n```\n\nFor the system to allocate background execution time to your app, your app must have a complication on the active watch face. If the system gives your app background execution time, it attempts to trigger your background task no earlier than the time specified by the `withPreferredDate` parameter; however, depending on the watch’s state, the system can defer or throttle your tasks. Therefore, your app might not wake up exactly at the specified time.\n\nWhen designing your app, don’t expect the system to trigger every background task. Design a fallback mechanism so your app behaves correctly even when throttling occurs. For example, even if your app never receives any background tasks, it can still update its state whenever the user launches it in the foreground.\n\n### Budget your app’s background time\n\nThe delivery of background tasks and the allocation of background execution time are completely up to the system. When making a watchOS app, schedule background updates based on these limits, and prepare for background task throttling. Understanding the limits helps you better design your app’s background update strategy.\n\nTo prevent background tasks from using too many system resources or excessively draining the battery, watchOS controls how often and how long background tasks can run. When scheduling background tasks, the system may:\n\n- Give each app an individual allotment of background execution time. The system only triggers an app’s background tasks when it has time remaining in its budget.\n- Throttle background tasks when system resources are tight. Even if individual apps have the budget for tasks, the system doesn’t trigger background tasks when the device’s battery is low or the system conditions are poor.\n- Throttle background execution when the user is performing high-priority activities, such as exercising or navigating.\n\nWhen the system triggers a background task, it wakes your app and gives it a small amount of time to run in the background. You need to complete the task as quickly as possible. If the available background time expires before you finish processing the task, the system may terminate your app, triggering an `EXC_CRASH (SIGKILL)` crash. For more information, see [doc:\/\/com.apple.documentation\/documentation\/Xcode\/understanding-the-exception-types-in-a-crash-report].\n\nWhen using [doc:\/\/com.apple.documentation\/documentation\/SwiftUI\/BackgroundTask] instances that may run long, use a `withTaskCancellationHandler(operation:onCancel:)` function to detect when the system cancels the background task. Use this function to clean up your background task and prepare for your app to become suspended.\n\n```swift\n.backgroundTask(.appRefresh) { context in\n    \/\/ Handles any other app refresh tasks.\n    await withTaskCancellationHandler {\n        \/\/ Handle the background refresh task.\n    } onCancel: {\n        \/\/ Clean up and prepare to become suspended.\n    }\n}\n```\n\nWhen using [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKRefreshBackgroundTask], assign an [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKRefreshBackgroundTask\/expirationHandler] to the task. The system then calls the [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKRefreshBackgroundTask\/expirationHandler] when your task is running out of time. You can use this handler to clean up your tasks.\n\n```swift\ntask.expirationHandler =  {\n    \/\/ Clean up the background task and prepare\n    \/\/ for the system to suspend your app.\n}\n```\n\nFor example, you could try to download data synchronously during a background refresh task. Then, in the expiration handler, convert the download to a background URL session if necessary. This lets your [doc:\/\/com.apple.documentation\/documentation\/Foundation\/URLSession] continue downloading the requested content, even after your app suspends.\n\n### Handle Siri Intents\n\nTo handle Siri intents, the system wakes your app in the background and executes your handler. Then it calls your app delegate’s [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKExtensionDelegate\/handle(_:completionHandler:)] method. When using a [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKIntentDidRunRefreshBackgroundTask] task, you need to defer calling [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKRefreshBackgroundTask\/setTaskCompletedWithSnapshot(_:)] until after you finish handling the intent. Be sure to process the intent using the following steps:\n\n1. The system executes your handler using a [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKIntentDidRunRefreshBackgroundTask] task. Save the task so you can set it as complete later.\n2. The system then calls your delegate’s [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKExtensionDelegate\/handle(_:completionHandler:)] method, passing an intent and completion handler. In this method, your app processes the intent and calls its completion handler.\n3. Finally, mark the task as complete by calling its [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKRefreshBackgroundTask\/setTaskCompletedWithSnapshot(_:)] method.\n\n### Manage background URL sessions\n\nWhen you schedule a background [doc:\/\/com.apple.documentation\/documentation\/Foundation\/URLSession], the system can wake your app in the background to handle a variety of events, including authorization requests, errors, and a completed download. The system then calls the relevant methods on your session delegate.\n\nWhen using a [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKURLSessionRefreshBackgroundTask] task, you need to defer calling [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKRefreshBackgroundTask\/setTaskCompletedWithSnapshot(_:)] until after you finish handling the call to the session delegate. For example, to handle a basic download task, use the following steps:\n\n1. The system calls your delegate’s [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKExtensionDelegate\/handle(_:)-92ulv] method, passing a [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKURLSessionRefreshBackgroundTask] task. In this method, your app needs to save the task so you can access it later.\n2. The system then calls your session delegate’s [doc:\/\/com.apple.documentation\/documentation\/Foundation\/URLSessionDownloadDelegate\/urlSession(_:downloadTask:didFinishDownloadingTo:)] method. In this method, your app needs to move the downloaded data to a permanent location.\n3. Finally, the system calls your session delegate’s [doc:\/\/com.apple.documentation\/documentation\/Foundation\/URLSessionTaskDelegate\/urlSession(_:task:didCompleteWithError:)] method. In this method, your app needs to mark the task as complete by calling the [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKRefreshBackgroundTask\/setTaskCompletedWithSnapshot(_:)] method on the background task that you saved in step 1.\n\nFor more complex interactions, the system may call other session delegate methods, such as [doc:\/\/com.apple.documentation\/documentation\/Foundation\/URLSessionTaskDelegate\/urlSession(_:task:didReceive:completionHandler:)], to handle authentication. These follow the same basic pattern: You handle the delegate call, and then call [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKRefreshBackgroundTask\/setTaskCompletedWithSnapshot(_:)] to end the background task.\n\n### Communicate using Watch Connectivity\n\nThe system can wake your app in the background to handle communication using [doc:\/\/com.apple.documentation\/documentation\/WatchConnectivity]. It calls your background task handler and then calls the relevant methods on your [doc:\/\/com.apple.documentation\/documentation\/WatchConnectivity\/WCSessionDelegate].\n\nWhen using a [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKWatchConnectivityRefreshBackgroundTask] task, you need to defer calling [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKRefreshBackgroundTask\/setTaskCompletedWithSnapshot(_:)] until after you finish handling the call to the session delegate. For example, to handle a basic download task, use the following steps:\n\n1. The system calls your delegate’s [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKExtensionDelegate\/handle(_:)-92ulv] method, passing a [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKWatchConnectivityRefreshBackgroundTask] task. In this method, your app needs to save the task so you can access it later.\n2. Then the system calls methods on your [doc:\/\/com.apple.documentation\/documentation\/WatchConnectivity\/WCSessionDelegate], based on the type of data that the paired iPhone sends. Your app processes the incoming data in these delegate methods.\n3. Your app can use the current session’s [doc:\/\/com.apple.documentation\/documentation\/WatchConnectivity\/WCSession\/hasContentPending] method to determine whether you still have any pending data.\n4. After you’ve processed all the incoming data, call the [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKRefreshBackgroundTask\/setTaskCompletedWithSnapshot(_:)] method on the background task you saved in step 1.\n\n### Communicate over Bluetooth\n\nYour apps can connect to Bluetooth peripherals and communicate with those devices in the background. To perform any background Bluetooth tasks, add the `bluetooth-central` value to the [doc:\/\/com.apple.documentation\/documentation\/BundleResources\/Information-Property-List\/UIBackgroundModes] array in the Info tab of your Xcode project settings or in your app’s `Info.plist` file. In Xcode’s property list editor, add “App communicates using Core Bluetooth” to the “Required background modes” array.\n\nTypically, your app scans for the Bluetooth peripheral while running in the foreground. You can then perform the initial connection and pair the devices if necessary.\n\nIn watchOS 8 or later, you can reconnect with the Bluetooth peripheral and fetch additional data using a [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKApplicationRefreshBackgroundTask], [doc:\/\/com.apple.documentation\/documentation\/SwiftUI\/BackgroundTask], or [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKExtendedRuntimeSession]. In watchOS 9 or later, the system can retain your connection to the peripheral, even after suspending your app; therefore, you may not need to reconnect when your app wakes.\n\nIn watchOS 9 or later, your app can also receive [doc:\/\/com.apple.watchkit\/documentation\/WatchKit\/WKBluetoothAlertRefreshBackgroundTask] or [doc:\/\/com.apple.documentation\/documentation\/SwiftUI\/BackgroundTask\/bluetoothAlert] tasks to handle timely alerts in the background. To receive timely alerts, your peripheral must use Generic Attribute Profile (GATT) transactions. Call [doc:\/\/com.apple.documentation\/documentation\/CoreBluetooth\/CBPeripheral\/setNotifyValue(_:for:)] to enable notifications for the specified characteristic. Then, any change to the peripheral’s characteristic wakes your app and executes your handler. Use your handler to reconnect to the peripheral and handle the alert.\n\nIn watchOS 9 or later, your app can also scan for Bluetooth peripherals from the background. Background scanning shares a budget with the timely alert tasks, so your app can only perform a few background scans per day.\n\n\n\nWhen your app receives a timely alert and your budget has only one Bluetooth alert task remaining, the system raises a [doc:\/\/com.apple.documentation\/documentation\/CoreBluetooth\/CBError-swift.struct\/Code\/leGattNearBackgroundNotificationLimit] error. If you exceed the budget, the system raises a [doc:\/\/com.apple.documentation\/documentation\/CoreBluetooth\/CBError-swift.struct\/Code\/leGattExceededBackgroundNotificationLimit] error, and your app doesn’t receive any timely alerts and can’t perform any background scans until additional background budget is available.\n\n## Background tasks\n\n- **Preparing to take your watchOS app’s snapshot**: Provide a timely, accurate snapshot of your app by using snapshot background tasks.\n- **WKApplicationRefreshBackgroundTask**: A task that updates your app’s state in the background.\n- **WKURLSessionRefreshBackgroundTask**: A task that responds to background URL sessions.\n- **WKWatchConnectivityRefreshBackgroundTask**: A background task used to receive background updates from the Watch Connectivity framework.\n- **WKBluetoothAlertRefreshBackgroundTask**: A task for handling timely Bluetooth alerts in the background.\n- **WKIntentDidRunRefreshBackgroundTask**: A background task used to update your app after a SiriKit intent runs.\n- **WKRelevantShortcutRefreshBackgroundTask**: A background task used to periodically donate relevant Siri shortcuts.\n- **WKSnapshotRefreshBackgroundTask**: A background task used to update your app’s user interface in preparation for a snapshot.\n- **WKRefreshBackgroundTask**: The abstract superclass for WatchKit’s background task classes.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Provide a timely, accurate snapshot of your app by using snapshot background tasks.",
          "name" : "Preparing to take your watchOS app’s snapshot",
          "url" : "https:\/\/developer.apple.com\/documentation\/WatchKit\/preparing-to-take-your-watchos-app-s-snapshot"
        },
        {
          "description" : "A task that updates your app’s state in the background.",
          "name" : "WKApplicationRefreshBackgroundTask",
          "url" : "https:\/\/developer.apple.com\/documentation\/WatchKit\/WKApplicationRefreshBackgroundTask"
        },
        {
          "description" : "A task that responds to background URL sessions.",
          "name" : "WKURLSessionRefreshBackgroundTask",
          "url" : "https:\/\/developer.apple.com\/documentation\/WatchKit\/WKURLSessionRefreshBackgroundTask"
        },
        {
          "description" : "A background task used to receive background updates from the Watch Connectivity framework.",
          "name" : "WKWatchConnectivityRefreshBackgroundTask",
          "url" : "https:\/\/developer.apple.com\/documentation\/WatchKit\/WKWatchConnectivityRefreshBackgroundTask"
        },
        {
          "description" : "A task for handling timely Bluetooth alerts in the background.",
          "name" : "WKBluetoothAlertRefreshBackgroundTask",
          "url" : "https:\/\/developer.apple.com\/documentation\/WatchKit\/WKBluetoothAlertRefreshBackgroundTask"
        },
        {
          "description" : "A background task used to update your app after a SiriKit intent runs.",
          "name" : "WKIntentDidRunRefreshBackgroundTask",
          "url" : "https:\/\/developer.apple.com\/documentation\/WatchKit\/WKIntentDidRunRefreshBackgroundTask"
        },
        {
          "description" : "A background task used to periodically donate relevant Siri shortcuts.",
          "name" : "WKRelevantShortcutRefreshBackgroundTask",
          "url" : "https:\/\/developer.apple.com\/documentation\/WatchKit\/WKRelevantShortcutRefreshBackgroundTask"
        },
        {
          "description" : "A background task used to update your app’s user interface in preparation for a snapshot.",
          "name" : "WKSnapshotRefreshBackgroundTask",
          "url" : "https:\/\/developer.apple.com\/documentation\/WatchKit\/WKSnapshotRefreshBackgroundTask"
        },
        {
          "description" : "The abstract superclass for WatchKit’s background task classes.",
          "name" : "WKRefreshBackgroundTask",
          "url" : "https:\/\/developer.apple.com\/documentation\/WatchKit\/WKRefreshBackgroundTask"
        }
      ],
      "title" : "Background tasks"
    }
  ],
  "source" : "appleJSON",
  "title" : "Using background tasks",
  "url" : "https:\/\/developer.apple.com\/documentation\/WatchKit\/using-background-tasks"
}