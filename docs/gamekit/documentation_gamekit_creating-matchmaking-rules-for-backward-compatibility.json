{
  "abstract" : "Add matchmaking rules that support previous classic matchmaking versions of your game.",
  "codeExamples" : [
    {
      "code" : "POST \/v1\/gameCenterMatchmakingQueues\n{\n    \"data\": {\n        \"type\": \"gameCenterMatchmakingQueues\",\n        \"attributes\": {\n            \"referenceName\": \"com.example.mygame.ClassicSkillRules\"\n            \"classicMatchmakingBundleIds\": [ \"com.example.mygame\" ]\n        },\n        \"relationships\": {\n            \"ruleSet\": {\n                \"data\": {\n                    \"type\": \"gameCenterMatchmakingRuleSets\",\n                    \"id\": \"6f7c8f9a-18ba-4372-9c17-d3fa0d18c46c\"\n                }\n            }\n        }\n    }\n}",
      "language" : "json"
    },
    {
      "code" : "POST \/v1\/gameCenterMatchmakingRules\n{\n    \"data\": {\n        \"type\": \"gameCenterMatchmakingRules\",\n        \"attributes\": {\n            \"type\": \"COMPATIBLE\",\n            \"description\": \"Players must use same map\",\n            \"referenceName\": \"SameMap\",\n            \"expression\": \"requests[0].properties.playerGroup == requests[1].properties.playerGroup\"\n        },\n        \"relationships\": {\n            \"ruleSet\": {\n                \"data\": {\n                    \"type\": \"gameCenterMatchmakingRuleSets\",\n                    \"id\": \"56f6cee1-df7b-45df-9bdc-c60d1208b3bf\"\n                }\n            }\n        }\n    }\n}",
      "language" : "json"
    },
    {
      "code" : "diff(players[].properties.skill) <= agedValues(avg(requests[].secondsInQueue), `20`, [ `40`, `100` ], [ `10`, `20` ])",
      "language" : "json"
    },
    {
      "code" : "requests[].properties.[ skill, `50`][*].not_null(@) | [*][0]",
      "language" : "json"
    },
    {
      "code" : "diff(requests[].properties.[ skill, `50`][*].not_null(@) | [*][0]) <= agedValues(avg(requests[].secondsInQueue), `20`, [ `40`, `100` ], [ `10`, `20` ])",
      "language" : "json"
    },
    {
      "code" : "{\n    \"requests\": [\n        {\n            \"requestName\": \"r1\",\n            \"playerId\": \"r1_p1\",\n            \"properties\": {\n                \"skill\": 49\n            },\n            \"players\": [\n                {\n                    \"playerId\": \"r1_p1\",\n                    \"properties\": {\n                        \"skill\": 49\n                    },\n                    \"requestName\": \"r1\"\n                }\n            ],\n            \"appVersion\": \"1.0.0\",\n            \"bundleId\": \"com.example.mygame\",\n            \"platform\": \"IOS\",\n            \"locale\": \"EN-US\",\n            \"longitude\": 0,\n            \"latitude\": 0,\n            \"minPlayers\": 2,\n            \"maxPlayers\": 2,\n            \"playerCount\": 1,\n            \"secondsInQueue\": 0\n        },\n        {\n            \"requestName\": \"r2\",\n            \"playerId\": \"r2_p1\",\n            \"properties\": {},\n            \"players\": [\n                {\n                    \"playerId\": \"r2_p1\",\n                    \"properties\": {},\n                    \"requestName\": \"r2\"\n                }\n            ],\n            \"appVersion\": \"1.0.0\",\n            \"bundleId\": \"com.example.mygame\",\n            \"platform\": \"IOS\",\n            \"locale\": \"EN-US\",\n            \"longitude\": 0,\n            \"latitude\": 0,\n            \"minPlayers\": 2,\n            \"maxPlayers\": 2,\n            \"playerCount\": 1,\n            \"secondsInQueue\": 0\n        }\n    ],\n    \"players\": [\n        {\n            \"playerId\": \"r1_p1\",\n            \"properties\": {\n                \"skill\": 49\n            },\n            \"requestName\": \"r1\"\n        },\n        {\n            \"playerId\": \"r2_p1\",\n            \"properties\": {},\n            \"requestName\": \"r2\"\n        }\n    ]\n}",
      "language" : "json"
    }
  ],
  "contentHash" : "3f21c705fd0edb7d845691673b81b4a60c043088cd2cd43958ee5e9165a48b17",
  "crawledAt" : "2025-12-02T19:15:13Z",
  "id" : "EC44D560-0635-4A51-879B-D44A7D36B100",
  "kind" : "article",
  "language" : "swift",
  "module" : "GameKit",
  "overview" : "## Overview\n\nLet players running the current version of your game match with players running previous classic matchmaking versions that don’t use rules. You increase the pool of players, improve the quality of matches, and reduce wait times, if you configure a queue and write rules that include classic match requests.\n\nFor more information on creating queues, rule sets, and rules, see [doc:\/\/com.apple.gamekit\/documentation\/GameKit\/finding-players-using-matchmaking-rules].\n\n### Add classic match requests to a queue\n\nGame Center adds classic match requests that don’t specify a queue name to a default classic matchmaking queue, excluding the requests from matching with players running versions that use rules. To include classic match requests in a queue, set the `classicMatchmakingBundleIds` field to the bundle IDs of the versions you want to include when you create the queue using the [doc:\/\/com.apple.documentation\/documentation\/AppStoreConnectAPI\/POST-v1-gameCenterMatchmakingQueues] endpoint.\n\nIf you create a Game Center group in App Store Connect to share leaderboards, achievements, and matchmaking between games (see [https:\/\/developer.apple.com\/help\/app-store-connect\/configure-game-center\/create-groups]), add the bundle IDs for the classic matchmaking games in the group to the `classicMatchmakingBundleIds` property.\n\n### Add a rule that handles the player group property\n\nIf you set the player group property of match requests in classic matchmaking versions, add a compatible rule to the rule set and queue that matches requests by player group.\n\nWhen you add classic match requests to a queue with the [doc:\/\/com.apple.gamekit\/documentation\/GameKit\/GKMatchRequest\/playerGroup] property set, those requests contain a `playerGroup` property in the `properties` array. Add a rule with a Boolean expression that compares the `playerGroup` properties of two requests using the [doc:\/\/com.apple.documentation\/documentation\/AppStoreConnectAPI\/POST-v1-gameCenterMatchmakingRules] endpoint.\n\nIn versions of your game that use matchmaking rules, be sure to include a corresponding `playerGroup` property in match requests using the [doc:\/\/com.apple.gamekit\/documentation\/GameKit\/GKMatchRequest\/properties] property.\n\nFor more information on creating rules, see [doc:\/\/com.apple.gamekit\/documentation\/GameKit\/finding-players-using-matchmaking-rules#Add-matchmaking-rules-to-the-rule-sets].\n\n### Write expressions that provide default values for player properties\n\nIf your rules use player properties that previous versions of your game don’t supply, the rules won’t match players of the previous versions with the current version. Especially if you configure a queue to contain both classic and rule-based match requests, the classic requests won’t have your custom player properties. To provide backward compatibility with previous versions, write rule expressions in a way that provide default values for missing player properties.\n\nFor example, replace this expression for the skills-based match rule (see [doc:\/\/com.apple.gamekit\/documentation\/GameKit\/finding-players-with-similar-skill-levels]) with one that provides a default value for the `skill` property:\n\nUse the rich set of [https:\/\/jmespath.org] operators, expressions, and functions in the rule expression to achieve the desired results. For example, this expression uses the flatten operator, wildcard expression, pipe expression, and `not_null()` function to provide a default value of 50 for the `skill` property:\n\nTo understand this and other complex expressions before adding them to rules, use the [http:\/\/play.jmespath.org]. For example, create sample requests where one player has a skill level of `49` and another player has no `skill` property value (see [doc:\/\/com.apple.gamekit\/documentation\/GameKit\/creating-matchmaking-rules-for-backward-compatibility#Create-JMESPath-playground-sample-match-requests]). Enter the sample requests into the input JSON field of the playground. Then enter parts of the expression in the playground to see the results.\n\nAdd the expression that produces the desired results to a rule using the [doc:\/\/com.apple.documentation\/documentation\/AppStoreConnectAPI\/POST-v1-gameCenterMatchmakingRules] endpoint. For example, replace the Boolean expression above that uses the `diff()` function to compare player skill properties with one that provides a default value for the `skill` property (see [doc:\/\/com.apple.gamekit\/documentation\/GameKit\/finding-players-with-similar-skill-levels#Create-a-match-rule-containing-the-expression]).\n\n### Create JMESPath playground sample match requests\n\nSample match requests that you create for testing expressions in the JMESPath playground are similar to those you pass to the [doc:\/\/com.apple.documentation\/documentation\/AppStoreConnectAPI\/POST-v1-gameCenterMatchmakingRuleSetTests] endpoint. Pass the same attribute and relationship properties except without the enclosing Game Center data structures.\n\nFor example, create sample requests where one player has a skill level of `49` and another player has no `skill` property value. For examples of match requests that you pass to the testing APIs, see [doc:\/\/com.apple.gamekit\/documentation\/GameKit\/testing-matchmaking-rules].\n\nTo create sample match requests for the playground using a script, see [https:\/\/github.com\/apple\/game-center-tools].\n\n### Test match requests from previous versions\n\nTest your matchmaking rules on the server side with different combinations of match requests from previous and current versions of your game. Pass the rule set and sample match requests to the test API (see [doc:\/\/com.apple.gamekit\/documentation\/GameKit\/testing-matchmaking-rules]). Your rules should match players using different versions of your game.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/GameKit\/creating-matchmaking-rules-for-backward-compatibility\ncrawled: 2025-12-02T19:15:13Z\n---\n\n# Creating matchmaking rules for backward compatibility\n\n**Article**\n\nAdd matchmaking rules that support previous classic matchmaking versions of your game.\n\n## Overview\n\nLet players running the current version of your game match with players running previous classic matchmaking versions that don’t use rules. You increase the pool of players, improve the quality of matches, and reduce wait times, if you configure a queue and write rules that include classic match requests.\n\nFor more information on creating queues, rule sets, and rules, see [doc:\/\/com.apple.gamekit\/documentation\/GameKit\/finding-players-using-matchmaking-rules].\n\n### Add classic match requests to a queue\n\nGame Center adds classic match requests that don’t specify a queue name to a default classic matchmaking queue, excluding the requests from matching with players running versions that use rules. To include classic match requests in a queue, set the `classicMatchmakingBundleIds` field to the bundle IDs of the versions you want to include when you create the queue using the [doc:\/\/com.apple.documentation\/documentation\/AppStoreConnectAPI\/POST-v1-gameCenterMatchmakingQueues] endpoint.\n\n```json\nPOST \/v1\/gameCenterMatchmakingQueues\n{\n    \"data\": {\n        \"type\": \"gameCenterMatchmakingQueues\",\n        \"attributes\": {\n            \"referenceName\": \"com.example.mygame.ClassicSkillRules\"\n            \"classicMatchmakingBundleIds\": [ \"com.example.mygame\" ]\n        },\n        \"relationships\": {\n            \"ruleSet\": {\n                \"data\": {\n                    \"type\": \"gameCenterMatchmakingRuleSets\",\n                    \"id\": \"6f7c8f9a-18ba-4372-9c17-d3fa0d18c46c\"\n                }\n            }\n        }\n    }\n}\n```\n\nIf you create a Game Center group in App Store Connect to share leaderboards, achievements, and matchmaking between games (see [https:\/\/developer.apple.com\/help\/app-store-connect\/configure-game-center\/create-groups]), add the bundle IDs for the classic matchmaking games in the group to the `classicMatchmakingBundleIds` property.\n\n### Add a rule that handles the player group property\n\nIf you set the player group property of match requests in classic matchmaking versions, add a compatible rule to the rule set and queue that matches requests by player group.\n\nWhen you add classic match requests to a queue with the [doc:\/\/com.apple.gamekit\/documentation\/GameKit\/GKMatchRequest\/playerGroup] property set, those requests contain a `playerGroup` property in the `properties` array. Add a rule with a Boolean expression that compares the `playerGroup` properties of two requests using the [doc:\/\/com.apple.documentation\/documentation\/AppStoreConnectAPI\/POST-v1-gameCenterMatchmakingRules] endpoint.\n\n```json\nPOST \/v1\/gameCenterMatchmakingRules\n{\n    \"data\": {\n        \"type\": \"gameCenterMatchmakingRules\",\n        \"attributes\": {\n            \"type\": \"COMPATIBLE\",\n            \"description\": \"Players must use same map\",\n            \"referenceName\": \"SameMap\",\n            \"expression\": \"requests[0].properties.playerGroup == requests[1].properties.playerGroup\"\n        },\n        \"relationships\": {\n            \"ruleSet\": {\n                \"data\": {\n                    \"type\": \"gameCenterMatchmakingRuleSets\",\n                    \"id\": \"56f6cee1-df7b-45df-9bdc-c60d1208b3bf\"\n                }\n            }\n        }\n    }\n}\n```\n\nIn versions of your game that use matchmaking rules, be sure to include a corresponding `playerGroup` property in match requests using the [doc:\/\/com.apple.gamekit\/documentation\/GameKit\/GKMatchRequest\/properties] property.\n\nFor more information on creating rules, see [doc:\/\/com.apple.gamekit\/documentation\/GameKit\/finding-players-using-matchmaking-rules#Add-matchmaking-rules-to-the-rule-sets].\n\n### Write expressions that provide default values for player properties\n\nIf your rules use player properties that previous versions of your game don’t supply, the rules won’t match players of the previous versions with the current version. Especially if you configure a queue to contain both classic and rule-based match requests, the classic requests won’t have your custom player properties. To provide backward compatibility with previous versions, write rule expressions in a way that provide default values for missing player properties.\n\nFor example, replace this expression for the skills-based match rule (see [doc:\/\/com.apple.gamekit\/documentation\/GameKit\/finding-players-with-similar-skill-levels]) with one that provides a default value for the `skill` property:\n\n```json\ndiff(players[].properties.skill) <= agedValues(avg(requests[].secondsInQueue), `20`, [ `40`, `100` ], [ `10`, `20` ])\n```\n\nUse the rich set of [https:\/\/jmespath.org] operators, expressions, and functions in the rule expression to achieve the desired results. For example, this expression uses the flatten operator, wildcard expression, pipe expression, and `not_null()` function to provide a default value of 50 for the `skill` property:\n\n```json\nrequests[].properties.[ skill, `50`][*].not_null(@) | [*][0]\n```\n\nTo understand this and other complex expressions before adding them to rules, use the [http:\/\/play.jmespath.org]. For example, create sample requests where one player has a skill level of `49` and another player has no `skill` property value (see [doc:\/\/com.apple.gamekit\/documentation\/GameKit\/creating-matchmaking-rules-for-backward-compatibility#Create-JMESPath-playground-sample-match-requests]). Enter the sample requests into the input JSON field of the playground. Then enter parts of the expression in the playground to see the results.\n\n\n\nAdd the expression that produces the desired results to a rule using the [doc:\/\/com.apple.documentation\/documentation\/AppStoreConnectAPI\/POST-v1-gameCenterMatchmakingRules] endpoint. For example, replace the Boolean expression above that uses the `diff()` function to compare player skill properties with one that provides a default value for the `skill` property (see [doc:\/\/com.apple.gamekit\/documentation\/GameKit\/finding-players-with-similar-skill-levels#Create-a-match-rule-containing-the-expression]).\n\n```json\ndiff(requests[].properties.[ skill, `50`][*].not_null(@) | [*][0]) <= agedValues(avg(requests[].secondsInQueue), `20`, [ `40`, `100` ], [ `10`, `20` ])\n```\n\n### Create JMESPath playground sample match requests\n\nSample match requests that you create for testing expressions in the JMESPath playground are similar to those you pass to the [doc:\/\/com.apple.documentation\/documentation\/AppStoreConnectAPI\/POST-v1-gameCenterMatchmakingRuleSetTests] endpoint. Pass the same attribute and relationship properties except without the enclosing Game Center data structures.\n\nFor example, create sample requests where one player has a skill level of `49` and another player has no `skill` property value. For examples of match requests that you pass to the testing APIs, see [doc:\/\/com.apple.gamekit\/documentation\/GameKit\/testing-matchmaking-rules].\n\nTo create sample match requests for the playground using a script, see [https:\/\/github.com\/apple\/game-center-tools].\n\n```json\n{\n    \"requests\": [\n        {\n            \"requestName\": \"r1\",\n            \"playerId\": \"r1_p1\",\n            \"properties\": {\n                \"skill\": 49\n            },\n            \"players\": [\n                {\n                    \"playerId\": \"r1_p1\",\n                    \"properties\": {\n                        \"skill\": 49\n                    },\n                    \"requestName\": \"r1\"\n                }\n            ],\n            \"appVersion\": \"1.0.0\",\n            \"bundleId\": \"com.example.mygame\",\n            \"platform\": \"IOS\",\n            \"locale\": \"EN-US\",\n            \"longitude\": 0,\n            \"latitude\": 0,\n            \"minPlayers\": 2,\n            \"maxPlayers\": 2,\n            \"playerCount\": 1,\n            \"secondsInQueue\": 0\n        },\n        {\n            \"requestName\": \"r2\",\n            \"playerId\": \"r2_p1\",\n            \"properties\": {},\n            \"players\": [\n                {\n                    \"playerId\": \"r2_p1\",\n                    \"properties\": {},\n                    \"requestName\": \"r2\"\n                }\n            ],\n            \"appVersion\": \"1.0.0\",\n            \"bundleId\": \"com.example.mygame\",\n            \"platform\": \"IOS\",\n            \"locale\": \"EN-US\",\n            \"longitude\": 0,\n            \"latitude\": 0,\n            \"minPlayers\": 2,\n            \"maxPlayers\": 2,\n            \"playerCount\": 1,\n            \"secondsInQueue\": 0\n        }\n    ],\n    \"players\": [\n        {\n            \"playerId\": \"r1_p1\",\n            \"properties\": {\n                \"skill\": 49\n            },\n            \"requestName\": \"r1\"\n        },\n        {\n            \"playerId\": \"r2_p1\",\n            \"properties\": {},\n            \"requestName\": \"r2\"\n        }\n    ]\n}\n```\n\n### Test match requests from previous versions\n\nTest your matchmaking rules on the server side with different combinations of match requests from previous and current versions of your game. Pass the rule set and sample match requests to the test API (see [doc:\/\/com.apple.gamekit\/documentation\/GameKit\/testing-matchmaking-rules]). Your rules should match players using different versions of your game.\n\n## Rules\n\n- **Letting players join matches using party codes**: Add a rule that lets players invite players and join matches using a shared party code.\n- **Finding players with similar skill levels**: Add a rule to find players in a range of skill levels to balance competitive gameplay.\n- **Assigning players to teams using rules**: Set criteria for assigning players to teams in your game using matchmaking rules.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Add a rule that lets players invite players and join matches using a shared party code.",
          "name" : "Letting players join matches using party codes",
          "url" : "https:\/\/developer.apple.com\/documentation\/GameKit\/letting-players-join-matches-using-party-codes"
        },
        {
          "description" : "Add a rule to find players in a range of skill levels to balance competitive gameplay.",
          "name" : "Finding players with similar skill levels",
          "url" : "https:\/\/developer.apple.com\/documentation\/GameKit\/finding-players-with-similar-skill-levels"
        },
        {
          "description" : "Set criteria for assigning players to teams in your game using matchmaking rules.",
          "name" : "Assigning players to teams using rules",
          "url" : "https:\/\/developer.apple.com\/documentation\/GameKit\/assigning-players-to-teams-using-rules"
        }
      ],
      "title" : "Rules"
    }
  ],
  "source" : "appleJSON",
  "title" : "Creating matchmaking rules for backward compatibility",
  "url" : "https:\/\/developer.apple.com\/documentation\/GameKit\/creating-matchmaking-rules-for-backward-compatibility"
}