{
  "abstract" : "Inspect the JavaScript console logs, the token, and events to determine why a token is invalid.",
  "codeExamples" : [
    {
      "code" : "% echo \"your-token-here\" | tr \".\" \"\\n\" | head -2 | base64 -D\n\n\/\/ Prints\n\/\/ {\"typ\":\"JWT\",\"alg\":\"ES256\",\"kid\":\"KEY_ID\",\"kid\":\"KEY_ID\"}",
      "language" : "other"
    },
    {
      "code" : "mapkit.init({ authorizationCallback: function(done) { done(\"your-token\"); }, ... });\nmapkit.addEventListener(\"error\", function(event) {\n    switch (event.status) {\n    case \"Too Many Requests\":\n        \/\/ Exceeded number of requests allowed.\n        break;\n    }\n});",
      "language" : "javascript"
    }
  ],
  "contentHash" : "9a1e4feda8275748e5dc5da6a5924c70b21d5fcb6b824dea970b7ec8144487c2",
  "crawledAt" : "2025-12-02T15:48:51Z",
  "id" : "76BCBE86-5E88-48D6-8476-45EEE54E1C62",
  "kind" : "article",
  "language" : "data",
  "module" : "Apple Maps Server API",
  "overview" : "## Overview\n\nMapKit JS requires a valid token to initialize. If the token you provide isn’t valid, MapKit JS won’t initialize and doesn’t provide a valid map to the user. When MapKit JS fails to initialize, errors are available in the JavaScript console.\n\n### Identify errors in the JavaScript console\n\nTo diagnose this situation, first check your browser’s JavaScript console for messages that describe why your token may be invalid. Reasons why a token might be invalid include:\n\nFor more information about the structure of MapKit-specific token, see [doc:\/\/com.apple.applemapsserverapi\/documentation\/AppleMapsServerAPI\/creating-and-using-tokens-with-maps-server-api].\n\n### Examine the token\n\nMapKit JS considers a token with duplicate headers to be invalid. You can view headers of the token and check for duplicates by decoding the token at the command line. For example, the following command decodes the headers of a token:\n\nIn the above output, you can see that the token has two `kid` headers.\n\nIf you find duplicate headers in your token, review the software that you used to create the key to remove any duplicate headers.\n\nFor more information on how to create a new token, see [doc:\/\/com.apple.applemapsserverapi\/documentation\/AppleMapsServerAPI\/creating-and-using-tokens-with-maps-server-api].\n\n### Inspect the error event on MapKit JS\n\nThe MapKit JS API rejects an otherwise valid token when your Apple Developer team exceeds the number of requests allowed. You can detect when your team exceeds the number of allowed requests by listening to the `error` event on the [doc:\/\/com.apple.documentation\/documentation\/MapKitJS\/mapkit] object.\n\nThe following example adds an event listener to the `mapkit` object and inspects the `status` string to see if the emitted error lists too many requests.\n\nFor more information about MapKit JS events, see [doc:\/\/com.apple.documentation\/documentation\/MapKitJS\/handling-initialization-events].",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/AppleMapsServerAPI\/debugging-an-invalid-token\ncrawled: 2025-12-02T15:48:51Z\n---\n\n# Debugging an Invalid token\n\n**Article**\n\nInspect the JavaScript console logs, the token, and events to determine why a token is invalid.\n\n## Overview\n\nMapKit JS requires a valid token to initialize. If the token you provide isn’t valid, MapKit JS won’t initialize and doesn’t provide a valid map to the user. When MapKit JS fails to initialize, errors are available in the JavaScript console.\n\n### Identify errors in the JavaScript console\n\nTo diagnose this situation, first check your browser’s JavaScript console for messages that describe why your token may be invalid. Reasons why a token might be invalid include:\n\n- The token is missing required fields.\n- The token has all the required fields, but some values are incorrect. Verify that the `kid` claim matches the key identifier used to sign the token, and that the `iss` claim matches the 10-character Team ID for your Apple Developer Account.\n- The string provided within the `origin` claim in your token doesn’t exactly match the `Origin` header passed by the browser. This string must match exactly, include the protocol (`http`, `https`), trailing slashes, and so on.\n\nFor more information about the structure of MapKit-specific token, see [doc:\/\/com.apple.applemapsserverapi\/documentation\/AppleMapsServerAPI\/creating-and-using-tokens-with-maps-server-api].\n\n### Examine the token\n\nMapKit JS considers a token with duplicate headers to be invalid. You can view headers of the token and check for duplicates by decoding the token at the command line. For example, the following command decodes the headers of a token:\n\n```other\n% echo \"your-token-here\" | tr \".\" \"\\n\" | head -2 | base64 -D\n\n\/\/ Prints\n\/\/ {\"typ\":\"JWT\",\"alg\":\"ES256\",\"kid\":\"KEY_ID\",\"kid\":\"KEY_ID\"}\n```\n\nIn the above output, you can see that the token has two `kid` headers.\n\nIf you find duplicate headers in your token, review the software that you used to create the key to remove any duplicate headers.\n\n\n\nFor more information on how to create a new token, see [doc:\/\/com.apple.applemapsserverapi\/documentation\/AppleMapsServerAPI\/creating-and-using-tokens-with-maps-server-api].\n\n### Inspect the error event on MapKit JS\n\nThe MapKit JS API rejects an otherwise valid token when your Apple Developer team exceeds the number of requests allowed. You can detect when your team exceeds the number of allowed requests by listening to the `error` event on the [doc:\/\/com.apple.documentation\/documentation\/MapKitJS\/mapkit] object.\n\nThe following example adds an event listener to the `mapkit` object and inspects the `status` string to see if the emitted error lists too many requests.\n\n```javascript\nmapkit.init({ authorizationCallback: function(done) { done(\"your-token\"); }, ... });\nmapkit.addEventListener(\"error\", function(event) {\n    switch (event.status) {\n    case \"Too Many Requests\":\n        \/\/ Exceeded number of requests allowed.\n        break;\n    }\n});\n```\n\nFor more information about MapKit JS events, see [doc:\/\/com.apple.documentation\/documentation\/MapKitJS\/handling-initialization-events].\n\n## Essentials\n\n- **Creating and using tokens with Maps Server API**: Sign JSON Web Tokens to use Maps Server API and debug common signing errors.\n- **Creating a Maps identifier and a private key**: Create a Maps identifier and a private key before generating tokens for MapKit JS.\n- **Generate a Maps token**: Returns a JWT maps access token that you use to call the service API.\n- **Common objects**: Understand the common JSON objects that API responses contain.\n- **Integrating the Apple Maps Server API into Java server applications**: Streamline your app’s API by moving georelated searches from inside your app to your server.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Sign JSON Web Tokens to use Maps Server API and debug common signing errors.",
          "name" : "Creating and using tokens with Maps Server API",
          "url" : "https:\/\/developer.apple.com\/documentation\/AppleMapsServerAPI\/creating-and-using-tokens-with-maps-server-api"
        },
        {
          "description" : "Create a Maps identifier and a private key before generating tokens for MapKit JS.",
          "name" : "Creating a Maps identifier and a private key",
          "url" : "https:\/\/developer.apple.com\/documentation\/AppleMapsServerAPI\/creating-a-maps-identifier-and-a-private-key"
        },
        {
          "description" : "Returns a JWT maps access token that you use to call the service API.",
          "name" : "Generate a Maps token",
          "url" : "https:\/\/developer.apple.com\/documentation\/AppleMapsServerAPI\/-v1-token"
        },
        {
          "description" : "Understand the common JSON objects that API responses contain.",
          "name" : "Common objects",
          "url" : "https:\/\/developer.apple.com\/documentation\/AppleMapsServerAPI\/common-objects"
        },
        {
          "description" : "Streamline your app’s API by moving georelated searches from inside your app to your server.",
          "name" : "Integrating the Apple Maps Server API into Java server applications",
          "url" : "https:\/\/developer.apple.com\/documentation\/AppleMapsServerAPI\/integrating-the-apple-maps-server-api-into-java-server-applications"
        }
      ],
      "title" : "Essentials"
    }
  ],
  "source" : "appleJSON",
  "title" : "Debugging an Invalid token",
  "url" : "https:\/\/developer.apple.com\/documentation\/AppleMapsServerAPI\/debugging-an-invalid-token"
}