{
  "abstract" : "Convert 8-channel audio to 2-channel spatial audio by using a spatial mixer audio unit.",
  "codeExamples" : [
    {
      "code" : "AudioComponentDescription auDescription = {kAudioUnitType_Mixer,\n                                           kAudioUnitSubType_SpatialMixer,\n                                           kAudioUnitManufacturer_Apple,\n                                           0,\n                                           0};\nAudioComponent comp = AudioComponentFindNext(NULL, &auDescription);\nassert(comp);\n\nOSStatus err = AudioComponentInstanceNew(comp, &mAU);\nassert(err == noErr);",
      "language" : "objc"
    },
    {
      "code" : "err = setStreamFormatAndACL(inOutputSampleRate, kAudioChannelLayoutTag_Stereo, kAudioUnitScope_Output, 0);\nassert(err == noErr);",
      "language" : "objc"
    },
    {
      "code" : "err = setStreamFormatAndACL(inInputSampleRate,\n                            kAudioChannelLayoutTag_Atmos_7_1_4,\n                            kAudioUnitScope_Input,\n                            elem);\nassert(err == noErr);",
      "language" : "objc"
    },
    {
      "code" : "UInt32 renderingAlgorithm = kSpatializationAlgorithm_UseOutputType;\nerr = AudioUnitSetProperty(mAU,\n                           kAudioUnitProperty_SpatializationAlgorithm,\n                           kAudioUnitScope_Input,\n                           elem,\n                           &renderingAlgorithm,\n                           sizeof(renderingAlgorithm));\nassert(err == noErr);",
      "language" : "objc"
    },
    {
      "code" : "UInt32 sourceMode = kSpatialMixerSourceMode_AmbienceBed;\nerr = AudioUnitSetProperty(mAU, kAudioUnitProperty_SpatialMixerSourceMode, kAudioUnitScope_Input, elem, &sourceMode, sizeof(sourceMode));\nassert(err == noErr);",
      "language" : "objc"
    },
    {
      "code" : "UInt32 ht = 1;\nerr = AudioUnitSetProperty(mAU,\n                           kAudioUnitProperty_SpatialMixerEnableHeadTracking,\n                           kAudioUnitScope_Global,\n                           0,\n                           &ht,\n                           sizeof(UInt32));",
      "language" : "objc"
    }
  ],
  "contentHash" : "acb6082be9789e974966344c9e342479dfc165e428b5ba2a63ae002bfb3f1e0b",
  "crawledAt" : "2025-12-02T15:47:47Z",
  "id" : "25B9A3E2-9D60-448F-9148-475389B27CF2",
  "kind" : "unknown",
  "language" : "swift",
  "module" : "Audio Toolbox",
  "overview" : "## Overview\n\nSpatial audio makes sound seem like it’s coming from all around you. To generate spatialized audio from a multichannel audio stream, you use a spatial mixer audio unit (AUSM). The audio streams can come from the output of a game engine, video player, or audio file.\n\nThe sample app shows you how to create an AUSM, and how to configure its channel layout and stream format. It streams multichannel input from an audio file, and down-mixes it to 2-channel spatial audio.\n\n### Create an audio unit spatial mixer\n\nThe sample uses the pull model to get the input from an in-memory file streamer. The `OutputAU` class pulls input from the `AudioKernel`, which manages the AUSM. The AUSM pulls audio from `AudioFileReader` to get input. On macOS, the output unit uses [doc:\/\/com.apple.audiotoolbox\/documentation\/AudioToolbox\/kAudioUnitSubType_HALOutput] to interface with the audio device. On iOS, the interface is configured as  [doc:\/\/com.apple.audiotoolbox\/documentation\/AudioToolbox\/kAudioUnitSubType_RemoteIO].\n\nTo begin setup of an AUSM, the sample initializes a mixer with a subtype of [doc:\/\/com.apple.audiotoolbox\/documentation\/AudioToolbox\/kAudioUnitSubType_SpatialMixer].\n\nAfter initializing the spatial mixer, the sample calls a convenience function to configure the output stream format and channel layout for stereo audio.\n\nThe sample then configures the input stream format and sets the channel layout to  [doc:\/\/com.apple.documentation\/documentation\/CoreAudioTypes\/kAudioChannelLayoutTag_MPEG_7_1_A]  for 8-channel audio.\n\n### Configure for spatial audio\n\nThe sample sets the spatialization algorithm to [doc:\/\/com.apple.audiotoolbox\/documentation\/AudioToolbox\/AUSpatializationAlgorithm\/spatializationAlgorithm_UseOutputType] for the highest-quality spatial rendering across different hardware.\n\nThe input channels are spatialized around the listener as far-field sources. The channel layout specifies the relative directions of the individual channels. The azimuth and elevation parameters control the audio rotation. The sample configures the source mode to [doc:\/\/com.apple.audiotoolbox\/documentation\/AudioToolbox\/AUSpatialMixerSourceMode\/spatialMixerSourceMode_AmbienceBed]. Use [doc:\/\/com.apple.audiotoolbox\/documentation\/AudioToolbox\/AUSpatialMixerSourceMode\/spatialMixerSourceMode_PointSource] for an object to render the input signal as a single source, except if rendering in-head with [doc:\/\/com.apple.audiotoolbox\/documentation\/AudioToolbox\/AUSpatialMixerPointSourceInHeadMode\/spatialMixerPointSourceInHeadMode_Bypass].\n\nSpatial audio includes dynamic head tracking for apps that enable it. To configure head tracking, set [doc:\/\/com.apple.audiotoolbox\/documentation\/AudioToolbox\/kAudioUnitProperty_SpatialMixerEnableHeadTracking]. For more information about supported devices, see [https:\/\/support.apple.com\/en-us\/HT211775].",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/AudioToolbox\/generating-spatial-audio-from-a-multichannel-audio-stream\ncrawled: 2025-12-02T15:47:47Z\n---\n\n# Generating spatial audio from a multichannel audio stream\n\n**Sample Code**\n\nConvert 8-channel audio to 2-channel spatial audio by using a spatial mixer audio unit.\n\n## Overview\n\nSpatial audio makes sound seem like it’s coming from all around you. To generate spatialized audio from a multichannel audio stream, you use a spatial mixer audio unit (AUSM). The audio streams can come from the output of a game engine, video player, or audio file.\n\nThe sample app shows you how to create an AUSM, and how to configure its channel layout and stream format. It streams multichannel input from an audio file, and down-mixes it to 2-channel spatial audio.\n\n### Create an audio unit spatial mixer\n\nThe sample uses the pull model to get the input from an in-memory file streamer. The `OutputAU` class pulls input from the `AudioKernel`, which manages the AUSM. The AUSM pulls audio from `AudioFileReader` to get input. On macOS, the output unit uses [doc:\/\/com.apple.audiotoolbox\/documentation\/AudioToolbox\/kAudioUnitSubType_HALOutput] to interface with the audio device. On iOS, the interface is configured as  [doc:\/\/com.apple.audiotoolbox\/documentation\/AudioToolbox\/kAudioUnitSubType_RemoteIO].\n\nTo begin setup of an AUSM, the sample initializes a mixer with a subtype of [doc:\/\/com.apple.audiotoolbox\/documentation\/AudioToolbox\/kAudioUnitSubType_SpatialMixer].\n\n```objc\nAudioComponentDescription auDescription = {kAudioUnitType_Mixer,\n                                           kAudioUnitSubType_SpatialMixer,\n                                           kAudioUnitManufacturer_Apple,\n                                           0,\n                                           0};\nAudioComponent comp = AudioComponentFindNext(NULL, &auDescription);\nassert(comp);\n\nOSStatus err = AudioComponentInstanceNew(comp, &mAU);\nassert(err == noErr);\n```\n\nAfter initializing the spatial mixer, the sample calls a convenience function to configure the output stream format and channel layout for stereo audio.\n\n```objc\nerr = setStreamFormatAndACL(inOutputSampleRate, kAudioChannelLayoutTag_Stereo, kAudioUnitScope_Output, 0);\nassert(err == noErr);\n```\n\nThe sample then configures the input stream format and sets the channel layout to  [doc:\/\/com.apple.documentation\/documentation\/CoreAudioTypes\/kAudioChannelLayoutTag_MPEG_7_1_A]  for 8-channel audio.\n\n```objc\nerr = setStreamFormatAndACL(inInputSampleRate,\n                            kAudioChannelLayoutTag_Atmos_7_1_4,\n                            kAudioUnitScope_Input,\n                            elem);\nassert(err == noErr);\n```\n\n### Configure for spatial audio\n\nThe sample sets the spatialization algorithm to [doc:\/\/com.apple.audiotoolbox\/documentation\/AudioToolbox\/AUSpatializationAlgorithm\/spatializationAlgorithm_UseOutputType] for the highest-quality spatial rendering across different hardware.\n\n```objc\nUInt32 renderingAlgorithm = kSpatializationAlgorithm_UseOutputType;\nerr = AudioUnitSetProperty(mAU,\n                           kAudioUnitProperty_SpatializationAlgorithm,\n                           kAudioUnitScope_Input,\n                           elem,\n                           &renderingAlgorithm,\n                           sizeof(renderingAlgorithm));\nassert(err == noErr);\n```\n\nThe input channels are spatialized around the listener as far-field sources. The channel layout specifies the relative directions of the individual channels. The azimuth and elevation parameters control the audio rotation. The sample configures the source mode to [doc:\/\/com.apple.audiotoolbox\/documentation\/AudioToolbox\/AUSpatialMixerSourceMode\/spatialMixerSourceMode_AmbienceBed]. Use [doc:\/\/com.apple.audiotoolbox\/documentation\/AudioToolbox\/AUSpatialMixerSourceMode\/spatialMixerSourceMode_PointSource] for an object to render the input signal as a single source, except if rendering in-head with [doc:\/\/com.apple.audiotoolbox\/documentation\/AudioToolbox\/AUSpatialMixerPointSourceInHeadMode\/spatialMixerPointSourceInHeadMode_Bypass].\n\n```objc\nUInt32 sourceMode = kSpatialMixerSourceMode_AmbienceBed;\nerr = AudioUnitSetProperty(mAU, kAudioUnitProperty_SpatialMixerSourceMode, kAudioUnitScope_Input, elem, &sourceMode, sizeof(sourceMode));\nassert(err == noErr);\n```\n\nSpatial audio includes dynamic head tracking for apps that enable it. To configure head tracking, set [doc:\/\/com.apple.audiotoolbox\/documentation\/AudioToolbox\/kAudioUnitProperty_SpatialMixerEnableHeadTracking]. For more information about supported devices, see [https:\/\/support.apple.com\/en-us\/HT211775].\n\n```objc\nUInt32 ht = 1;\nerr = AudioUnitSetProperty(mAU,\n                           kAudioUnitProperty_SpatialMixerEnableHeadTracking,\n                           kAudioUnitScope_Global,\n                           0,\n                           &ht,\n                           sizeof(UInt32));\n```\n\n## Audio Units\n\n- **Audio Unit v3 Plug-Ins**: Deliver custom audio effects, instruments, and other audio behaviors using an Audio Unit v3 app extension.\n- **Audio Components**: Find, load, and configure audio components, such as Audio Units and audio codecs.\n- **Audio Unit v2 (C) API**: Configure an Audio Unit and prepare it to render audio.\n- **Audio Unit Properties**: Obtain information about the built-in mixers, equalizers, filters, effects, and other Audio Unit app extensions.\n- **Audio Unit Voice I\/O**: Configure system voice processing and respond to speech events.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Deliver custom audio effects, instruments, and other audio behaviors using an Audio Unit v3 app extension.",
          "name" : "Audio Unit v3 Plug-Ins",
          "url" : "https:\/\/developer.apple.com\/documentation\/AudioToolbox\/audio-unit-v3-plug-ins"
        },
        {
          "description" : "Find, load, and configure audio components, such as Audio Units and audio codecs.",
          "name" : "Audio Components",
          "url" : "https:\/\/developer.apple.com\/documentation\/AudioToolbox\/audio-components"
        },
        {
          "description" : "Configure an Audio Unit and prepare it to render audio.",
          "name" : "Audio Unit v2 (C) API",
          "url" : "https:\/\/developer.apple.com\/documentation\/AudioToolbox\/audio-unit-v2-c-api"
        },
        {
          "description" : "Obtain information about the built-in mixers, equalizers, filters, effects, and other Audio Unit app extensions.",
          "name" : "Audio Unit Properties",
          "url" : "https:\/\/developer.apple.com\/documentation\/AudioToolbox\/audio-unit-properties"
        },
        {
          "description" : "Configure system voice processing and respond to speech events.",
          "name" : "Audio Unit Voice I\/O",
          "url" : "https:\/\/developer.apple.com\/documentation\/AudioToolbox\/audio-unit-voice-i-o"
        }
      ],
      "title" : "Audio Units"
    }
  ],
  "source" : "appleJSON",
  "title" : "Generating spatial audio from a multichannel audio stream",
  "url" : "https:\/\/developer.apple.com\/documentation\/AudioToolbox\/generating-spatial-audio-from-a-multichannel-audio-stream"
}