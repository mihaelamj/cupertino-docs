{
  "abstract" : "Implement a portal window that displays a 3D environment and simulates entering a portal by using RealityKit.",
  "codeExamples" : [
    {
      "code" : "@MainActor func createEnvironment(on root: Entity) async throws {\n    do {\n        \/\/\/ The root entity for the box environment.\n        let assetRoot = try await Entity(named: \"CornellBox.usda\")\n\n        \/\/ Convert the image-based lighting file into a URL, and load it as an environment resource.\n        guard let iblURL = Bundle.main.url(forResource: \"TeapotIBL\", withExtension: \"exr\") else {\n            fatalError(\"Failed to load the Image-Based Lighting file.\")\n        }\n        let iblEnv = try await EnvironmentResource(fromImage: iblURL)\n\n        \/\/ ...\n    }\n}",
      "language" : "swift"
    },
    {
      "code" : "@MainActor func createEnvironment(on root: Entity) async throws {\n    do {\n        \/\/ ...\n\n        \/\/\/ The entity to perform image-based lighting on the environment.\n        let iblEntity = Entity()\n\n        \/\/\/ The image-based lighting component that contains background and lighting information.\n        var iblComp = ImageBasedLightComponent(source: .single(iblEnv))\n        iblComp.inheritsRotation = true\n\n        \/\/ Add the image-based lighting component to the entity.\n        iblEntity.components.set(iblComp)\n\n        \/\/ Set up image-based lighting for the box environment.\n        assetRoot.components.set(ImageBasedLightReceiverComponent(imageBasedLight: iblEntity))\n\n        \/\/ Add the image-based lighting entity to the box environment.\n        assetRoot.addChild(iblEntity)\n\n        \/\/ Add the box environment to `root`.\n        root.addChild(assetRoot)\n    }\n}",
      "language" : "swift"
    },
    {
      "code" : "\/\/\/ The root entity for other entities within the scene.\nprivate let root = Entity()\n\n\/\/\/ A plane entity representing a portal.\nprivate let portalPlane = ModelEntity(\n    mesh: .generatePlane(width: 1.0, height: 1.0),\n    materials: [PortalMaterial()]\n)",
      "language" : "swift"
    },
    {
      "code" : "@MainActor func createPortal() async {\n    \/\/ Create the entity that stores the content within the portal.\n    let world = Entity()\n\n    \/\/ Shrink the portal world and update the position\n    \/\/ to make it fit into the portal view.\n    world.scale *= 0.5\n    world.position.y -= 0.5\n    world.position.z -= 0.5\n\n    \/\/ Allow the entity to be visible only through a portal.\n    world.components.set(WorldComponent())\n\n    do {\n        \/\/ Create the box environment and add it to the root.\n        try await createEnvironment(on: world)\n        root.addChild(world)\n\n        \/\/ Set up the portal to show the content in the `world`.\n        portalPlane.components.set(PortalComponent(target: world))\n        root.addChild(portalPlane)\n    } catch {\n        fatalError(\"Failed to create environment: \\(error)\")\n    }\n}",
      "language" : "swift"
    },
    {
      "code" : "struct ImmersiveView: View {\n    var body: some View {\n        RealityView { content in\n            \/\/ Create the box environment on the root entity.\n            let root = Entity()\n            do {\n                try await createEnvironment(on: root)\n            } catch {\n                print(\"Failed to load environment: \\(error.localizedDescription)\")\n            }\n\n            content.add(root)\n        }\n    }\n}",
      "language" : "swift"
    },
    {
      "code" : "ImmersiveSpace(id: appModel.immersiveSpaceID) {\n    ImmersiveView()\n        .onAppear {\n            appModel.immersiveSpaceState = .open\n        }\n        .onDisappear {\n            appModel.immersiveSpaceState = .closed\n        }\n}",
      "language" : "swift"
    }
  ],
  "contentHash" : "1c9b7e2fce365340621cbdc707c7308f892b1b441f3dfeb3173bd309482ebb57",
  "crawledAt" : "2025-12-02T17:30:11Z",
  "id" : "D15363DE-FA25-4660-A90F-A455315364C8",
  "kind" : "unknown",
  "language" : "swift",
  "overview" : "## Overview\n\nThis sample code project demonstrates how to view a 3D environment through a flat plane with the portal component, and transition into the portal by creating an immersive space. To create a portal, you first need to define an entity and set the [doc:\/\/com.apple.documentation\/documentation\/RealityKit\/WorldComponent] to store the content of the portal. Next, you create a separate entity to represent the portal’s structure, such as the flat plane in the sample. Finally, you combine the two entities, assigning the portal content entity to [doc:\/\/com.apple.documentation\/documentation\/RealityKit\/PortalComponent] and setting it to the portal structure entity to create the portal.\n\nAt launch, the sample app creates the following:\n\n### Set up the 3D environment\n\nThe sample creates the 3D environment in two scenarios:\n\nThe app uses the `createEnvironment(on:)` method to create the box environment and apply image-based lighting.\n\nThe method starts by loading the box environment from the `.usda` file. Then, it loads an image-based lighting file as an [doc:\/\/com.apple.documentation\/documentation\/RealityKit\/EnvironmentResource] that contains the background and lighting information as a scene.\n\nTo apply image-based lighting to the box environment, the app creates an [doc:\/\/com.apple.documentation\/documentation\/RealityKit\/ImageBasedLightComponent] and sets it to a placeholder [doc:\/\/com.apple.documentation\/documentation\/RealityKit\/Entity]. This allows the app to later assign the [doc:\/\/com.apple.documentation\/documentation\/RealityKit\/ImageBasedLightReceiverComponent] to the box environment to enable the environment with image-based lighting.\n\nFinally, the app adds the placeholder entity containing the image-based lighting component to the box environment, and then adds the box environment to the root entity.\n\n### Create a portal window\n\nTo create a portal, the app defines the mesh of the portal by creating a flat plane to act as a window shape for it.\n\nThe `createPortal()` method sets up the portal and adds it to the `root`. First, it creates a `world` entity to store the content within the portal and sets it with [doc:\/\/com.apple.documentation\/documentation\/RealityKit\/WorldComponent] to separate the `world` entity from the default world, enabling it to be visible only through a portal. Then, it creates the 3D box environment using `createEnvironment(on:)`, and passes in the `world` entity.\n\nFinally, it sets the `portalPlane` entity with the [doc:\/\/com.apple.documentation\/documentation\/RealityKit\/PortalComponent] to transform it into a portal that renders the 3D environment within the `world` entity.\n\n### Enter the 3D environment\n\nIn the sample app, a person can enter the portal by tapping a button. To achieve this, the app creates an immersive space and loads the 3D box environment in the scene.\n\nTo handle the enter and exit actions of the portal, the sample creates a button to enter or exit the immersive space based on the current state. The button uses [doc:\/\/com.apple.documentation\/documentation\/SwiftUI\/EnvironmentValues\/openImmersiveSpace] and [doc:\/\/com.apple.documentation\/documentation\/SwiftUI\/EnvironmentValues\/dismissImmersiveSpace] to open and close the immersive space. Because there are multiple paths to close the immersive space and there may be multiple paths to open the immersive space, your app can use the view life-cycle updates to keep track of the current state of the immersive space. Use the [doc:\/\/com.apple.documentation\/documentation\/SwiftUI\/View\/onAppear(perform:)] and [doc:\/\/com.apple.documentation\/documentation\/SwiftUI\/View\/onDisappear(perform:)] on the root view of the immersive space to respond to these changes.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/visionos\/displaying-a-3d-environment-through-a-portal\ncrawled: 2025-12-02T17:30:11Z\n---\n\n# Displaying a 3D environment through a portal\n\n**Sample Code**\n\nImplement a portal window that displays a 3D environment and simulates entering a portal by using RealityKit.\n\n## Overview\n\nThis sample code project demonstrates how to view a 3D environment through a flat plane with the portal component, and transition into the portal by creating an immersive space. To create a portal, you first need to define an entity and set the [doc:\/\/com.apple.documentation\/documentation\/RealityKit\/WorldComponent] to store the content of the portal. Next, you create a separate entity to represent the portal’s structure, such as the flat plane in the sample. Finally, you combine the two entities, assigning the portal content entity to [doc:\/\/com.apple.documentation\/documentation\/RealityKit\/PortalComponent] and setting it to the portal structure entity to create the portal.\n\nAt launch, the sample app creates the following:\n\n- A portal that displays a box environment.\n- A vertical stack that contains a line of text and a button.\n- An immersive space that is ready to open.\n\n\n\n### Set up the 3D environment\n\nThe sample creates the 3D environment in two scenarios:\n\n- When creating the portal\n- When loading the immersive space\n\nThe app uses the `createEnvironment(on:)` method to create the box environment and apply image-based lighting.\n\n```swift\n@MainActor func createEnvironment(on root: Entity) async throws {\n    do {\n        \/\/\/ The root entity for the box environment.\n        let assetRoot = try await Entity(named: \"CornellBox.usda\")\n\n        \/\/ Convert the image-based lighting file into a URL, and load it as an environment resource.\n        guard let iblURL = Bundle.main.url(forResource: \"TeapotIBL\", withExtension: \"exr\") else {\n            fatalError(\"Failed to load the Image-Based Lighting file.\")\n        }\n        let iblEnv = try await EnvironmentResource(fromImage: iblURL)\n\n        \/\/ ...\n    }\n}\n```\n\nThe method starts by loading the box environment from the `.usda` file. Then, it loads an image-based lighting file as an [doc:\/\/com.apple.documentation\/documentation\/RealityKit\/EnvironmentResource] that contains the background and lighting information as a scene.\n\nTo apply image-based lighting to the box environment, the app creates an [doc:\/\/com.apple.documentation\/documentation\/RealityKit\/ImageBasedLightComponent] and sets it to a placeholder [doc:\/\/com.apple.documentation\/documentation\/RealityKit\/Entity]. This allows the app to later assign the [doc:\/\/com.apple.documentation\/documentation\/RealityKit\/ImageBasedLightReceiverComponent] to the box environment to enable the environment with image-based lighting.\n\n```swift\n@MainActor func createEnvironment(on root: Entity) async throws {\n    do {\n        \/\/ ...\n\n        \/\/\/ The entity to perform image-based lighting on the environment.\n        let iblEntity = Entity()\n\n        \/\/\/ The image-based lighting component that contains background and lighting information.\n        var iblComp = ImageBasedLightComponent(source: .single(iblEnv))\n        iblComp.inheritsRotation = true\n\n        \/\/ Add the image-based lighting component to the entity.\n        iblEntity.components.set(iblComp)\n\n        \/\/ Set up image-based lighting for the box environment.\n        assetRoot.components.set(ImageBasedLightReceiverComponent(imageBasedLight: iblEntity))\n\n        \/\/ Add the image-based lighting entity to the box environment.\n        assetRoot.addChild(iblEntity)\n\n        \/\/ Add the box environment to `root`.\n        root.addChild(assetRoot)\n    }\n}\n```\n\nFinally, the app adds the placeholder entity containing the image-based lighting component to the box environment, and then adds the box environment to the root entity.\n\n### Create a portal window\n\nTo create a portal, the app defines the mesh of the portal by creating a flat plane to act as a window shape for it.\n\n```swift\n\/\/\/ The root entity for other entities within the scene.\nprivate let root = Entity()\n\n\/\/\/ A plane entity representing a portal.\nprivate let portalPlane = ModelEntity(\n    mesh: .generatePlane(width: 1.0, height: 1.0),\n    materials: [PortalMaterial()]\n)\n```\n\nThe `createPortal()` method sets up the portal and adds it to the `root`. First, it creates a `world` entity to store the content within the portal and sets it with [doc:\/\/com.apple.documentation\/documentation\/RealityKit\/WorldComponent] to separate the `world` entity from the default world, enabling it to be visible only through a portal. Then, it creates the 3D box environment using `createEnvironment(on:)`, and passes in the `world` entity.\n\n```swift\n@MainActor func createPortal() async {\n    \/\/ Create the entity that stores the content within the portal.\n    let world = Entity()\n\n    \/\/ Shrink the portal world and update the position\n    \/\/ to make it fit into the portal view.\n    world.scale *= 0.5\n    world.position.y -= 0.5\n    world.position.z -= 0.5\n\n    \/\/ Allow the entity to be visible only through a portal.\n    world.components.set(WorldComponent())\n\n    do {\n        \/\/ Create the box environment and add it to the root.\n        try await createEnvironment(on: world)\n        root.addChild(world)\n\n        \/\/ Set up the portal to show the content in the `world`.\n        portalPlane.components.set(PortalComponent(target: world))\n        root.addChild(portalPlane)\n    } catch {\n        fatalError(\"Failed to create environment: \\(error)\")\n    }\n}\n```\n\nFinally, it sets the `portalPlane` entity with the [doc:\/\/com.apple.documentation\/documentation\/RealityKit\/PortalComponent] to transform it into a portal that renders the 3D environment within the `world` entity.\n\n### Enter the 3D environment\n\nIn the sample app, a person can enter the portal by tapping a button. To achieve this, the app creates an immersive space and loads the 3D box environment in the scene.\n\n```swift\nstruct ImmersiveView: View {\n    var body: some View {\n        RealityView { content in\n            \/\/ Create the box environment on the root entity.\n            let root = Entity()\n            do {\n                try await createEnvironment(on: root)\n            } catch {\n                print(\"Failed to load environment: \\(error.localizedDescription)\")\n            }\n\n            content.add(root)\n        }\n    }\n}\n```\n\nTo handle the enter and exit actions of the portal, the sample creates a button to enter or exit the immersive space based on the current state. The button uses [doc:\/\/com.apple.documentation\/documentation\/SwiftUI\/EnvironmentValues\/openImmersiveSpace] and [doc:\/\/com.apple.documentation\/documentation\/SwiftUI\/EnvironmentValues\/dismissImmersiveSpace] to open and close the immersive space. Because there are multiple paths to close the immersive space and there may be multiple paths to open the immersive space, your app can use the view life-cycle updates to keep track of the current state of the immersive space. Use the [doc:\/\/com.apple.documentation\/documentation\/SwiftUI\/View\/onAppear(perform:)] and [doc:\/\/com.apple.documentation\/documentation\/SwiftUI\/View\/onDisappear(perform:)] on the root view of the immersive space to respond to these changes.\n\n```swift\nImmersiveSpace(id: appModel.immersiveSpaceID) {\n    ImmersiveView()\n        .onAppear {\n            appModel.immersiveSpaceState = .open\n        }\n        .onDisappear {\n            appModel.immersiveSpaceState = .closed\n        }\n}\n```\n\n",
  "sections" : [

  ],
  "source" : "appleJSON",
  "title" : "Displaying a 3D environment through a portal",
  "url" : "https:\/\/developer.apple.com\/documentation\/visionos\/displaying-a-3d-environment-through-a-portal"
}