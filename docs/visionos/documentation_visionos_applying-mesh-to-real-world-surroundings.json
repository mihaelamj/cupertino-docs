{
  "abstract" : "Add a layer of mesh to objects in the real world, using scene reconstruction in ARKit.",
  "codeExamples" : [
    {
      "code" : "import SwiftUI\nimport RealityKit\nimport ARKit\n\nclass MeshAnchorGenerator {\n    \/\/\/ The root entity of the view.\n    var root: Entity\n\n    \/\/\/ The collection of anchors.\n    private var anchors: [UUID : Entity] = [:]\n\n    init(root: Entity) {\n        self.root = root\n    }\n\n    \/\/ ...\n}",
      "language" : "swift"
    },
    {
      "code" : "@MainActor\nfunc run(_ sceneRec: SceneReconstructionProvider) async {\n    \/\/ Loop to process all anchor updates that the provider detects.\n    for await update in sceneRec.anchorUpdates {\n        switch update.event {\n        case .added, .updated:\n            \/\/ Retrives the entity from the anchor collection based on the anchor ID.\n            \/\/ If it doesn't exist, creates and adds a new entity to the collection.\n            let entity = anchors[update.anchor.id] ?? {\n                let entity = Entity()\n                root.addChild(entity)\n                anchors[update.anchor.id] = entity\n\n                return entity\n            }()\n\n            \/\/\/ The material for the mesh to update.\n            let material = SimpleMaterial(color: .cyan.withAlphaComponent(0.8), isMetallic: false)\n\n            \/\/\/ The mesh from an anchor.\n            guard let mesh = try? await MeshResource(from: update.anchor) else { return }\n\n            await MainActor.run {\n                \/\/ Update the entity mesh and apply the material.\n                entity.components.set(ModelComponent(mesh: mesh, materials: [material]))\n\n                \/\/ Set the transform matrix on its position relative to the anchor.\n                entity.setTransformMatrix(update.anchor.originFromAnchorTransform, relativeTo: nil)\n            }\n\n            \/\/ ...\n        }\n    }\n}",
      "language" : "swift"
    },
    {
      "code" : "@MainActor\nfunc run(_ sceneRec: SceneReconstructionProvider) async {\n    for await update in sceneRec.anchorUpdates {\n        switch update.event {\n\n        \/\/ ...\n\n        case .removed:\n            \/\/ Remove the entity from the root if it exists.\n            anchors[update.anchor.id]?.removeFromParent()\n\n            \/\/ Remove the anchor entry from the dictionary.\n            anchors[update.anchor.id] = nil\n        }\n    }\n}",
      "language" : "swift"
    },
    {
      "code" : "import SwiftUI\nimport RealityKit\n\nstruct SceneReconstructionView: View {\n    var body: some View {\n        RealityView { content in\n            \/\/\/ The root entity.\n            let root = Entity()\n\n            \/\/\/ The `ARKitSession` instance for scene reconstruction.\n            let arSession = ARKitSession()\n\n            \/\/\/ The provider instance for scene reconstruction.\n            let sceneReconstruction = SceneReconstructionProvider()\n    \n            \/\/ ...\n        }\n    }\n}",
      "language" : "swift"
    },
    {
      "code" : "import SwiftUI\nimport RealityKit\n\nstruct SceneReconstructionView: View {\n    var body: some View {\n        RealityView { content in\n\n            \/\/ ...\n\n            Task {\n                \/\/\/ The generator to store the root with unlit materials.\n                let generator = MeshAnchorGenerator(root: root)\n\n                \/\/ Check if the device supports scene reconstruction.\n                guard SceneReconstructionProvider.isSupported else {\n                    print(\"SceneReconstructionProvider is not supported on this device.\")\n                    return\n                }\n\n                do {\n                    \/\/ Start the `ARKitSession` and run the `SceneReconstructionProvider`.\n                    try await arSession.run([sceneReconstruction])\n                } catch let error as ARKitSession.Error {\n                    \/\/ Handle any `ARKitSession` errors.\n                    print(\"Encountered an error while running providers: \\(error.localizedDescription)\")\n                } catch let error {\n                    \/\/ Handle other errors.\n                    print(\"Encountered an unexpected error: \\(error.localizedDescription)\")\n                }\n\n                \/\/ Start the generator if the session runs successfully.\n                await generator.run(sceneReconstruction)\n            }\n\n            \/\/ Add the root entity to the `RealityView`.\n            content.add(root)\n        }\n    }\n}",
      "language" : "swift"
    },
    {
      "code" : "import SwiftUI\n\n@main\nstruct EntryPoint: App {\n    var body: some Scene {\n        WindowGroup {\n            MainView()\n        }\n\n        ImmersiveSpace(id: \"SceneReconstruction\") {\n            SceneReconstructionView()\n        }\n    }\n}",
      "language" : "swift"
    },
    {
      "code" : "import SwiftUI\n\nstruct MainView: View {\n    @Environment(\\.openImmersiveSpace) var openImmersiveSpace\n\n    var body: some View {\n        Text(\"Scene Reconstruction Example\")\n            .onAppear {\n                Task {\n                    await openImmersiveSpace(id: \"SceneReconstruction\")\n                }\n            }\n    }\n}",
      "language" : "swift"
    }
  ],
  "contentHash" : "0a8c184551b68f32ca39a28386b1e1474d34f845e345a975c0c70bcd8baab1b6",
  "crawledAt" : "2025-12-02T16:04:13Z",
  "id" : "636041C2-BD10-4C38-BF69-A01D624BBF5C",
  "kind" : "unknown",
  "language" : "swift",
  "overview" : "## Overview\n\nWith [doc:\/\/com.apple.documentation\/documentation\/ARKit] in visionOS, you can create immersive experiences that integrate with real-world environments. This sample demonstrates how to use ARKit’s scene-reconstruction capability to construct and display a layer of mesh on real-world objects, like the scene in the following video:\n\n### Capture the anchors from the scene\n\nThe sample uses the `MeshAnchorGenerator` class to retrieve anchor information from [doc:\/\/com.apple.documentation\/documentation\/ARKit\/SceneReconstructionProvider]. In the following code snippet, the generator takes in the root entity from the reality view to perform actions on the entities and create a dictionary to store the collection of anchors:\n\nThe `run(_:)` method processes all anchor updates asynchronously from the [doc:\/\/com.apple.documentation\/documentation\/ARKit\/SceneReconstructionProvider]. When an anchor detects either an `.added` or an `.updated` event, it creates a new entity if one isn’t already present, and it updates its mesh, material, and transform properties:\n\nWhen an anchor detects a `.removed` event, the app removes the entity from the `root` and the anchor collection:\n\n### Add scene reconstruction to the view\n\nTo track the anchors, the app must start an `ARKitSession`. The app creates the `root` to store all the entities, the [doc:\/\/com.apple.documentation\/documentation\/ARKit\/ARKitSession] instance, and the [doc:\/\/com.apple.documentation\/documentation\/ARKit\/SceneReconstructionProvider] instance to perform scene reconstruction:\n\nWhen the properties are in place, the app constructs the `MeshAnchorGenerator` class with the root. It initiates the `ARKitSession` while handling any potential errors. Finally, the app proceeds with the generation process by invoking the `run(_:)` method with the `sceneReconstruction` instance:\n\n### Set up the immersive space\n\nFor `ARKit` and `SceneReconstructionProvider` to work, the app requires an immersive space. The sample creates an immersive scene in the app’s entry point:\n\nThe `MainView` launches the immersive space with [doc:\/\/com.apple.documentation\/documentation\/SwiftUI\/EnvironmentValues\/openImmersiveSpace] after it appears:",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/visionos\/applying-mesh-to-real-world-surroundings\ncrawled: 2025-12-02T16:04:13Z\n---\n\n# Applying mesh to real-world surroundings\n\n**Sample Code**\n\nAdd a layer of mesh to objects in the real world, using scene reconstruction in ARKit.\n\n## Overview\n\nWith [doc:\/\/com.apple.documentation\/documentation\/ARKit] in visionOS, you can create immersive experiences that integrate with real-world environments. This sample demonstrates how to use ARKit’s scene-reconstruction capability to construct and display a layer of mesh on real-world objects, like the scene in the following video:\n\n\n\n### Capture the anchors from the scene\n\nThe sample uses the `MeshAnchorGenerator` class to retrieve anchor information from [doc:\/\/com.apple.documentation\/documentation\/ARKit\/SceneReconstructionProvider]. In the following code snippet, the generator takes in the root entity from the reality view to perform actions on the entities and create a dictionary to store the collection of anchors:\n\n```swift\nimport SwiftUI\nimport RealityKit\nimport ARKit\n\nclass MeshAnchorGenerator {\n    \/\/\/ The root entity of the view.\n    var root: Entity\n\n    \/\/\/ The collection of anchors.\n    private var anchors: [UUID : Entity] = [:]\n\n    init(root: Entity) {\n        self.root = root\n    }\n\n    \/\/ ...\n}\n```\n\nThe `run(_:)` method processes all anchor updates asynchronously from the [doc:\/\/com.apple.documentation\/documentation\/ARKit\/SceneReconstructionProvider]. When an anchor detects either an `.added` or an `.updated` event, it creates a new entity if one isn’t already present, and it updates its mesh, material, and transform properties:\n\n```swift\n@MainActor\nfunc run(_ sceneRec: SceneReconstructionProvider) async {\n    \/\/ Loop to process all anchor updates that the provider detects.\n    for await update in sceneRec.anchorUpdates {\n        switch update.event {\n        case .added, .updated:\n            \/\/ Retrives the entity from the anchor collection based on the anchor ID.\n            \/\/ If it doesn't exist, creates and adds a new entity to the collection.\n            let entity = anchors[update.anchor.id] ?? {\n                let entity = Entity()\n                root.addChild(entity)\n                anchors[update.anchor.id] = entity\n\n                return entity\n            }()\n\n            \/\/\/ The material for the mesh to update.\n            let material = SimpleMaterial(color: .cyan.withAlphaComponent(0.8), isMetallic: false)\n\n            \/\/\/ The mesh from an anchor.\n            guard let mesh = try? await MeshResource(from: update.anchor) else { return }\n\n            await MainActor.run {\n                \/\/ Update the entity mesh and apply the material.\n                entity.components.set(ModelComponent(mesh: mesh, materials: [material]))\n\n                \/\/ Set the transform matrix on its position relative to the anchor.\n                entity.setTransformMatrix(update.anchor.originFromAnchorTransform, relativeTo: nil)\n            }\n\n            \/\/ ...\n        }\n    }\n}\n```\n\nWhen an anchor detects a `.removed` event, the app removes the entity from the `root` and the anchor collection:\n\n```swift\n@MainActor\nfunc run(_ sceneRec: SceneReconstructionProvider) async {\n    for await update in sceneRec.anchorUpdates {\n        switch update.event {\n\n        \/\/ ...\n\n        case .removed:\n            \/\/ Remove the entity from the root if it exists.\n            anchors[update.anchor.id]?.removeFromParent()\n\n            \/\/ Remove the anchor entry from the dictionary.\n            anchors[update.anchor.id] = nil\n        }\n    }\n}\n```\n\n\n\n### Add scene reconstruction to the view\n\nTo track the anchors, the app must start an `ARKitSession`. The app creates the `root` to store all the entities, the [doc:\/\/com.apple.documentation\/documentation\/ARKit\/ARKitSession] instance, and the [doc:\/\/com.apple.documentation\/documentation\/ARKit\/SceneReconstructionProvider] instance to perform scene reconstruction:\n\n```swift\nimport SwiftUI\nimport RealityKit\n\nstruct SceneReconstructionView: View {\n    var body: some View {\n        RealityView { content in\n            \/\/\/ The root entity.\n            let root = Entity()\n\n            \/\/\/ The `ARKitSession` instance for scene reconstruction.\n            let arSession = ARKitSession()\n\n            \/\/\/ The provider instance for scene reconstruction.\n            let sceneReconstruction = SceneReconstructionProvider()\n    \n            \/\/ ...\n        }\n    }\n}\n```\n\nWhen the properties are in place, the app constructs the `MeshAnchorGenerator` class with the root. It initiates the `ARKitSession` while handling any potential errors. Finally, the app proceeds with the generation process by invoking the `run(_:)` method with the `sceneReconstruction` instance:\n\n```swift\nimport SwiftUI\nimport RealityKit\n\nstruct SceneReconstructionView: View {\n    var body: some View {\n        RealityView { content in\n\n            \/\/ ...\n\n            Task {\n                \/\/\/ The generator to store the root with unlit materials.\n                let generator = MeshAnchorGenerator(root: root)\n\n                \/\/ Check if the device supports scene reconstruction.\n                guard SceneReconstructionProvider.isSupported else {\n                    print(\"SceneReconstructionProvider is not supported on this device.\")\n                    return\n                }\n\n                do {\n                    \/\/ Start the `ARKitSession` and run the `SceneReconstructionProvider`.\n                    try await arSession.run([sceneReconstruction])\n                } catch let error as ARKitSession.Error {\n                    \/\/ Handle any `ARKitSession` errors.\n                    print(\"Encountered an error while running providers: \\(error.localizedDescription)\")\n                } catch let error {\n                    \/\/ Handle other errors.\n                    print(\"Encountered an unexpected error: \\(error.localizedDescription)\")\n                }\n\n                \/\/ Start the generator if the session runs successfully.\n                await generator.run(sceneReconstruction)\n            }\n\n            \/\/ Add the root entity to the `RealityView`.\n            content.add(root)\n        }\n    }\n}\n```\n\n### Set up the immersive space\n\nFor `ARKit` and `SceneReconstructionProvider` to work, the app requires an immersive space. The sample creates an immersive scene in the app’s entry point:\n\n```swift\nimport SwiftUI\n\n@main\nstruct EntryPoint: App {\n    var body: some Scene {\n        WindowGroup {\n            MainView()\n        }\n\n        ImmersiveSpace(id: \"SceneReconstruction\") {\n            SceneReconstructionView()\n        }\n    }\n}\n```\n\nThe `MainView` launches the immersive space with [doc:\/\/com.apple.documentation\/documentation\/SwiftUI\/EnvironmentValues\/openImmersiveSpace] after it appears:\n\n```swift\nimport SwiftUI\n\nstruct MainView: View {\n    @Environment(\\.openImmersiveSpace) var openImmersiveSpace\n\n    var body: some View {\n        Text(\"Scene Reconstruction Example\")\n            .onAppear {\n                Task {\n                    await openImmersiveSpace(id: \"SceneReconstruction\")\n                }\n            }\n    }\n}\n```\n\n## Integrating ARKit\n\n- **Creating a 3D painting space**: Implement a painting canvas entity, and update its mesh to represent a stroke.\n- **Tracking and visualizing hand movement**: Use hand-tracking anchors to display a visual representation of hand transforms in visionOS.\n- **Displaying an entity that follows a person’s view**: Create an entity that tracks and follows head movement in an immersive scene.\n- **Obscuring virtual items in a scene behind real-world items**: Increase the realism of an immersive experience by adding entities with invisible materials  real-world objects.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Implement a painting canvas entity, and update its mesh to represent a stroke.",
          "name" : "Creating a 3D painting space",
          "url" : "https:\/\/developer.apple.com\/documentation\/visionOS\/creating-a-painting-space-in-visionos"
        },
        {
          "description" : "Use hand-tracking anchors to display a visual representation of hand transforms in visionOS.",
          "name" : "Tracking and visualizing hand movement",
          "url" : "https:\/\/developer.apple.com\/documentation\/visionOS\/tracking-and-visualizing-hand-movement"
        },
        {
          "description" : "Create an entity that tracks and follows head movement in an immersive scene.",
          "name" : "Displaying an entity that follows a person’s view",
          "url" : "https:\/\/developer.apple.com\/documentation\/visionOS\/displaying-a-3D-object-that-moves-to-stay-in-a-person's-view"
        },
        {
          "description" : "Increase the realism of an immersive experience by adding entities with invisible materials  real-world objects.",
          "name" : "Obscuring virtual items in a scene behind real-world items",
          "url" : "https:\/\/developer.apple.com\/documentation\/visionOS\/obscuring-virtual-items-in-a-scene-behind-real-world-items"
        }
      ],
      "title" : "Integrating ARKit"
    }
  ],
  "source" : "appleJSON",
  "title" : "Applying mesh to real-world surroundings",
  "url" : "https:\/\/developer.apple.com\/documentation\/visionos\/applying-mesh-to-real-world-surroundings"
}