{
  "abstract" : "Access the app transaction to determine when a customer purchased an app and the features to which they’re entitled.",
  "codeExamples" : [
    {
      "code" : "do {\n    \/\/ Get the `appTransaction`.\n    let shared = try await AppTransaction.shared\n    if case .verified(let appTransaction) = shared {\n        \/\/ Hard-code the major version number in which the app's business model changed.\n        let newBusinessModelMajorVersion = \"2\" \n\n        \/\/ Get the major version number of the version the customer originally purchased.\n        let versionComponents = appTransaction.originalAppVersion.split(separator: \".\")\n        let originalMajorVersion = versionComponents[0]\n\n        if originalMajorVersion < newBusinessModelMajorVersion {\n            \/\/ This customer purchased the app before the business model changed.\n            \/\/ Deliver content that they're entitled to based on their app purchase.\n        }\n        else {\n            \/\/ This person purchased the app after the business model changed.\n        }\n    }\n}\ncatch {\n    \/\/ Handle errors.\n}\n\n\n\/\/ Iterate over any other products they purchased.\nfor await result in Transaction.currentEntitlements {\n    if case .verified(let transaction) = result {\n        \/\/ Deliver the content based on their current entitlements.\n    }\n}",
      "language" : "swift"
    },
    {
      "code" : "do {\n    \/\/ Get the `appTransaction`.\n    let shared = try await AppTransaction.shared\n    if case .verified(let appTransaction) = shared {\n        \/\/ Hard-code the `CFBundleVersion` number in which the app's business model changed.\n        let newBusinessModelVersion = \"2\"\n\n        \/\/ Compare this number with the version number the person originally purchased.\n        if appTransaction.originalAppVersion < newBusinessModelVersion {\n            \/\/ Handle a case in which a person purchased the app before the business model changed.\n            \/\/ Deliver content that they're entitled to based on their app purchase.\n        }\n        else {\n            \/\/ This person purchased the app after the business model changed.\n        }\n    }\n}\ncatch {\n    \/\/ Handle errors.\n}\n\n\/\/ Iterate over any other products they purchased.\nfor await result in Transaction.currentEntitlements {\n    if case .verified(let transaction) = result {\n    \/\/ Deliver the content based on their current entitlements.\n    }\n}",
      "language" : "swift"
    }
  ],
  "contentHash" : "a8471f23954b01ee2314842b405cc02702ec7b11a2f0c69e8ae3c0f0ec4395f2",
  "crawledAt" : "2025-12-03T15:31:28Z",
  "id" : "6349D1DB-6AD0-44B8-9C2F-9F4D143F5379",
  "kind" : "article",
  "language" : "swift",
  "module" : "StoreKit",
  "overview" : "## Overview\n\nThe [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/AppTransaction\/originalAppVersion] property indicates the app version that the customer purchased. If you change your business model from a paid app to a free app that offers in-app purchases, use this property to learn whether the customer purchased your app before you changed the business model. Then, use that information to determine your customers’ entitlement to features that were available in the paid app.\n\n### Provide features to all customers\n\nFor example, an app that is a paid app in version 1 has premium features available to everyone who buys it. For version 2, the developer changes the business model, making it a free app that offers in-app purchases. Version 2 of the app has the same premium features, but now they’re available as in-app purchases.\n\nIn version 2, the developer wants to continue to provide the premium features to customers who purchased version 1. To do so, the app performs the following steps:\n\n### Obtain an app transaction\n\nAn app that performs these steps ensures that paid customers can access the premium features that were included with the app they purchased.\n\nThe code examples below demonstrate how an app obtains an [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/AppTransaction], compares the [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/AppTransaction\/originalAppVersion] with a constant that represents a specific app version, and then determines the customer’s entitlements.\n\nHere’s how it looks in macOS:\n\nHere’s an example of the code for an app in iOS, tvOS, watchOS, and visionOS:",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/storekit\/supporting-business-model-changes-by-using-the-app-transaction\ncrawled: 2025-12-03T15:31:28Z\n---\n\n# Supporting business model changes by using the app transaction\n\n**Article**\n\nAccess the app transaction to determine when a customer purchased an app and the features to which they’re entitled.\n\n## Overview\n\nThe [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/AppTransaction\/originalAppVersion] property indicates the app version that the customer purchased. If you change your business model from a paid app to a free app that offers in-app purchases, use this property to learn whether the customer purchased your app before you changed the business model. Then, use that information to determine your customers’ entitlement to features that were available in the paid app.\n\n### Provide features to all customers\n\nFor example, an app that is a paid app in version 1 has premium features available to everyone who buys it. For version 2, the developer changes the business model, making it a free app that offers in-app purchases. Version 2 of the app has the same premium features, but now they’re available as in-app purchases.\n\nIn version 2, the developer wants to continue to provide the premium features to customers who purchased version 1. To do so, the app performs the following steps:\n\n1. The app’s code includes a constant that indicates the version the business model changed; that constant is `\"2\"` in this example.\n2. The app compares the [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/AppTransaction\/originalAppVersion]  value with the constant. If the customer purchased the app before the business model changed, the app determines that they’re entitled to the premium features.\n3. The app also checks the [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/Transaction\/currentEntitlements] sequence and delivers any in-app purchases the customers may have made.\n\n### Obtain an app transaction\n\nAn app that performs these steps ensures that paid customers can access the premium features that were included with the app they purchased.\n\nThe code examples below demonstrate how an app obtains an [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/AppTransaction], compares the [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/AppTransaction\/originalAppVersion] with a constant that represents a specific app version, and then determines the customer’s entitlements.\n\nHere’s how it looks in macOS:\n\n```swift\ndo {\n    \/\/ Get the `appTransaction`.\n    let shared = try await AppTransaction.shared\n    if case .verified(let appTransaction) = shared {\n        \/\/ Hard-code the major version number in which the app's business model changed.\n        let newBusinessModelMajorVersion = \"2\" \n\n        \/\/ Get the major version number of the version the customer originally purchased.\n        let versionComponents = appTransaction.originalAppVersion.split(separator: \".\")\n        let originalMajorVersion = versionComponents[0]\n\n        if originalMajorVersion < newBusinessModelMajorVersion {\n            \/\/ This customer purchased the app before the business model changed.\n            \/\/ Deliver content that they're entitled to based on their app purchase.\n        }\n        else {\n            \/\/ This person purchased the app after the business model changed.\n        }\n    }\n}\ncatch {\n    \/\/ Handle errors.\n}\n\n\n\/\/ Iterate over any other products they purchased.\nfor await result in Transaction.currentEntitlements {\n    if case .verified(let transaction) = result {\n        \/\/ Deliver the content based on their current entitlements.\n    }\n}\n```\n\nHere’s an example of the code for an app in iOS, tvOS, watchOS, and visionOS:\n\n```swift\ndo {\n    \/\/ Get the `appTransaction`.\n    let shared = try await AppTransaction.shared\n    if case .verified(let appTransaction) = shared {\n        \/\/ Hard-code the `CFBundleVersion` number in which the app's business model changed.\n        let newBusinessModelVersion = \"2\"\n\n        \/\/ Compare this number with the version number the person originally purchased.\n        if appTransaction.originalAppVersion < newBusinessModelVersion {\n            \/\/ Handle a case in which a person purchased the app before the business model changed.\n            \/\/ Deliver content that they're entitled to based on their app purchase.\n        }\n        else {\n            \/\/ This person purchased the app after the business model changed.\n        }\n    }\n}\ncatch {\n    \/\/ Handle errors.\n}\n\n\/\/ Iterate over any other products they purchased.\nfor await result in Transaction.currentEntitlements {\n    if case .verified(let transaction) = result {\n    \/\/ Deliver the content based on their current entitlements.\n    }\n}\n```\n\n\n\n## App transaction\n\n- **AppTransaction**: Information that represents the customer’s purchase of the app, cryptographically signed by the App Store.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Information that represents the customer’s purchase of the app, cryptographically signed by the App Store.",
          "name" : "AppTransaction",
          "url" : "https:\/\/developer.apple.com\/documentation\/StoreKit\/AppTransaction"
        }
      ],
      "title" : "App transaction"
    }
  ],
  "source" : "appleJSON",
  "title" : "Supporting business model changes by using the app transaction",
  "url" : "https:\/\/developer.apple.com\/documentation\/storekit\/supporting-business-model-changes-by-using-the-app-transaction"
}