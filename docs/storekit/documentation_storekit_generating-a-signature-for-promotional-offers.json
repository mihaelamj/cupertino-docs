{
  "abstract" : "Create a signature to validate a promotional offer using your private key.",
  "codeExamples" : [
    {
      "code" : "appBundleId + '\\u2063' + keyIdentifier + '\\u2063' + productIdentifier + '\\u2063' + offerIdentifier + '\\u2063' + appAccountToken + '\\u2063' + nonce + '\\u2063' + timestamp",
      "language" : "http"
    },
    {
      "code" : "openssl ec -in {downloaded_private_key} -pubout -out public_key.pem",
      "language" : "shell"
    },
    {
      "code" : "MEQCIEQlmZRNfYzKBSE8QnhLTIHZZZWCFgZpRqRxHss65KoFAiAJgJKjdrWdkLUOCCjuEx2RmFS7daRzSVZRVZ8RyMyUXg=="
    }
  ],
  "contentHash" : "e5c6f68cb6c65f6cab13f4348b2658652430c5294261af8fd85ae12d43bea710",
  "crawledAt" : "2025-12-02T16:15:08Z",
  "id" : "79C19D28-C872-43F3-9EEA-9D932CC77DA6",
  "kind" : "article",
  "language" : "swift",
  "module" : "StoreKit",
  "overview" : "## Overview\n\nBefore you can create a signature on your server, you need to complete the one-time setup to generate a private key in App Store Connect, as [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/setting-up-promotional-offers] describes. Always use a secure connection when sending data, including the signature, between your app and server. For more information on ensuring your data’s security, see [doc:\/\/com.apple.documentation\/documentation\/Security\/preventing-insecure-network-connections].\n\nTo create the signature, you use parameters that identify the product and the offer, parameters your server generates, and your private key. To generate the signature, you combine the required parameters, then sign and encode the resulting string.\n\n### Combine the parameters\n\nIn the first step of generating the signature, you need the following parameters, most of which you also supply for [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKPaymentDiscount]:\n\nCombine the parameters into a UTF-8 string with an invisible separator (`'\\u2063'`) between them in the same order as the following example:\n\nIf you provide `applicationUsername` instead of `appAccountToken`, replace it accordingly in the UTF-8 string above.\n\n### Sign the combined string\n\nSign the combined UTF-8 string with the following key and algorithm:\n\nThe result is a Digital Encoding Rules (DER)-formatted binary value, which is the signature.\n\n### Validate locally and encode the signature\n\nConsider validating your signatures locally to ensure your signing process works correctly. You can create a public key derivative of your private key to test against. One way to create this key is by running the `openSSL` command from the terminal app, as the example below shows:\n\nUse Base64 encoding for the binary signature you generated to obtain the final signature string to send to the App Store for validation. The signature string resembles the following:\n\n### Respond to the request\n\nRespond to the app’s request for the signature over a secure connection, providing the encoded signature string, the `nonce`, the `timestamp`, and the `keyIdentifier`. Note that each payload, signature, and `nonce` is only valid for one buy request, even if the buy fails.\n\nSee [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/implementing-promotional-offers-in-your-app#Create-a-Signature] for information about the app’s request and how it uses the signature.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/StoreKit\/generating-a-signature-for-promotional-offers\ncrawled: 2025-12-02T16:15:08Z\n---\n\n# Generating a signature for promotional offers\n\n**Article**\n\nCreate a signature to validate a promotional offer using your private key.\n\n## Overview\n\nBefore you can create a signature on your server, you need to complete the one-time setup to generate a private key in App Store Connect, as [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/setting-up-promotional-offers] describes. Always use a secure connection when sending data, including the signature, between your app and server. For more information on ensuring your data’s security, see [doc:\/\/com.apple.documentation\/documentation\/Security\/preventing-insecure-network-connections].\n\nTo create the signature, you use parameters that identify the product and the offer, parameters your server generates, and your private key. To generate the signature, you combine the required parameters, then sign and encode the resulting string.\n\n### Combine the parameters\n\nIn the first step of generating the signature, you need the following parameters, most of which you also supply for [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKPaymentDiscount]:\n\n\n\n\n\nCombine the parameters into a UTF-8 string with an invisible separator (`'\\u2063'`) between them in the same order as the following example:\n\n```http\nappBundleId + '\\u2063' + keyIdentifier + '\\u2063' + productIdentifier + '\\u2063' + offerIdentifier + '\\u2063' + appAccountToken + '\\u2063' + nonce + '\\u2063' + timestamp\n```\n\nIf you provide `applicationUsername` instead of `appAccountToken`, replace it accordingly in the UTF-8 string above.\n\n### Sign the combined string\n\nSign the combined UTF-8 string with the following key and algorithm:\n\n- Your PKCS #8 private key (downloaded from App Store Connect) that corresponds to the `keyIdentifier` in the UTF-8 string\n- The Elliptic Curve Digital Signature Algorithm (ECDSA) with a SHA-256 hash\n\nThe result is a Digital Encoding Rules (DER)-formatted binary value, which is the signature.\n\n### Validate locally and encode the signature\n\nConsider validating your signatures locally to ensure your signing process works correctly. You can create a public key derivative of your private key to test against. One way to create this key is by running the `openSSL` command from the terminal app, as the example below shows:\n\n```shell\nopenssl ec -in {downloaded_private_key} -pubout -out public_key.pem\n```\n\nUse Base64 encoding for the binary signature you generated to obtain the final signature string to send to the App Store for validation. The signature string resembles the following:\n\n```\nMEQCIEQlmZRNfYzKBSE8QnhLTIHZZZWCFgZpRqRxHss65KoFAiAJgJKjdrWdkLUOCCjuEx2RmFS7daRzSVZRVZ8RyMyUXg==\n```\n\n### Respond to the request\n\nRespond to the app’s request for the signature over a secure connection, providing the encoded signature string, the `nonce`, the `timestamp`, and the `keyIdentifier`. Note that each payload, signature, and `nonce` is only valid for one buy request, even if the buy fails.\n\nSee [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/implementing-promotional-offers-in-your-app#Create-a-Signature] for information about the app’s request and how it uses the signature.\n\n## Promotional offers\n\n- **Setting up promotional offers**: Generate a key and configure offers for auto-renewable subscriptions in App Store Connect.\n- **Implementing promotional offers in your app**: Offer discounted pricing for auto-renewable subscription products to eligible subscribers.\n- **Generating a Promotional Offer Signature on the Server**: Generate a signature using your private key and lightweight cryptography libraries.\n- **SKPaymentDiscount**: The signed discount to apply to a payment.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Generate a key and configure offers for auto-renewable subscriptions in App Store Connect.",
          "name" : "Setting up promotional offers",
          "url" : "https:\/\/developer.apple.com\/documentation\/StoreKit\/setting-up-promotional-offers"
        },
        {
          "description" : "Offer discounted pricing for auto-renewable subscription products to eligible subscribers.",
          "name" : "Implementing promotional offers in your app",
          "url" : "https:\/\/developer.apple.com\/documentation\/StoreKit\/implementing-promotional-offers-in-your-app"
        },
        {
          "description" : "Generate a signature using your private key and lightweight cryptography libraries.",
          "name" : "Generating a Promotional Offer Signature on the Server",
          "url" : "https:\/\/developer.apple.com\/documentation\/StoreKit\/generating-a-promotional-offer-signature-on-the-server"
        },
        {
          "description" : "The signed discount to apply to a payment.",
          "name" : "SKPaymentDiscount",
          "url" : "https:\/\/developer.apple.com\/documentation\/StoreKit\/SKPaymentDiscount"
        }
      ],
      "title" : "Promotional offers"
    }
  ],
  "source" : "appleJSON",
  "title" : "Generating a signature for promotional offers",
  "url" : "https:\/\/developer.apple.com\/documentation\/StoreKit\/generating-a-signature-for-promotional-offers"
}