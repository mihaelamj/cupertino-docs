{
  "abstract" : "Offer discounted pricing for auto-renewable subscription products to eligible subscribers.",
  "codeExamples" : [
    {
      "code" : "\/\/ Fetch the signature from your server to be applied to the offer.\n\/\/ At this point you know the user and the product the offer is for, and which offer you want to display.\npublic func prepareOffer(usernameHash: String, productIdentifier: String, offerIdentifier: String, completion: (SKPaymentDiscount) -> Void) {\n\n    \/\/ Make a secure request to your server, providing the username, product, and discount data\n    \/\/ Your server will use these values to generate the signature and return it, along with the nonce, timestamp, and key identifier that it uses to generate the signature.\n    YourServer.fetchOfferDetails(username: usernameHash, productIdentifier: productIdentifier, offerIdentifier: offerIdentifier, completion: { (nonce: UUID, timestamp: NSNumber, keyIdentifier: String, signature: String) in \n\n        \/\/ Create an SKPaymentDiscount to be used later when the user initiates the purchase\n        let discountOffer = SKPaymentDiscount(identifier: offerIdentifier, keyIdentifier: keyIdentifier, nonce: nonce, signature: discountsignature, timestamp: timestamp)\n\n        completion(discountOffer)\n    })\n}",
      "language" : "swift"
    },
    {
      "code" : "\/\/ An example function that makes a buy request with a promotional offer attached.\npublic func buyProduct(productIdentifier: SKProduct, forUser usernameHash: String, withOffer discountOffer: SKPaymentDiscount) {\n\n    \/\/ The original product being purchased.\n    let payment = SKMutablePayment(product: product)\n\n    \/\/ You must set applicationUsername to be the same as the one used to generate the signature.\n    payment.applicationUsername = usernameHash\n\n    \/\/ Add the offer to the payment.\n    payment.paymentDiscount = discountOffer\n\n    \/\/ Add the payment to the queue for purchase.\n    SKPaymentQueue.default().add(payment)\n}",
      "language" : "swift"
    }
  ],
  "contentHash" : "c97c90cc8fdce4cc1ffd5cda7b26c9d57b2ff330c9279cbc86efc644b92800f4",
  "crawledAt" : "2025-12-02T16:15:07Z",
  "id" : "94C0229A-A6D5-4B48-BC37-2EB664CF39BA",
  "kind" : "article",
  "language" : "swift",
  "module" : "StoreKit",
  "overview" : "## Overview\n\nPromotional offers can be effective in winning back lapsed subscribers or retaining current subscribers. You can provide lapsed or current subscribers a limited-time offer of a discounted or free period of service for auto-renewable subscriptions on macOS, iOS, and tvOS. To implement the offers, first complete the setup on App Store Connect, including generating a private key. See [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/setting-up-promotional-offers] for more details.\n\nYou decide the criteria for which subscribers qualify for an offer. In your app, the details of the offers you set up in App Store Connect appear in the [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKProduct\/discounts] array in [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKProduct]. To indicate the offer you want to give to a user, include a signed [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKMutablePayment\/paymentDiscount] in the [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKMutablePayment] object.\n\nFor business guidance on using promotional offers, see [https:\/\/developer.apple.com\/app-store\/subscriptions\/#providing-subscription-offers].\n\n### Prepare Your Offer\n\nTo present a promotional offer, first determine the subscriber’s eligibility, get the product details from the App Store, and generate a signature on your server.\n\n\n\n#### Determine Eligibility\n\nThere are two aspects to determining a user’s eligibility for promotional offers:\n\nConsider using the App Store server notification `DID_CHANGE_RENEWAL_STATUS` to determine eligibility. This notification is triggered by changes in a subscription’s auto-renew status. For example, you receive a notification when a subscriber disables auto-renew in Manage Subscriptions or contacts AppleCare to cancel their subscription. For more information on server notifications, see [doc:\/\/com.apple.documentation\/documentation\/AppStoreServerNotifications]. Your server can notify your app if the user is eligible for an offer so the app can present it to the customer.\n\nConsider also implementing [doc:\/\/com.apple.documentation\/documentation\/DeviceCheck] to keep track of devices that have previously redeemed offers. `TwoBitKit` allows you to maintain user privacy while defining parameters you use to determine eligibility.\n\n#### Request Product Details\n\nOnce you determine that the subscriber is eligible for an offer, the next step is requesting the product details, including offers, from the App Store. To fetch the details, use [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKProductsRequest] with the subscription’s product identifier.\n\nIn response, the App Store returns the localized information in [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKProduct]. The [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKProduct\/discounts] array of [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKProduct] contains all promotional offers you configured in App Store Connect for that product. The [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKProductDiscount] object contains offer details including the localized price.\n\nYou determine which offer from the [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKProduct\/discounts] array to present to the user.\n\n#### Create a Signature\n\nA signature is a unique string that your server generates using specified parameters and your private key. You include it in the [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKPaymentDiscount\/signature] parameter of [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKPaymentDiscount], and the App Store uses it to validate the promotional offer. The signature is time sensitive, unique per offer, and redeemable only once.\n\nTo generate the signature, send a secure request to your server. The server will need to know the [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKMutablePayment\/applicationUsername], [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKProduct\/productIdentifier], and [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKProductDiscount\/identifier]. Your app should supply these parameters in the request if the server doesn’t already know them. See [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/generating-a-signature-for-promotional-offers] for more information.\n\nYour server should respond with the signature string and the additional values it used to generate the signature: a `nonce`, `timestamp`, and the `keyIdentifier`. Use these values to complete the parameters in the [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKPaymentDiscount] object nested in the [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKMutablePayment] object representing the offer. If the App Store determines that the signature isn’t a match for the parameters in the payment, the transaction fails.\n\nThe following code example shows how to request a signature from your server and prepare the discount offer.\n\n#### Present Your Offer\n\nYou can present offers to users through various channels, such as email, but they must interact with the offer inside your app’s UI. Display the offer in your app at the time you choose, using the pricing and terms from the [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKProductDiscount] object. By using the details from this object, you ensure that the offer displayed to the user accurately reflects the offer you intend to give. For design guidance, see [https:\/\/developer.apple.com\/app-store\/subscriptions\/#clear-description].\n\nPresent offers to eligible subscribers only, to avoid misleading or confusing users.\n\n### Complete the Transaction\n\nAfter a user chooses to buy the promotional offer, submit the payment request, verify the receipt, and unlock the offer.\n\n\n\n#### Create a Payment Request\n\nWhen the user initiates a buy of the offer in the app, send an [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKMutablePayment] to the App Store with the signed offer. Create an [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKPaymentDiscount] object that includes the signature you generated and its `identifier`, `keyIdentifier`, `nonce` (one-time use), and `timestamp` parameters. Add this object as the [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKMutablePayment\/paymentDiscount] property to the [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKMutablePayment] object.\n\nInclude in the [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKMutablePayment] object the same [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKMutablePayment\/applicationUsername], often a unique hash of the username, that the signature contains. Add the [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKMutablePayment] object to the queue.\n\n#### Notify the User of the Transaction State\n\nOnce the App Store validates the offer, it processes your payment request and generates an [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKPaymentTransaction]. Your app uses it to validate the transaction and unlock content accordingly.\n\nHandle the transaction state of the payment request and notify the customer as needed. If the transaction is successful, the App Store automatically updates the app receipt with the transaction in the [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKPaymentTransactionState\/purchased] state. Base64-encode the receipt on-device and securely send the receipt data to your server.\n\n#### Verify the Receipt\n\nAs you do for all purchases, verify the receipt with the App Store by calling the [doc:\/\/com.apple.documentation\/documentation\/AppStoreReceipts\/Verify-Receipt] endpoint from your server. The App Store sends a JSON response containing information about the user’s purchase. See [https:\/\/developer.apple.com\/library\/archive\/releasenotes\/General\/ValidateAppStoreReceipt\/Chapters\/ValidateRemotely.html] for more information.\n\nWhen a subscriber redeems an offer, the receipt contains a [doc:\/\/com.apple.documentation\/documentation\/AppStoreReceipts\/promotional_offer_id] in the purchase transaction. This receipt field is a string containing the offer ID that you configured in App Store Connect. You can look at past transactions in the receipt to identify the offers the customer redeemed.\n\n#### Unlock the Service\n\nAfter validating that the user has purchased the subscription product, unlock the subscription service in the app for the user. Update the customer’s eligibility criteria for offers, as needed.\n\nWhen a customer redeems a promotional offer, the offer period starts at the next billing event.\n\nOnce the offer period concludes, a promotional offer auto-renews at the standard price.\n\nA user can redeem and have active only one promotional offer at a time. If the user accepts another offer before a current offer ends, the current offer is canceled in the following billing event and the new offer takes effect.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/StoreKit\/implementing-promotional-offers-in-your-app\ncrawled: 2025-12-02T16:15:07Z\n---\n\n# Implementing promotional offers in your app\n\n**Article**\n\nOffer discounted pricing for auto-renewable subscription products to eligible subscribers.\n\n## Overview\n\nPromotional offers can be effective in winning back lapsed subscribers or retaining current subscribers. You can provide lapsed or current subscribers a limited-time offer of a discounted or free period of service for auto-renewable subscriptions on macOS, iOS, and tvOS. To implement the offers, first complete the setup on App Store Connect, including generating a private key. See [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/setting-up-promotional-offers] for more details.\n\nYou decide the criteria for which subscribers qualify for an offer. In your app, the details of the offers you set up in App Store Connect appear in the [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKProduct\/discounts] array in [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKProduct]. To indicate the offer you want to give to a user, include a signed [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKMutablePayment\/paymentDiscount] in the [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKMutablePayment] object.\n\nFor business guidance on using promotional offers, see [https:\/\/developer.apple.com\/app-store\/subscriptions\/#providing-subscription-offers].\n\n\n\n### Prepare Your Offer\n\nTo present a promotional offer, first determine the subscriber’s eligibility, get the product details from the App Store, and generate a signature on your server.\n\n\n\n#### Determine Eligibility\n\nThere are two aspects to determining a user’s eligibility for promotional offers:\n\n- The App Store deems all customers with an existing or expired subscription in the app eligible to redeem a promotional offer. You can check whether the receipt contains any existing or expired subscription purchases to identify these current or lapsed subscribers.\n- You determine any additional eligibility criteria for a specific promotional offer. Eligibility can be contingent on a wide range of business logic determined by your business needs.\n\nConsider using the App Store server notification `DID_CHANGE_RENEWAL_STATUS` to determine eligibility. This notification is triggered by changes in a subscription’s auto-renew status. For example, you receive a notification when a subscriber disables auto-renew in Manage Subscriptions or contacts AppleCare to cancel their subscription. For more information on server notifications, see [doc:\/\/com.apple.documentation\/documentation\/AppStoreServerNotifications]. Your server can notify your app if the user is eligible for an offer so the app can present it to the customer.\n\n\n\nConsider also implementing [doc:\/\/com.apple.documentation\/documentation\/DeviceCheck] to keep track of devices that have previously redeemed offers. `TwoBitKit` allows you to maintain user privacy while defining parameters you use to determine eligibility.\n\n#### Request Product Details\n\nOnce you determine that the subscriber is eligible for an offer, the next step is requesting the product details, including offers, from the App Store. To fetch the details, use [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKProductsRequest] with the subscription’s product identifier.\n\nIn response, the App Store returns the localized information in [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKProduct]. The [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKProduct\/discounts] array of [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKProduct] contains all promotional offers you configured in App Store Connect for that product. The [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKProductDiscount] object contains offer details including the localized price.\n\nYou determine which offer from the [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKProduct\/discounts] array to present to the user.\n\n#### Create a Signature\n\nA signature is a unique string that your server generates using specified parameters and your private key. You include it in the [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKPaymentDiscount\/signature] parameter of [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKPaymentDiscount], and the App Store uses it to validate the promotional offer. The signature is time sensitive, unique per offer, and redeemable only once.\n\nTo generate the signature, send a secure request to your server. The server will need to know the [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKMutablePayment\/applicationUsername], [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKProduct\/productIdentifier], and [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKProductDiscount\/identifier]. Your app should supply these parameters in the request if the server doesn’t already know them. See [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/generating-a-signature-for-promotional-offers] for more information.\n\nYour server should respond with the signature string and the additional values it used to generate the signature: a `nonce`, `timestamp`, and the `keyIdentifier`. Use these values to complete the parameters in the [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKPaymentDiscount] object nested in the [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKMutablePayment] object representing the offer. If the App Store determines that the signature isn’t a match for the parameters in the payment, the transaction fails.\n\n\n\nThe following code example shows how to request a signature from your server and prepare the discount offer.\n\n```swift\n\/\/ Fetch the signature from your server to be applied to the offer.\n\/\/ At this point you know the user and the product the offer is for, and which offer you want to display.\npublic func prepareOffer(usernameHash: String, productIdentifier: String, offerIdentifier: String, completion: (SKPaymentDiscount) -> Void) {\n\n    \/\/ Make a secure request to your server, providing the username, product, and discount data\n    \/\/ Your server will use these values to generate the signature and return it, along with the nonce, timestamp, and key identifier that it uses to generate the signature.\n    YourServer.fetchOfferDetails(username: usernameHash, productIdentifier: productIdentifier, offerIdentifier: offerIdentifier, completion: { (nonce: UUID, timestamp: NSNumber, keyIdentifier: String, signature: String) in \n\n        \/\/ Create an SKPaymentDiscount to be used later when the user initiates the purchase\n        let discountOffer = SKPaymentDiscount(identifier: offerIdentifier, keyIdentifier: keyIdentifier, nonce: nonce, signature: discountsignature, timestamp: timestamp)\n\n        completion(discountOffer)\n    })\n}\n```\n\n#### Present Your Offer\n\nYou can present offers to users through various channels, such as email, but they must interact with the offer inside your app’s UI. Display the offer in your app at the time you choose, using the pricing and terms from the [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKProductDiscount] object. By using the details from this object, you ensure that the offer displayed to the user accurately reflects the offer you intend to give. For design guidance, see [https:\/\/developer.apple.com\/app-store\/subscriptions\/#clear-description].\n\nPresent offers to eligible subscribers only, to avoid misleading or confusing users.\n\n### Complete the Transaction\n\nAfter a user chooses to buy the promotional offer, submit the payment request, verify the receipt, and unlock the offer.\n\n\n\n#### Create a Payment Request\n\nWhen the user initiates a buy of the offer in the app, send an [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKMutablePayment] to the App Store with the signed offer. Create an [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKPaymentDiscount] object that includes the signature you generated and its `identifier`, `keyIdentifier`, `nonce` (one-time use), and `timestamp` parameters. Add this object as the [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKMutablePayment\/paymentDiscount] property to the [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKMutablePayment] object.\n\nInclude in the [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKMutablePayment] object the same [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKMutablePayment\/applicationUsername], often a unique hash of the username, that the signature contains. Add the [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKMutablePayment] object to the queue.\n\n```swift\n\/\/ An example function that makes a buy request with a promotional offer attached.\npublic func buyProduct(productIdentifier: SKProduct, forUser usernameHash: String, withOffer discountOffer: SKPaymentDiscount) {\n\n    \/\/ The original product being purchased.\n    let payment = SKMutablePayment(product: product)\n\n    \/\/ You must set applicationUsername to be the same as the one used to generate the signature.\n    payment.applicationUsername = usernameHash\n\n    \/\/ Add the offer to the payment.\n    payment.paymentDiscount = discountOffer\n\n    \/\/ Add the payment to the queue for purchase.\n    SKPaymentQueue.default().add(payment)\n}\n```\n\n#### Notify the User of the Transaction State\n\nOnce the App Store validates the offer, it processes your payment request and generates an [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKPaymentTransaction]. Your app uses it to validate the transaction and unlock content accordingly.\n\nHandle the transaction state of the payment request and notify the customer as needed. If the transaction is successful, the App Store automatically updates the app receipt with the transaction in the [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/SKPaymentTransactionState\/purchased] state. Base64-encode the receipt on-device and securely send the receipt data to your server.\n\n\n\n#### Verify the Receipt\n\nAs you do for all purchases, verify the receipt with the App Store by calling the [doc:\/\/com.apple.documentation\/documentation\/AppStoreReceipts\/Verify-Receipt] endpoint from your server. The App Store sends a JSON response containing information about the user’s purchase. See [https:\/\/developer.apple.com\/library\/archive\/releasenotes\/General\/ValidateAppStoreReceipt\/Chapters\/ValidateRemotely.html] for more information.\n\nWhen a subscriber redeems an offer, the receipt contains a [doc:\/\/com.apple.documentation\/documentation\/AppStoreReceipts\/promotional_offer_id] in the purchase transaction. This receipt field is a string containing the offer ID that you configured in App Store Connect. You can look at past transactions in the receipt to identify the offers the customer redeemed.\n\n#### Unlock the Service\n\nAfter validating that the user has purchased the subscription product, unlock the subscription service in the app for the user. Update the customer’s eligibility criteria for offers, as needed.\n\nWhen a customer redeems a promotional offer, the offer period starts at the next billing event.\n\n- For upgrades or crossgrades to a different subscription with the same duration, the promotional offer triggers a billing event and goes into effect immediately.\n- For downgrades or crossgrades to a different subscription with different durations, the promotional offer period goes into effect at the next renewal date.\n- For the same subscription in an introductory offer, this promotional offer period goes into effect at the next scheduled billing event.\n\nOnce the offer period concludes, a promotional offer auto-renews at the standard price.\n\nA user can redeem and have active only one promotional offer at a time. If the user accepts another offer before a current offer ends, the current offer is canceled in the following billing event and the new offer takes effect.\n\n## Promotional offers\n\n- **Setting up promotional offers**: Generate a key and configure offers for auto-renewable subscriptions in App Store Connect.\n- **Generating a signature for promotional offers**: Create a signature to validate a promotional offer using your private key.\n- **Generating a Promotional Offer Signature on the Server**: Generate a signature using your private key and lightweight cryptography libraries.\n- **SKPaymentDiscount**: The signed discount to apply to a payment.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Generate a key and configure offers for auto-renewable subscriptions in App Store Connect.",
          "name" : "Setting up promotional offers",
          "url" : "https:\/\/developer.apple.com\/documentation\/StoreKit\/setting-up-promotional-offers"
        },
        {
          "description" : "Create a signature to validate a promotional offer using your private key.",
          "name" : "Generating a signature for promotional offers",
          "url" : "https:\/\/developer.apple.com\/documentation\/StoreKit\/generating-a-signature-for-promotional-offers"
        },
        {
          "description" : "Generate a signature using your private key and lightweight cryptography libraries.",
          "name" : "Generating a Promotional Offer Signature on the Server",
          "url" : "https:\/\/developer.apple.com\/documentation\/StoreKit\/generating-a-promotional-offer-signature-on-the-server"
        },
        {
          "description" : "The signed discount to apply to a payment.",
          "name" : "SKPaymentDiscount",
          "url" : "https:\/\/developer.apple.com\/documentation\/StoreKit\/SKPaymentDiscount"
        }
      ],
      "title" : "Promotional offers"
    }
  ],
  "source" : "appleJSON",
  "title" : "Implementing promotional offers in your app",
  "url" : "https:\/\/developer.apple.com\/documentation\/StoreKit\/implementing-promotional-offers-in-your-app"
}