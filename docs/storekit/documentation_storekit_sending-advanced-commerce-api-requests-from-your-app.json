{
  "abstract" : "Send Advanced Commerce API requests from your app that you authorize with a JSON Web Signature (JWS) you generate on your server.",
  "codeExamples" : [
    {
      "code" : "{\n    \"operation\": \"CREATE_ONE_TIME_CHARGE\",\n    \"version\": \"1\",                     \n    \"requestInfo\": {\n        \"requestReferenceId\": \"f55df048-4cd8-4261-b404-b6f813ff70e5\"\n    },\n    \"currency\": \"USD\",\n    \"taxCode\": \"C003-00-2\", \n    \"storefront\": \"USA\",\n    \"item\": {\n        \"SKU\": \"BOOK_SHERLOCK_HOMLES\",\n        \"displayName\": \"Sherlock Holmes\", \n        \"description\": \"The Sherlock Holmes, 5th Edition\",\n        \"price\": 4990\n    }\n}",
      "language" : "JSON"
    },
    {
      "code" : "{\n    \"signatureInfo\": {\n        \"token\": \"<your JWS compact serialization>\"\n    }\n}",
      "language" : "JSON"
    },
    {
      "code" : "let jsonString =\"<# your signatureInfo UTF-8 JSON string>\"\nlet advancedCommerceRequestData = Data(jsonString.utf8)",
      "language" : "swift"
    },
    {
      "code" : "let purchaseResult = try await product.purchase(\n    options: [ \n        Product.PurchaseOption.custom( \n            key: “advancedCommerceData”, \n            value: advancedCommerceRequestData\n        )\n    ]\n)",
      "language" : "swift"
    }
  ],
  "contentHash" : "34110bddab7aa52779d622b0f4f9133add7347a73dc521347779197d16faf2b8",
  "crawledAt" : "2025-12-02T17:35:08Z",
  "id" : "3EE66F89-305F-4E8C-96AD-37E39B2DB2AE",
  "kind" : "article",
  "language" : "swift",
  "module" : "StoreKit",
  "overview" : "## Overview\n\nYou can make certain [doc:\/\/com.apple.documentation\/documentation\/AdvancedCommerceAPI] requests through StoreKit in your app, while you make other requests directly from your server.  In both cases, you authorize the calls with signatures you generate on your server.\n\nThe following Advanced Commerce API requests are available in your app using StoreKit APIs:\n\nTo make Advanced Commerce requests from your app, follow these steps:\n\nFor more information on authorizing server-based calls, see [doc:\/\/com.apple.documentation\/documentation\/AdvancedCommerceAPI\/authorizing-server-calls].\n\n## Create the base64-encoded request data\n\nPlace the Advanced Commerce request data in a UTF-8 JSON string and base64-encode the request.\n\nFor example, the following JSON represents a [doc:\/\/com.apple.documentation\/documentation\/AdvancedCommerceAPI\/OneTimeChargeCreateRequest] for the purchase of a one-time charge product:\n\nThe result of base64-encoding the example JSON request is:\n\n`ewogICAgIm9wZXJhdGlvbiI6ICJDUkVBVEVfT05FX1RJTUVfQ0hBUkdFIiwKICAgICJ2ZXJzaW9uIjogIjEiLCAgICAgICAgICAgICAgICAgICAgIAogICAgInJlcXVlc3RJbmZvIjogewogICAgICAgICJyZXF1ZXN0UmVmZXJlbmNlSWQiOiAiZjU1ZGYwNDgtNGNkOC00MjYxLWI0MDQtYjZmODEzZmY3MGU1IgogICAgfSwKICAgICJjdXJyZW5jeSI6ICJVU0QiLAogICAgInRheENvZGUiOiAiQzAwMy0wMC0yIiwgCiAgICAic3RvcmVmcm9udCI6ICJVU0EiLAogICAgIml0ZW0iOiB7CiAgICAgICAgIlNLVSI6ICJCT09LX1NIRVJMT0NLX0hPTUxFUyIsCiAgICAgICAgImRpc3BsYXlOYW1lIjogIlNoZXJsb2NrIEhvbG1lcyIsIAogICAgICAgICJkZXNjcmlwdGlvbiI6ICJUaGUgU2hlcmxvY2sgSG9sbWVzLCA1dGggRWRpdGlvbiIsCiAgICAgICAgInByaWNlIjogNDk5MAogICAgfQp9 `\n\nThis value, calculated using your own data, is your *base64-encoded request data*.\n\n## Generate the JWS using your request data\n\nFollow the signing instructions for Advanced Commerce API in-app requests in [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/generating-jws-to-sign-app-store-requests]. The Advanced Commerce API requires a custom claim, `request`. Provide the base64-encoded request data from the previous step as the value of the `request` claim in the JWS payload.\n\nThe result after following the instructions is a *JWS compact serialization*.\n\n## Wrap the JWS and convert it into data\n\nWrap the JWS to create a `signatureInfo` JSON string that contains a `token` key.  You can complete this step on your server or in your app. Create the `signatureInfo` JSON string as shown below:\n\nSet the value of the `token` key to your JWS compact serialization.\n\nNext, convert the `signatureInfo` JSON string into a `Data` buffer, as shown below:\n\nThe result is the Advanced Commerce request data object, referred to as `advancedCommerceRequestData` in the code snippets.\n\nSecurely send the `advancedCommerceRequestData` to your app.\n\n## Call the StoreKit purchase API using the signed request data\n\nTo complete the Advanced Commerce request in the app, call a StoreKit purchase method and provide the signed request, in the Advanced Commerce request data form, as a purchase option.\n\nThe following code example sets up the purchase request:\n\nIn this example:",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/StoreKit\/sending-advanced-commerce-api-requests-from-your-app\ncrawled: 2025-12-02T17:35:08Z\n---\n\n# Sending Advanced Commerce API requests from your app\n\n**Article**\n\nSend Advanced Commerce API requests from your app that you authorize with a JSON Web Signature (JWS) you generate on your server.\n\n## Overview\n\nYou can make certain [doc:\/\/com.apple.documentation\/documentation\/AdvancedCommerceAPI] requests through StoreKit in your app, while you make other requests directly from your server.  In both cases, you authorize the calls with signatures you generate on your server.\n\nThe following Advanced Commerce API requests are available in your app using StoreKit APIs:\n\n- [doc:\/\/com.apple.documentation\/documentation\/AdvancedCommerceAPI\/OneTimeChargeCreateRequest]\n- [doc:\/\/com.apple.documentation\/documentation\/AdvancedCommerceAPI\/SubscriptionCreateRequest]\n- [doc:\/\/com.apple.documentation\/documentation\/AdvancedCommerceAPI\/SubscriptionModifyInAppRequest]\n- [doc:\/\/com.apple.documentation\/documentation\/AdvancedCommerceAPI\/SubscriptionReactivateInAppRequest]\n\nTo make Advanced Commerce requests from your app, follow these steps:\n\n1. Collect the request data according to the API you’re invoking.  On your server, create your *base64-encoded request data* by combining the request data into a UTF-8 JSON string and base64-encoding the string.\n2. On your server, create a JWS compact serialization that includes your base64-encoded request data in the JWS payload, as described in [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/generating-jws-to-sign-app-store-requests#Include-custom-claims-for-Advanced-Commerce-API-in-app-requests]. For more information, see [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/generating-jws-to-sign-app-store-requests].\n3. Wrap the JWS in a JSON object, and convert it into a `Data` buffer to create the Advanced Commerce request data object, `advancedCommerceRequestData`.\n4. In your app, use the `advancedCommerceRequestData` as the value of a purchase option in your product purchase call.\n\nFor more information on authorizing server-based calls, see [doc:\/\/com.apple.documentation\/documentation\/AdvancedCommerceAPI\/authorizing-server-calls].\n\n## Create the base64-encoded request data\n\nPlace the Advanced Commerce request data in a UTF-8 JSON string and base64-encode the request.\n\nFor example, the following JSON represents a [doc:\/\/com.apple.documentation\/documentation\/AdvancedCommerceAPI\/OneTimeChargeCreateRequest] for the purchase of a one-time charge product:\n\n```JSON\n{\n    \"operation\": \"CREATE_ONE_TIME_CHARGE\",\n    \"version\": \"1\",                     \n    \"requestInfo\": {\n        \"requestReferenceId\": \"f55df048-4cd8-4261-b404-b6f813ff70e5\"\n    },\n    \"currency\": \"USD\",\n    \"taxCode\": \"C003-00-2\", \n    \"storefront\": \"USA\",\n    \"item\": {\n        \"SKU\": \"BOOK_SHERLOCK_HOMLES\",\n        \"displayName\": \"Sherlock Holmes\", \n        \"description\": \"The Sherlock Holmes, 5th Edition\",\n        \"price\": 4990\n    }\n}\n```\n\nThe result of base64-encoding the example JSON request is:\n\n`ewogICAgIm9wZXJhdGlvbiI6ICJDUkVBVEVfT05FX1RJTUVfQ0hBUkdFIiwKICAgICJ2ZXJzaW9uIjogIjEiLCAgICAgICAgICAgICAgICAgICAgIAogICAgInJlcXVlc3RJbmZvIjogewogICAgICAgICJyZXF1ZXN0UmVmZXJlbmNlSWQiOiAiZjU1ZGYwNDgtNGNkOC00MjYxLWI0MDQtYjZmODEzZmY3MGU1IgogICAgfSwKICAgICJjdXJyZW5jeSI6ICJVU0QiLAogICAgInRheENvZGUiOiAiQzAwMy0wMC0yIiwgCiAgICAic3RvcmVmcm9udCI6ICJVU0EiLAogICAgIml0ZW0iOiB7CiAgICAgICAgIlNLVSI6ICJCT09LX1NIRVJMT0NLX0hPTUxFUyIsCiAgICAgICAgImRpc3BsYXlOYW1lIjogIlNoZXJsb2NrIEhvbG1lcyIsIAogICAgICAgICJkZXNjcmlwdGlvbiI6ICJUaGUgU2hlcmxvY2sgSG9sbWVzLCA1dGggRWRpdGlvbiIsCiAgICAgICAgInByaWNlIjogNDk5MAogICAgfQp9 `\n\nThis value, calculated using your own data, is your *base64-encoded request data*.\n\n## Generate the JWS using your request data\n\nFollow the signing instructions for Advanced Commerce API in-app requests in [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/generating-jws-to-sign-app-store-requests]. The Advanced Commerce API requires a custom claim, `request`. Provide the base64-encoded request data from the previous step as the value of the `request` claim in the JWS payload.\n\nThe result after following the instructions is a *JWS compact serialization*.\n\n## Wrap the JWS and convert it into data\n\nWrap the JWS to create a `signatureInfo` JSON string that contains a `token` key.  You can complete this step on your server or in your app. Create the `signatureInfo` JSON string as shown below:\n\n```JSON\n{\n    \"signatureInfo\": {\n        \"token\": \"<your JWS compact serialization>\"\n    }\n}\n```\n\nSet the value of the `token` key to your JWS compact serialization.\n\nNext, convert the `signatureInfo` JSON string into a `Data` buffer, as shown below:\n\n```swift\nlet jsonString =\"<# your signatureInfo UTF-8 JSON string>\"\nlet advancedCommerceRequestData = Data(jsonString.utf8)\n```\n\nThe result is the Advanced Commerce request data object, referred to as `advancedCommerceRequestData` in the code snippets.\n\nSecurely send the `advancedCommerceRequestData` to your app.\n\n## Call the StoreKit purchase API using the signed request data\n\nTo complete the Advanced Commerce request in the app, call a StoreKit purchase method and provide the signed request, in the Advanced Commerce request data form, as a purchase option.\n\nThe following code example sets up the purchase request:\n\n```swift\nlet purchaseResult = try await product.purchase(\n    options: [ \n        Product.PurchaseOption.custom( \n            key: “advancedCommerceData”, \n            value: advancedCommerceRequestData\n        )\n    ]\n)\n```\n\nIn this example:\n\n- Use the custom key `\"advancedCommerceData\"` for all Advanced Commerce in-app requests. For more information about the custom purchase option, see [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/Product\/PurchaseOption\/custom(key:value:)-80cvh].\n- For the value attribute, provide your Advanced Commerce request data, which you created using your JWS compact serialization\n- For more information about the product purchase method, see [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/Product\/purchase(options:)].\n\n## Advanced Commerce API interactions\n\n- **AdvancedCommerceProduct**: A product configured as a generic SKU in App Store Connect for use with the Advanced Commerce API.\n- **Generating JWS to sign App Store requests**: Create signed JSON Web Signature (JWS) strings on your server to authorize your API requests in your app.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "A product configured as a generic SKU in App Store Connect for use with the Advanced Commerce API.",
          "name" : "AdvancedCommerceProduct",
          "url" : "https:\/\/developer.apple.com\/documentation\/StoreKit\/AdvancedCommerceProduct"
        },
        {
          "description" : "Create signed JSON Web Signature (JWS) strings on your server to authorize your API requests in your app.",
          "name" : "Generating JWS to sign App Store requests",
          "url" : "https:\/\/developer.apple.com\/documentation\/StoreKit\/generating-jws-to-sign-app-store-requests"
        }
      ],
      "title" : "Advanced Commerce API interactions"
    }
  ],
  "source" : "appleJSON",
  "title" : "Sending Advanced Commerce API requests from your app",
  "url" : "https:\/\/developer.apple.com\/documentation\/StoreKit\/sending-advanced-commerce-api-requests-from-your-app"
}