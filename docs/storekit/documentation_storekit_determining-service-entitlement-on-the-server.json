{
  "abstract" : "Identify a customer’s entitlement to your service, offers, and messaging by analyzing a validated receipt and the state of their subscription.",
  "codeExamples" : [
    {
      "code" : "curl -XPOST -H \"Content-type: application\/json\" -d '<FLAT JSON DATA>' 'localhost:3000\/simulate'",
      "language" : "swift"
    },
    {
      "code" : "{\n    \"products\": [\n        {\n            \"product_id\": \"com.example.monthly\",\n            \"entitlementCode\": 5,\n            \"expiration\": 1599391591000,\n            \"totalRenewals\": 7,\n            \"groupID\": \"13472270\",\n            \"originalTransactions\": [\n                {\n                    \"originalTX\": \"190000625698817\",\n                    \"start\": 1564455960000,\n                    \"expiration\": 1599391591000,\n                    \"renewals\": 7\n                }\n            ],\n            \"trialConsumed\": true\n        }\n    ],\n    \"trialConsumedForGroup\": [\n        \"13472270\"\n    ]\n}",
      "language" : "swift"
    }
  ],
  "contentHash" : "577cfdb384a275174ec797524503d2839fcfb5bfac0e922c75ed15ab5b72ebc0",
  "crawledAt" : "2025-12-02T15:32:29Z",
  "id" : "C0458E34-3528-4477-AB5F-C34B71FD8A07",
  "kind" : "unknown",
  "language" : "swift",
  "module" : "StoreKit",
  "overview" : "## Overview\n\nWhen your app provides a subscription service, you receive data in the form of in-app receipts and App Store server notifications that provide a subscription’s state. After reading this data, your app determines whether to allow or restrict the user’s access to service, products, offers, and messages.\n\nThis server-side sample code project analyzes a receipt to help the app determine entitlement by systematically examining all potential subscription states that affect service entitlement, such as offers periods and billing states. The output from this sample’s REST API endpoints is a response that indicates whether the app can enable service or needs to perform other steps to retain or communicate with customers. You can extend this code and customize the response based on your own business logic. The sample code contains two endpoints:\n\n### Configure the sample code project\n\nFollow these steps to run the sample code project:\n\n### Send a request using sample receipt data\n\nThe requests to the service entitlement engine take JSON data from a receipt. The data must be in the same JSON format that you receive by calling the `\/verifyReceipt` endpoint when you pass it a valid receipt. The example file `flatJSONExample` in the `Source\/Example` directory contains sample receipt data in the correct format for the requests.\n\nTo run the request, switch to the second Terminal window and type the following `curl` command. Replace the `<FLAT JSON DATA>` with the `flatJSONExample`.\n\nIf the mocked JSON receipt data is in the correct format, the response contains the analyzed data the entitlement engine produces based on the receipt data.\n\nIf you have real receipt data, replace the `<FLAT JSON DATA>` in the command with your receipt data.\n\n### Receive the sample response\n\nThe response contains the result of the engine’s analysis of the receipt data. Use it to determine whether a customer has the necessary entitlements to service, offers, or other messaging. The response object contains an array of subscription objects organized by product ID, each containing fields that provide insights for that subscription.\n\nThe following example response shows a customer who was previously subscribed and then resubscribed. The customer is in state 5, which indicates an active subscription with autorenew still in an enabled state.\n\nIn this case, the sample app issues an offer for a yearly subscription to the customer because they’re in state `5`, and they have a history of seven total renewals.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/StoreKit\/determining-service-entitlement-on-the-server\ncrawled: 2025-12-02T15:32:29Z\n---\n\n# Determining service entitlement on the server\n\n**Sample Code**\n\nIdentify a customer’s entitlement to your service, offers, and messaging by analyzing a validated receipt and the state of their subscription.\n\n## Overview\n\n\n\nWhen your app provides a subscription service, you receive data in the form of in-app receipts and App Store server notifications that provide a subscription’s state. After reading this data, your app determines whether to allow or restrict the user’s access to service, products, offers, and messages.\n\nThis server-side sample code project analyzes a receipt to help the app determine entitlement by systematically examining all potential subscription states that affect service entitlement, such as offers periods and billing states. The output from this sample’s REST API endpoints is a response that indicates whether the app can enable service or needs to perform other steps to retain or communicate with customers. You can extend this code and customize the response based on your own business logic. The sample code contains two endpoints:\n\n- URL: `localhost:3000\/simulate` — Use `\/simulate` for testing using real or artificial receipts. This endpoint requires no special configuration.\n- URL: `localhost:3000\/entitle` — Use `\/entitle` with real Base64-encoded receipts. This endpoint requires additional configuration.\n\n### Configure the sample code project\n\nFollow these steps to run the sample code project:\n\n1. Install the latest stable version of Node.js.\n2. Open the Terminal app (`\/Applications\/Utilities`).\n3. Navigate to the sample code `\/Sample` directory.\n4. In Terminal, enter `npm install` and press Return. Make sure it completes successfully.\n5. In Terminal, copy the example environment file: `cp env.example`.\n6. In Terminal, enter `npm start` and press Return to start the server. The server runs in your Terminal window. To stop the server, press Control-C while in Terminal.\n7. In Terminal, choose Shell > New Windows > New Window with Profile to open a second Teminal window to use to send the requests.\n\n### Send a request using sample receipt data\n\nThe requests to the service entitlement engine take JSON data from a receipt. The data must be in the same JSON format that you receive by calling the `\/verifyReceipt` endpoint when you pass it a valid receipt. The example file `flatJSONExample` in the `Source\/Example` directory contains sample receipt data in the correct format for the requests.\n\nTo run the request, switch to the second Terminal window and type the following `curl` command. Replace the `<FLAT JSON DATA>` with the `flatJSONExample`.\n\n```swift\ncurl -XPOST -H \"Content-type: application\/json\" -d '<FLAT JSON DATA>' 'localhost:3000\/simulate'\n```\n\nIf the mocked JSON receipt data is in the correct format, the response contains the analyzed data the entitlement engine produces based on the receipt data.\n\nIf you have real receipt data, replace the `<FLAT JSON DATA>` in the command with your receipt data.\n\n### Receive the sample response\n\nThe response contains the result of the engine’s analysis of the receipt data. Use it to determine whether a customer has the necessary entitlements to service, offers, or other messaging. The response object contains an array of subscription objects organized by product ID, each containing fields that provide insights for that subscription.\n\nThe following example response shows a customer who was previously subscribed and then resubscribed. The customer is in state 5, which indicates an active subscription with autorenew still in an enabled state.\n\n```swift\n{\n    \"products\": [\n        {\n            \"product_id\": \"com.example.monthly\",\n            \"entitlementCode\": 5,\n            \"expiration\": 1599391591000,\n            \"totalRenewals\": 7,\n            \"groupID\": \"13472270\",\n            \"originalTransactions\": [\n                {\n                    \"originalTX\": \"190000625698817\",\n                    \"start\": 1564455960000,\n                    \"expiration\": 1599391591000,\n                    \"renewals\": 7\n                }\n            ],\n            \"trialConsumed\": true\n        }\n    ],\n    \"trialConsumedForGroup\": [\n        \"13472270\"\n    ]\n}\n```\n\nIn this case, the sample app issues an offer for a yearly subscription to the customer because they’re in state `5`, and they have a history of seven total renewals.\n\n",
  "sections" : [

  ],
  "source" : "appleJSON",
  "title" : "Determining service entitlement on the server",
  "url" : "https:\/\/developer.apple.com\/documentation\/StoreKit\/determining-service-entitlement-on-the-server"
}