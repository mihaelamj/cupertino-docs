{
  "abstract" : "Verify that your app handles failed subscription renewals that are in the billing retry or billing grace period states, as well as failed In-App Purchases.",
  "codeExamples" : [

  ],
  "contentHash" : "056c8e7683fc117852c15564743d3fd555e4c5dbdb19cc70d2e5f9d761b9a20a",
  "crawledAt" : "2025-12-03T07:03:56Z",
  "id" : "4F30CBD1-FE50-486B-944A-2225B185B352",
  "kind" : "article",
  "language" : "swift",
  "module" : "StoreKit",
  "overview" : "## Overview\n\nPayments can fail unexpectedly at any stage of the billing cycle, such as when a payment card expires. Test your app’s user experience to ensure it handles these unexpected events, and provides appropriate levels of service when billing issues occur.\n\nIn sandbox testing, you can simulate billing issues that cause In-App Purchases to fail, and auto-renewable subscriptions not to renew. You can also enable Billing Grace Period for the sandbox environment. Use these sandbox features to test how your app handles auto-renewable subscriptions with billing issues that do or don’t recover.\n\nThe sandbox environment sends [doc:\/\/com.apple.documentation\/documentation\/AppStoreServerNotifications] as you perform tests. For more information, see [doc:\/\/com.apple.documentation\/documentation\/AppStoreServerNotifications\/enabling-app-store-server-notifications].\n\nThe sandbox environment renews auto-renewable subscriptions up to 12 times. For more information about renewal rates in the sandbox environment, see [https:\/\/developer.apple.com\/help\/app-store-connect\/test-in-app-purchases\/manage-sandbox-apple-id-settings#edit-subscription-renewal-speed].\n\nFor more information about subscription state changes when billing issues occur, see [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/reducing-involuntary-subscriber-churn]. For information about how apps determine access to subscription content, see [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/handling-subscriptions-billing].\n\n### Configure the sandbox environment to simulate billing issues\n\nFollow these steps on a test device running iOS 16 or iPadOS 16, or later:\n\nDisabling this setting causes In-App Purchases to fail, and auto-renewable subscriptions to not renew in the sandbox environment.\n\nThis setting stays in a disabled state until you reenable it. Reenable it to simulate a customer resolving a billing issue.\n\n### Enable Billing Grace Period in the sandbox environment\n\nTo enable Billing Grace Period in the sandbox environment, log in to [https:\/\/appstoreconnect.apple.com\/login], and do the following:\n\nTo test billing issues for subscriptions with Billing Grace Period, first, purchase an auto-renewable subscription, and then configure the setting to simulate billing issues (as described above in [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/testing-failing-subscription-renewals-and-in-app-purchases#Configure-the-sandbox-environment-to-simulate-billing-issues]).\n\n### Test subscriptions that enter a billing retry state\n\nAuto-renewable subscriptions expire and enter a billing retry state when a subscription fails to auto-renew.\n\nThis test case assumes that Billing Grace Period is in a disabled state for the sandbox enviroment. To test subscriptions entering a billing retry state:\n\n### Test subscriptions that enter a billing grace period\n\nAuto-renewable subscriptions enter a billing grace period when both of the following occur:\n\nTo test subscriptions entering a billing grace period:\n\n### Test billing problem messaging after a subscription enters a billing retry state\n\nAuto-renewable subscriptions expire and enter a billing retry state when a subscription fails to auto-renew. The system displays a Billing Problem message when your app launches, unless your app chooses to delay the [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/Message\/Reason-swift.struct\/billingIssue] message. Use these steps to trigger the message and test how your app responds to the message in various views. For more information about managing these system messages, see [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/Message].\n\nTo test when the system presents the Billing Problem sheet after subscriptions enter the billing retry state:\n\nYou may perform this test with or without Billing Grace Period enabled.\n\n### Test subscriptions that recover from billing issues\n\nA subscription is *recovered* when a billing retry succeeds. It exits a billing retry or billing grace period state, and is active again.\n\nTo test recovered auto-renewable subscriptions, follow these steps:\n\nRepeat the test starting with a subscription in the billing grace period, as described above in [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/testing-failing-subscription-renewals-and-in-app-purchases#Test-subscriptions-that-enter-a-billing-grace-period].\n\nThe subscription billing cycle for a subscription that recovers from a billing retry state starts on the recovery date. The billing cycle for a subscription that recovers during a billing grace period doesn’t change.\n\n### Test subscriptions that don’t recover from billing issues\n\nSubscriptions exit a billing retry state when any of the following happens:\n\nTo test subscriptions that expire and don’t recover, follow these steps:\n\nTo test a subscription that a customer cancels, follow these steps:\n\nRepeat the test starting with a subscription in the billing retry state, as described above in [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/testing-failing-subscription-renewals-and-in-app-purchases#Test-subscriptions-that-enter-a-billing-retry-state].\n\n### Test a failed In-App Purchase\n\nTo test a failed purchase attempt, follow these steps:",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/StoreKit\/testing-failing-subscription-renewals-and-in-app-purchases\ncrawled: 2025-12-03T07:03:56Z\n---\n\n# Testing failing subscription renewals and In-App Purchases\n\n**Article**\n\nVerify that your app handles failed subscription renewals that are in the billing retry or billing grace period states, as well as failed In-App Purchases.\n\n## Overview\n\nPayments can fail unexpectedly at any stage of the billing cycle, such as when a payment card expires. Test your app’s user experience to ensure it handles these unexpected events, and provides appropriate levels of service when billing issues occur.\n\nIn sandbox testing, you can simulate billing issues that cause In-App Purchases to fail, and auto-renewable subscriptions not to renew. You can also enable Billing Grace Period for the sandbox environment. Use these sandbox features to test how your app handles auto-renewable subscriptions with billing issues that do or don’t recover.\n\nThe sandbox environment sends [doc:\/\/com.apple.documentation\/documentation\/AppStoreServerNotifications] as you perform tests. For more information, see [doc:\/\/com.apple.documentation\/documentation\/AppStoreServerNotifications\/enabling-app-store-server-notifications].\n\nThe sandbox environment renews auto-renewable subscriptions up to 12 times. For more information about renewal rates in the sandbox environment, see [https:\/\/developer.apple.com\/help\/app-store-connect\/test-in-app-purchases\/manage-sandbox-apple-id-settings#edit-subscription-renewal-speed].\n\nFor more information about subscription state changes when billing issues occur, see [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/reducing-involuntary-subscriber-churn]. For information about how apps determine access to subscription content, see [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/handling-subscriptions-billing].\n\n### Configure the sandbox environment to simulate billing issues\n\nFollow these steps on a test device running iOS 16 or iPadOS 16, or later:\n\n1. Sign in to the App Store using a Sandbox Apple Account.\n2. Choose Settings > Developer > Sandbox Account > Manage > Account Settings.\n3. Disable the Allow Purchases & Renewals setting.\n\nDisabling this setting causes In-App Purchases to fail, and auto-renewable subscriptions to not renew in the sandbox environment.\n\n\n\nThis setting stays in a disabled state until you reenable it. Reenable it to simulate a customer resolving a billing issue.\n\n### Enable Billing Grace Period in the sandbox environment\n\nTo enable Billing Grace Period in the sandbox environment, log in to [https:\/\/appstoreconnect.apple.com\/login], and do the following:\n\n1. From My Apps, select your app.\n2. In the sidebar under Features, click Subscriptions.\n3. In the Billing Grace Period section, click Set Up Billing Grace Period.\n4. Select a duration from the drop-down menu.\n5. Select whether to apply the grace period to all renewals or to only paid-to-paid renewals. For more information about the configurable settings, see [https:\/\/developer.apple.com\/help\/app-store-connect\/manage-subscriptions\/enable-billing-grace-period-for-auto-renewable-subscriptions].\n6. Select Only Sandbox Environment to enable Billing Grace Period for testing only.\n7. Click Next.\n8. Click Confirm.\n\nTo test billing issues for subscriptions with Billing Grace Period, first, purchase an auto-renewable subscription, and then configure the setting to simulate billing issues (as described above in [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/testing-failing-subscription-renewals-and-in-app-purchases#Configure-the-sandbox-environment-to-simulate-billing-issues]).\n\n### Test subscriptions that enter a billing retry state\n\nAuto-renewable subscriptions expire and enter a billing retry state when a subscription fails to auto-renew.\n\nThis test case assumes that Billing Grace Period is in a disabled state for the sandbox enviroment. To test subscriptions entering a billing retry state:\n\n1. Successfully purchase an auto-renewable subscription in your app.\n2. Set the environment to simulate billing issues, as described above in [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/testing-failing-subscription-renewals-and-in-app-purchases#Configure-the-sandbox-environment-to-simulate-billing-issues].\n3. Wait for the subscription period to renew. The renewal fails, and it enters a billing retry state.\n4. Check that your app recognizes the state. Subscriptions in a billing retry state that aren’t in a billing grace period are not entitled to service. StoreKit provides the [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/Product\/SubscriptionInfo\/RenewalInfo\/isInBillingRetry] value in the [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/Product\/SubscriptionInfo\/RenewalState] object.\n\n### Test subscriptions that enter a billing grace period\n\nAuto-renewable subscriptions enter a billing grace period when both of the following occur:\n\n- Billing Grace Period is enabled for your app\n- The subscription fails to auto-renew\n\nTo test subscriptions entering a billing grace period:\n\n1. Follow the steps as described above in [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/testing-failing-subscription-renewals-and-in-app-purchases#Enable-Billing-Grace-Period-in-the-sandbox-environment].\n2. Successfully purchase an auto-renewable subscription in your app.\n3. Set the environment to simulate billing issues, as described above in [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/testing-failing-subscription-renewals-and-in-app-purchases#Configure-the-sandbox-environment-to-simulate-billing-issues].\n4. Wait for the subscription period to renew. The subscription enters the billing grace period.\n5. Check that your app recognizes the state and provides service for the subscription during the billing grace period. StoreKit provides the grace period expiration date in the [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/Product\/SubscriptionInfo\/RenewalInfo\/gracePeriodExpirationDate] property of the [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/Product\/SubscriptionInfo\/RenewalInfo] object.\n6. Wait for the billing grace period to expire. The subscription remains in the billing retry state.\n7. Check that your app recognizes the billing retry state. Subscriptions aren’t entitled to service after the billing grace period expires.\n\n\n\n### Test billing problem messaging after a subscription enters a billing retry state\n\nAuto-renewable subscriptions expire and enter a billing retry state when a subscription fails to auto-renew. The system displays a Billing Problem message when your app launches, unless your app chooses to delay the [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/Message\/Reason-swift.struct\/billingIssue] message. Use these steps to trigger the message and test how your app responds to the message in various views. For more information about managing these system messages, see [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/Message].\n\nTo test when the system presents the Billing Problem sheet after subscriptions enter the billing retry state:\n\n1. Successfully purchase an auto-renewable subscription in your app.\n2. Set the environment to simulate billing issues, as described above in [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/testing-failing-subscription-renewals-and-in-app-purchases#Configure-the-sandbox-environment-to-simulate-billing-issues].\n3. Wait for the subscription period to renew. The renewal fails, and enters a billing retry state.\n4. The App Store sends the [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/Message\/Reason-swift.struct\/billingIssue] message. Launch the app or bring it to the foreground.\n5. If your app doesn’t implement [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/Message\/messages-swift.type.property], the system presents the Billing Problem sheet.\n6. If your app implements [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/Message\/messages-swift.type.property] and delays the message, perform the steps your app requires for it to call [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/Message\/display(in:)]. As long as the billing issue is still active, the system presents the Billing Problem sheet. If you resolve the billing issue before the app calls [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/Message\/display(in:)], the system doesn’t present the sheet.\n\nYou may perform this test with or without Billing Grace Period enabled.\n\n### Test subscriptions that recover from billing issues\n\nA subscription is *recovered* when a billing retry succeeds. It exits a billing retry or billing grace period state, and is active again.\n\nTo test recovered auto-renewable subscriptions, follow these steps:\n\n1. Start with a subscription in the billing retry state, as described above in [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/testing-failing-subscription-renewals-and-in-app-purchases#Test-subscriptions-that-enter-a-billing-retry-state].\n2. Choose Settings > Developer > Sandbox Account > Manage > Account Settings, and enable the Allow Purchases & Renewals setting, which causes the next subscription renewal attempt to succeed.\n3. Check that your app recognizes the active subscription state, which is entitled to service.\n\nRepeat the test starting with a subscription in the billing grace period, as described above in [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/testing-failing-subscription-renewals-and-in-app-purchases#Test-subscriptions-that-enter-a-billing-grace-period].\n\nThe subscription billing cycle for a subscription that recovers from a billing retry state starts on the recovery date. The billing cycle for a subscription that recovers during a billing grace period doesn’t change.\n\n### Test subscriptions that don’t recover from billing issues\n\nSubscriptions exit a billing retry state when any of the following happens:\n\n- The billing retry period expires without recovering the subscription.\n- The customer cancels the subscription.\n- The subscription is recovered because billing succeeds.\n\nTo test subscriptions that expire and don’t recover, follow these steps:\n\n1. Start with a subscription in a billing retry state, as described above in [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/testing-failing-subscription-renewals-and-in-app-purchases#Test-subscriptions-that-enter-a-billing-retry-state].\n2. Wait for the billing retry period to expire — don’t enable the Allow Purchases & Renewals setting.\n3. Check that your app recognizes the subscription state. The subscription is inactive and not entitled to service.\n\nTo test a subscription that a customer cancels, follow these steps:\n\n1. Start with a subscription in a billing grace period, as described above in [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/testing-failing-subscription-renewals-and-in-app-purchases#Test-subscriptions-that-enter-a-billing-grace-period].\n2. Cancel the subscription by managing subscriptions in Settings, or by using your app’s implementation of [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/AppStore\/showManageSubscriptions(in:)]. For more information about managing subscriptions in Settings, see [https:\/\/support.apple.com\/en-gb\/HT202039].\n3. The system immediately cancels the subscription.\n4. Check that your app recognizes the subscription state. The subscription is inactive and not entitled to service.\n\nRepeat the test starting with a subscription in the billing retry state, as described above in [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/testing-failing-subscription-renewals-and-in-app-purchases#Test-subscriptions-that-enter-a-billing-retry-state].\n\n### Test a failed In-App Purchase\n\nTo test a failed purchase attempt, follow these steps:\n\n1. Set the environment to simulate billing issues, as described above in [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/testing-failing-subscription-renewals-and-in-app-purchases#Configure-the-sandbox-environment-to-simulate-billing-issues].\n2. In your app, attempt to buy an In-App Purchase product. The system displays an error message for the sandbox environment that shows the purchase failed.\n3. To continue testing billing issues, select OK. Alternatively, to simulate a user resolving a billing issue, select Settings to return to Account Settings, where you can enable Allow Purchases & Renewals.\n\n## Payment transactions\n\n- **Testing purchases made outside your app**: Verify that your app receives and handles transactions that occur outside your app, such as subscription purchases, renewals, and offer and promo code redemptions.\n- **Testing win-back offers in the sandbox environment**: Verify that your app receives and handles win-back offer transactions, including those made outside your app.\n- **Testing an interrupted purchase**: Verify that your app handles an interrupted purchase by inspecting and invoking payment transactions.\n- **Testing a payment request**: Verify that requests for payment function properly in the sandbox environment by inspecting the calls to the payment transaction observer.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Verify that your app receives and handles transactions that occur outside your app, such as subscription purchases, renewals, and offer and promo code redemptions.",
          "name" : "Testing purchases made outside your app",
          "url" : "https:\/\/developer.apple.com\/documentation\/StoreKit\/testing-purchases-made-outside-your-app"
        },
        {
          "description" : "Verify that your app receives and handles win-back offer transactions, including those made outside your app.",
          "name" : "Testing win-back offers in the sandbox environment",
          "url" : "https:\/\/developer.apple.com\/documentation\/StoreKit\/testing-win-back-offers-in-the-sandbox-environment"
        },
        {
          "description" : "Verify that your app handles an interrupted purchase by inspecting and invoking payment transactions.",
          "name" : "Testing an interrupted purchase",
          "url" : "https:\/\/developer.apple.com\/documentation\/StoreKit\/testing-an-interrupted-purchase"
        },
        {
          "description" : "Verify that requests for payment function properly in the sandbox environment by inspecting the calls to the payment transaction observer.",
          "name" : "Testing a payment request",
          "url" : "https:\/\/developer.apple.com\/documentation\/StoreKit\/testing-a-payment-request"
        }
      ],
      "title" : "Payment transactions"
    }
  ],
  "source" : "appleJSON",
  "title" : "Testing failing subscription renewals and In-App Purchases",
  "url" : "https:\/\/developer.apple.com\/documentation\/StoreKit\/testing-failing-subscription-renewals-and-in-app-purchases"
}