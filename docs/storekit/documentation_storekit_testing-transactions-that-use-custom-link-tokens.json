{
  "abstract" : "Recognize custom link tokens that your app receives in the sandbox testing environment, and use them to test reporting transactions.",
  "codeExamples" : [

  ],
  "contentHash" : "267247b72ea24ae8f949fb786d88e86be9441e8aa5d2fc3ce3cf05cc49858460",
  "crawledAt" : "2025-12-02T06:30:55Z",
  "id" : "D7DB0C83-AFF5-4B52-BE83-3BAF70544F40",
  "kind" : "article",
  "module" : "StoreKit",
  "overview" : "## Overview\n\nWhen you test your app in the sandbox environment, the External Purchase API returns tokens that are valid only in that environment. These tokens have an [doc:\/\/com.apple.documentation\/documentation\/ExternalPurchaseServerAPI\/externalPurchaseId] that starts with the string `SANDBOX`. For more information about the token format, see [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/receiving-and-decoding-external-purchase-tokens].\n\nApps running in the sandbox environment need to satisfy the same requirements as they do in the production environment to receive external purchase tokens, including that they:\n\n### Handle custom link tokens in the sandbox environment\n\nThe [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/ExternalPurchaseCustomLink] API generates custom link tokens, which have a token type and an expiration date. There are two possible token types, `ACQUISITION` and `SERVICES`. Your app requests a token by calling the [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/ExternalPurchaseCustomLink\/token(for:)] method and specifying the token type. The first time you request a token in the sandbox environment, the system creates the token and initiates an *active token period*.\n\nApps can request tokens again at any time. If there’s an active token period, the system returns the token that corresponds to that active period. The returned token can be identical to the original token, or it can be a *refreshed* token. A refreshed token has the same creation and expiration dates as the original token, but a different `externalPurchaseId`. Use either an original token or a refreshed token to report transactions.\n\nThere’s a maximum of one active token period for `ACQUISITION` tokens, for each Sandbox Apple Account, for each app. After the `ACQUISITION` token expires, the Sandbox Apple Account can’t receive another `ACQUISITION` token for the same app. This reflects the behavior in the production environment, where apps have a maximum of one active period for the `ACQUISITION` token for each customer. To repeat tests for this token type after it expires, use another Sandbox Apple Account.\n\nAfter a `SERVICES` token period expires, your app can request a new `SERVICES` token and you can continue testing. The new token has a new creation and expiration date, and starts a new active token period.\n\n### Test reporting tokens on your server\n\nTo test your server’s token reporting implementation, send reports for sandbox tokens to the Sandbox URL of the [doc:\/\/com.apple.documentation\/documentation\/ExternalPurchaseServerAPI\/Send-External-Purchase-Report] endpoint. For more information about reporting tokens, see [doc:\/\/com.apple.documentation\/documentation\/ExternalPurchaseServerAPI].\n\nTo report transactions, you can use any token for the customer that’s active (not expired) at the time of the transaction.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/StoreKit\/testing-transactions-that-use-custom-link-tokens\ncrawled: 2025-12-02T06:30:55Z\n---\n\n# Testing transactions that use custom link tokens\n\n**Article**\n\nRecognize custom link tokens that your app receives in the sandbox testing environment, and use them to test reporting transactions.\n\n## Overview\n\nWhen you test your app in the sandbox environment, the External Purchase API returns tokens that are valid only in that environment. These tokens have an [doc:\/\/com.apple.documentation\/documentation\/ExternalPurchaseServerAPI\/externalPurchaseId] that starts with the string `SANDBOX`. For more information about the token format, see [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/receiving-and-decoding-external-purchase-tokens].\n\nApps running in the sandbox environment need to satisfy the same requirements as they do in the production environment to receive external purchase tokens, including that they:\n\n- Have either of these entitlements, [doc:\/\/com.apple.documentation\/documentation\/BundleResources\/Entitlements\/com.apple.developer.storekit.external-purchase-link] or  [doc:\/\/com.apple.documentation\/documentation\/BundleResources\/Entitlements\/com.apple.developer.storekit.external-purchase-link-streaming]\n- Configure the associated property list key, [doc:\/\/com.apple.documentation\/documentation\/BundleResources\/Information-Property-List\/SKExternalPurchaseCustomLinkRegions] or [doc:\/\/com.apple.documentation\/documentation\/BundleResources\/Information-Property-List\/SKExternalPurchaseLinkStreamingRegions]\n- Check their eligibility to use the [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/external-purchase] API at runtime, with [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/ExternalPurchaseCustomLink\/isEligible] and [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/AppStore\/canMakePayments]\n\n### Handle custom link tokens in the sandbox environment\n\nThe [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/ExternalPurchaseCustomLink] API generates custom link tokens, which have a token type and an expiration date. There are two possible token types, `ACQUISITION` and `SERVICES`. Your app requests a token by calling the [doc:\/\/com.apple.storekit\/documentation\/StoreKit\/ExternalPurchaseCustomLink\/token(for:)] method and specifying the token type. The first time you request a token in the sandbox environment, the system creates the token and initiates an *active token period*.\n\n\n\nApps can request tokens again at any time. If there’s an active token period, the system returns the token that corresponds to that active period. The returned token can be identical to the original token, or it can be a *refreshed* token. A refreshed token has the same creation and expiration dates as the original token, but a different `externalPurchaseId`. Use either an original token or a refreshed token to report transactions.\n\nThere’s a maximum of one active token period for `ACQUISITION` tokens, for each Sandbox Apple Account, for each app. After the `ACQUISITION` token expires, the Sandbox Apple Account can’t receive another `ACQUISITION` token for the same app. This reflects the behavior in the production environment, where apps have a maximum of one active period for the `ACQUISITION` token for each customer. To repeat tests for this token type after it expires, use another Sandbox Apple Account.\n\nAfter a `SERVICES` token period expires, your app can request a new `SERVICES` token and you can continue testing. The new token has a new creation and expiration date, and starts a new active token period.\n\n### Test reporting tokens on your server\n\nTo test your server’s token reporting implementation, send reports for sandbox tokens to the Sandbox URL of the [doc:\/\/com.apple.documentation\/documentation\/ExternalPurchaseServerAPI\/Send-External-Purchase-Report] endpoint. For more information about reporting tokens, see [doc:\/\/com.apple.documentation\/documentation\/ExternalPurchaseServerAPI].\n\nTo report transactions, you can use any token for the customer that’s active (not expired) at the time of the transaction.\n\n## Communicating and promoting offers\n\n- **ExternalPurchaseCustomLink**: Enables qualifying apps to offer custom links for external purchases and use alternative payment service providers.\n- **ExternalPurchaseCustomLink.Token**: A token you use with the External Purchase custom link API.\n- **com.apple.developer.storekit.external-purchase-link**: A Boolean value that indicates whether your app can include a link that directs people to a website to make an external purchase.\n- **SKExternalPurchaseCustomLinkRegions**: An array of country code strings that indicate the regions where your app supports custom links for the communication and promotion of offers.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Enables qualifying apps to offer custom links for external purchases and use alternative payment service providers.",
          "name" : "ExternalPurchaseCustomLink",
          "url" : "https:\/\/developer.apple.com\/documentation\/StoreKit\/ExternalPurchaseCustomLink"
        },
        {
          "description" : "A token you use with the External Purchase custom link API.",
          "name" : "ExternalPurchaseCustomLink.Token",
          "url" : "https:\/\/developer.apple.com\/documentation\/StoreKit\/ExternalPurchaseCustomLink\/Token"
        },
        {
          "description" : "A Boolean value that indicates whether your app can include a link that directs people to a website to make an external purchase.",
          "name" : "com.apple.developer.storekit.external-purchase-link",
          "url" : "https:\/\/developer.apple.com\/documentation\/BundleResources\/Entitlements\/com.apple.developer.storekit.external-purchase-link"
        },
        {
          "description" : "An array of country code strings that indicate the regions where your app supports custom links for the communication and promotion of offers.",
          "name" : "SKExternalPurchaseCustomLinkRegions",
          "url" : "https:\/\/developer.apple.com\/documentation\/BundleResources\/Information-Property-List\/SKExternalPurchaseCustomLinkRegions"
        }
      ],
      "title" : "Communicating and promoting offers"
    }
  ],
  "source" : "appleJSON",
  "title" : "Testing transactions that use custom link tokens",
  "url" : "https:\/\/developer.apple.com\/documentation\/StoreKit\/testing-transactions-that-use-custom-link-tokens"
}