{
  "abstract" : "Ensure the validity of a postback you receive after an ad conversion by verifying its cryptographic signature.",
  "codeExamples" : [
    {
      "code" : "import CryptoKit\nimport Foundation\n\nenum PublicKeyError: Error {\n    case unknownKeyID\n    case invalidPublicKey\n}\n\nfunc getPublicKey(forKeyID keyID: String) throws -> P256.Signing.PublicKey {\n    let publicKeyBase64: String\n    switch keyID {\n    case \"apple-cas-identifier\/0\":\n        publicKeyBase64 = \"MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEWdp8GPcGqmhgzEFj9Z2nSpQVddayaPe4FMzqM9wib1+aHaaIzoHoLN9zW4K8y4SPykE3YVK3sVqW6Af0lfx3gg==\"\n    case \"apple-development-identifier\/0\":\n        publicKeyBase64 = \"MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAELeEDzpJEP+\/qRSE5hJVC1p1J0ssUnQGMzBBbvnACBok8OVGGLgxL0myrKiy6lvRtSlLRsWit87i+vftD8AEqeQ==\"\n    case \"apple-development-identifier\/1\":\n        publicKeyBase64 = \"MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAE8YzdO7eM97s\/IJ25kdW5CZ3A14USE5IJ5Ha\/vhWaxI6UBI1ZxCEvjrKxVluVGe6qWwF1BDFq+QHqKfH5u+wxHQ==\"\n    default:\n        throw PublicKeyError.unknownKeyID\n    }\n\n    guard let publicKeyData = Data(base64Encoded: publicKeyBase64) else {\n        throw PublicKeyError.invalidPublicKey\n    }\n    return try P256.Signing.PublicKey(derRepresentation: publicKeyData)\n}",
      "language" : "swift"
    }
  ],
  "contentHash" : "36446c0c2c41e1f418d2f59096b836af709dd5d911cc8403d86fb06454ee1b9c",
  "crawledAt" : "2025-12-02T15:58:02Z",
  "id" : "55E6E7CC-9208-42D1-89B7-203CA22EC3E3",
  "kind" : "article",
  "language" : "swift",
  "module" : "AdAttributionKit",
  "overview" : "## Overview\n\nPostbacks contain data that validate an ad conversion. You need to verify the postback signature to make sure that Apple signed it before you count the conversion. Follow these steps to validate the postback:\n\n## Receive the postback\n\nDevices send postbacks to ad networks and developers within a defined timeframe after a conversion event occurs and the advertised app updates the conversion value at least once. Ad networks receive postbacks at the URL they provide when they register to use AdAttributionKit. Developers who opt in receive copies of winning postbacks at the URL they configure in the app’s property list key, `AttributionCopyEndpoint`. For more information about setting up your postback URL, see [doc:\/\/com.apple.AdAttributionKit\/documentation\/AdAttributionKit\/registering-an-ad-network] and [doc:\/\/com.apple.AdAttributionKit\/documentation\/AdAttributionKit\/configuring-an-advertised-app]. For more information about the timeframe for receiving attribution, see [doc:\/\/com.apple.AdAttributionKit\/documentation\/AdAttributionKit\/receiving-ad-attributions-and-postbacks]. You may receive postbacks in three conversion windows. For more information, see [doc:\/\/com.apple.AdAttributionKit\/documentation\/AdAttributionKit\/receiving-postbacks-in-multiple-conversion-windows].\n\n## Verify Apple’s signature\n\nApple signs postbacks with a different key depending on the environment and whether the system creates the postbacks in an end-to-end flow or in developer settings.\n\nFor production flows, always use the production key to validate that Apple generated the postbacks. Ignore postbacks that don’t pass signature validation in production flows.\n\nYou can also validate postback signatures in development environments, whether you’re testing an end-to-end flow or generating postbacks directly from the developer settings.\n\nDetermine which NIST P-256 public key you need from the list below:\n\nThe following code demonstrates how to determine which public key to use, depending on the `kid` property you receive in the postback’s JWS header:\n\nTo verify a signature, follow these steps:\n\nIf your verification passes, the postback is valid.\n\n## Verify the JWS components\n\nThe JWS components include the following:\n\n## Respond to the postback\n\nWhen you receive a postback, respond with an HTTP 200 OK status code. If the device receives a 500 status code, it attempts to send the postback up to nine times over a maximum of 9 days.\n\n## Count unique messages only\n\nUse the `postback-identifier` value to ensure that you’re counting unique ad conversions. If you receive more than one postback with the same `postback-identifier`, discard the duplicate report.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/AdAttributionKit\/verifying-a-postback\ncrawled: 2025-12-02T15:58:02Z\n---\n\n# Verifying a postback\n\n**Article**\n\nEnsure the validity of a postback you receive after an ad conversion by verifying its cryptographic signature.\n\n## Overview\n\nPostbacks contain data that validate an ad conversion. You need to verify the postback signature to make sure that Apple signed it before you count the conversion. Follow these steps to validate the postback:\n\n1. Receive the postback at a URL you configure.\n2. Respond to the postback request when you receive it.\n3. Validate the JSON Web Signature (JWS) by verifying its signature.\n4. Count only unique postbacks with signatures you verify. Check the did-win parameter to learn whether the postback represents a winning attribution.\n\n## Receive the postback\n\nDevices send postbacks to ad networks and developers within a defined timeframe after a conversion event occurs and the advertised app updates the conversion value at least once. Ad networks receive postbacks at the URL they provide when they register to use AdAttributionKit. Developers who opt in receive copies of winning postbacks at the URL they configure in the app’s property list key, `AttributionCopyEndpoint`. For more information about setting up your postback URL, see [doc:\/\/com.apple.AdAttributionKit\/documentation\/AdAttributionKit\/registering-an-ad-network] and [doc:\/\/com.apple.AdAttributionKit\/documentation\/AdAttributionKit\/configuring-an-advertised-app]. For more information about the timeframe for receiving attribution, see [doc:\/\/com.apple.AdAttributionKit\/documentation\/AdAttributionKit\/receiving-ad-attributions-and-postbacks]. You may receive postbacks in three conversion windows. For more information, see [doc:\/\/com.apple.AdAttributionKit\/documentation\/AdAttributionKit\/receiving-postbacks-in-multiple-conversion-windows].\n\n## Verify Apple’s signature\n\nApple signs postbacks with a different key depending on the environment and whether the system creates the postbacks in an end-to-end flow or in developer settings.\n\nFor production flows, always use the production key to validate that Apple generated the postbacks. Ignore postbacks that don’t pass signature validation in production flows.\n\nYou can also validate postback signatures in development environments, whether you’re testing an end-to-end flow or generating postbacks directly from the developer settings.\n\nDetermine which NIST P-256 public key you need from the list below:\n\n- To validate production postbacks:\n\n**Key identifier**: apple-cas-identifier\/0\n\n**Base64-encoded key**: `MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEWdp8GPcGqmhgzEFj9Z2nSpQVddayaPe4FMzqM9wib1+aHaaIzoHoLN9zW4K8y4SPykE3YVK3sVqW6Af0lfx3gg==`\n- To validate development postbacks the system creates from end-to-end flows:\n\n**Key identifier**: apple-development-identifier\/0\n\n**Base64-encoded key**: `MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAELeEDzpJEP+\/qRSE5hJVC1p1J0ssUnQGMzBBbvnACBok8OVGGLgxL0myrKiy6lvRtSlLRsWit87i+vftD8AEqeQ==`\n- To validate development postbacks the system generates from developer settings:\n\n**Key identifier**: apple-development-identifier\/1\n\n**Base64-encoded key**: `MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAE8YzdO7eM97s\/IJ25kdW5CZ3A14USE5IJ5Ha\/vhWaxI6UBI1ZxCEvjrKxVluVGe6qWwF1BDFq+QHqKfH5u+wxHQ==`\n\nThe following code demonstrates how to determine which public key to use, depending on the `kid` property you receive in the postback’s JWS header:\n\n```swift\nimport CryptoKit\nimport Foundation\n\nenum PublicKeyError: Error {\n    case unknownKeyID\n    case invalidPublicKey\n}\n\nfunc getPublicKey(forKeyID keyID: String) throws -> P256.Signing.PublicKey {\n    let publicKeyBase64: String\n    switch keyID {\n    case \"apple-cas-identifier\/0\":\n        publicKeyBase64 = \"MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEWdp8GPcGqmhgzEFj9Z2nSpQVddayaPe4FMzqM9wib1+aHaaIzoHoLN9zW4K8y4SPykE3YVK3sVqW6Af0lfx3gg==\"\n    case \"apple-development-identifier\/0\":\n        publicKeyBase64 = \"MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAELeEDzpJEP+\/qRSE5hJVC1p1J0ssUnQGMzBBbvnACBok8OVGGLgxL0myrKiy6lvRtSlLRsWit87i+vftD8AEqeQ==\"\n    case \"apple-development-identifier\/1\":\n        publicKeyBase64 = \"MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAE8YzdO7eM97s\/IJ25kdW5CZ3A14USE5IJ5Ha\/vhWaxI6UBI1ZxCEvjrKxVluVGe6qWwF1BDFq+QHqKfH5u+wxHQ==\"\n    default:\n        throw PublicKeyError.unknownKeyID\n    }\n\n    guard let publicKeyData = Data(base64Encoded: publicKeyBase64) else {\n        throw PublicKeyError.invalidPublicKey\n    }\n    return try P256.Signing.PublicKey(derRepresentation: publicKeyData)\n}\n```\n\nTo verify a signature, follow these steps:\n\n1. Decode Apple’s public key, which appears as a Base64-encoded string above. The result is a byte array in DER format.\n2. Create an X.509 standard public key from the DER byte array.\n3. Use the public key to verify the signature of the JWS using the outlined process in [https:\/\/datatracker.ietf.org\/doc\/html\/rfc7515#section-5.2].\n\nIf your verification passes, the postback is valid.\n\n\n\n## Verify the JWS components\n\nThe JWS components include the following:\n\n- A header that has `alg` and `kid` parameters.\n- A payload that contains the `impression-type`, `ad-network-identifier`, `source-identifier`, `advertised-item-identifier`, `conversion-type`, `postback-identifier`, `did-win`, and `postback-sequence-index` properties, as well as the `marketplace-identifier` and `publisher-item-identifier` properties, both of which are optional.\n- The signature that Apple generates, which is the last component of the JWS.\n\n## Respond to the postback\n\nWhen you receive a postback, respond with an HTTP 200 OK status code. If the device receives a 500 status code, it attempts to send the postback up to nine times over a maximum of 9 days.\n\n## Count unique messages only\n\nUse the `postback-identifier` value to ensure that you’re counting unique ad conversions. If you receive more than one postback with the same `postback-identifier`, discard the duplicate report.\n\n## Postback verification and parameter identification\n\n- **Identifying the parameters in a postback**: Interpret postback properties to understand the attribution report.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Interpret postback properties to understand the attribution report.",
          "name" : "Identifying the parameters in a postback",
          "url" : "https:\/\/developer.apple.com\/documentation\/AdAttributionKit\/identifying-the-parameters-in-a-postback"
        }
      ],
      "title" : "Postback verification and parameter identification"
    }
  ],
  "source" : "appleJSON",
  "title" : "Verifying a postback",
  "url" : "https:\/\/developer.apple.com\/documentation\/AdAttributionKit\/verifying-a-postback"
}