{
  "abstract" : "Modify an updatable Core ML model by running an update task with labeled data.",
  "codeExamples" : [
    {
      "code" : " var featureProviders = [MLFeatureProvider]()\n\n let inputName = \"drawing\"\n let outputName = \"label\"\n         \n for drawing in trainingDrawings {\n     let inputValue = drawing.featureValue\n     let outputValue = MLFeatureValue(string: String(emoji))\n     \n     let dataPointFeatures: [String: MLFeatureValue] = [inputName: inputValue,\n                                                        outputName: outputValue]\n     \n     if let provider = try? MLDictionaryFeatureProvider(dictionary: dataPointFeatures) {\n         featureProviders.append(provider)\n     }\n }\n \nreturn MLArrayBatchProvider(array: featureProviders)",
      "language" : "swift"
    },
    {
      "code" : "let imageFeatureValue = try? MLFeatureValue(cgImage: preparedImage,\n                                            constraint: imageConstraint)\nreturn imageFeatureValue!",
      "language" : "swift"
    },
    {
      "code" : "\/\/\/ - Tag: ImageConstraintProperty\nextension UpdatableDrawingClassifier {\n    \/\/\/ Returns the image constraint for the model's \"drawing\" input feature.\n    var imageConstraint: MLImageConstraint {\n        let description = model.modelDescription\n        \n        let inputName = \"drawing\"\n        let imageInputDescription = description.inputDescriptionsByName[inputName]!\n        \n        return imageInputDescription.imageConstraint!\n    }\n}",
      "language" : "swift"
    },
    {
      "code" : "\/\/ Create an Update Task.\nguard let updateTask = try? MLUpdateTask(forModelAt: url,\n                                   trainingData: trainingData,\n                                   configuration: nil,\n                                   completionHandler: completionHandler)\n    else {\n        print(\"Could't create an MLUpdateTask.\")\n        return\n}",
      "language" : "swift"
    },
    {
      "code" : "updateTask.resume()",
      "language" : "swift"
    },
    {
      "code" : "let updatedModel = updateContext.model\nlet fileManager = FileManager.default\ndo {\n    \/\/ Create a directory for the updated model.\n    try fileManager.createDirectory(at: tempUpdatedModelURL,\n                                    withIntermediateDirectories: true,\n                                    attributes: nil)\n    \n    \/\/ Save the updated model to temporary filename.\n    try updatedModel.write(to: tempUpdatedModelURL)\n    \n    \/\/ Replace any previously updated model with this one.\n    _ = try fileManager.replaceItemAt(updatedModelURL,\n                                      withItemAt: tempUpdatedModelURL)\n    \n    print(\"Updated model saved to:\\n\\t\\(updatedModelURL)\")\n} catch let error {\n    print(\"Could not save updated model to the file system: \\(error)\")\n    return\n}",
      "language" : "swift"
    },
    {
      "code" : "guard FileManager.default.fileExists(atPath: updatedModelURL.path) else {\n    \/\/ The updated model is not present at its designated path.\n    return\n}\n\n\/\/ Create an instance of the updated model.\nguard let model = try? UpdatableDrawingClassifier(contentsOf: updatedModelURL) else {\n    return\n}\n\n\/\/ Use this updated model to make predictions in the future.\nupdatedDrawingClassifier = model",
      "language" : "swift"
    }
  ],
  "contentHash" : "f31b98ffb035da7cbc8d21099289a4530ee68bbe739b5dd0b1bd1486d32400f5",
  "crawledAt" : "2025-12-02T15:48:27Z",
  "id" : "ACCF2F4D-A86C-4551-B32F-507D735D82F6",
  "kind" : "unknown",
  "language" : "swift",
  "module" : "Core ML",
  "overview" : "## Overview\n\nWith the [doc:\/\/com.apple.documentation\/documentation\/CoreML] framework, you can customize an updatable model at runtime on the user’s device. Using this technique, you can create a personalized experience for the user while keeping their data private.\n\nThis sample demonstrates how to update the drawing classifier with an [doc:\/\/com.apple.documentation\/documentation\/CoreML\/MLUpdateTask]. The app initiates an update task with the user’s drawings paired with a string label. Once the update is complete, the app uses the updated drawing classifier to recognize similar drawings from the user and convert each into its associated string label.\n\n### Prepare your model update data\n\nGather your training data:\n\nEach time the user adds a new emoji sticker, the app prompts the user to make three drawings, and uses those drawings to update the drawing classifier. It does this by first creating an [doc:\/\/com.apple.documentation\/documentation\/CoreML\/MLDictionaryFeatureProvider] that contains the feature values for a drawing and its label. The app appends each feature provider to an array, which it uses to create an [doc:\/\/com.apple.documentation\/documentation\/CoreML\/MLArrayBatchProvider] at the end of the function.\n\nThe sample makes each `MLDictionaryFeatureProvider` by initializing it with a dictionary of two [doc:\/\/com.apple.documentation\/documentation\/CoreML\/MLFeatureValue] instances keyed by strings. The feature values are:\n\nThe sample creates a feature value for the emoji string by using [doc:\/\/com.apple.documentation\/documentation\/CoreML\/MLFeatureValue\/init(string:)]. However, to convert the drawing’s underlying [doc:\/\/com.apple.documentation\/documentation\/CoreGraphics\/CGImage] into a feature value, the sample acquires the image constraint of the model’s image input feature.\n\nThe sample gets the drawing classifier’s `\"drawing\"` [doc:\/\/com.apple.documentation\/documentation\/CoreML\/MLImageConstraint] by inspecting the [doc:\/\/com.apple.documentation\/documentation\/CoreML\/MLModelDescription].\n\n### Create an update task\n\nYou create an [doc:\/\/com.apple.documentation\/documentation\/CoreML\/MLUpdateTask] by passing the following to an initializer:\n\nThe sample updates the drawing classifier model it’s currently using, which could be the original drawing classifier model or a previously updated model.\n\n### Run the update task\n\nYou begin an update task by calling its [doc:\/\/com.apple.documentation\/documentation\/CoreML\/MLTask\/resume()] method.\n\n[doc:\/\/com.apple.documentation\/documentation\/CoreML] updates the model on a separate thread and calls your completion handler when it finishes the update process.\n\n### Save the updated model\n\nUse your completion handler to save the updated model in the [doc:\/\/com.apple.documentation\/documentation\/CoreML\/MLUpdateContext] to disk. The sample saves the updated model to the file system by first writing the model to a temporary location. Next, the sample moves the updated model to a permanent location, replacing any previously saved updated model.\n\n### Load the updated model\n\nUse your updated model by loading it with the model’s [doc:\/\/com.apple.documentation\/documentation\/CoreML\/MLModel\/init(contentsOf:)] initializer. The sample loads a new instance of `UpdatableDrawingClassifier` with the [doc:\/\/com.apple.documentation\/documentation\/Foundation\/URL] of the updated model file the app saved in the previous step.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/CoreML\/personalizing-a-model-with-on-device-updates\ncrawled: 2025-12-02T15:48:27Z\n---\n\n# Personalizing a Model with On-Device Updates\n\n**Sample Code**\n\nModify an updatable Core ML model by running an update task with labeled data.\n\n## Overview\n\nWith the [doc:\/\/com.apple.documentation\/documentation\/CoreML] framework, you can customize an updatable model at runtime on the user’s device. Using this technique, you can create a personalized experience for the user while keeping their data private.\n\nThis sample demonstrates how to update the drawing classifier with an [doc:\/\/com.apple.documentation\/documentation\/CoreML\/MLUpdateTask]. The app initiates an update task with the user’s drawings paired with a string label. Once the update is complete, the app uses the updated drawing classifier to recognize similar drawings from the user and convert each into its associated string label.\n\n\n\n### Prepare your model update data\n\nGather your training data:\n\n1. Wrap each value of a datapoint in an [doc:\/\/com.apple.documentation\/documentation\/CoreML\/MLFeatureValue], one for each model input and output.\n2. Group all the feature values for a datapoint in an [doc:\/\/com.apple.documentation\/documentation\/CoreML\/MLFeatureProvider].\n3. Group all the feature providers in an [doc:\/\/com.apple.documentation\/documentation\/CoreML\/MLBatchProvider].\n\nEach time the user adds a new emoji sticker, the app prompts the user to make three drawings, and uses those drawings to update the drawing classifier. It does this by first creating an [doc:\/\/com.apple.documentation\/documentation\/CoreML\/MLDictionaryFeatureProvider] that contains the feature values for a drawing and its label. The app appends each feature provider to an array, which it uses to create an [doc:\/\/com.apple.documentation\/documentation\/CoreML\/MLArrayBatchProvider] at the end of the function.\n\n```swift\n var featureProviders = [MLFeatureProvider]()\n\n let inputName = \"drawing\"\n let outputName = \"label\"\n         \n for drawing in trainingDrawings {\n     let inputValue = drawing.featureValue\n     let outputValue = MLFeatureValue(string: String(emoji))\n     \n     let dataPointFeatures: [String: MLFeatureValue] = [inputName: inputValue,\n                                                        outputName: outputValue]\n     \n     if let provider = try? MLDictionaryFeatureProvider(dictionary: dataPointFeatures) {\n         featureProviders.append(provider)\n     }\n }\n \nreturn MLArrayBatchProvider(array: featureProviders)\n```\n\nThe sample makes each `MLDictionaryFeatureProvider` by initializing it with a dictionary of two [doc:\/\/com.apple.documentation\/documentation\/CoreML\/MLFeatureValue] instances keyed by strings. The feature values are:\n\n- The underlying image of the drawing keyed by `\"drawing\"`\n- The emoji character as a string keyed by `\"label\"`\n\nThe sample creates a feature value for the emoji string by using [doc:\/\/com.apple.documentation\/documentation\/CoreML\/MLFeatureValue\/init(string:)]. However, to convert the drawing’s underlying [doc:\/\/com.apple.documentation\/documentation\/CoreGraphics\/CGImage] into a feature value, the sample acquires the image constraint of the model’s image input feature.\n\n```swift\nlet imageFeatureValue = try? MLFeatureValue(cgImage: preparedImage,\n                                            constraint: imageConstraint)\nreturn imageFeatureValue!\n```\n\nThe sample gets the drawing classifier’s `\"drawing\"` [doc:\/\/com.apple.documentation\/documentation\/CoreML\/MLImageConstraint] by inspecting the [doc:\/\/com.apple.documentation\/documentation\/CoreML\/MLModelDescription].\n\n```swift\n\/\/\/ - Tag: ImageConstraintProperty\nextension UpdatableDrawingClassifier {\n    \/\/\/ Returns the image constraint for the model's \"drawing\" input feature.\n    var imageConstraint: MLImageConstraint {\n        let description = model.modelDescription\n        \n        let inputName = \"drawing\"\n        let imageInputDescription = description.inputDescriptionsByName[inputName]!\n        \n        return imageInputDescription.imageConstraint!\n    }\n}\n```\n\n### Create an update task\n\nYou create an [doc:\/\/com.apple.documentation\/documentation\/CoreML\/MLUpdateTask] by passing the following to an initializer:\n\n- An [doc:\/\/com.apple.documentation\/documentation\/CoreML\/MLBatchProvider] that contains your update data\n- The location of the compiled model youʼd like to update (*ModelName*`.mlmodelc`)\n- An [doc:\/\/com.apple.documentation\/documentation\/CoreML\/MLModelConfiguration], if applicable\n- A completion handler with a single [doc:\/\/com.apple.documentation\/documentation\/CoreML\/MLUpdateContext] parameter\n\nThe sample updates the drawing classifier model it’s currently using, which could be the original drawing classifier model or a previously updated model.\n\n```swift\n\/\/ Create an Update Task.\nguard let updateTask = try? MLUpdateTask(forModelAt: url,\n                                   trainingData: trainingData,\n                                   configuration: nil,\n                                   completionHandler: completionHandler)\n    else {\n        print(\"Could't create an MLUpdateTask.\")\n        return\n}\n```\n\n\n\n### Run the update task\n\nYou begin an update task by calling its [doc:\/\/com.apple.documentation\/documentation\/CoreML\/MLTask\/resume()] method.\n\n```swift\nupdateTask.resume()\n```\n\n[doc:\/\/com.apple.documentation\/documentation\/CoreML] updates the model on a separate thread and calls your completion handler when it finishes the update process.\n\n### Save the updated model\n\nUse your completion handler to save the updated model in the [doc:\/\/com.apple.documentation\/documentation\/CoreML\/MLUpdateContext] to disk. The sample saves the updated model to the file system by first writing the model to a temporary location. Next, the sample moves the updated model to a permanent location, replacing any previously saved updated model.\n\n```swift\nlet updatedModel = updateContext.model\nlet fileManager = FileManager.default\ndo {\n    \/\/ Create a directory for the updated model.\n    try fileManager.createDirectory(at: tempUpdatedModelURL,\n                                    withIntermediateDirectories: true,\n                                    attributes: nil)\n    \n    \/\/ Save the updated model to temporary filename.\n    try updatedModel.write(to: tempUpdatedModelURL)\n    \n    \/\/ Replace any previously updated model with this one.\n    _ = try fileManager.replaceItemAt(updatedModelURL,\n                                      withItemAt: tempUpdatedModelURL)\n    \n    print(\"Updated model saved to:\\n\\t\\(updatedModelURL)\")\n} catch let error {\n    print(\"Could not save updated model to the file system: \\(error)\")\n    return\n}\n```\n\n### Load the updated model\n\nUse your updated model by loading it with the model’s [doc:\/\/com.apple.documentation\/documentation\/CoreML\/MLModel\/init(contentsOf:)] initializer. The sample loads a new instance of `UpdatableDrawingClassifier` with the [doc:\/\/com.apple.documentation\/documentation\/Foundation\/URL] of the updated model file the app saved in the previous step.\n\n```swift\nguard FileManager.default.fileExists(atPath: updatedModelURL.path) else {\n    \/\/ The updated model is not present at its designated path.\n    return\n}\n\n\/\/ Create an instance of the updated model.\nguard let model = try? UpdatableDrawingClassifier(contentsOf: updatedModelURL) else {\n    return\n}\n\n\/\/ Use this updated model to make predictions in the future.\nupdatedDrawingClassifier = model\n```\n\n## On-device model updates\n\n- **MLTask**: An abstract base class for machine learning tasks.\n- **MLUpdateTask**: A task that updates a model with additional training data.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "An abstract base class for machine learning tasks.",
          "name" : "MLTask",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreML\/MLTask"
        },
        {
          "description" : "A task that updates a model with additional training data.",
          "name" : "MLUpdateTask",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreML\/MLUpdateTask"
        }
      ],
      "title" : "On-device model updates"
    }
  ],
  "source" : "appleJSON",
  "title" : "Personalizing a Model with On-Device Updates",
  "url" : "https:\/\/developer.apple.com\/documentation\/CoreML\/personalizing-a-model-with-on-device-updates"
}