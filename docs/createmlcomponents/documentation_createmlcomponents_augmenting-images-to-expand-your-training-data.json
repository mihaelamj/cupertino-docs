{
  "abstract" : "Improve your model by using transformed versions of your training images.",
  "codeExamples" : [
    {
      "code" : "let augmenter = Augmenter {\n    ApplyRandomly(probability: 0.5) {\n        ImageFlipper(orientation: .horizontal)\n    }\n    RandomImageCropper(scale: 0.8 ..< 0.9, aspectRatio: 1.0)\n}",
      "language" : "swift"
    },
    {
      "code" : "let augmenter = Augmenter {\n    ApplyRandomly(probability: 0.5) {\n        ImageFlipper(orientation: .horizontal)\n    }\n    UniformRandomFloatingPointParameter(range: -10.0 ... 10.0) { angle in\n        ImageRotator(angle: angle * .pi \/ 180)\n    }\n    RandomImageCropper(scale: 0.8 ..< 0.9, aspectRatio: 1.0)\n}",
      "language" : "swift"
    },
    {
      "code" : "let augmentedTrainingData = augmenter.applied(to: trainingData)",
      "language" : "swift"
    },
    {
      "code" : "let augmentedTrainingData = augmenter.applied(\n   to: trainingData,\n   upsampledBy: 10\n)",
      "language" : "swift"
    },
    {
      "code" : "let reader = ImageReader().adaptedAsAnnotatedFeatureTransformer(annotationType: String.self)\nlet trainingImages = try await reader.applied(to: trainingFiles)\nlet validationImages = try await reader.applied(to: validationFiles)",
      "language" : "swift"
    },
    {
      "code" : "let featurePrint = ImageFeaturePrint(revision: 2)\nlet classifier = FullyConnectedNetworkClassifier<Float, String>(labels: labels, configuration: configuration)\nlet task = featurePrint.appending(classifier)",
      "language" : "swift"
    },
    {
      "code" : "let augmenter = Augmenter {\n    ApplyRandomly(probability: 0.5) {\n        ImageFlipper(orientation: .horizontal)\n    }\n    UniformRandomFloatingPointParameter(range: -10.0 ... 10.0) { angle in\n        ImageRotator(angle: angle * .pi \/ 180)\n    }\n    RandomImageCropper(scale: 0.8 ..< 0.9, aspectRatio: 1.0)\n}",
      "language" : "swift"
    },
    {
      "code" : "var model = task.makeTransformer()\nfor iteration in 0 ..< 100 {\n    \/\/ Perform one training iteration.\n    let augmentedData = augmenter.applied(to: trainingImages.shuffled())\n    for try await batch in augmentedData.batches(ofSize: 32, dropsLastPartialBatch: false) {\n        try await task.update(&model, with: batch)\n    }\n\n    \/\/ Compute accuracy on validation data, stop when done.\n    \/\/ ...\n}",
      "language" : "swift"
    },
    {
      "code" : "var accuracies = [Double](repeating: 0, count 5)\nfor iteration in 0 ..< 100 {\n    \/\/ Perform one training iteration.\n    \/\/ ...\n\n    \/\/ Compute the accuracy on the validation data.\n    let predictions = try await model.prediction(from: validationImages)\n    let validationMetrics = ClassificationMetrics(\n        predictions.map(\\.prediction.mostLikelyLabel),\n        predictions.map(\\.annotation)\n    )\n    let validationAccuracy = validationMetrics.accuracy\n\n    \/\/ Save the accuracy in a circular buffer.\n    metrics[iteration % accuracies.count] = validationAccuracy\n\n    \/\/ Stop when there has been no significant improvement in the last 5 iterations.\n    if accuracies.allSatisfy({ $0 >= validationAccuracy - 0.01 }) {\n        break\n    }\n}",
      "language" : "swift"
    }
  ],
  "contentHash" : "918a8f198f76389271d71041d4bb561be0cbaae6c96ee2d4dce783febbbe944c",
  "crawledAt" : "2025-12-03T12:01:07Z",
  "id" : "DECAFFDF-F1F4-423C-B6EA-6932BB2738EE",
  "kind" : "article",
  "language" : "swift",
  "module" : "Create ML Components",
  "overview" : "## Overview\n\nTraining a good image model requires a variety of training images with different characteristics. If you’re training an image classifier to recognize flowers you can improve classification accuracy by providing flower photos with a variety of lighting conditions, angles, and backgrounds. However, collecting and labeling images is a time-consuming process.\n\nTo maximize the potential impact of your data you can use image augmentations. Augmenting images is the process of applying transformations such as flipping, cropping, resizing, adjusting brightness, adding noise, and so on. Image augmentations are not a replacement for a good image data set, but they help maximize the data set’s effectiveness. Each augmentation has the potential to multiply the size of your training data which is helpful when your training sample size is small.\n\n\n\nKeep in mind that performing augmentations has some drawbacks. You can’t reuse extracted features across training iterations because each iteration produces a new set of augmented images. This increase in training time can be significant. Augmentations have the most impact when your dataset is small relative to the number of parameters in your model.\n\n### Write an augmentation\n\nYou can use [doc:\/\/com.apple.createmlcomponents\/documentation\/CreateMLComponents\/Augmenter] to create a custom augmentation. The augmenter applies each transformer to each image in sequence. For example, this augmenter randomly flips (with 50% probability) and then randomly crops images:\n\nTo generate a random number each time, use [doc:\/\/com.apple.createmlcomponents\/documentation\/CreateMLComponents\/UniformRandomFloatingPointParameter]. You can use the random number with any transformer. For instance, to perform a slight rotation using [doc:\/\/com.apple.createmlcomponents\/documentation\/CreateMLComponents\/ImageRotator]:\n\n### Apply augmentations to your training data\n\nAfter you create an augmenter, you can use it to augment your training data. You do this with the [doc:\/\/com.apple.createmlcomponents\/documentation\/CreateMLComponents\/Augmenter\/applied(to:)] method:\n\nBecause augmentations are usually random, it makes sense to do more than one pass over your training data. Each pass results in a different set of images, for instance with different scale factors. You can control the number of passes by using the [doc:\/\/com.apple.createmlcomponents\/documentation\/CreateMLComponents\/Augmenter\/applied(to:upsampledBy:)] method. For instance, to get 10 times the number of images:\n\n### Train an image classifier\n\nYou can now use your augmented data set to train an image classifier. Because augmentations take images, not URLs, you may need to read your files first.\n\nNow that you have annotated images, the next step is to create your pipeline. For an image classifier, create a feature extractor and a classifier.\n\nNext, create the augmenter that transforms the training images.\n\nFinally, create a model, apply the augmenter to the training data, and progressively train the model using [doc:\/\/com.apple.createmlcomponents\/documentation\/CreateMLComponents\/UpdatableSupervisedEstimator\/update(_:with:eventHandler:)]. The following example applies the `augmenter` to the `trainingImages` and updates the `model` up to 100 times:\n\nThe example above applies the `augmenter` to shuffled images. Shuffling images creates more variation, which helps prevent over-fitting. The example breaks the data into batches after each augmentation, and updates the model with each `batch`. Using a smaller batch size typically produces a better model, while using a larger batch size can speed up training.\n\n### Stop training\n\nTraining your model progressively using the [doc:\/\/com.apple.createmlcomponents\/documentation\/CreateMLComponents\/UpdatableSupervisedEstimator\/update(_:with:eventHandler:)] method lets you control when to stop training. Stop training when the validation accuracy stops improving, for example:",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/createmlcomponents\/augmenting-images-to-expand-your-training-data\ncrawled: 2025-12-03T12:01:07Z\n---\n\n# Augmenting images to expand your training data\n\n**Article**\n\nImprove your model by using transformed versions of your training images.\n\n## Overview\n\nTraining a good image model requires a variety of training images with different characteristics. If you’re training an image classifier to recognize flowers you can improve classification accuracy by providing flower photos with a variety of lighting conditions, angles, and backgrounds. However, collecting and labeling images is a time-consuming process.\n\nTo maximize the potential impact of your data you can use image augmentations. Augmenting images is the process of applying transformations such as flipping, cropping, resizing, adjusting brightness, adding noise, and so on. Image augmentations are not a replacement for a good image data set, but they help maximize the data set’s effectiveness. Each augmentation has the potential to multiply the size of your training data which is helpful when your training sample size is small.\n\n\n\nKeep in mind that performing augmentations has some drawbacks. You can’t reuse extracted features across training iterations because each iteration produces a new set of augmented images. This increase in training time can be significant. Augmentations have the most impact when your dataset is small relative to the number of parameters in your model.\n\n### Write an augmentation\n\nYou can use [doc:\/\/com.apple.createmlcomponents\/documentation\/CreateMLComponents\/Augmenter] to create a custom augmentation. The augmenter applies each transformer to each image in sequence. For example, this augmenter randomly flips (with 50% probability) and then randomly crops images:\n\n```swift\nlet augmenter = Augmenter {\n    ApplyRandomly(probability: 0.5) {\n        ImageFlipper(orientation: .horizontal)\n    }\n    RandomImageCropper(scale: 0.8 ..< 0.9, aspectRatio: 1.0)\n}\n```\n\nTo generate a random number each time, use [doc:\/\/com.apple.createmlcomponents\/documentation\/CreateMLComponents\/UniformRandomFloatingPointParameter]. You can use the random number with any transformer. For instance, to perform a slight rotation using [doc:\/\/com.apple.createmlcomponents\/documentation\/CreateMLComponents\/ImageRotator]:\n\n```swift\nlet augmenter = Augmenter {\n    ApplyRandomly(probability: 0.5) {\n        ImageFlipper(orientation: .horizontal)\n    }\n    UniformRandomFloatingPointParameter(range: -10.0 ... 10.0) { angle in\n        ImageRotator(angle: angle * .pi \/ 180)\n    }\n    RandomImageCropper(scale: 0.8 ..< 0.9, aspectRatio: 1.0)\n}\n```\n\n### Apply augmentations to your training data\n\nAfter you create an augmenter, you can use it to augment your training data. You do this with the [doc:\/\/com.apple.createmlcomponents\/documentation\/CreateMLComponents\/Augmenter\/applied(to:)] method:\n\n```swift\nlet augmentedTrainingData = augmenter.applied(to: trainingData)\n```\n\nBecause augmentations are usually random, it makes sense to do more than one pass over your training data. Each pass results in a different set of images, for instance with different scale factors. You can control the number of passes by using the [doc:\/\/com.apple.createmlcomponents\/documentation\/CreateMLComponents\/Augmenter\/applied(to:upsampledBy:)] method. For instance, to get 10 times the number of images:\n\n```swift\nlet augmentedTrainingData = augmenter.applied(\n   to: trainingData,\n   upsampledBy: 10\n)\n```\n\n\n\n### Train an image classifier\n\nYou can now use your augmented data set to train an image classifier. Because augmentations take images, not URLs, you may need to read your files first.\n\n```swift\nlet reader = ImageReader().adaptedAsAnnotatedFeatureTransformer(annotationType: String.self)\nlet trainingImages = try await reader.applied(to: trainingFiles)\nlet validationImages = try await reader.applied(to: validationFiles)\n```\n\nNow that you have annotated images, the next step is to create your pipeline. For an image classifier, create a feature extractor and a classifier.\n\n```swift\nlet featurePrint = ImageFeaturePrint(revision: 2)\nlet classifier = FullyConnectedNetworkClassifier<Float, String>(labels: labels, configuration: configuration)\nlet task = featurePrint.appending(classifier)\n```\n\nNext, create the augmenter that transforms the training images.\n\n```swift\nlet augmenter = Augmenter {\n    ApplyRandomly(probability: 0.5) {\n        ImageFlipper(orientation: .horizontal)\n    }\n    UniformRandomFloatingPointParameter(range: -10.0 ... 10.0) { angle in\n        ImageRotator(angle: angle * .pi \/ 180)\n    }\n    RandomImageCropper(scale: 0.8 ..< 0.9, aspectRatio: 1.0)\n}\n```\n\nFinally, create a model, apply the augmenter to the training data, and progressively train the model using [doc:\/\/com.apple.createmlcomponents\/documentation\/CreateMLComponents\/UpdatableSupervisedEstimator\/update(_:with:eventHandler:)]. The following example applies the `augmenter` to the `trainingImages` and updates the `model` up to 100 times:\n\n```swift\nvar model = task.makeTransformer()\nfor iteration in 0 ..< 100 {\n    \/\/ Perform one training iteration.\n    let augmentedData = augmenter.applied(to: trainingImages.shuffled())\n    for try await batch in augmentedData.batches(ofSize: 32, dropsLastPartialBatch: false) {\n        try await task.update(&model, with: batch)\n    }\n\n    \/\/ Compute accuracy on validation data, stop when done.\n    \/\/ ...\n}\n```\n\nThe example above applies the `augmenter` to shuffled images. Shuffling images creates more variation, which helps prevent over-fitting. The example breaks the data into batches after each augmentation, and updates the model with each `batch`. Using a smaller batch size typically produces a better model, while using a larger batch size can speed up training.\n\n\n\n### Stop training\n\nTraining your model progressively using the [doc:\/\/com.apple.createmlcomponents\/documentation\/CreateMLComponents\/UpdatableSupervisedEstimator\/update(_:with:eventHandler:)] method lets you control when to stop training. Stop training when the validation accuracy stops improving, for example:\n\n```swift\nvar accuracies = [Double](repeating: 0, count 5)\nfor iteration in 0 ..< 100 {\n    \/\/ Perform one training iteration.\n    \/\/ ...\n\n    \/\/ Compute the accuracy on the validation data.\n    let predictions = try await model.prediction(from: validationImages)\n    let validationMetrics = ClassificationMetrics(\n        predictions.map(\\.prediction.mostLikelyLabel),\n        predictions.map(\\.annotation)\n    )\n    let validationAccuracy = validationMetrics.accuracy\n\n    \/\/ Save the accuracy in a circular buffer.\n    metrics[iteration % accuracies.count] = validationAccuracy\n\n    \/\/ Stop when there has been no significant improvement in the last 5 iterations.\n    if accuracies.allSatisfy({ $0 >= validationAccuracy - 0.01 }) {\n        break\n    }\n}\n```\n\n## Related Documentation\n\n- **Augmenter**: An augmenter.\n- **ApplyEachRandomly**: Applies each transformer randomly given a probability.\n- **ApplyRandomly**: Randomly applies the transformer with the given probability.\n- **ChooseRandomly**: Apply single transformation randomly chosen from a list of transformers.\n- **RandomImageCropper**: Crops an image at a random location.\n- **RandomTransformer**: A transformer that takes an input and a random number generator and produces a randomized output.\n- **ShuffleRandomly**: Apply transformations in a random order.\n- **UniformRandomFloatingPointParameter**: Applies the transformer with a randomly generated input parameter.\n- **UniformRandomIntegerParameter**: Applies the transformer with a randomly generated input parameter.\n\n## Image components\n\n- **Creating a multi-label image classifier**: Train a machine learning model to assign multiple labels to an image.\n- **ImageReader**: An image file reader.\n- **ImageFeatureExtractor**: A transformer that takes an image and outputs image features.\n- **ImageCropper**: An image crop transformer.\n- **ImageScaler**: An image scaling transformer.\n- **ImageFeaturePrint**: ImageFeaturePrint image feature extractor.\n- **ImageBlur**: An image blurring transformer.\n- **ImageColorTransformer**: An image color transformer.\n- **ImageExposureAdjuster**: An image exposure adjusting transformer.\n- **ImageFlipper**: An image flipper transformer.\n- **ImageRotator**: An image rotating transformer.\n- **RandomImageNoiseGenerator**: A transformer that adds random noise to an image.\n- **MLModelImageFeatureExtractor**: An image feature extractor provided by an MLModel.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "An augmenter.",
          "name" : "Augmenter",
          "url" : "https:\/\/developer.apple.com\/documentation\/CreateMLComponents\/Augmenter"
        },
        {
          "description" : "Applies each transformer randomly given a probability.",
          "name" : "ApplyEachRandomly",
          "url" : "https:\/\/developer.apple.com\/documentation\/CreateMLComponents\/ApplyEachRandomly"
        },
        {
          "description" : "Randomly applies the transformer with the given probability.",
          "name" : "ApplyRandomly",
          "url" : "https:\/\/developer.apple.com\/documentation\/CreateMLComponents\/ApplyRandomly"
        },
        {
          "description" : "Apply single transformation randomly chosen from a list of transformers.",
          "name" : "ChooseRandomly",
          "url" : "https:\/\/developer.apple.com\/documentation\/CreateMLComponents\/ChooseRandomly"
        },
        {
          "description" : "Crops an image at a random location.",
          "name" : "RandomImageCropper",
          "url" : "https:\/\/developer.apple.com\/documentation\/CreateMLComponents\/RandomImageCropper"
        },
        {
          "description" : "A transformer that takes an input and a random number generator and produces a randomized output.",
          "name" : "RandomTransformer",
          "url" : "https:\/\/developer.apple.com\/documentation\/CreateMLComponents\/RandomTransformer"
        },
        {
          "description" : "Apply transformations in a random order.",
          "name" : "ShuffleRandomly",
          "url" : "https:\/\/developer.apple.com\/documentation\/CreateMLComponents\/ShuffleRandomly"
        },
        {
          "description" : "Applies the transformer with a randomly generated input parameter.",
          "name" : "UniformRandomFloatingPointParameter",
          "url" : "https:\/\/developer.apple.com\/documentation\/CreateMLComponents\/UniformRandomFloatingPointParameter"
        },
        {
          "description" : "Applies the transformer with a randomly generated input parameter.",
          "name" : "UniformRandomIntegerParameter",
          "url" : "https:\/\/developer.apple.com\/documentation\/CreateMLComponents\/UniformRandomIntegerParameter"
        }
      ],
      "title" : "Related Documentation"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "Train a machine learning model to assign multiple labels to an image.",
          "name" : "Creating a multi-label image classifier",
          "url" : "https:\/\/developer.apple.com\/documentation\/CreateMLComponents\/creating-a-multi-label-image-classifier"
        },
        {
          "description" : "An image file reader.",
          "name" : "ImageReader",
          "url" : "https:\/\/developer.apple.com\/documentation\/CreateMLComponents\/ImageReader"
        },
        {
          "description" : "A transformer that takes an image and outputs image features.",
          "name" : "ImageFeatureExtractor",
          "url" : "https:\/\/developer.apple.com\/documentation\/CreateMLComponents\/ImageFeatureExtractor"
        },
        {
          "description" : "An image crop transformer.",
          "name" : "ImageCropper",
          "url" : "https:\/\/developer.apple.com\/documentation\/CreateMLComponents\/ImageCropper"
        },
        {
          "description" : "An image scaling transformer.",
          "name" : "ImageScaler",
          "url" : "https:\/\/developer.apple.com\/documentation\/CreateMLComponents\/ImageScaler"
        },
        {
          "description" : "ImageFeaturePrint image feature extractor.",
          "name" : "ImageFeaturePrint",
          "url" : "https:\/\/developer.apple.com\/documentation\/CreateMLComponents\/ImageFeaturePrint"
        },
        {
          "description" : "An image blurring transformer.",
          "name" : "ImageBlur",
          "url" : "https:\/\/developer.apple.com\/documentation\/CreateMLComponents\/ImageBlur"
        },
        {
          "description" : "An image color transformer.",
          "name" : "ImageColorTransformer",
          "url" : "https:\/\/developer.apple.com\/documentation\/CreateMLComponents\/ImageColorTransformer"
        },
        {
          "description" : "An image exposure adjusting transformer.",
          "name" : "ImageExposureAdjuster",
          "url" : "https:\/\/developer.apple.com\/documentation\/CreateMLComponents\/ImageExposureAdjuster"
        },
        {
          "description" : "An image flipper transformer.",
          "name" : "ImageFlipper",
          "url" : "https:\/\/developer.apple.com\/documentation\/CreateMLComponents\/ImageFlipper"
        },
        {
          "description" : "An image rotating transformer.",
          "name" : "ImageRotator",
          "url" : "https:\/\/developer.apple.com\/documentation\/CreateMLComponents\/ImageRotator"
        },
        {
          "description" : "A transformer that adds random noise to an image.",
          "name" : "RandomImageNoiseGenerator",
          "url" : "https:\/\/developer.apple.com\/documentation\/CreateMLComponents\/RandomImageNoiseGenerator"
        },
        {
          "description" : "An image feature extractor provided by an MLModel.",
          "name" : "MLModelImageFeatureExtractor",
          "url" : "https:\/\/developer.apple.com\/documentation\/CreateMLComponents\/MLModelImageFeatureExtractor"
        }
      ],
      "title" : "Image components"
    }
  ],
  "source" : "appleJSON",
  "title" : "Augmenting images to expand your training data",
  "url" : "https:\/\/developer.apple.com\/documentation\/createmlcomponents\/augmenting-images-to-expand-your-training-data"
}