{
  "abstract" : "Configure a compression session to optimize encoding for video-conferencing apps.",
  "codeExamples" : [
    {
      "code" : "\/\/ Set `kVTVideoEncoderSpecification_EnableLowLatencyRateControl` in encoder\n\/\/ specification when creating a compression session to request low-latency\n\/\/ rate control.\nlet videoEncoderSpecification = [kVTVideoEncoderSpecification_EnableLowLatencyRateControl: true as CFBoolean] as CFDictionary\n\n\/\/ Specify the pixel format of the uncompressed video.\nlet sourceImageBufferAttributes = [kCVPixelBufferPixelFormatTypeKey: options.pixelFormat as CFNumber] as CFDictionary\n\nvar compressionSessionOut: VTCompressionSession?\nlet err = VTCompressionSessionCreate(allocator: kCFAllocatorDefault,\n                                     width: Int32(options.destWidth),\n                                     height: Int32(options.destHeight),\n                                     codecType: options.codec,\n                                     encoderSpecification: videoEncoderSpecification,\n                                     imageBufferAttributes: sourceImageBufferAttributes,\n                                     compressedDataAllocator: nil,\n                                     outputCallback: nil,\n                                     refcon: nil,\n                                     compressionSessionOut: &compressionSessionOut)\nguard err == noErr, let compressionSession = compressionSessionOut else {\n    throw RuntimeError(\"VTCompressionSession creation failed (\\(err))!\")\n}",
      "language" : "swift"
    },
    {
      "code" : "\/\/\/ Get the suggested encoder settings dictionary for encode preset.\n\/\/\/ - Parameters:\n\/\/\/   - session: A compression session.\n\/\/\/   - encodePreset: The `EncodePreset` enumeration.\nprivate func getEncoderSettingsForPreset(session: VTCompressionSession, encodePreset: EncodePreset) -> [CFString: Any]? {\n    var supportedPresetDictionaries: CFDictionary?\n    var encoderSettings: [CFString: Any]?\n\n    _ = withUnsafeMutablePointer(to: &supportedPresetDictionaries) { valueOut in\n        VTSessionCopyProperty( session, key: kVTCompressionPropertyKey_SupportedPresetDictionaries,\n                               allocator: kCFAllocatorDefault, valueOut: valueOut )\n    }\n\n    if let presetDictionaries = supportedPresetDictionaries as? [CFString: [CFString: Any]] {\n        let presetConstant = switch encodePreset {\n        case .videoConferencing: kVTCompressionPreset_VideoConferencing\n        }\n\n        encoderSettings = presetDictionaries[presetConstant]\n    }\n\n    return encoderSettings\n}",
      "language" : "swift"
    },
    {
      "code" : "\/\/\/ Configures a compression session for low-latency conferencing.\n\/\/\/ - Parameters:\n\/\/\/   - session: A compression session.\n\/\/\/   - options: The configuration options.\n\/\/\/   - expectedFrameRate: The expected frame rate of the video source.\nprivate func configureVTCompressionSession(session: VTCompressionSession, options: Options, expectedFrameRate: Float) throws {\n    \/\/ Different encoder implementations may support different property sets, so\n    \/\/ the app needs to determine the implications of a failed property setting\n    \/\/ on a case-by-case basis for the encoder. If the property is essential for\n    \/\/ the use case and its setting fails, the app terminates. Otherwise, the\n    \/\/ encoder ignores the failed setting and uses a default value to proceed\n    \/\/ with encoding.\n\n    var err: OSStatus = noErr\n    var variableBitRateMode = false\n\n    if let presetTuple = options.presetTuple {\n        \/\/ Try configuring the encoder using the preset.\n        let encoderSettings: [CFString: Any]?\n        encoderSettings = getEncoderSettingsForPreset(session: session, encodePreset: presetTuple.0)\n\n        if let encoderSettings {\n            if encoderSettings[kVTCompressionPropertyKey_VariableBitRate] != nil {\n                variableBitRateMode = true\n            }\n\n            \/\/ Set the encoder settings dictionary on the compression session.\n            err = VTSessionSetProperties(session, propertyDictionary: encoderSettings as CFDictionary)\n            try NSError.check(err, \"VTSessionSetProperties failed\")\n        }\n    }\n\n    \/\/ Indicate real-time compression session, which conferencing requires.\n    err = VTSessionSetProperty(session, key: kVTCompressionPropertyKey_RealTime, value: kCFBooleanTrue)\n    if err != noErr {\n        print(\"Warning: VTSessionSetProperty(kVTCompressionPropertyKey_RealTime) failed (\\(err))\")\n    }\n\n    \/\/ Indicate the expected frame rate, if known. This is just a hint for rate\n    \/\/ control purposes; the actual encoding frame rate matches the incoming\n    \/\/ frame rate even if it doesn't match this setting. When\n    \/\/ `kVTCompressionPropertyKey_RealTime` is `kCFBooleanTrue`, the video\n    \/\/ encoder may optimize energy usage.\n    err = VTSessionSetProperty(session, key: kVTCompressionPropertyKey_ExpectedFrameRate, value: expectedFrameRate as CFNumber)\n    if err != noErr {\n        print(\"Warning: VTSessionSetProperty(kVTCompressionPropertyKey_ExpectedFrameRate) failed (\\(err))\")\n    }\n\n    \/\/ Specify the profile and level for the encoded bitstream.\n    if let profileTuple = options.profileTuple {\n        var profileConstant: CFString?\n\n        if options.codec == kCMVideoCodecType_H264 {\n            if profileTuple.0 == .h264Main {\n                profileConstant = kVTProfileLevel_H264_Main_AutoLevel\n            } else if profileTuple.0 == .h264High {\n                profileConstant = kVTProfileLevel_H264_High_AutoLevel\n            }\n        } else if options.codec == kCMVideoCodecType_HEVC {\n            if profileTuple.0 == .hevcMain {\n                profileConstant = kVTProfileLevel_HEVC_Main_AutoLevel\n            } else if profileTuple.0 == .hevcMain10 {\n                profileConstant = kVTProfileLevel_HEVC_Main10_AutoLevel\n            }\n        }\n\n        if let profileConstant {\n            err = VTSessionSetProperty(session, key: kVTCompressionPropertyKey_ProfileLevel, value: profileConstant)\n            if err != noErr {\n                print(\"Warning: VTSessionSetProperty(kVTCompressionPropertyKey_ProfileLevel) failed (\\(err))\")\n            }\n        }\n    }\n\n    if let destBitRate = options.destBitRate {\n        if variableBitRateMode {\n            \/\/ Specify the long-term desired variable bit rate in bits per second.\n            err = VTSessionSetProperty(session, key: kVTCompressionPropertyKey_VariableBitRate, value: destBitRate as CFNumber)\n            if err != noErr {\n                print(\"Warning: VTSessionSetProperty(kVTCompressionPropertyKey_VariableBitRate) failed (\\(err))\")\n            }\n\n            \/\/ Set VBV maximum bit rate.\n            err = VTSessionSetProperty(session, key: kVTCompressionPropertyKey_VBVMaxBitRate, value: (destBitRate * 3 \/ 2) as CFNumber)\n            if err != noErr {\n                print(\"Warning: VTSessionSetProperty(kVTCompressionPropertyKey_VBVMaxBitRate) failed (\\(err))\")\n            }\n        } else {\n            \/\/ Specify the long-term desired average bit rate in bits per second.\n            \/\/ It's a soft limit, so the encoder may overshoot or undershoot and\n            \/\/ the average bit rate of the output video may be over or under the\n            \/\/ target.\n            err = VTSessionSetProperty(session, key: kVTCompressionPropertyKey_AverageBitRate, value: destBitRate as CFNumber)\n            if err != noErr {\n                print(\"Warning: VTSessionSetProperty(kVTCompressionPropertyKey_AverageBitRate) failed (\\(err))\")\n            }\n        }\n    }\n}",
      "language" : "swift"
    }
  ],
  "contentHash" : "46cb41421dbb059ddcf8e606e3278529c27eda19e15983bf5c6c87d1e50c519c",
  "crawledAt" : "2025-12-02T15:50:01Z",
  "id" : "25CAE340-759B-4124-B723-4733A4C6EA5B",
  "kind" : "unknown",
  "language" : "swift",
  "module" : "Video Toolbox",
  "overview" : "## Overview\n\nThis sample code project demonstrates how to configure and use a `VTCompressionSession` object to encode video for low-latency conferencing.\n\n### Create a compression session\n\nCreate a `VTCompressionSession` object and specify the required dimensions and `codecType`. For low latency use, include the `kVTVideoEncoderSpecification_EnableLowLatencyRateControl` option and set it to `true` in the `videoEncoderSpecification`. Optionally, specify `sourceImageBufferAttributes` to provide a description of the source pixel buffers.\n\n### Configure the compression session\n\nGet the suggested encoder settings dictionary for the encode preset.\n\nSet the encoder settings dictionary. Set `kVTCompressionPropertyKey_RealTime` to `kCFBooleanTrue` to indicate that this is a live encoding session. Specify the expected video source frame rate. Optionally specify the codec profile and level and update the average target bit rate. The low-latency rate control that the system enables during the `VTCompressionSession` object creation takes care of the other encoder configuration for low latency.\n\n### Encode video frames\n\nCall `VTCompressionSessionEncodeFrame(_:imageBuffer:presentationTimeStamp:duration:frameProperties:infoFlagsOut:outputHandler:)` and submit each uncompressed frame to the `VTCompressionSession` object for encoding. The object calls the `outputHandler` block for each encoded frame. Check whether a frame drop or error occurs after frame encoding.\n\nCall `VTCompressionSessionCompleteFrames(_:untilPresentationTimeStamp:)` to indicate to the `VTCompressionSession` object that the app submitted all uncompressed video frames for encoding.\n\n### Perform compression and encoding\n\nYou can use the movie file `\/Assets\/video.m4v` to test this app. Copy the file to your desktop or other working directory, and then open Terminal to that directory and run the following command, where `xxx` is a unique string that Xcode generates. Use autocomplete before the `xxx` component to complete the path for that directory.\n\n`~\/Library\/Developer\/Xcode\/DerivedData\/VTEncoderForConferencing-xxx\/Build\/Products\/Debug\/VTEncoderForConferencing-Swift video.m4v`\n\nPass the `--help` option for additional configuration options.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/VideoToolbox\/encoding-video-for-low-latency-conferencing\ncrawled: 2025-12-02T15:50:01Z\n---\n\n# Encoding video for low-latency conferencing\n\n**Sample Code**\n\nConfigure a compression session to optimize encoding for video-conferencing apps.\n\n## Overview\n\nThis sample code project demonstrates how to configure and use a `VTCompressionSession` object to encode video for low-latency conferencing.\n\n### Create a compression session\n\nCreate a `VTCompressionSession` object and specify the required dimensions and `codecType`. For low latency use, include the `kVTVideoEncoderSpecification_EnableLowLatencyRateControl` option and set it to `true` in the `videoEncoderSpecification`. Optionally, specify `sourceImageBufferAttributes` to provide a description of the source pixel buffers.\n\n```swift\n\/\/ Set `kVTVideoEncoderSpecification_EnableLowLatencyRateControl` in encoder\n\/\/ specification when creating a compression session to request low-latency\n\/\/ rate control.\nlet videoEncoderSpecification = [kVTVideoEncoderSpecification_EnableLowLatencyRateControl: true as CFBoolean] as CFDictionary\n\n\/\/ Specify the pixel format of the uncompressed video.\nlet sourceImageBufferAttributes = [kCVPixelBufferPixelFormatTypeKey: options.pixelFormat as CFNumber] as CFDictionary\n\nvar compressionSessionOut: VTCompressionSession?\nlet err = VTCompressionSessionCreate(allocator: kCFAllocatorDefault,\n                                     width: Int32(options.destWidth),\n                                     height: Int32(options.destHeight),\n                                     codecType: options.codec,\n                                     encoderSpecification: videoEncoderSpecification,\n                                     imageBufferAttributes: sourceImageBufferAttributes,\n                                     compressedDataAllocator: nil,\n                                     outputCallback: nil,\n                                     refcon: nil,\n                                     compressionSessionOut: &compressionSessionOut)\nguard err == noErr, let compressionSession = compressionSessionOut else {\n    throw RuntimeError(\"VTCompressionSession creation failed (\\(err))!\")\n}\n```\n\n### Configure the compression session\n\nGet the suggested encoder settings dictionary for the encode preset.\n\n```swift\n\/\/\/ Get the suggested encoder settings dictionary for encode preset.\n\/\/\/ - Parameters:\n\/\/\/   - session: A compression session.\n\/\/\/   - encodePreset: The `EncodePreset` enumeration.\nprivate func getEncoderSettingsForPreset(session: VTCompressionSession, encodePreset: EncodePreset) -> [CFString: Any]? {\n    var supportedPresetDictionaries: CFDictionary?\n    var encoderSettings: [CFString: Any]?\n\n    _ = withUnsafeMutablePointer(to: &supportedPresetDictionaries) { valueOut in\n        VTSessionCopyProperty( session, key: kVTCompressionPropertyKey_SupportedPresetDictionaries,\n                               allocator: kCFAllocatorDefault, valueOut: valueOut )\n    }\n\n    if let presetDictionaries = supportedPresetDictionaries as? [CFString: [CFString: Any]] {\n        let presetConstant = switch encodePreset {\n        case .videoConferencing: kVTCompressionPreset_VideoConferencing\n        }\n\n        encoderSettings = presetDictionaries[presetConstant]\n    }\n\n    return encoderSettings\n}\n```\n\nSet the encoder settings dictionary. Set `kVTCompressionPropertyKey_RealTime` to `kCFBooleanTrue` to indicate that this is a live encoding session. Specify the expected video source frame rate. Optionally specify the codec profile and level and update the average target bit rate. The low-latency rate control that the system enables during the `VTCompressionSession` object creation takes care of the other encoder configuration for low latency.\n\n```swift\n\/\/\/ Configures a compression session for low-latency conferencing.\n\/\/\/ - Parameters:\n\/\/\/   - session: A compression session.\n\/\/\/   - options: The configuration options.\n\/\/\/   - expectedFrameRate: The expected frame rate of the video source.\nprivate func configureVTCompressionSession(session: VTCompressionSession, options: Options, expectedFrameRate: Float) throws {\n    \/\/ Different encoder implementations may support different property sets, so\n    \/\/ the app needs to determine the implications of a failed property setting\n    \/\/ on a case-by-case basis for the encoder. If the property is essential for\n    \/\/ the use case and its setting fails, the app terminates. Otherwise, the\n    \/\/ encoder ignores the failed setting and uses a default value to proceed\n    \/\/ with encoding.\n\n    var err: OSStatus = noErr\n    var variableBitRateMode = false\n\n    if let presetTuple = options.presetTuple {\n        \/\/ Try configuring the encoder using the preset.\n        let encoderSettings: [CFString: Any]?\n        encoderSettings = getEncoderSettingsForPreset(session: session, encodePreset: presetTuple.0)\n\n        if let encoderSettings {\n            if encoderSettings[kVTCompressionPropertyKey_VariableBitRate] != nil {\n                variableBitRateMode = true\n            }\n\n            \/\/ Set the encoder settings dictionary on the compression session.\n            err = VTSessionSetProperties(session, propertyDictionary: encoderSettings as CFDictionary)\n            try NSError.check(err, \"VTSessionSetProperties failed\")\n        }\n    }\n\n    \/\/ Indicate real-time compression session, which conferencing requires.\n    err = VTSessionSetProperty(session, key: kVTCompressionPropertyKey_RealTime, value: kCFBooleanTrue)\n    if err != noErr {\n        print(\"Warning: VTSessionSetProperty(kVTCompressionPropertyKey_RealTime) failed (\\(err))\")\n    }\n\n    \/\/ Indicate the expected frame rate, if known. This is just a hint for rate\n    \/\/ control purposes; the actual encoding frame rate matches the incoming\n    \/\/ frame rate even if it doesn't match this setting. When\n    \/\/ `kVTCompressionPropertyKey_RealTime` is `kCFBooleanTrue`, the video\n    \/\/ encoder may optimize energy usage.\n    err = VTSessionSetProperty(session, key: kVTCompressionPropertyKey_ExpectedFrameRate, value: expectedFrameRate as CFNumber)\n    if err != noErr {\n        print(\"Warning: VTSessionSetProperty(kVTCompressionPropertyKey_ExpectedFrameRate) failed (\\(err))\")\n    }\n\n    \/\/ Specify the profile and level for the encoded bitstream.\n    if let profileTuple = options.profileTuple {\n        var profileConstant: CFString?\n\n        if options.codec == kCMVideoCodecType_H264 {\n            if profileTuple.0 == .h264Main {\n                profileConstant = kVTProfileLevel_H264_Main_AutoLevel\n            } else if profileTuple.0 == .h264High {\n                profileConstant = kVTProfileLevel_H264_High_AutoLevel\n            }\n        } else if options.codec == kCMVideoCodecType_HEVC {\n            if profileTuple.0 == .hevcMain {\n                profileConstant = kVTProfileLevel_HEVC_Main_AutoLevel\n            } else if profileTuple.0 == .hevcMain10 {\n                profileConstant = kVTProfileLevel_HEVC_Main10_AutoLevel\n            }\n        }\n\n        if let profileConstant {\n            err = VTSessionSetProperty(session, key: kVTCompressionPropertyKey_ProfileLevel, value: profileConstant)\n            if err != noErr {\n                print(\"Warning: VTSessionSetProperty(kVTCompressionPropertyKey_ProfileLevel) failed (\\(err))\")\n            }\n        }\n    }\n\n    if let destBitRate = options.destBitRate {\n        if variableBitRateMode {\n            \/\/ Specify the long-term desired variable bit rate in bits per second.\n            err = VTSessionSetProperty(session, key: kVTCompressionPropertyKey_VariableBitRate, value: destBitRate as CFNumber)\n            if err != noErr {\n                print(\"Warning: VTSessionSetProperty(kVTCompressionPropertyKey_VariableBitRate) failed (\\(err))\")\n            }\n\n            \/\/ Set VBV maximum bit rate.\n            err = VTSessionSetProperty(session, key: kVTCompressionPropertyKey_VBVMaxBitRate, value: (destBitRate * 3 \/ 2) as CFNumber)\n            if err != noErr {\n                print(\"Warning: VTSessionSetProperty(kVTCompressionPropertyKey_VBVMaxBitRate) failed (\\(err))\")\n            }\n        } else {\n            \/\/ Specify the long-term desired average bit rate in bits per second.\n            \/\/ It's a soft limit, so the encoder may overshoot or undershoot and\n            \/\/ the average bit rate of the output video may be over or under the\n            \/\/ target.\n            err = VTSessionSetProperty(session, key: kVTCompressionPropertyKey_AverageBitRate, value: destBitRate as CFNumber)\n            if err != noErr {\n                print(\"Warning: VTSessionSetProperty(kVTCompressionPropertyKey_AverageBitRate) failed (\\(err))\")\n            }\n        }\n    }\n}\n```\n\n### Encode video frames\n\nCall `VTCompressionSessionEncodeFrame(_:imageBuffer:presentationTimeStamp:duration:frameProperties:infoFlagsOut:outputHandler:)` and submit each uncompressed frame to the `VTCompressionSession` object for encoding. The object calls the `outputHandler` block for each encoded frame. Check whether a frame drop or error occurs after frame encoding.\n\nCall `VTCompressionSessionCompleteFrames(_:untilPresentationTimeStamp:)` to indicate to the `VTCompressionSession` object that the app submitted all uncompressed video frames for encoding.\n\n### Perform compression and encoding\n\nYou can use the movie file `\/Assets\/video.m4v` to test this app. Copy the file to your desktop or other working directory, and then open Terminal to that directory and run the following command, where `xxx` is a unique string that Xcode generates. Use autocomplete before the `xxx` component to complete the path for that directory.\n\n`~\/Library\/Developer\/Xcode\/DerivedData\/VTEncoderForConferencing-xxx\/Build\/Products\/Debug\/VTEncoderForConferencing-Swift video.m4v`\n\nPass the `--help` option for additional configuration options.\n\n## Compression\n\n- **Encoding video for live streaming**: Configure a compression session to encode video for live streaming.\n- **Encoding video for offline transcoding**: Configure a compression session to transcode video in offline workflows.\n- **VTCompressionSession**: An object that compresses video data.\n- **VTDecompressionSession**: An object that decompresses video data.\n- **VTFrameSilo**: An object that stores sample buffers from a multipass encoding session.\n- **VTMultiPassStorage**: An object that stores video encoding metadata from a multipass encoding session.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Configure a compression session to encode video for live streaming.",
          "name" : "Encoding video for live streaming",
          "url" : "https:\/\/developer.apple.com\/documentation\/VideoToolbox\/encoding-video-for-live-streaming"
        },
        {
          "description" : "Configure a compression session to transcode video in offline workflows.",
          "name" : "Encoding video for offline transcoding",
          "url" : "https:\/\/developer.apple.com\/documentation\/VideoToolbox\/encoding-video-for-offline-transcoding"
        },
        {
          "description" : "An object that compresses video data.",
          "name" : "VTCompressionSession",
          "url" : "https:\/\/developer.apple.com\/documentation\/VideoToolbox\/VTCompressionSession-api-collection"
        },
        {
          "description" : "An object that decompresses video data.",
          "name" : "VTDecompressionSession",
          "url" : "https:\/\/developer.apple.com\/documentation\/VideoToolbox\/VTDecompressionSession-api-collection"
        },
        {
          "description" : "An object that stores sample buffers from a multipass encoding session.",
          "name" : "VTFrameSilo",
          "url" : "https:\/\/developer.apple.com\/documentation\/VideoToolbox\/VTFrameSilo-api-collection"
        },
        {
          "description" : "An object that stores video encoding metadata from a multipass encoding session.",
          "name" : "VTMultiPassStorage",
          "url" : "https:\/\/developer.apple.com\/documentation\/VideoToolbox\/VTMultiPassStorage-api-collection"
        }
      ],
      "title" : "Compression"
    }
  ],
  "source" : "appleJSON",
  "title" : "Encoding video for low-latency conferencing",
  "url" : "https:\/\/developer.apple.com\/documentation\/VideoToolbox\/encoding-video-for-low-latency-conferencing"
}