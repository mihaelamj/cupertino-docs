{
  "abstract" : "Secure your communications with Apple Push Notification service (APNs) by using stateless authentication tokens.",
  "codeExamples" : [
    {
      "code" : "{\n   \"alg\" : \"ES256\",\n   \"kid\" : \"ABC123DEFG\"\n}\n{\n   \"iss\": \"DEF123GHIJ\",\n   \"iat\": 1437179036\n}",
      "language" : "other"
    },
    {
      "code" : "authorization = bearer eyAia2lkIjogIjhZTDNHM1JSWDciIH0.eyAiaXNzIjogIkM4Nk5WOUpYM0QiLCAiaWF0I\n\t\t jogIjE0NTkxNDM1ODA2NTAiIH0.MEYCIQDzqyahmH1rz1s-LFNkylXEa2lZ_aOCX4daxxTZkVEGzwIhALvkClnx5m5eAT6\n\t\t Lxw7LZtEQcH6JENhJTMArwLf3sXwi\n",
      "language" : "other"
    }
  ],
  "contentHash" : "5d4559246dee6c930889610c4f886bc6cc29b043787f3c5cca73a29807606d39",
  "crawledAt" : "2025-12-04T07:39:56Z",
  "id" : "07578412-8330-4F31-BA30-3C70429B119F",
  "kind" : "article",
  "language" : "swift",
  "module" : "User Notifications",
  "overview" : "## Overview\n\nToken-based authentication offers a stateless way to communicate with APNs. Stateless communication is faster than certificate-based communication because it doesn’t require APNs to look up the certificate, or other information, related to your provider server. There are other advantages to using token-based authentication:\n\nToken-based requests are slightly larger than certificate-based requests because each request contains the token. You must also update and encrypt your tokens at least once an hour using the provider token signing key that Apple provides you. To learn more about key creation, see [https:\/\/developer.apple.com\/help\/account\/manage-keys\/create-a-private-key\/].\n\n### Team-scoped keys\n\nUse team-scoped keys to generate authentication tokens for sending notifications to any topic in a team. These keys restrict usage to either Sandbox or Production, enhancing security. They apply to all existing and new topics in the team. Each environment can have a maximum of two keys.\n\n### Topic-specific keys\n\nUse topic-specific keys to generate authentication tokens for sending notifications to specific team topics within a single environment. These keys provide granular control and simplify management. You can create a maximum of 200 keys for Sandbox and 200 for Production, with up to 400 topics per topic-based key.\n\nA topic-specific key can have at most one related key in the same environment. When you connect to the APNs server, you can use authentication tokens from both the topic-based key and its related key (if available) for push notification requests.\n\n### Obtain an encryption key and key ID from Apple\n\nYou need an APNs authentication token signing key to generate the tokens that your server uses. You request this key from your developer account on [https:\/\/developer.apple.com\/account\/resources\/keys\/list], as shown in the following image:\n\n\n\nWhen you request a key, Apple gives you:\n\nSecure both pieces of information carefully. You use the authentication token signing key to encrypt your JSON tokens, so this key must remain private to prevent anyone else from generating those tokens.\n\nFor detailed instructions on how to use an authentication token, see the `authorization` header field in [doc:\/\/com.apple.usernotifications\/documentation\/UserNotifications\/sending-notification-requests-to-apns].\n\n### Create and encrypt your JSON token\n\nThe token that you include with your notification requests uses the JSON Web Token (JWT) specification. The following table describes the four key-value pairs the token itself contains:\n\nThe keys divide between the header and claims payload of the JSON Web Token. The header of the token contains the encryption algorithm and Key ID, and the claims payload contains your Team ID and the token generation time. The code snippet below shows an example of a JSON token for a fictional developer account.\n\nEncrypt the resulting JSON data using your authentication token signing key and the specified algorithm. Your provider server must include the resulting encrypted data with all notification requests.\n\nFor detailed information about the JWT specification, see [https:\/\/tools.ietf.org\/html\/rfc7519].\n\n### Attach your token to notification requests\n\nWhen creating the POST request for a notification, include your encrypted token in the `authorization` header of your request. The token is in Base64URL-encoded JWT format, and is specified as `bearer <token data>`, as shown in the following example:\n\nFor information on how to construct your POST requests, see [doc:\/\/com.apple.usernotifications\/documentation\/UserNotifications\/sending-notification-requests-to-apns].\n\n### Refresh your token regularly\n\nFor security, APNs requires you to refresh your token regularly. Refresh your token no more than once every 20 minutes and no less than once every 60 minutes. APNs rejects any request whose token contains a timestamp that’s more than one hour old. Similarly, APNs report an error if you use a new token more than once every 20 minutes on the same connection.\n\nOn your provider server, set up a recurring task to recreate your token with a current timestamp. Encrypt the token again and attach it to subsequent notification requests.\n\n### Team and bundle ID mapping\n\nYou can’t map a connection to APNs to multiple teams. If you manage APNs for multiple developer accounts, open separate connection pools for each of them.\n\nAs part of the authentication process, APNs relates a team ID and associated bundle IDs to a connection on the first push. After the authentication process, attempting to associate a different team or sending a push to a newly added bundle ID causes an error. To send remote notifications to a new topic, add the topic to your team in App Store Connect and create new connections to APNs.\n\nFor transferred apps, close and recreate any existing connections from your push provider server to APNs. If you don’t, APNs can’t start accepting push requests from the new team.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/UserNotifications\/establishing-a-token-based-connection-to-apns\ncrawled: 2025-12-04T07:39:56Z\n---\n\n# Establishing a token-based connection to APNs\n\n**Article**\n\nSecure your communications with Apple Push Notification service (APNs) by using stateless authentication tokens.\n\n## Overview\n\nToken-based authentication offers a stateless way to communicate with APNs. Stateless communication is faster than certificate-based communication because it doesn’t require APNs to look up the certificate, or other information, related to your provider server. There are other advantages to using token-based authentication:\n\n- You can use the same token from multiple provider servers.\n- You can use one token to distribute notifications for all or a subset of your company’s apps.\n\nToken-based requests are slightly larger than certificate-based requests because each request contains the token. You must also update and encrypt your tokens at least once an hour using the provider token signing key that Apple provides you. To learn more about key creation, see [https:\/\/developer.apple.com\/help\/account\/manage-keys\/create-a-private-key\/].\n\n### Team-scoped keys\n\nUse team-scoped keys to generate authentication tokens for sending notifications to any topic in a team. These keys restrict usage to either Sandbox or Production, enhancing security. They apply to all existing and new topics in the team. Each environment can have a maximum of two keys.\n\n\n\n### Topic-specific keys\n\nUse topic-specific keys to generate authentication tokens for sending notifications to specific team topics within a single environment. These keys provide granular control and simplify management. You can create a maximum of 200 keys for Sandbox and 200 for Production, with up to 400 topics per topic-based key.\n\nA topic-specific key can have at most one related key in the same environment. When you connect to the APNs server, you can use authentication tokens from both the topic-based key and its related key (if available) for push notification requests.\n\n\n\n### Obtain an encryption key and key ID from Apple\n\nYou need an APNs authentication token signing key to generate the tokens that your server uses. You request this key from your developer account on [https:\/\/developer.apple.com\/account\/resources\/keys\/list], as shown in the following image:\n\n\n\nWhen you request a key, Apple gives you:\n\n- A 10-character string with the Key ID. You must include this string in your JSON tokens. You can find instructions to get this ID in [https:\/\/developer.apple.com\/help\/account\/manage-keys\/get-a-key-identifier].\n- An authentication token signing key, specified as a text file (with a `.p8` file extension).\n\nSecure both pieces of information carefully. You use the authentication token signing key to encrypt your JSON tokens, so this key must remain private to prevent anyone else from generating those tokens.\n\n\n\nFor detailed instructions on how to use an authentication token, see the `authorization` header field in [doc:\/\/com.apple.usernotifications\/documentation\/UserNotifications\/sending-notification-requests-to-apns].\n\n### Create and encrypt your JSON token\n\nThe token that you include with your notification requests uses the JSON Web Token (JWT) specification. The following table describes the four key-value pairs the token itself contains:\n\n\n\nThe keys divide between the header and claims payload of the JSON Web Token. The header of the token contains the encryption algorithm and Key ID, and the claims payload contains your Team ID and the token generation time. The code snippet below shows an example of a JSON token for a fictional developer account.\n\n```other\n{\n   \"alg\" : \"ES256\",\n   \"kid\" : \"ABC123DEFG\"\n}\n{\n   \"iss\": \"DEF123GHIJ\",\n   \"iat\": 1437179036\n}\n```\n\n\n\nEncrypt the resulting JSON data using your authentication token signing key and the specified algorithm. Your provider server must include the resulting encrypted data with all notification requests.\n\nFor detailed information about the JWT specification, see [https:\/\/tools.ietf.org\/html\/rfc7519].\n\n### Attach your token to notification requests\n\nWhen creating the POST request for a notification, include your encrypted token in the `authorization` header of your request. The token is in Base64URL-encoded JWT format, and is specified as `bearer <token data>`, as shown in the following example:\n\n```other\nauthorization = bearer eyAia2lkIjogIjhZTDNHM1JSWDciIH0.eyAiaXNzIjogIkM4Nk5WOUpYM0QiLCAiaWF0I\n\t\t jogIjE0NTkxNDM1ODA2NTAiIH0.MEYCIQDzqyahmH1rz1s-LFNkylXEa2lZ_aOCX4daxxTZkVEGzwIhALvkClnx5m5eAT6\n\t\t Lxw7LZtEQcH6JENhJTMArwLf3sXwi\n\n```\n\nFor information on how to construct your POST requests, see [doc:\/\/com.apple.usernotifications\/documentation\/UserNotifications\/sending-notification-requests-to-apns].\n\n### Refresh your token regularly\n\nFor security, APNs requires you to refresh your token regularly. Refresh your token no more than once every 20 minutes and no less than once every 60 minutes. APNs rejects any request whose token contains a timestamp that’s more than one hour old. Similarly, APNs report an error if you use a new token more than once every 20 minutes on the same connection.\n\nOn your provider server, set up a recurring task to recreate your token with a current timestamp. Encrypt the token again and attach it to subsequent notification requests.\n\n### Team and bundle ID mapping\n\nYou can’t map a connection to APNs to multiple teams. If you manage APNs for multiple developer accounts, open separate connection pools for each of them.\n\nAs part of the authentication process, APNs relates a team ID and associated bundle IDs to a connection on the first push. After the authentication process, attempting to associate a different team or sending a push to a newly added bundle ID causes an error. To send remote notifications to a new topic, add the topic to your team in App Store Connect and create new connections to APNs.\n\nFor transferred apps, close and recreate any existing connections from your push provider server to APNs. If you don’t, APNs can’t start accepting push requests from the new team.\n\n\n\n## Security\n\n- **Establishing a certificate-based connection to APNs**: Secure your communications with Apple Push Notification service (APNs) by installing a certificate on your provider server.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Secure your communications with Apple Push Notification service (APNs) by installing a certificate on your provider server.",
          "name" : "Establishing a certificate-based connection to APNs",
          "url" : "https:\/\/developer.apple.com\/documentation\/UserNotifications\/establishing-a-certificate-based-connection-to-apns"
        }
      ],
      "title" : "Security"
    }
  ],
  "source" : "appleJSON",
  "title" : "Establishing a token-based connection to APNs",
  "url" : "https:\/\/developer.apple.com\/documentation\/UserNotifications\/establishing-a-token-based-connection-to-apns"
}