{
  "abstract" : "Modify the payload of a remote notification before it’s displayed on the user’s iOS device.",
  "codeExamples" : [
    {
      "code" : "\/\/ Storage for the completion handler and content.\nvar contentHandler: ((UNNotificationContent) -> Void)?\nvar bestAttemptContent: UNMutableNotificationContent?\n\/\/ Modify the payload contents.\noverride func didReceive(_ request: UNNotificationRequest,\n         withContentHandler contentHandler: \n         @escaping (UNNotificationContent) -> Void) {\n   self.contentHandler = contentHandler\n   self.bestAttemptContent = (request.content.mutableCopy() \n         as? UNMutableNotificationContent)\n   \n   \/\/ Try to decode the encrypted message data.\n   let encryptedData = bestAttemptContent?.userInfo[\"ENCRYPTED_DATA\"]\n   if let bestAttemptContent = bestAttemptContent {\n      if let data = encryptedData as? String {\n         let decryptedMessage = self.decrypt(data: data)\n        bestAttemptContent.body = decryptedMessage\n      }\n      else {\n         bestAttemptContent.body = \"(Encrypted)\"\n      }\n      \n      \/\/ Always call the completion handler when done.      \n      contentHandler(bestAttemptContent)\n   }\n}\n    \n\/\/ Return something before time expires.\noverride func serviceExtensionTimeWillExpire() {\n   if let contentHandler = contentHandler, \n      let bestAttemptContent = bestAttemptContent {\n         \n      \/\/ Mark the message as still encrypted.   \n      bestAttemptContent.subtitle = \"(Encrypted)\"\n      bestAttemptContent.body = \"\"\n      contentHandler(bestAttemptContent)\n   }\n}",
      "language" : "swift"
    },
    {
      "code" : "{\n   \"aps\" : {\n      \"category\" : \"SECRET\",\n      \"mutable-content\" : 1,\n      \"alert\" : {\n         \"title\" : \"Secret Message!\",\n         \"body\"  : \"(Encrypted)\"\n     },\n   },\n   \"ENCRYPTED_DATA\" : \"Salted__·öîQÊ$UDì_¶Ù∞èΩ^¬%gq∞NÿÒQùw\"\n}",
      "language" : "json"
    }
  ],
  "contentHash" : "ac41e53ebe7aacb1b10706dc017465cdeb658f9b8062c330be8c7a2537de3411",
  "crawledAt" : "2025-12-01T09:45:21Z",
  "id" : "D51D7F1A-88F0-4EDD-8220-43C738CAA4E2",
  "kind" : "article",
  "module" : "User Notifications",
  "overview" : "## Overview\n\nYou may want to modify the content of a remote notification on a user’s iOS device if you need to:\n\nModifying a remote notification requires a notification service app extension, which you include inside your iOS app bundle. The app extension receives the contents of your remote notifications before the system displays them to the user, giving you time to update the notification payload. You control which notifications your extension handles.\n\n### Add a service app extension to your project\n\nA notification service app extension ships as a separate bundle inside your iOS app. To add this extension to your app:\n\n### Implement your extension’s handler methods\n\nThe notification service app extension template provided by Xcode includes a default implementation for you to modify.\n\nYour [doc:\/\/com.apple.usernotifications\/documentation\/UserNotifications\/UNNotificationServiceExtension\/didReceive(_:withContentHandler:)] method has only about 30 seconds to modify the payload and call the provided completion handler. If your code takes longer than that, the system calls the [doc:\/\/com.apple.usernotifications\/documentation\/UserNotifications\/UNNotificationServiceExtension\/serviceExtensionTimeWillExpire()] method, at which point you must return whatever you can to the system immediately. If you fail to call the completion handler from either method, the system displays the original contents of the notification.\n\nListing 1 shows an implementation of the [doc:\/\/com.apple.usernotifications\/documentation\/UserNotifications\/UNNotificationServiceExtension] object that decrypts the contents of a secret message delivered using a remote notification. The [doc:\/\/com.apple.usernotifications\/documentation\/UserNotifications\/UNNotificationServiceExtension\/didReceive(_:withContentHandler:)] method decrypts the data and returns a modified version of the notification’s content if it’s successful. If it’s unsuccessful, or if time expires, the extension returns content indicating that the data is still encrypted.\n\nListing 1. Decrypting data contained in a remote notification\n\n### Configure the payload for the remote notification\n\nThe system executes your notification service app extension only when a remote notification’s payload contains the following information:\n\nListing 2 shows the JSON data for a notification payload containing encrypted data. The `mutable-content` flag is set so that the user’s device knows to run the corresponding service app extension, the code for which is shown in .\n\nListing 2. Specifying the remote notification payload",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/UserNotifications\/modifying-content-in-newly-delivered-notifications\ncrawled: 2025-12-01T09:45:21Z\n---\n\n# Modifying content in newly delivered notifications\n\n**Article**\n\nModify the payload of a remote notification before it’s displayed on the user’s iOS device.\n\n## Overview\n\nYou may want to modify the content of a remote notification on a user’s iOS device if you need to:\n\n- Decrypt data sent in an encrypted format.\n- Download images or other media attachments whose size would exceed the maximum payload size.\n- Update the notification’s content, perhaps by incorporating data from the user’s device.\n\nModifying a remote notification requires a notification service app extension, which you include inside your iOS app bundle. The app extension receives the contents of your remote notifications before the system displays them to the user, giving you time to update the notification payload. You control which notifications your extension handles.\n\n\n\n### Add a service app extension to your project\n\nA notification service app extension ships as a separate bundle inside your iOS app. To add this extension to your app:\n\n1. Select File > New > Target in Xcode.\n2. Select the Notification Service Extension target from the iOS > Application section.\n3. Click Next.\n4. Specify a name and other configuration details for your app extension.\n5. Click Finish.\n\n### Implement your extension’s handler methods\n\nThe notification service app extension template provided by Xcode includes a default implementation for you to modify.\n\n- Use the [doc:\/\/com.apple.usernotifications\/documentation\/UserNotifications\/UNNotificationServiceExtension\/didReceive(_:withContentHandler:)] method to create a new [doc:\/\/com.apple.usernotifications\/documentation\/UserNotifications\/UNMutableNotificationContent] object with the updated content.\n- Use the [doc:\/\/com.apple.usernotifications\/documentation\/UserNotifications\/UNNotificationServiceExtension\/serviceExtensionTimeWillExpire()] method to terminate any payload-modification tasks that are still running.\n\nYour [doc:\/\/com.apple.usernotifications\/documentation\/UserNotifications\/UNNotificationServiceExtension\/didReceive(_:withContentHandler:)] method has only about 30 seconds to modify the payload and call the provided completion handler. If your code takes longer than that, the system calls the [doc:\/\/com.apple.usernotifications\/documentation\/UserNotifications\/UNNotificationServiceExtension\/serviceExtensionTimeWillExpire()] method, at which point you must return whatever you can to the system immediately. If you fail to call the completion handler from either method, the system displays the original contents of the notification.\n\nListing 1 shows an implementation of the [doc:\/\/com.apple.usernotifications\/documentation\/UserNotifications\/UNNotificationServiceExtension] object that decrypts the contents of a secret message delivered using a remote notification. The [doc:\/\/com.apple.usernotifications\/documentation\/UserNotifications\/UNNotificationServiceExtension\/didReceive(_:withContentHandler:)] method decrypts the data and returns a modified version of the notification’s content if it’s successful. If it’s unsuccessful, or if time expires, the extension returns content indicating that the data is still encrypted.\n\nListing 1. Decrypting data contained in a remote notification\n\n```swift\n\/\/ Storage for the completion handler and content.\nvar contentHandler: ((UNNotificationContent) -> Void)?\nvar bestAttemptContent: UNMutableNotificationContent?\n\/\/ Modify the payload contents.\noverride func didReceive(_ request: UNNotificationRequest,\n         withContentHandler contentHandler: \n         @escaping (UNNotificationContent) -> Void) {\n   self.contentHandler = contentHandler\n   self.bestAttemptContent = (request.content.mutableCopy() \n         as? UNMutableNotificationContent)\n   \n   \/\/ Try to decode the encrypted message data.\n   let encryptedData = bestAttemptContent?.userInfo[\"ENCRYPTED_DATA\"]\n   if let bestAttemptContent = bestAttemptContent {\n      if let data = encryptedData as? String {\n         let decryptedMessage = self.decrypt(data: data)\n        bestAttemptContent.body = decryptedMessage\n      }\n      else {\n         bestAttemptContent.body = \"(Encrypted)\"\n      }\n      \n      \/\/ Always call the completion handler when done.      \n      contentHandler(bestAttemptContent)\n   }\n}\n    \n\/\/ Return something before time expires.\noverride func serviceExtensionTimeWillExpire() {\n   if let contentHandler = contentHandler, \n      let bestAttemptContent = bestAttemptContent {\n         \n      \/\/ Mark the message as still encrypted.   \n      bestAttemptContent.subtitle = \"(Encrypted)\"\n      bestAttemptContent.body = \"\"\n      contentHandler(bestAttemptContent)\n   }\n}\n```\n\n### Configure the payload for the remote notification\n\nThe system executes your notification service app extension only when a remote notification’s payload contains the following information:\n\n- The payload must include the `mutable-content` key with a value of `1`.\n- The payload must include an `alert` dictionary with title, subtitle, or body information.\n\nListing 2 shows the JSON data for a notification payload containing encrypted data. The `mutable-content` flag is set so that the user’s device knows to run the corresponding service app extension, the code for which is shown in .\n\nListing 2. Specifying the remote notification payload\n\n```json\n{\n   \"aps\" : {\n      \"category\" : \"SECRET\",\n      \"mutable-content\" : 1,\n      \"alert\" : {\n         \"title\" : \"Secret Message!\",\n         \"body\"  : \"(Encrypted)\"\n     },\n   },\n   \"ENCRYPTED_DATA\" : \"Salted__·öîQÊ$UDì_¶Ù∞èΩ^¬%gq∞NÿÒQùw\"\n}\n```\n\n## Notification service app extension\n\n- **UNNotificationServiceExtension**: An object that modifies the content of a remote notification before it’s delivered to the user.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "An object that modifies the content of a remote notification before it’s delivered to the user.",
          "name" : "UNNotificationServiceExtension",
          "url" : "https:\/\/developer.apple.com\/documentation\/UserNotifications\/UNNotificationServiceExtension"
        }
      ],
      "title" : "Notification service app extension"
    }
  ],
  "source" : "appleJSON",
  "title" : "Modifying content in newly delivered notifications",
  "url" : "https:\/\/developer.apple.com\/documentation\/UserNotifications\/modifying-content-in-newly-delivered-notifications"
}