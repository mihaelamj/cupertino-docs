{
  "abstract" : "Secure your communications with APNs to send API requests.",
  "codeExamples" : [
    {
      "code" : "$ openssl s_client -connect api.development.push.apple.com:443 -cert YourSSLCertAndPrivateKey.pem -debug \n-showcerts -CAfile server-ca-cert.pem",
      "language" : "Other"
    }
  ],
  "contentHash" : "bb9c1f2a5ab5be4e79d3ed12952336125ef6a124234f6f1d2e275f590ca19aa1",
  "crawledAt" : "2025-12-04T01:08:13Z",
  "id" : "236F84C8-F463-4F76-8342-6C70580194C6",
  "kind" : "article",
  "language" : "swift",
  "module" : "User Notifications",
  "overview" : "## Overview\n\nUse `HTTP\/2` and `TLS 1.2` or later to establish a connection between your provider server and APNs server to send API requests. Based on the type of request you’re using, there’s a different development and production endpoint. If you’re shipping apps, use the production end points. If you’re testing, use the development endpoints. If you’re sending many remote notifications, you can establish multiple connections to these servers to improve performance.\n\nAPNs allows for multiple concurrent streams for each connection, but don’t assume a specific number of streams. The exact number varies based on server load and whether you use a provider certificate or an authentication token. For example, if you’re using an `authentication` token, APNs allows only one stream until you post a request with a valid `authentication` token. APNs ignores `HTTP\/2 PRIORITY` frames, so don’t send them on your streams.\n\nIf you experience a revoked provider certificate, or if you revoke your authentication token, close all connections to APNs, fix the problem, and then open new connections. APNs may also terminate a connection by sending a `GOAWAY` frame. The payload of the `GOAWAY` frame includes `JSON` data with a `reason` key, indicating the reason for the connection termination. For a list of values for the `reason` key, refer to the response error strings in [doc:\/\/com.apple.usernotifications\/documentation\/UserNotifications\/handling-notification-responses-from-apns].\n\n### Create a request to APNs\n\nTo send a notification to a person’s device, construct and send a POST notification to APNs. Send this request over the connection you created using `HTTP\/2` and `TLS`. To create your POST notification, you must already have the following pieces of information:\n\n### Send a request to APNs\n\nAPNs requires the use of HPACK (header compression for HTTP\/2), which prevents repeatedly storing header keys and values. APNs maintains a small dynamic table for HPACK. To avoid filling up that table, encode your headers in the following way—especially when using many streams:\n\nIf you are using token-based authentication, the `authorization` header value shouldn’t change frequently and can be indexed. If you are using separate connections for different push types, `apns-push-type` header value can also be indexed and reused. If you are using broadcast push notifications, the channel ID used for push notifications might not change often and can be indexed.\n\n### Troubleshoot problems with connecting to APNs\n\nIf your provider server is unable to connect to APNs, examine the following possible causes:\n\nYou can verify the TLS handshake between your provider server and APNs by running the `OpenSSL s_client` command from your server, as shown below. This command can also show if your `TLS\/SSL` certificates are expired or revoked.\n\nThe code listing below verifies the `TLS` handshake with device push notifications sandbox endpoint",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/UserNotifications\/establishing-a-connection-to-apns\ncrawled: 2025-12-04T01:08:13Z\n---\n\n# Establishing a connection to Apple Push Notification service (APNs)\n\n**Article**\n\nSecure your communications with APNs to send API requests.\n\n## Overview\n\nUse `HTTP\/2` and `TLS 1.2` or later to establish a connection between your provider server and APNs server to send API requests. Based on the type of request you’re using, there’s a different development and production endpoint. If you’re shipping apps, use the production end points. If you’re testing, use the development endpoints. If you’re sending many remote notifications, you can establish multiple connections to these servers to improve performance.\n\nAPNs allows for multiple concurrent streams for each connection, but don’t assume a specific number of streams. The exact number varies based on server load and whether you use a provider certificate or an authentication token. For example, if you’re using an `authentication` token, APNs allows only one stream until you post a request with a valid `authentication` token. APNs ignores `HTTP\/2 PRIORITY` frames, so don’t send them on your streams.\n\nIf you experience a revoked provider certificate, or if you revoke your authentication token, close all connections to APNs, fix the problem, and then open new connections. APNs may also terminate a connection by sending a `GOAWAY` frame. The payload of the `GOAWAY` frame includes `JSON` data with a `reason` key, indicating the reason for the connection termination. For a list of values for the `reason` key, refer to the response error strings in [doc:\/\/com.apple.usernotifications\/documentation\/UserNotifications\/handling-notification-responses-from-apns].\n\n### Create a request to APNs\n\nTo send a notification to a person’s device, construct and send a POST notification to APNs. Send this request over the connection you created using `HTTP\/2` and `TLS`. To create your POST notification, you must already have the following pieces of information:\n\n- If you’re using device push, the device token that identifies the device to receive the notification; refer to [doc:\/\/com.apple.usernotifications\/documentation\/UserNotifications\/registering-your-app-with-apns].\n- If you’re using token-based authentication, your current authentication token; refer to [doc:\/\/com.apple.usernotifications\/documentation\/UserNotifications\/establishing-a-token-based-connection-to-apns].\n- The notification’s payload, specified as JSON data; refer to [doc:\/\/com.apple.usernotifications\/documentation\/UserNotifications\/generating-a-remote-notification].\n- If you’re using certificate-based authentication, your provider certificate. You send your provider certificate to APNs when setting up your `TLS` connection. For more information, refer to [doc:\/\/com.apple.usernotifications\/documentation\/UserNotifications\/establishing-a-certificate-based-connection-to-apns].\n\n\n\n### Send a request to APNs\n\nAPNs requires the use of HPACK (header compression for HTTP\/2), which prevents repeatedly storing header keys and values. APNs maintains a small dynamic table for HPACK. To avoid filling up that table, encode your headers in the following way—especially when using many streams:\n\n- The first time you send an APNs documented header name, encode them with incremental indexing and add the header fields to the dynamic table. Reuse the indexed header name for subsequent requests.\n- Index and reuse an APNs documented header value that doesn’t change frequently for your use-case.\n\nIf you are using token-based authentication, the `authorization` header value shouldn’t change frequently and can be indexed. If you are using separate connections for different push types, `apns-push-type` header value can also be indexed and reused. If you are using broadcast push notifications, the channel ID used for push notifications might not change often and can be indexed.\n\n### Troubleshoot problems with connecting to APNs\n\nIf your provider server is unable to connect to APNs, examine the following possible causes:\n\n- Make sure you have the needed certificates installed on your provider server. If your provider server doesn’t have the proper certificates for `TLS\/SS`L validation, it cannot connect to APNs. For certificate-based connections, your provider server must also have the certificate you obtained from Apple. Refer to [doc:\/\/com.apple.usernotifications\/documentation\/UserNotifications\/establishing-a-certificate-based-connection-to-apns].\n- Check how often your provider server connects to APNs. If your provider server opens and closes its connection to APNs repeatedly, APNs may treat it as a denial-of-service attack and temporarily block your server from connecting.\n\nYou can verify the TLS handshake between your provider server and APNs by running the `OpenSSL s_client` command from your server, as shown below. This command can also show if your `TLS\/SSL` certificates are expired or revoked.\n\nThe code listing below verifies the `TLS` handshake with device push notifications sandbox endpoint\n\n```Other\n$ openssl s_client -connect api.development.push.apple.com:443 -cert YourSSLCertAndPrivateKey.pem -debug \n-showcerts -CAfile server-ca-cert.pem\n```\n\n## Server tasks\n\n- **Registering your app with APNs**: Communicate with Apple Push Notification service (APNs) and receive a unique device token that identifies your app.\n- **Generating a remote notification**: Send notifications to the user’s device with a JSON payload.\n- **Pushing background updates to your App**: Deliver notifications that wake your app and update it in the background.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Communicate with Apple Push Notification service (APNs) and receive a unique device token that identifies your app.",
          "name" : "Registering your app with APNs",
          "url" : "https:\/\/developer.apple.com\/documentation\/UserNotifications\/registering-your-app-with-apns"
        },
        {
          "description" : "Send notifications to the user’s device with a JSON payload.",
          "name" : "Generating a remote notification",
          "url" : "https:\/\/developer.apple.com\/documentation\/UserNotifications\/generating-a-remote-notification"
        },
        {
          "description" : "Deliver notifications that wake your app and update it in the background.",
          "name" : "Pushing background updates to your App",
          "url" : "https:\/\/developer.apple.com\/documentation\/UserNotifications\/pushing-background-updates-to-your-app"
        }
      ],
      "title" : "Server tasks"
    }
  ],
  "source" : "appleJSON",
  "title" : "Establishing a connection to Apple Push Notification service (APNs)",
  "url" : "https:\/\/developer.apple.com\/documentation\/UserNotifications\/establishing-a-connection-to-apns"
}