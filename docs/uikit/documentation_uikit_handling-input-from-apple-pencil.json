{
  "abstract" : "Learn how to detect and respond to touches from Apple Pencil.",
  "codeExamples" : [
    {
      "code" : "var estimates : [NSNumber : StrokeSample]\n \nfunc addSamples(for touches: [UITouch]) {\n   if let stroke = strokeCollection?.activeStroke {\n      for touch in touches {\n         if touch == touches.last {\n            let sample = StrokeSample(point: touch.location(in: self), \n                                 forceValue: touch.force)\n            stroke.add(sample: sample)\n            registerForEstimates(touch: touch, sample: sample)\n         } else {\n            let sample = StrokeSample(point: touch.location(in: self), \n                                 forceValue: touch.force, coalesced: true)\n            stroke.add(sample: sample)\n            registerForEstimates(touch: touch, sample: sample)\n         }\n      }\n      self.setNeedsDisplay()\n   }\n}\n \nfunc registerForEstimates(touch : UITouch, sample : StrokeSample) {\n   if touch.estimatedPropertiesExpectingUpdates.contains(.force) {\n      estimates[touch.estimationUpdateIndex!] = sample\n   }\n}",
      "language" : "swift"
    },
    {
      "code" : "override func touchesEstimatedPropertiesUpdated(_ touches: Set<UITouch>) {\n   for touch in touches {\n      \/\/ If the force value is no longer an estimate, update it.\n      if !touch.estimatedPropertiesExpectingUpdates.contains(.force) {\n         let index = touch.estimationUpdateIndex!\n         var sample = estimates[index]\n         sample?.force = touch.force\n \n         \/\/ Remove the key and value from the dictionary.\n         estimates.removeValue(forKey: index)\n      }\n   }\n}",
      "language" : "swift"
    }
  ],
  "contentHash" : "ddfe9f21d58d0145b4f027c218501c157fdaa571b00669b4e1e3fdf33697d073",
  "crawledAt" : "2025-12-02T16:19:48Z",
  "id" : "B0B9FC21-255E-450E-A71F-40D7A598068E",
  "kind" : "collection",
  "language" : "swift",
  "module" : "UIKit",
  "overview" : "## Overview\n\nUIKit reports touches from Apple Pencil in the same way it reports touches from a person’s fingers. Specifically, UIKit delivers a [doc:\/\/com.apple.uikit\/documentation\/UIKit\/UITouch] object containing the location of the touch in your app. However, a touch object originating from Apple Pencil contains additional information, including the azimuth and altitude of Apple Pencil and the amount of force recorded at its tip.\n\n\n\nBecause Apple Pencil is a separate device, there’s a delay between the time Apple Pencil gathers altitude, azimuth, and force values and the time that those values are reported to your app. As a result, UIKit may provide *estimated* values for those properties initially, and then provide the real values at a later time. If you use altitude, azimuth, or force information from Apple Pencil, you must explicitly handle estimated properties.\n\n### Handle estimated properties\n\nWhen UIKit has only an estimate of a property’s value, it includes a flag in the [doc:\/\/com.apple.uikit\/documentation\/UIKit\/UITouch\/estimatedPropertiesExpectingUpdates] property of the corresponding [doc:\/\/com.apple.uikit\/documentation\/UIKit\/UITouch] object. When handling a touch event, check that property to determine if you need to update the touch information later.\n\nWhen a touch object contains estimated properties, UIKit also provides a value in the [doc:\/\/com.apple.uikit\/documentation\/UIKit\/UITouch\/estimationUpdateIndex] property that you can use to identify the touch later. Use the value in the [doc:\/\/com.apple.uikit\/documentation\/UIKit\/UITouch\/estimationUpdateIndex] property as a key to a dictionary that you maintain. Set the value of that key to the app-specific object that you use to store the touch information. When UIKit later reports the real values, use the index to look up your app-specific object and replace the estimated values with the real values.\n\nThe following code shows the `addSamples` method of an app that captures touch data. For each touch, the method creates a custom `StrokeSample` object with the touch information. If the force value of the touch is only an estimate, the `registerForEstimates` method caches the sample in a dictionary using the value in the [doc:\/\/com.apple.uikit\/documentation\/UIKit\/UITouch\/estimationUpdateIndex] property as the key.\n\nWhen UIKit receives the actual values for a touch, it calls the [doc:\/\/com.apple.uikit\/documentation\/UIKit\/UIResponder\/touchesEstimatedPropertiesUpdated(_:)] method of your responder or gesture recognizer. Use that method to replace estimated data with the real values provided by UIKit.\n\nThe following code shows an example of the [doc:\/\/com.apple.uikit\/documentation\/UIKit\/UIResponder\/touchesEstimatedPropertiesUpdated(_:)] method, which updates the force value for the cached `StrokeSample` objects created in the previous code example. The method uses the value in the [doc:\/\/com.apple.uikit\/documentation\/UIKit\/UITouch\/estimationUpdateIndex] property to retrieve the `StrokeSample` object from the `estimates` dictionary. It then updates the force value and removes the sample from the dictionary.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/UIKit\/handling-input-from-apple-pencil\ncrawled: 2025-12-02T16:19:48Z\n---\n\n# Handling input from Apple Pencil\n\nLearn how to detect and respond to touches from Apple Pencil.\n\n## Overview\n\nUIKit reports touches from Apple Pencil in the same way it reports touches from a person’s fingers. Specifically, UIKit delivers a [doc:\/\/com.apple.uikit\/documentation\/UIKit\/UITouch] object containing the location of the touch in your app. However, a touch object originating from Apple Pencil contains additional information, including the azimuth and altitude of Apple Pencil and the amount of force recorded at its tip.\n\n\n\nBecause Apple Pencil is a separate device, there’s a delay between the time Apple Pencil gathers altitude, azimuth, and force values and the time that those values are reported to your app. As a result, UIKit may provide *estimated* values for those properties initially, and then provide the real values at a later time. If you use altitude, azimuth, or force information from Apple Pencil, you must explicitly handle estimated properties.\n\n\n\n### Handle estimated properties\n\nWhen UIKit has only an estimate of a property’s value, it includes a flag in the [doc:\/\/com.apple.uikit\/documentation\/UIKit\/UITouch\/estimatedPropertiesExpectingUpdates] property of the corresponding [doc:\/\/com.apple.uikit\/documentation\/UIKit\/UITouch] object. When handling a touch event, check that property to determine if you need to update the touch information later.\n\nWhen a touch object contains estimated properties, UIKit also provides a value in the [doc:\/\/com.apple.uikit\/documentation\/UIKit\/UITouch\/estimationUpdateIndex] property that you can use to identify the touch later. Use the value in the [doc:\/\/com.apple.uikit\/documentation\/UIKit\/UITouch\/estimationUpdateIndex] property as a key to a dictionary that you maintain. Set the value of that key to the app-specific object that you use to store the touch information. When UIKit later reports the real values, use the index to look up your app-specific object and replace the estimated values with the real values.\n\nThe following code shows the `addSamples` method of an app that captures touch data. For each touch, the method creates a custom `StrokeSample` object with the touch information. If the force value of the touch is only an estimate, the `registerForEstimates` method caches the sample in a dictionary using the value in the [doc:\/\/com.apple.uikit\/documentation\/UIKit\/UITouch\/estimationUpdateIndex] property as the key.\n\n```swift\nvar estimates : [NSNumber : StrokeSample]\n \nfunc addSamples(for touches: [UITouch]) {\n   if let stroke = strokeCollection?.activeStroke {\n      for touch in touches {\n         if touch == touches.last {\n            let sample = StrokeSample(point: touch.location(in: self), \n                                 forceValue: touch.force)\n            stroke.add(sample: sample)\n            registerForEstimates(touch: touch, sample: sample)\n         } else {\n            let sample = StrokeSample(point: touch.location(in: self), \n                                 forceValue: touch.force, coalesced: true)\n            stroke.add(sample: sample)\n            registerForEstimates(touch: touch, sample: sample)\n         }\n      }\n      self.setNeedsDisplay()\n   }\n}\n \nfunc registerForEstimates(touch : UITouch, sample : StrokeSample) {\n   if touch.estimatedPropertiesExpectingUpdates.contains(.force) {\n      estimates[touch.estimationUpdateIndex!] = sample\n   }\n}\n```\n\nWhen UIKit receives the actual values for a touch, it calls the [doc:\/\/com.apple.uikit\/documentation\/UIKit\/UIResponder\/touchesEstimatedPropertiesUpdated(_:)] method of your responder or gesture recognizer. Use that method to replace estimated data with the real values provided by UIKit.\n\nThe following code shows an example of the [doc:\/\/com.apple.uikit\/documentation\/UIKit\/UIResponder\/touchesEstimatedPropertiesUpdated(_:)] method, which updates the force value for the cached `StrokeSample` objects created in the previous code example. The method uses the value in the [doc:\/\/com.apple.uikit\/documentation\/UIKit\/UITouch\/estimationUpdateIndex] property to retrieve the `StrokeSample` object from the `estimates` dictionary. It then updates the force value and removes the sample from the dictionary.\n\n```swift\noverride func touchesEstimatedPropertiesUpdated(_ touches: Set<UITouch>) {\n   for touch in touches {\n      \/\/ If the force value is no longer an estimate, update it.\n      if !touch.estimatedPropertiesExpectingUpdates.contains(.force) {\n         let index = touch.estimationUpdateIndex!\n         var sample = estimates[index]\n         sample?.force = touch.force\n \n         \/\/ Remove the key and value from the dictionary.\n         estimates.removeValue(forKey: index)\n      }\n   }\n}\n```\n\n## Related articles\n\n- **Computing the perpendicular force of Apple Pencil**: Adjust the force values reported by Apple Pencil so that they’re consistent with 3D Touch force values.\n\n## Essentials\n\n- **Handling double taps from Apple Pencil**: Detect and respond to double taps a person makes on Apple Pencil.\n- **Handling squeezes from Apple Pencil**: Detect and respond to squeezes a person makes on Apple Pencil Pro.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Adjust the force values reported by Apple Pencil so that they’re consistent with 3D Touch force values.",
          "name" : "Computing the perpendicular force of Apple Pencil",
          "url" : "https:\/\/developer.apple.com\/documentation\/UIKit\/computing-the-perpendicular-force-of-apple-pencil"
        }
      ],
      "title" : "Related articles"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "Detect and respond to double taps a person makes on Apple Pencil.",
          "name" : "Handling double taps from Apple Pencil",
          "url" : "https:\/\/developer.apple.com\/documentation\/ApplePencil\/handling-double-taps-from-apple-pencil"
        },
        {
          "description" : "Detect and respond to squeezes a person makes on Apple Pencil Pro.",
          "name" : "Handling squeezes from Apple Pencil",
          "url" : "https:\/\/developer.apple.com\/documentation\/ApplePencil\/handling-squeezes-from-apple-pencil"
        }
      ],
      "title" : "Essentials"
    }
  ],
  "source" : "appleJSON",
  "title" : "Handling input from Apple Pencil",
  "url" : "https:\/\/developer.apple.com\/documentation\/UIKit\/handling-input-from-apple-pencil"
}