{
  "abstract" : "Listen for and respond to a user’s preference changes in your Mac app built with Mac Catalyst using Combine.",
  "codeExamples" : [
    {
      "code" : "func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -> Bool {\n\n    \/\/ To ensure that the app has a good set of preference values, register\n    \/\/ the default values each time the app launches.\n    registerDefaultPreferenceValues()\n\n    return true\n}",
      "language" : "swift"
    },
    {
      "code" : "func registerDefaultPreferenceValues() {\n    let preferenceSpecifiers = retrieveSettingsBundlePreferenceSpecifiers(from: \"Root.plist\")\n    let defaultValuesToRegister = parse(preferenceSpecifiers)\n\n    \/\/ Register the default values with the registration domain.\n    UserDefaults.standard.register(defaults: defaultValuesToRegister)\n}",
      "language" : "swift"
    },
    {
      "code" : "func parse(_ preferenceSpecifiers: [NSDictionary]) -> [String: Any] {\n    var defaultValuesToRegister = [String: Any]()\n\n    \/\/ Parse the preference specifiers, copying the default values\n    \/\/ into the `defaultValuesToRegister` dictionary.\n    for preferenceItem in preferenceSpecifiers {\n        if let key = preferenceItem[\"Key\"] as? String,\n            let defaultValue = preferenceItem[\"DefaultValue\"] {\n            defaultValuesToRegister[key] = defaultValue\n        }\n\n        \/\/ Add child pane preference specifiers.\n        if let type = preferenceItem[\"Type\"] as? String,\n            type == \"PSChildPaneSpecifier\" {\n            if var file = preferenceItem[\"File\"] as? String {\n                if file.hasSuffix(\".plist\") == false {\n                    file += \".plist\"\n                }\n                let morePreferenceSpecifiers = retrieveSettingsBundlePreferenceSpecifiers(from: file)\n                let moreDefaultValuesToRegister = parse(morePreferenceSpecifiers)\n                defaultValuesToRegister.merge(moreDefaultValuesToRegister) { (current, _) in current }\n            }\n        }\n    }\n    \n    return defaultValuesToRegister\n}",
      "language" : "swift"
    },
    {
      "code" : "extension UserDefaults {\n\n    @objc dynamic var backgroundColorValue: Int {\n        return integer(forKey: \"backgroundColorValue\")\n    }\n    \n    @objc dynamic var someRandomOption: Bool {\n        return bool(forKey: \"someRandomOption\")\n    }\n\n}",
      "language" : "swift"
    },
    {
      "code" : "var subscriber: AnyCancellable?   \/\/ Subscriber of preference changes.\n\noverride func viewDidLoad() {\n    super.viewDidLoad()\n    \n    \/\/ Set the view's initial background color to the color specified in Preferences.\n    if let colorSetting = BackgroundColors(rawValue: UserDefaults.standard.backgroundColorValue) {\n        view.backgroundColor = colorSetting.currentColor()\n    }\n    \n    \/\/ Listen for changes to the background color preference made in the Preferences window.\n    subscriber = UserDefaults.standard\n        .publisher(for: \\.backgroundColorValue, options: [.initial, .new])\n        .map( { BackgroundColors(rawValue: $0)?.currentColor() })\n        .assign(to: \\UIView.backgroundColor, on: self.view)\n}",
      "language" : "swift"
    }
  ],
  "contentHash" : "af1d1b4d3a0b33fe8e041ef8d6531785efba48c9dbcc637c84dd297ac410043f",
  "crawledAt" : "2025-12-02T15:52:15Z",
  "id" : "E52B2454-AC5C-4227-B137-E41C31657D98",
  "kind" : "unknown",
  "language" : "swift",
  "module" : "UIKit",
  "overview" : "## Overview\n\nWith [doc:\/\/com.apple.documentation\/documentation\/Combine], your app can listen for changes a user makes to the app’s Preferences window, and respond to those changes. The sample app provides a Preferences window with one setting: background color. When the user selects a color, the background of the main view changes to match their selection.\n\nThis sample code project shows how to:\n\nTo use the sample app, open the sample code project in Xcode and select My Mac as the destination. Then, build and run the sample project.\n\n### Provide a preferences window in the app\n\nThe sample app includes a `Settings.bundle` file that the system uses to automatically add the standard Preferences menu item to the app menu. Selecting the menu item displays a Preferences window that the system generates based on the preference specifiers defined in the Settings bundle. To learn more, see [doc:\/\/com.apple.uikit\/documentation\/UIKit\/displaying-a-preferences-window].\n\nThe Settings bundle for the sample app has a preference specifier for setting the background color of the main view. It also has a child pane preference specifier, which displays a second tab of preferences in the Preferences windows. The Settings bundle file `Root.plist` defines these specifiers, while the file `OtherSettings.plist` defines the preference specifiers for the child pane.\n\n### Register default preference values\n\nWhen the user changes preferences in the Preferences window, the window saves them to the application domain of the user defaults system. To store and retrieve the preference values within the app, the sample app uses [doc:\/\/com.apple.documentation\/documentation\/Foundation\/UserDefaults]. However, when you launch the sample app for the first time, the preference values don’t exist in the user defaults system. If the app tries retrieving a value, [doc:\/\/com.apple.documentation\/documentation\/Foundation\/UserDefaults] returns `nil`.\n\nTo ensure that the app always retrieves a non-`nil` value, the sample app registers the default preference values with the registration domain. However, this domain doesn’t persist these values between app launches, so the sample app registers the default values each time the user launches the app.\n\nThe method `registerDefaultPreferenceValues()` retrieves the default values from the Settings bundle by retrieving the preference specifiers from the `Root.plist` file and parsing the specifiers for their default value. After retrieving the values, the method registers the default values.\n\nTo parse the preference specifiers, the `parse()` method loops through the array of specifiers, copying the default values into the dictionary `defaultValuesToRegister`. If the method detects the `PSChildPaneSpecifier` type, it gets the name of the child pane property list file, and merges the default values in the file into the `defaultValuesToRegister` dictionary. After gathering the default values, the method returns the dictionary to the caller.\n\n### Retrieve preference values\n\nAfter registering the default values with the registration domain, the app can retrieve a preference value without the possibility of encountering an unavailable value. To simplify access to the background color preference value, the sample app extends [doc:\/\/com.apple.documentation\/documentation\/Foundation\/UserDefaults] to include properties for each preference value.\n\n### Handle changes made in the preferences window\n\nAs the user changes the background color setting in the Preferences window, the app changes the background color of its main view. To accomplish this, the view controller for the main view creates a subscriber in the [doc:\/\/com.apple.uikit\/documentation\/UIKit\/UIViewController\/viewDidLoad()] method. When the background color value changes, the subscriber receives the new value, maps it to a [doc:\/\/com.apple.uikit\/documentation\/UIKit\/UIColor] object, and assigns the color to the view’s [doc:\/\/com.apple.uikit\/documentation\/UIKit\/UIView\/backgroundColor] property.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/UIKit\/detecting-changes-in-the-preferences-window\ncrawled: 2025-12-02T15:52:15Z\n---\n\n# Detecting changes in the preferences window\n\n**Sample Code**\n\nListen for and respond to a user’s preference changes in your Mac app built with Mac Catalyst using Combine.\n\n## Overview\n\nWith [doc:\/\/com.apple.documentation\/documentation\/Combine], your app can listen for changes a user makes to the app’s Preferences window, and respond to those changes. The sample app provides a Preferences window with one setting: background color. When the user selects a color, the background of the main view changes to match their selection.\n\nThis sample code project shows how to:\n\n- Add a Preferences window in a Mac app built with Mac Catalyst.\n- Register default values for the preferences.\n- Retrieve current preference values.\n- Listen for and respond to changes the user makes in the Preferences window.\n\nTo use the sample app, open the sample code project in Xcode and select My Mac as the destination. Then, build and run the sample project.\n\n### Provide a preferences window in the app\n\nThe sample app includes a `Settings.bundle` file that the system uses to automatically add the standard Preferences menu item to the app menu. Selecting the menu item displays a Preferences window that the system generates based on the preference specifiers defined in the Settings bundle. To learn more, see [doc:\/\/com.apple.uikit\/documentation\/UIKit\/displaying-a-preferences-window].\n\nThe Settings bundle for the sample app has a preference specifier for setting the background color of the main view. It also has a child pane preference specifier, which displays a second tab of preferences in the Preferences windows. The Settings bundle file `Root.plist` defines these specifiers, while the file `OtherSettings.plist` defines the preference specifiers for the child pane.\n\n### Register default preference values\n\nWhen the user changes preferences in the Preferences window, the window saves them to the application domain of the user defaults system. To store and retrieve the preference values within the app, the sample app uses [doc:\/\/com.apple.documentation\/documentation\/Foundation\/UserDefaults]. However, when you launch the sample app for the first time, the preference values don’t exist in the user defaults system. If the app tries retrieving a value, [doc:\/\/com.apple.documentation\/documentation\/Foundation\/UserDefaults] returns `nil`.\n\nTo ensure that the app always retrieves a non-`nil` value, the sample app registers the default preference values with the registration domain. However, this domain doesn’t persist these values between app launches, so the sample app registers the default values each time the user launches the app.\n\n```swift\nfunc application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -> Bool {\n\n    \/\/ To ensure that the app has a good set of preference values, register\n    \/\/ the default values each time the app launches.\n    registerDefaultPreferenceValues()\n\n    return true\n}\n```\n\nThe method `registerDefaultPreferenceValues()` retrieves the default values from the Settings bundle by retrieving the preference specifiers from the `Root.plist` file and parsing the specifiers for their default value. After retrieving the values, the method registers the default values.\n\n```swift\nfunc registerDefaultPreferenceValues() {\n    let preferenceSpecifiers = retrieveSettingsBundlePreferenceSpecifiers(from: \"Root.plist\")\n    let defaultValuesToRegister = parse(preferenceSpecifiers)\n\n    \/\/ Register the default values with the registration domain.\n    UserDefaults.standard.register(defaults: defaultValuesToRegister)\n}\n```\n\nTo parse the preference specifiers, the `parse()` method loops through the array of specifiers, copying the default values into the dictionary `defaultValuesToRegister`. If the method detects the `PSChildPaneSpecifier` type, it gets the name of the child pane property list file, and merges the default values in the file into the `defaultValuesToRegister` dictionary. After gathering the default values, the method returns the dictionary to the caller.\n\n```swift\nfunc parse(_ preferenceSpecifiers: [NSDictionary]) -> [String: Any] {\n    var defaultValuesToRegister = [String: Any]()\n\n    \/\/ Parse the preference specifiers, copying the default values\n    \/\/ into the `defaultValuesToRegister` dictionary.\n    for preferenceItem in preferenceSpecifiers {\n        if let key = preferenceItem[\"Key\"] as? String,\n            let defaultValue = preferenceItem[\"DefaultValue\"] {\n            defaultValuesToRegister[key] = defaultValue\n        }\n\n        \/\/ Add child pane preference specifiers.\n        if let type = preferenceItem[\"Type\"] as? String,\n            type == \"PSChildPaneSpecifier\" {\n            if var file = preferenceItem[\"File\"] as? String {\n                if file.hasSuffix(\".plist\") == false {\n                    file += \".plist\"\n                }\n                let morePreferenceSpecifiers = retrieveSettingsBundlePreferenceSpecifiers(from: file)\n                let moreDefaultValuesToRegister = parse(morePreferenceSpecifiers)\n                defaultValuesToRegister.merge(moreDefaultValuesToRegister) { (current, _) in current }\n            }\n        }\n    }\n    \n    return defaultValuesToRegister\n}\n```\n\n### Retrieve preference values\n\nAfter registering the default values with the registration domain, the app can retrieve a preference value without the possibility of encountering an unavailable value. To simplify access to the background color preference value, the sample app extends [doc:\/\/com.apple.documentation\/documentation\/Foundation\/UserDefaults] to include properties for each preference value.\n\n```swift\nextension UserDefaults {\n\n    @objc dynamic var backgroundColorValue: Int {\n        return integer(forKey: \"backgroundColorValue\")\n    }\n    \n    @objc dynamic var someRandomOption: Bool {\n        return bool(forKey: \"someRandomOption\")\n    }\n\n}\n```\n\n### Handle changes made in the preferences window\n\nAs the user changes the background color setting in the Preferences window, the app changes the background color of its main view. To accomplish this, the view controller for the main view creates a subscriber in the [doc:\/\/com.apple.uikit\/documentation\/UIKit\/UIViewController\/viewDidLoad()] method. When the background color value changes, the subscriber receives the new value, maps it to a [doc:\/\/com.apple.uikit\/documentation\/UIKit\/UIColor] object, and assigns the color to the view’s [doc:\/\/com.apple.uikit\/documentation\/UIKit\/UIView\/backgroundColor] property.\n\n```swift\nvar subscriber: AnyCancellable?   \/\/ Subscriber of preference changes.\n\noverride func viewDidLoad() {\n    super.viewDidLoad()\n    \n    \/\/ Set the view's initial background color to the color specified in Preferences.\n    if let colorSetting = BackgroundColors(rawValue: UserDefaults.standard.backgroundColorValue) {\n        view.backgroundColor = colorSetting.currentColor()\n    }\n    \n    \/\/ Listen for changes to the background color preference made in the Preferences window.\n    subscriber = UserDefaults.standard\n        .publisher(for: \\.backgroundColorValue, options: [.initial, .new])\n        .map( { BackgroundColors(rawValue: $0)?.currentColor() })\n        .assign(to: \\UIView.backgroundColor, on: self.view)\n}\n```\n\n## User preferences\n\n- **Displaying a Preferences window**: Provide a Preferences window in your Mac app built with Mac Catalyst so users can manage app preferences defined in a Settings bundle.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Provide a Preferences window in your Mac app built with Mac Catalyst so users can manage app preferences defined in a Settings bundle.",
          "name" : "Displaying a Preferences window",
          "url" : "https:\/\/developer.apple.com\/documentation\/UIKit\/displaying-a-preferences-window"
        }
      ],
      "title" : "User preferences"
    }
  ],
  "source" : "appleJSON",
  "title" : "Detecting changes in the preferences window",
  "url" : "https:\/\/developer.apple.com\/documentation\/UIKit\/detecting-changes-in-the-preferences-window"
}