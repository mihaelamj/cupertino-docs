{
  "abstract" : "Receive incoming Voice-over-IP (VoIP) push notifications and use them to display the system call interface to the user.",
  "codeExamples" : [
    {
      "code" : "\/\/ Configure the app's CallKit provider object.\nlet config = CXProviderConfiguration(localizedName: \"VoIP Service\")\nconfig.supportsVideo = true\nconfig.supportedHandleTypes = [.phoneNumber]\nconfig.maximumCallsPerCallGroup = 1\n\n\/\/ Create the provider and attach the custom delegate object\n\/\/ used by the app to respond to updates.\ncallProvider = CXProvider(configuration: config)\ncallProvider?.setDelegate(callManager, queue: nil)",
      "language" : "swift"
    },
    {
      "code" : "func pushRegistry(_ registry: PKPushRegistry, \n          didReceiveIncomingPushWith payload: PKPushPayload, \n          for type: PKPushType, \n          completion: @escaping () -> Void) {\n   if type == .voIP {\n      \/\/ Extract the call information from the push notification payload\n      if let handle = payload.dictionaryPayload[\"handle\"] as? String,\n            let uuidString = payload.dictionaryPayload[\"callUUID\"] as? String,\n            let callUUID = UUID(uuidString: uuidString) {\n\n         \/\/ Configure the call information data structures.\n         let callUpdate = CXCallUpdate()\n         let phoneNumber = CXHandle(type: .phoneNumber, value: handle)\n         callUpdate.remoteHandle = phoneNumber\n                \n         \/\/ Report the call to CallKit, and let it display the call UI.\n         callProvider?.reportNewIncomingCall(with: callUUID, \n                     update: callUpdate, completion: { (error) in\n            if error == nil {\n               \/\/ If the system allows the call to proceed, make a data record for it.\n               let newCall = VoipCall(callUUID, phoneNumber: phoneNumber)\n               self.callManager.addCall(newCall)\n            }\n\n            \/\/ Tell PushKit that the notification is handled.\n            completion()\n         })\n                \n         \/\/ Asynchronously register with the telephony server and \n         \/\/ process the call. Report updates to CallKit as needed.\n         establishConnection(for: callUUID)\n      }\n   }\n}\n",
      "language" : "swift"
    }
  ],
  "contentHash" : "4f2deec982a73afc814b1af6d237bd6db5be12b78a26cbee16791c0ef4a3d7b8",
  "crawledAt" : "2025-12-06T07:16:24Z",
  "id" : "90BA72FD-451B-482A-8AB4-FF3A0450F5F9",
  "kind" : "article",
  "language" : "swift",
  "module" : "PushKit",
  "overview" : "## Overview\n\nIf your app provides Voice-over-IP (VoIP) phone services, you may use PushKit to handle incoming calls on user devices. PushKit provides an efficient way to manage calls that doesn’t require your app to be running to receive calls. When it detects a call for a specific user, your server sends a push notification to the user’s device with information about that call. Upon receiving the notification, the device wakes up your app and gives it time to notify the user and connect to your call service.\n\nFor apps built using the iOS 13 SDK or later, PushKit requires you to use CallKit when handling VoIP calls. CallKit ensures that apps providing call-related services on a user’s device work seamlessly together on the user’s device, and respect features like Do Not Disturb. CallKit also operates the system’s call-related UIs, including the incoming or outgoing call screens. Use CallKit to present these interfaces and manage interactions with them.\n\nFor information about how to configure your app to app to support PushKit, see [doc:\/\/com.apple.pushkit\/documentation\/PushKit\/supporting-pushkit-notifications-in-your-app].\n\n### Create a Call Provider Object to Manage Calls in Your App\n\nVoIP apps must use CallKit to present the system’s call-related interfaces. You present these interfaces using a [doc:\/\/com.apple.documentation\/documentation\/CallKit\/CXProvider] object, which manages user interactions for both incoming and outgoing calls. Create a provider object early in your app’s life cycle and make it available to your app’s call-related code.\n\nThe following code example shows how to create a provider object and assign a custom delegate to it. Initialize the [doc:\/\/com.apple.documentation\/documentation\/CallKit\/CXProvider] object with a configuration object containing the details about your service. Assign one of your app’s custom objects as a delegate, and use that object to respond to user actions and telephony-related changes.\n\nEach provider object represents a single instance of your app’s phone service and facilitates interactions with the system. Apps need only one provider object to manage phone calls for the current user. If your service allows multiple users or multiple accounts per user, you are responsible for mapping incoming calls to the appropriate user accounts.\n\n### Generate Push Notifications from Your Server\n\nYour servers handle most of the call-related work required to connect users. Each time the user opens your app on a device, create a connection from that app to your server. When the user initiates a phone call, use that connection to communicate the details of the call back to your server. Your server must then try to connect the call initiator with the call recipient. If the recipient’s app is running and has an active connection with the server, communicate directly with the app using your existing connection. If the app is not running, generate a push notification to wake up the app.\n\nEach push notification consists of a device token and a payload with the details of the call. You bundle this information into an HTTP request, which you then send to Apple Push Notification service (APNs). PushKit provides the device token that you use as the target address for the user’s device at configuration time.\n\nWhen configuring the HTTP request for VoIP push notifications, always configure your requests with the following information:\n\nFor information about configuring a custom server to generate push notifications, see [doc:\/\/com.apple.documentation\/documentation\/UserNotifications\/setting-up-a-remote-notification-server]. For information about how to send push notifications, see [doc:\/\/com.apple.documentation\/documentation\/UserNotifications\/sending-notification-requests-to-apns].\n\n### Respond to VoIP Push Notifications in Your App\n\nWhen one of your users initiates a phone call, your server must connect to your app on the recipient’s device. If your server doesn’t have an active network connection to the app, you can ask the app to check in by sending it a push notification. Construct the push notification request on your server and send it to APNs for delivery to the user’s device. For VoIP push notifications, the system launches or wakes your app and delivers the notification to your app’s [doc:\/\/com.apple.pushkit\/documentation\/PushKit\/PKPushRegistry] object, which calls the [doc:\/\/com.apple.pushkit\/documentation\/PushKit\/PKPushRegistryDelegate\/pushRegistry(_:didReceiveIncomingPushWith:for:completion:)] method of its delegate. Use that method to display the incoming call UI and to establish a connection to your VoIP server.\n\nThe following code example shows how you might process an incoming VoIP push notification in your [doc:\/\/com.apple.pushkit\/documentation\/PushKit\/PKPushRegistryDelegate\/pushRegistry(_:didReceiveIncomingPushWith:for:completion:)] method. After extracting the call data from the notification’s payload dictionary, create a [doc:\/\/com.apple.documentation\/documentation\/CallKit\/CXCallUpdate] object and pass it to the [doc:\/\/com.apple.documentation\/documentation\/CallKit\/CXProvider\/reportNewIncomingCall(with:update:completion:)] method of your app’s [doc:\/\/com.apple.documentation\/documentation\/CallKit\/CXProvider] object. While CallKit processes your request, establish a connection to your VoIP server in parallel; you can always notify CallKit later if you run into problems. If CallKit handles the call successfully, the completion block creates some custom data structures to manage that call within the app.\n\nIf the system allows your call to proceed, the [doc:\/\/com.apple.documentation\/documentation\/CallKit\/CXProvider\/reportNewIncomingCall(with:update:completion:)] method executes its completion block and CallKit displays the incoming call interface. At that point, use the delegate of your [doc:\/\/com.apple.documentation\/documentation\/CallKit\/CXProvider] object to respond to user interactions with the interface. For example, use your delegate to respond when the user answers or ends the call.\n\nFor more information about how to handle user interactions with the call interface, see the methods of [doc:\/\/com.apple.documentation\/documentation\/CallKit\/CXProviderDelegate].\n\n### Respond to Call Hang Ups and Failures\n\nMany things can go wrong when connecting a VoIP call, and CallKit makes it easy to handle problems when they occur.\n\nAfter sending the initial push notification, don’t send additional push notifications to cancel the call or communicate new details to your app. Instead, communicate with the app directly over the network connection you established between it and your server. Using an existing network connection is generally faster than sending a push notification, and if network conditions are poor, APNs may be unable to deliver push notifications to the device anyway.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/pushkit\/responding-to-voip-notifications-from-pushkit\ncrawled: 2025-12-06T07:16:24Z\n---\n\n# Responding to VoIP Notifications from PushKit\n\n**Article**\n\nReceive incoming Voice-over-IP (VoIP) push notifications and use them to display the system call interface to the user.\n\n## Overview\n\nIf your app provides Voice-over-IP (VoIP) phone services, you may use PushKit to handle incoming calls on user devices. PushKit provides an efficient way to manage calls that doesn’t require your app to be running to receive calls. When it detects a call for a specific user, your server sends a push notification to the user’s device with information about that call. Upon receiving the notification, the device wakes up your app and gives it time to notify the user and connect to your call service.\n\nFor apps built using the iOS 13 SDK or later, PushKit requires you to use CallKit when handling VoIP calls. CallKit ensures that apps providing call-related services on a user’s device work seamlessly together on the user’s device, and respect features like Do Not Disturb. CallKit also operates the system’s call-related UIs, including the incoming or outgoing call screens. Use CallKit to present these interfaces and manage interactions with them.\n\n\n\nFor information about how to configure your app to app to support PushKit, see [doc:\/\/com.apple.pushkit\/documentation\/PushKit\/supporting-pushkit-notifications-in-your-app].\n\n### Create a Call Provider Object to Manage Calls in Your App\n\nVoIP apps must use CallKit to present the system’s call-related interfaces. You present these interfaces using a [doc:\/\/com.apple.documentation\/documentation\/CallKit\/CXProvider] object, which manages user interactions for both incoming and outgoing calls. Create a provider object early in your app’s life cycle and make it available to your app’s call-related code.\n\nThe following code example shows how to create a provider object and assign a custom delegate to it. Initialize the [doc:\/\/com.apple.documentation\/documentation\/CallKit\/CXProvider] object with a configuration object containing the details about your service. Assign one of your app’s custom objects as a delegate, and use that object to respond to user actions and telephony-related changes.\n\n```swift\n\/\/ Configure the app's CallKit provider object.\nlet config = CXProviderConfiguration(localizedName: \"VoIP Service\")\nconfig.supportsVideo = true\nconfig.supportedHandleTypes = [.phoneNumber]\nconfig.maximumCallsPerCallGroup = 1\n\n\/\/ Create the provider and attach the custom delegate object\n\/\/ used by the app to respond to updates.\ncallProvider = CXProvider(configuration: config)\ncallProvider?.setDelegate(callManager, queue: nil)\n```\n\nEach provider object represents a single instance of your app’s phone service and facilitates interactions with the system. Apps need only one provider object to manage phone calls for the current user. If your service allows multiple users or multiple accounts per user, you are responsible for mapping incoming calls to the appropriate user accounts.\n\n### Generate Push Notifications from Your Server\n\nYour servers handle most of the call-related work required to connect users. Each time the user opens your app on a device, create a connection from that app to your server. When the user initiates a phone call, use that connection to communicate the details of the call back to your server. Your server must then try to connect the call initiator with the call recipient. If the recipient’s app is running and has an active connection with the server, communicate directly with the app using your existing connection. If the app is not running, generate a push notification to wake up the app.\n\nEach push notification consists of a device token and a payload with the details of the call. You bundle this information into an HTTP request, which you then send to Apple Push Notification service (APNs). PushKit provides the device token that you use as the target address for the user’s device at configuration time.\n\nWhen configuring the HTTP request for VoIP push notifications, always configure your requests with the following information:\n\n- Set the value of the `apns-expiration` header field to `0`, or to only a few seconds. Doing so prevents the system from delivering the notification at a much later time.\n- Include information about the incoming call to the JSON payload. For example, include the unique call identifier that your server uses to track the call. Your app can use this identifier to check in with the server later. You might also want to include information about the caller, so that you can display that information in the incoming call UI.\n\nFor information about configuring a custom server to generate push notifications, see [doc:\/\/com.apple.documentation\/documentation\/UserNotifications\/setting-up-a-remote-notification-server]. For information about how to send push notifications, see [doc:\/\/com.apple.documentation\/documentation\/UserNotifications\/sending-notification-requests-to-apns].\n\n### Respond to VoIP Push Notifications in Your App\n\nWhen one of your users initiates a phone call, your server must connect to your app on the recipient’s device. If your server doesn’t have an active network connection to the app, you can ask the app to check in by sending it a push notification. Construct the push notification request on your server and send it to APNs for delivery to the user’s device. For VoIP push notifications, the system launches or wakes your app and delivers the notification to your app’s [doc:\/\/com.apple.pushkit\/documentation\/PushKit\/PKPushRegistry] object, which calls the [doc:\/\/com.apple.pushkit\/documentation\/PushKit\/PKPushRegistryDelegate\/pushRegistry(_:didReceiveIncomingPushWith:for:completion:)] method of its delegate. Use that method to display the incoming call UI and to establish a connection to your VoIP server.\n\nThe following code example shows how you might process an incoming VoIP push notification in your [doc:\/\/com.apple.pushkit\/documentation\/PushKit\/PKPushRegistryDelegate\/pushRegistry(_:didReceiveIncomingPushWith:for:completion:)] method. After extracting the call data from the notification’s payload dictionary, create a [doc:\/\/com.apple.documentation\/documentation\/CallKit\/CXCallUpdate] object and pass it to the [doc:\/\/com.apple.documentation\/documentation\/CallKit\/CXProvider\/reportNewIncomingCall(with:update:completion:)] method of your app’s [doc:\/\/com.apple.documentation\/documentation\/CallKit\/CXProvider] object. While CallKit processes your request, establish a connection to your VoIP server in parallel; you can always notify CallKit later if you run into problems. If CallKit handles the call successfully, the completion block creates some custom data structures to manage that call within the app.\n\n```swift\nfunc pushRegistry(_ registry: PKPushRegistry, \n          didReceiveIncomingPushWith payload: PKPushPayload, \n          for type: PKPushType, \n          completion: @escaping () -> Void) {\n   if type == .voIP {\n      \/\/ Extract the call information from the push notification payload\n      if let handle = payload.dictionaryPayload[\"handle\"] as? String,\n            let uuidString = payload.dictionaryPayload[\"callUUID\"] as? String,\n            let callUUID = UUID(uuidString: uuidString) {\n\n         \/\/ Configure the call information data structures.\n         let callUpdate = CXCallUpdate()\n         let phoneNumber = CXHandle(type: .phoneNumber, value: handle)\n         callUpdate.remoteHandle = phoneNumber\n                \n         \/\/ Report the call to CallKit, and let it display the call UI.\n         callProvider?.reportNewIncomingCall(with: callUUID, \n                     update: callUpdate, completion: { (error) in\n            if error == nil {\n               \/\/ If the system allows the call to proceed, make a data record for it.\n               let newCall = VoipCall(callUUID, phoneNumber: phoneNumber)\n               self.callManager.addCall(newCall)\n            }\n\n            \/\/ Tell PushKit that the notification is handled.\n            completion()\n         })\n                \n         \/\/ Asynchronously register with the telephony server and \n         \/\/ process the call. Report updates to CallKit as needed.\n         establishConnection(for: callUUID)\n      }\n   }\n}\n\n```\n\nIf the system allows your call to proceed, the [doc:\/\/com.apple.documentation\/documentation\/CallKit\/CXProvider\/reportNewIncomingCall(with:update:completion:)] method executes its completion block and CallKit displays the incoming call interface. At that point, use the delegate of your [doc:\/\/com.apple.documentation\/documentation\/CallKit\/CXProvider] object to respond to user interactions with the interface. For example, use your delegate to respond when the user answers or ends the call.\n\n\n\nFor more information about how to handle user interactions with the call interface, see the methods of [doc:\/\/com.apple.documentation\/documentation\/CallKit\/CXProviderDelegate].\n\n### Respond to Call Hang Ups and Failures\n\nMany things can go wrong when connecting a VoIP call, and CallKit makes it easy to handle problems when they occur.\n\n- If the person who initiated the call hangs up, use the network connection between your app and server to notify the app. In your app, call the [doc:\/\/com.apple.documentation\/documentation\/CallKit\/CXProvider\/reportCall(with:endedAt:reason:)] method of its [doc:\/\/com.apple.documentation\/documentation\/CallKit\/CXProvider] object, specifying [doc:\/\/com.apple.documentation\/documentation\/CallKit\/CXCallEndedReason\/remoteEnded] as the reason for the end of the call. If the incoming call interface is onscreen, CallKit updates the interface to reflect the end of the call, and dismisses the interface.\n- If the recipient of a call answers before the app establishes a connection to your server, don’t fulfill the [doc:\/\/com.apple.documentation\/documentation\/CallKit\/CXAnswerCallAction] object sent to the [doc:\/\/com.apple.documentation\/documentation\/CallKit\/CXProviderDelegate\/provider(_:perform:)-h4in] method of your delegate immediately. Instead, wait until you establish a connection and then fulfill the object. While it waits for your app to fulfill the request, the incoming call interface lets the user know that the call is connecting, but not yet ready.\n- If your app fails to establish a connection to your server, call the [doc:\/\/com.apple.documentation\/documentation\/CallKit\/CXProvider\/reportCall(with:endedAt:reason:)] method with the [doc:\/\/com.apple.documentation\/documentation\/CallKit\/CXCallEndedReason\/failed] option. If the incoming call interface is currently onscreen, the system updates it to indicate a failed call.\n\nAfter sending the initial push notification, don’t send additional push notifications to cancel the call or communicate new details to your app. Instead, communicate with the app directly over the network connection you established between it and your server. Using an existing network connection is generally faster than sending a push notification, and if network conditions are poor, APNs may be unable to deliver push notifications to the device anyway.\n\n## Push Types\n\n- **PKPushType**: Constants reflecting the push types you want to support.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Constants reflecting the push types you want to support.",
          "name" : "PKPushType",
          "url" : "https:\/\/developer.apple.com\/documentation\/PushKit\/PKPushType"
        }
      ],
      "title" : "Push Types"
    }
  ],
  "source" : "appleJSON",
  "title" : "Responding to VoIP Notifications from PushKit",
  "url" : "https:\/\/developer.apple.com\/documentation\/pushkit\/responding-to-voip-notifications-from-pushkit"
}