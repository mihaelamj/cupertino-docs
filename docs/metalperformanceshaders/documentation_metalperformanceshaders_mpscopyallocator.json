{
  "abstract" : "A block to make a copy of a source texture for filters that can only execute out of place.",
  "codeExamples" : [

  ],
  "contentHash" : "cf3514978745526efdef0f8eb2388428909a223690fe508dec4dc1bfc4777767",
  "crawledAt" : "2025-12-09T21:37:53Z",
  "declaration" : {
    "code" : "typealias MPSCopyAllocator = (MPSKernel, any MTLCommandBuffer, any MTLTexture) -> any MTLTexture",
    "language" : "swift"
  },
  "id" : "C7EBBB8D-E6E2-4920-B30A-7BB324CCE6EE",
  "kind" : "typealias",
  "language" : "swift",
  "module" : "Metal Performance Shaders",
  "overview" : "## Discussion\n\nThe block takes the following parameters:\n\nThe copy allocator returns a new valid texture to use as the destination for the kernel operation. If the calling function succeeds, its texture parameter will be overwritten with a pointer to this texture. If the calling function fails, then the texture will be released before the calling function returns.\n\nAllocating a new texture each time is slow (they take up to 1 ms each). You can recycle old textures (or buffers and make texture from them) and reuse the memory inside the copy allocator block.\n\nIf there is any metadata associated with the source texture, such as colorspace information, resource label, CPU cache mode, purgeable state, etc., it may need to be similarly associated with the new texture to avoid losing your metadata.\n\nIf the kernel’s [doc:\/\/com.apple.metalperformanceshaders\/documentation\/MetalPerformanceShaders\/MPSUnaryImageKernel\/clipRect] property doesn’t cover the entire image, you may need to copy pixels from the source texture to the new texture, or regions of the next texture will be uninitialized. You can make a command encoder to encode work on the command buffer here, if necessary. It will be scheduled to run immediately before the kernel work. You may call any of the [doc:\/\/com.apple.documentation\/documentation\/Metal\/MTLCommandBuffer\/enqueue()], [doc:\/\/com.apple.documentation\/documentation\/Metal\/MTLCommandBuffer\/commit()], [doc:\/\/com.apple.documentation\/documentation\/Metal\/MTLCommandBuffer\/waitUntilCompleted()], or [doc:\/\/com.apple.documentation\/documentation\/Metal\/MTLCommandBuffer\/waitUntilScheduled()] methods inside the copy allocator block. Make sure to call [doc:\/\/com.apple.documentation\/documentation\/Metal\/MTLCommandEncoder\/endEncoding()] on the command encoder so that the command buffer has no active encoder before returning.\n\nThe following listing shows a minimal copy allocator implementation.\n\nListing 1. Minimal MPSCopyAllocator Implementation",
  "platforms" : [
    "iOS",
    "iPadOS",
    "Mac Catalyst",
    "macOS",
    "tvOS",
    "visionOS"
  ],
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/metalperformanceshaders\/mpscopyallocator\ncrawled: 2025-12-09T21:37:53Z\n---\n\n# MPSCopyAllocator\n\n**Type Alias**\n\nA block to make a copy of a source texture for filters that can only execute out of place.\n\n## Declaration\n\n```swift\ntypealias MPSCopyAllocator = (MPSKernel, any MTLCommandBuffer, any MTLTexture) -> any MTLTexture\n```\n\n## Discussion\n\nThe block takes the following parameters:\n\n\n\nThe copy allocator returns a new valid texture to use as the destination for the kernel operation. If the calling function succeeds, its texture parameter will be overwritten with a pointer to this texture. If the calling function fails, then the texture will be released before the calling function returns.\n\nAllocating a new texture each time is slow (they take up to 1 ms each). You can recycle old textures (or buffers and make texture from them) and reuse the memory inside the copy allocator block.\n\nIf there is any metadata associated with the source texture, such as colorspace information, resource label, CPU cache mode, purgeable state, etc., it may need to be similarly associated with the new texture to avoid losing your metadata.\n\nIf the kernel’s [doc:\/\/com.apple.metalperformanceshaders\/documentation\/MetalPerformanceShaders\/MPSUnaryImageKernel\/clipRect] property doesn’t cover the entire image, you may need to copy pixels from the source texture to the new texture, or regions of the next texture will be uninitialized. You can make a command encoder to encode work on the command buffer here, if necessary. It will be scheduled to run immediately before the kernel work. You may call any of the [doc:\/\/com.apple.documentation\/documentation\/Metal\/MTLCommandBuffer\/enqueue()], [doc:\/\/com.apple.documentation\/documentation\/Metal\/MTLCommandBuffer\/commit()], [doc:\/\/com.apple.documentation\/documentation\/Metal\/MTLCommandBuffer\/waitUntilCompleted()], or [doc:\/\/com.apple.documentation\/documentation\/Metal\/MTLCommandBuffer\/waitUntilScheduled()] methods inside the copy allocator block. Make sure to call [doc:\/\/com.apple.documentation\/documentation\/Metal\/MTLCommandEncoder\/endEncoding()] on the command encoder so that the command buffer has no active encoder before returning.\n\n\n\nThe following listing shows a minimal copy allocator implementation.\n\nListing 1. Minimal MPSCopyAllocator Implementation\n\n\n\n## Methods\n\n- **encode(commandBuffer:inPlaceTexture:fallbackCopyAllocator:)**: This method attempts to apply a kernel in place on a texture.\n- **encode(commandBuffer:sourceImage:destinationImage:)**\n- **encode(commandBuffer:sourceTexture:destinationTexture:)**: Encodes a kernel into a command buffer, out of place.\n- **sourceRegion(destinationSize:)**: Determines the region of the source texture that will be read for an encode operation.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "This method attempts to apply a kernel in place on a texture.",
          "name" : "encode(commandBuffer:inPlaceTexture:fallbackCopyAllocator:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSUnaryImageKernel\/encode(commandBuffer:inPlaceTexture:fallbackCopyAllocator:)"
        },
        {
          "description" : "",
          "name" : "encode(commandBuffer:sourceImage:destinationImage:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSUnaryImageKernel\/encode(commandBuffer:sourceImage:destinationImage:)"
        },
        {
          "description" : "Encodes a kernel into a command buffer, out of place.",
          "name" : "encode(commandBuffer:sourceTexture:destinationTexture:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSUnaryImageKernel\/encode(commandBuffer:sourceTexture:destinationTexture:)"
        },
        {
          "description" : "Determines the region of the source texture that will be read for an encode operation.",
          "name" : "sourceRegion(destinationSize:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSUnaryImageKernel\/sourceRegion(destinationSize:)"
        }
      ],
      "title" : "Methods"
    }
  ],
  "source" : "appleJSON",
  "title" : "MPSCopyAllocator",
  "url" : "https:\/\/developer.apple.com\/documentation\/metalperformanceshaders\/mpscopyallocator"
}