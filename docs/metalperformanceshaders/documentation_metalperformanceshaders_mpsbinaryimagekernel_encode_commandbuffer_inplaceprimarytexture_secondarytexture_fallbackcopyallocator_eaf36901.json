{
  "abstract" : "This method attempts to apply a kernel in place on a texture.",
  "codeExamples" : [

  ],
  "contentHash" : "0ffb1c0f1b3798930503ea1dc25355cd947d976fe65dc52b24cb8bf3af4f7b3e",
  "crawledAt" : "2025-12-06T12:05:29Z",
  "declaration" : {
    "code" : "func encode(commandBuffer: any MTLCommandBuffer, inPlacePrimaryTexture: UnsafeMutablePointer<any MTLTexture>, secondaryTexture: any MTLTexture, fallbackCopyAllocator copyAllocator: MPSCopyAllocator? = nil) -> Bool",
    "language" : "swift"
  },
  "id" : "37EE4335-65BE-4AB1-A8F5-67F63F22A220",
  "kind" : "method",
  "language" : "swift",
  "module" : "Metal Performance Shaders",
  "overview" : "## Return Value\n\n[doc:\/\/com.apple.documentation\/documentation\/Swift\/true] if the operation succeeded (the texture may have been replaced with a new texture if a copy allocator was provided). [doc:\/\/com.apple.documentation\/documentation\/Swift\/false] if the operation failed (the texture is unmodified).\n\n## Discussion\n\nThis method attempts to apply the kernel in place on a texture. In-place operation means that the same texture is used both to hold the input image and the results. Operating in-place can be an excellent way to reduce resource utilization, and save time and energy. While simple Metal kernels can not operate in place because textures can not be readable and writable at the same time, some Metal Performance Shaders kernels can operate in place because they use multi-pass algorithms. Whether a kernel can operate in-place can depend on current hardware, OS version, and the parameters and properties passed to it. You should never assume that a kernel will continue to work in place, even if you have observed it doing so before.\n\nIf the in-place operation succeeds, this method returns [doc:\/\/com.apple.documentation\/documentation\/Swift\/true]. If the in-place operation fails and no copy allocator is provided, then this method returns [doc:\/\/com.apple.documentation\/documentation\/Swift\/false]. Without a fallback copy allocator, in neither case is the pointer held at `texture` modified.\n\nFailure during in-place operation is common. You may find it simplifies your code to provide a copy allocator. When an in-place operation fails, your copy allocator will be invoked to create a new texture in which to write the results, allowing the kernel to proceed reliably out-of-place. The original texture will be released, replaced with a pointer to the new texture and [doc:\/\/com.apple.documentation\/documentation\/Swift\/true] will be returned. If the copy allocator returns an invalid texture, it is released, `texture` remains unmodified, and [doc:\/\/com.apple.documentation\/documentation\/Swift\/false] is returned.",
  "platforms" : [
    "iOS",
    "iPadOS",
    "Mac Catalyst",
    "macOS",
    "tvOS",
    "visionOS"
  ],
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSBinaryImageKernel\/encode(commandBuffer:inPlacePrimaryTexture:secondaryTexture:fallbackCopyAllocator:)\ncrawled: 2025-12-06T12:05:29Z\n---\n\n# encode(commandBuffer:inPlacePrimaryTexture:secondaryTexture:fallbackCopyAllocator:)\n\n**Instance Method**\n\nThis method attempts to apply a kernel in place on a texture.\n\n## Declaration\n\n```swift\nfunc encode(commandBuffer: any MTLCommandBuffer, inPlacePrimaryTexture: UnsafeMutablePointer<any MTLTexture>, secondaryTexture: any MTLTexture, fallbackCopyAllocator copyAllocator: MPSCopyAllocator? = nil) -> Bool\n```\n\n## Parameters\n\n- **commandBuffer**: A valid command buffer to receive the encoded kernel.\n- **inPlacePrimaryTexture**: A pointer to a valid texture containing the primary image. On success, the image contents and possibly the texture itself will be replaced with the result image.\n- **secondaryTexture**: A pointer to a valid texture containing the secondary source image. It will not be overwritten.\n- **copyAllocator**: An optional block to allocate a new texture to hold the operation results, in case in-place operation is not possible. The allocator may use a different pixel format or size than the original texture. You may enqueue operations on the provided command buffer using the provided compute command encoder to initialize the texture contents.\n\n## Return Value\n\n[doc:\/\/com.apple.documentation\/documentation\/Swift\/true] if the operation succeeded (the texture may have been replaced with a new texture if a copy allocator was provided). [doc:\/\/com.apple.documentation\/documentation\/Swift\/false] if the operation failed (the texture is unmodified).\n\n## Discussion\n\nThis method attempts to apply the kernel in place on a texture. In-place operation means that the same texture is used both to hold the input image and the results. Operating in-place can be an excellent way to reduce resource utilization, and save time and energy. While simple Metal kernels can not operate in place because textures can not be readable and writable at the same time, some Metal Performance Shaders kernels can operate in place because they use multi-pass algorithms. Whether a kernel can operate in-place can depend on current hardware, OS version, and the parameters and properties passed to it. You should never assume that a kernel will continue to work in place, even if you have observed it doing so before.\n\nIf the in-place operation succeeds, this method returns [doc:\/\/com.apple.documentation\/documentation\/Swift\/true]. If the in-place operation fails and no copy allocator is provided, then this method returns [doc:\/\/com.apple.documentation\/documentation\/Swift\/false]. Without a fallback copy allocator, in neither case is the pointer held at `texture` modified.\n\nFailure during in-place operation is common. You may find it simplifies your code to provide a copy allocator. When an in-place operation fails, your copy allocator will be invoked to create a new texture in which to write the results, allowing the kernel to proceed reliably out-of-place. The original texture will be released, replaced with a pointer to the new texture and [doc:\/\/com.apple.documentation\/documentation\/Swift\/true] will be returned. If the copy allocator returns an invalid texture, it is released, `texture` remains unmodified, and [doc:\/\/com.apple.documentation\/documentation\/Swift\/false] is returned.\n\n## Related Documentation\n\n- **MPSCopyAllocator**: A block to make a copy of a source texture for filters that can only execute out of place.\n\n## Methods\n\n- **encode(commandBuffer:primaryTexture:inPlaceSecondaryTexture:fallbackCopyAllocator:)**: This method attempts to apply a kernel in place on a texture.\n- **encode(commandBuffer:primaryTexture:secondaryTexture:destinationTexture:)**: Encodes a kernel into a command buffer, out-of-place.\n- **encode(commandBuffer:primaryImage:secondaryImage:destinationImage:)**\n- **primarySourceRegion(forDestinationSize:)**: Determines the region of the primary source texture that will be read for an encode operation.\n- **secondarySourceRegion(forDestinationSize:)**: Determines the region of the secondary source texture that will be read for an encode operation.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "A block to make a copy of a source texture for filters that can only execute out of place.",
          "name" : "MPSCopyAllocator",
          "url" : "https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSCopyAllocator"
        }
      ],
      "title" : "Related Documentation"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "This method attempts to apply a kernel in place on a texture.",
          "name" : "encode(commandBuffer:primaryTexture:inPlaceSecondaryTexture:fallbackCopyAllocator:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSBinaryImageKernel\/encode(commandBuffer:primaryTexture:inPlaceSecondaryTexture:fallbackCopyAllocator:)"
        },
        {
          "description" : "Encodes a kernel into a command buffer, out-of-place.",
          "name" : "encode(commandBuffer:primaryTexture:secondaryTexture:destinationTexture:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSBinaryImageKernel\/encode(commandBuffer:primaryTexture:secondaryTexture:destinationTexture:)"
        },
        {
          "description" : "",
          "name" : "encode(commandBuffer:primaryImage:secondaryImage:destinationImage:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSBinaryImageKernel\/encode(commandBuffer:primaryImage:secondaryImage:destinationImage:)"
        },
        {
          "description" : "Determines the region of the primary source texture that will be read for an encode operation.",
          "name" : "primarySourceRegion(forDestinationSize:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSBinaryImageKernel\/primarySourceRegion(forDestinationSize:)"
        },
        {
          "description" : "Determines the region of the secondary source texture that will be read for an encode operation.",
          "name" : "secondarySourceRegion(forDestinationSize:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSBinaryImageKernel\/secondarySourceRegion(forDestinationSize:)"
        }
      ],
      "title" : "Methods"
    }
  ],
  "source" : "appleJSON",
  "title" : "encode(commandBuffer:inPlacePrimaryTexture:secondaryTexture:fallbackCopyAllocator:)",
  "url" : "https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSBinaryImageKernel\/encode(commandBuffer:inPlacePrimaryTexture:secondaryTexture:fallbackCopyAllocator:)"
}