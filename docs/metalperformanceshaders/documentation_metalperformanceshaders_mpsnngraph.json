{
  "abstract" : "An optimized representation of a graph of neural network image and filter nodes.",
  "codeExamples" : [

  ],
  "conformsTo" : [
    "CVarArg",
    "CustomDebugStringConvertible",
    "CustomStringConvertible",
    "Equatable",
    "Hashable",
    "NSCoding",
    "NSCopying",
    "NSObjectProtocol",
    "NSSecureCoding"
  ],
  "contentHash" : "96caa9e71fece5a54cab0d5d3b29f4f1c5ca25a6f3da43faa2262e1e95dd1a03",
  "crawledAt" : "2025-12-02T20:00:54Z",
  "declaration" : {
    "code" : "class MPSNNGraph",
    "language" : "swift"
  },
  "id" : "7CF18F95-A009-4D64-B085-E67957CAC8A4",
  "kind" : "class",
  "language" : "swift",
  "module" : "Metal Performance Shaders",
  "overview" : "## Overview\n\nOnce you have prepared a graph of [doc:\/\/com.apple.metalperformanceshaders\/documentation\/MetalPerformanceShaders\/MPSNNImageNode], [doc:\/\/com.apple.metalperformanceshaders\/documentation\/MetalPerformanceShaders\/MPSNNFilterNode], and, if needed, [doc:\/\/com.apple.metalperformanceshaders\/documentation\/MetalPerformanceShaders\/MPSNNStateNode] objects, you may initialize a [doc:\/\/com.apple.metalperformanceshaders\/documentation\/MetalPerformanceShaders\/MPSNNGraph] using the image node that you wish to appear as the result. The graph object will introspect the graph representation and determine which nodes are needed for inputs, and which nodes are produced as output state (if any). Nodes which are not needed to calculate the result image node are ignored. Some nodes may be internally concatenated with other nodes for better performance.\n\nDuring [doc:\/\/com.apple.metalperformanceshaders\/documentation\/MetalPerformanceShaders\/MPSNNGraph] construction, the graph attached to the result node will be parsed and reduced to an optimized representation. This representation may be saved using the [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSSecureCoding] protocol for later recall.\n\nWhen decoding a [doc:\/\/com.apple.metalperformanceshaders\/documentation\/MetalPerformanceShaders\/MPSNNGraph] using a [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSCoder], it will be created against the system default [doc:\/\/com.apple.documentation\/documentation\/Metal\/MTLDevice]. If you would like to set the device, your [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSCoder] should conform to the [doc:\/\/com.apple.metalperformanceshaders\/documentation\/MetalPerformanceShaders\/MPSDeviceProvider] protocol.\n\n### Debugging Tips\n\nIn typical usage, some refinement, especially of padding policies, may be required to get the expected answer from Metal Performance Shaders. If the result image is the wrong size, padding is typically the problem. When the answers are incorrect, the [doc:\/\/com.apple.metalperformanceshaders\/documentation\/MetalPerformanceShaders\/MPSCNNKernel\/offset] or other property may be incorrectly configured at some stage. As the graph is generated starting from an output image node, you may create other graphs starting at any image node within the graph. This will give you a view into the result produced from each intermediate layer with a minimum of fuss. In addition, the usual [doc:\/\/com.apple.documentation\/documentation\/ObjectiveC\/NSObject-swift.class\/debugDescription()] method is available to inspect objects to make sure they conform to expectation.\n\nNote that certain operations such as neuron filters that follow convolution filters and image concatenation may be optimized away by the [doc:\/\/com.apple.metalperformanceshaders\/documentation\/MetalPerformanceShaders\/MPSNNGraph] when it is constructed. The convolution can do neuron operations as part of its operation. Concatenation is best done by writing the result of earlier filter passes in the right place using [doc:\/\/com.apple.metalperformanceshaders\/documentation\/MetalPerformanceShaders\/MPSCNNKernel\/destinationFeatureChannelOffset] rather than by adding an extra copy. Other optimizations may be added as framework capabilities improve.",
  "platforms" : [
    "iOS",
    "iPadOS",
    "Mac Catalyst",
    "macOS",
    "tvOS",
    "visionOS"
  ],
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSNNGraph\ncrawled: 2025-12-02T20:00:54Z\n---\n\n# MPSNNGraph\n\n**Class**\n\nAn optimized representation of a graph of neural network image and filter nodes.\n\n## Declaration\n\n```swift\nclass MPSNNGraph\n```\n\n## Overview\n\nOnce you have prepared a graph of [doc:\/\/com.apple.metalperformanceshaders\/documentation\/MetalPerformanceShaders\/MPSNNImageNode], [doc:\/\/com.apple.metalperformanceshaders\/documentation\/MetalPerformanceShaders\/MPSNNFilterNode], and, if needed, [doc:\/\/com.apple.metalperformanceshaders\/documentation\/MetalPerformanceShaders\/MPSNNStateNode] objects, you may initialize a [doc:\/\/com.apple.metalperformanceshaders\/documentation\/MetalPerformanceShaders\/MPSNNGraph] using the image node that you wish to appear as the result. The graph object will introspect the graph representation and determine which nodes are needed for inputs, and which nodes are produced as output state (if any). Nodes which are not needed to calculate the result image node are ignored. Some nodes may be internally concatenated with other nodes for better performance.\n\n\n\nDuring [doc:\/\/com.apple.metalperformanceshaders\/documentation\/MetalPerformanceShaders\/MPSNNGraph] construction, the graph attached to the result node will be parsed and reduced to an optimized representation. This representation may be saved using the [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSSecureCoding] protocol for later recall.\n\nWhen decoding a [doc:\/\/com.apple.metalperformanceshaders\/documentation\/MetalPerformanceShaders\/MPSNNGraph] using a [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSCoder], it will be created against the system default [doc:\/\/com.apple.documentation\/documentation\/Metal\/MTLDevice]. If you would like to set the device, your [doc:\/\/com.apple.documentation\/documentation\/Foundation\/NSCoder] should conform to the [doc:\/\/com.apple.metalperformanceshaders\/documentation\/MetalPerformanceShaders\/MPSDeviceProvider] protocol.\n\n### Debugging Tips\n\nIn typical usage, some refinement, especially of padding policies, may be required to get the expected answer from Metal Performance Shaders. If the result image is the wrong size, padding is typically the problem. When the answers are incorrect, the [doc:\/\/com.apple.metalperformanceshaders\/documentation\/MetalPerformanceShaders\/MPSCNNKernel\/offset] or other property may be incorrectly configured at some stage. As the graph is generated starting from an output image node, you may create other graphs starting at any image node within the graph. This will give you a view into the result produced from each intermediate layer with a minimum of fuss. In addition, the usual [doc:\/\/com.apple.documentation\/documentation\/ObjectiveC\/NSObject-swift.class\/debugDescription()] method is available to inspect objects to make sure they conform to expectation.\n\nNote that certain operations such as neuron filters that follow convolution filters and image concatenation may be optimized away by the [doc:\/\/com.apple.metalperformanceshaders\/documentation\/MetalPerformanceShaders\/MPSNNGraph] when it is constructed. The convolution can do neuron operations as part of its operation. Concatenation is best done by writing the result of earlier filter passes in the right place using [doc:\/\/com.apple.metalperformanceshaders\/documentation\/MetalPerformanceShaders\/MPSCNNKernel\/destinationFeatureChannelOffset] rather than by adding an extra copy. Other optimizations may be added as framework capabilities improve.\n\n## Initializers\n\n- **init(coder:device:)**\n- **init(device:resultImage:)**\n- **init(device:resultImage:resultImageIsNeeded:)**\n- **init(device:resultImages:resultsAreNeeded:)**\n\n## Instance Properties\n\n- **destinationImageAllocator**\n- **MPSImageAllocator**\n- **intermediateImageHandles**\n- **outputStateIsTemporary**\n- **resultHandle**\n- **resultStateHandles**\n- **sourceImageHandles**\n- **sourceStateHandles**\n- **format**\n- **resultImageIsNeeded**\n\n## Instance Methods\n\n- **encode(to:sourceImages:)**\n- **encode(to:sourceImages:sourceStates:intermediateImages:destinationStates:)**\n- **MPSState**: An opaque data container for large storage in MPS CNN filters.\n- **MPSNNBinaryGradientState**: A class representing the state of a gradient binary kernel when it was encoded.\n- **MPSNNGradientState**: A class representing the state of a gradient kernel when it was encoded.\n- **executeAsync(withSourceImages:completionHandler:)**\n- **MPSNNGraphCompletionHandler**: A notification when an asynchronous graph execution has finished.\n- **encodeBatch(to:sourceImages:sourceStates:)**\n- **encodeBatch(to:sourceImages:sourceStates:intermediateImages:destinationStates:)**\n- **readCountForSourceImage(at:)**\n- **readCountForSourceState(at:)**\n- **reloadFromDataSources()**\n\n## Neural Network Graphs\n\n- **MPSNNImageNode**: A placeholder node denoting the position of a neural network image in a graph.\n- **MPSHandle**: The protocol that provides resource identification.\n\n## Inherits From\n\n- MPSKernel\n\n## Conforms To\n\n- CVarArg\n- CustomDebugStringConvertible\n- CustomStringConvertible\n- Equatable\n- Hashable\n- NSCoding\n- NSCopying\n- NSObjectProtocol\n- NSSecureCoding\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "",
          "name" : "init(coder:device:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSNNGraph\/init(coder:device:)"
        },
        {
          "description" : "",
          "name" : "init(device:resultImage:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSNNGraph\/init(device:resultImage:)"
        },
        {
          "description" : "",
          "name" : "init(device:resultImage:resultImageIsNeeded:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSNNGraph\/init(device:resultImage:resultImageIsNeeded:)"
        },
        {
          "description" : "",
          "name" : "init(device:resultImages:resultsAreNeeded:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSNNGraph\/init(device:resultImages:resultsAreNeeded:)"
        }
      ],
      "title" : "Initializers"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "",
          "name" : "destinationImageAllocator",
          "url" : "https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSNNGraph\/destinationImageAllocator"
        },
        {
          "description" : "",
          "name" : "MPSImageAllocator",
          "url" : "https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSImageAllocator"
        },
        {
          "description" : "",
          "name" : "intermediateImageHandles",
          "url" : "https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSNNGraph\/intermediateImageHandles"
        },
        {
          "description" : "",
          "name" : "outputStateIsTemporary",
          "url" : "https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSNNGraph\/outputStateIsTemporary"
        },
        {
          "description" : "",
          "name" : "resultHandle",
          "url" : "https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSNNGraph\/resultHandle"
        },
        {
          "description" : "",
          "name" : "resultStateHandles",
          "url" : "https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSNNGraph\/resultStateHandles"
        },
        {
          "description" : "",
          "name" : "sourceImageHandles",
          "url" : "https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSNNGraph\/sourceImageHandles"
        },
        {
          "description" : "",
          "name" : "sourceStateHandles",
          "url" : "https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSNNGraph\/sourceStateHandles"
        },
        {
          "description" : "",
          "name" : "format",
          "url" : "https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSNNGraph\/format"
        },
        {
          "description" : "",
          "name" : "resultImageIsNeeded",
          "url" : "https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSNNGraph\/resultImageIsNeeded"
        }
      ],
      "title" : "Instance Properties"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "",
          "name" : "encode(to:sourceImages:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSNNGraph\/encode(to:sourceImages:)"
        },
        {
          "description" : "",
          "name" : "encode(to:sourceImages:sourceStates:intermediateImages:destinationStates:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSNNGraph\/encode(to:sourceImages:sourceStates:intermediateImages:destinationStates:)"
        },
        {
          "description" : "An opaque data container for large storage in MPS CNN filters.",
          "name" : "MPSState",
          "url" : "https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSState"
        },
        {
          "description" : "A class representing the state of a gradient binary kernel when it was encoded.",
          "name" : "MPSNNBinaryGradientState",
          "url" : "https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSNNBinaryGradientState"
        },
        {
          "description" : "A class representing the state of a gradient kernel when it was encoded.",
          "name" : "MPSNNGradientState",
          "url" : "https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSNNGradientState"
        },
        {
          "description" : "",
          "name" : "executeAsync(withSourceImages:completionHandler:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSNNGraph\/executeAsync(withSourceImages:completionHandler:)"
        },
        {
          "description" : "A notification when an asynchronous graph execution has finished.",
          "name" : "MPSNNGraphCompletionHandler",
          "url" : "https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSNNGraphCompletionHandler"
        },
        {
          "description" : "",
          "name" : "encodeBatch(to:sourceImages:sourceStates:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSNNGraph\/encodeBatch(to:sourceImages:sourceStates:)"
        },
        {
          "description" : "",
          "name" : "encodeBatch(to:sourceImages:sourceStates:intermediateImages:destinationStates:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSNNGraph\/encodeBatch(to:sourceImages:sourceStates:intermediateImages:destinationStates:)"
        },
        {
          "description" : "",
          "name" : "readCountForSourceImage(at:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSNNGraph\/readCountForSourceImage(at:)"
        },
        {
          "description" : "",
          "name" : "readCountForSourceState(at:)",
          "url" : "https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSNNGraph\/readCountForSourceState(at:)"
        },
        {
          "description" : "",
          "name" : "reloadFromDataSources()",
          "url" : "https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSNNGraph\/reloadFromDataSources()"
        }
      ],
      "title" : "Instance Methods"
    },
    {
      "content" : "",
      "items" : [
        {
          "description" : "A placeholder node denoting the position of a neural network image in a graph.",
          "name" : "MPSNNImageNode",
          "url" : "https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSNNImageNode"
        },
        {
          "description" : "The protocol that provides resource identification.",
          "name" : "MPSHandle",
          "url" : "https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSHandle"
        }
      ],
      "title" : "Neural Network Graphs"
    },
    {
      "content" : "",
      "items" : [
        {
          "name" : "MPSKernel"
        }
      ],
      "title" : "Inherits From"
    }
  ],
  "source" : "appleJSON",
  "title" : "MPSNNGraph",
  "url" : "https:\/\/developer.apple.com\/documentation\/MetalPerformanceShaders\/MPSNNGraph"
}