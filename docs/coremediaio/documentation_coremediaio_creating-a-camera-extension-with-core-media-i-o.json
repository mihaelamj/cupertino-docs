{
  "abstract" : "Build high-performance camera drivers that are secure and simple to deploy.",
  "codeExamples" : [
    {
      "code" : "<plist version=\"1.0\">\n    <dict>\n        <key>com.apple.security.app-sandbox<\/key>\n        <true\/>\n        <key>com.apple.developer.system-extension.install<\/key>\n        <true\/>\n        <key>com.apple.security.application-groups<\/key>\n        <array>\n            <string>$(TeamIdentifierPrefix)com.example.CustomCamera<\/string>\n        <\/array>\n    <\/dict>\n<\/plist>",
      "language" : "objc"
    },
    {
      "code" : "<plist version=\"1.0\">\n    <dict>\n        <key>com.apple.security.app-sandbox<\/key>\n        <true\/>\n        <key>com.apple.security.application-groups<\/key>\n        <array>\n            <string>(TeamIdentifierPrefix)com.example.CustomCamera<\/string>\n        <\/array>\n    <\/dict>\n<\/plist>",
      "language" : "swift"
    },
    {
      "code" : "\/\/ The bundle identifier of your extension.\nlet identifier = \"com.example.apple-samplecode.CustomCamera.CameraExtension\"\n\n\/\/ Submit an activation request.\nlet activationRequest = OSSystemExtensionRequest.activationRequest(forExtensionWithIdentifier: identifier, queue: .main)\nactivationRequest.delegate = self\nOSSystemExtensionManager.shared.submitRequest(activationRequest)",
      "language" : "swift"
    },
    {
      "code" : "\/\/ Discover devices with a device type of `externalUnknown`.\nlet discoverySession = AVCaptureDevice.DiscoverySession(deviceTypes: [.externalUnknown],\n                                                        mediaType: .video,\n                                                        position: .unspecified)\n\/\/ Access the external devices.\nlet externalDevices = discoverySession.devices",
      "language" : "swift"
    }
  ],
  "contentHash" : "04bf9a6c0595bdc94bfce939702b76681c48d37c5fe685c372eaccc98a584c2c",
  "crawledAt" : "2025-12-05T15:24:46Z",
  "id" : "F8633582-539F-4B47-8D7A-19AC76229916",
  "kind" : "article",
  "language" : "swift",
  "module" : "Core Media I\/O",
  "overview" : "## Overview\n\nCamera extensions are a new type of system extension available in macOS 12.3 and later. They provide a simple, secure model for building high-performance camera drivers for macOS. You package and install them with your app, which makes them simple to deploy, including through the App Store.\n\nThe following illustration shows a high-level view of a camera extension.\n\n\n\nA camera extension consists of three primary components:\n\nTo simplify creating your own extensions, Xcode provides a Camera Extension template that provides a fully functional extension implementation. It creates a virtual camera device that renders a horizontal white line that moves up and down the display. This article shows how to configure the template’s output to build your own camera extension.\n\n### Add entitlements to your host app\n\nYou package your camera extension as part of your app bundle. To allow your app to install and communicate with the extension, your app target requires two additional capabilities. Select the target in Xcode, and click the Signing & Capabilities pane. Add the following capabilities to the target:\n\nAdding the capabilities to the target writes the values to an entitlements file. For example, an app with a bundle identifier of `com.example.CustomCamera` would have an entitlements file similar to the following:\n\n### Create a camera extension target\n\nAdd a new target to your app using the Camera Extension template. In Xcode, go to the File menu and choose File > New and select the Target menu item. In the dialog that appears, select the macOS pane and find the Camera Extension template as shown below.\n\n\n\nClick the Next button. On the screen that follows, give the extension an appropriate name and leave the other values set to their defaults, and then click the Finish button.\n\nThe template creates a new target and folder with the name you specified. The folder contains the following files:\n\n### Configure the extension\n\nSo that your app and extension can communicate, open the `[CameraExtensionName].entitlements` file and update it to use the same app group name that you defined in your app, as in the example below.\n\nNext, open the `[CameraExtensionName]Provider.swift` file. This file provides a complete implementation for all components of a camera extension. Look through the file and familiarize yourself with the code.\n\nYou can quickly find essential user-customizable strings by searching the file for the string, `SampleCapture`, and replacing the values as appropriate. A particularly important string to customize is the [doc:\/\/com.apple.coremediaio\/documentation\/CoreMediaIO\/CMIOExtensionDevice\/localizedName] that you specify for the [doc:\/\/com.apple.coremediaio\/documentation\/CoreMediaIO\/CMIOExtensionDevice], because it’s the string that apps display in their camera selection UI.\n\n### Activate the extension\n\nThe system automatically installs a camera extension when a user installs your app. However, before your extension is available for the system to use, your app needs to activate it by performing an activation request like shown below.\n\nOnly apps that reside in the `\/Applications` directory can activate an extension. To test your extension, move your app from Xcode’s build results to the `\/Applications` folder. Launch your app from its new location to test its activation request. When it attempts to activate the extension, the system prompts the user with a dialog like shown below.\n\n\n\nBefore the extension is available to the system, a person with Admin privileges for the Mac must explicitly allow access to it in the Systems & Privacy screen of System Settings.\n\n\n\n### Access the custom camera\n\nAfter you’ve allowed the system to use your custom extension, it’s automatically available as a selectable camera in system apps like FaceTime and PhotoBooth. Camera extensions are also fully compatible with [doc:\/\/com.apple.documentation\/documentation\/AVFoundation] capture APIs, which means you can access your extension as an [doc:\/\/com.apple.documentation\/documentation\/AVFoundation\/AVCaptureDevice] object and use it like any other device. For example, to retrieve your custom camera extension (as well as any others on the system), retrieve it as an [doc:\/\/com.apple.documentation\/documentation\/AVFoundation\/AVCaptureDevice\/DeviceType-swift.struct\/externalUnknown] device type as shown below.",
  "rawMarkdown" : "---\nsource: https:\/\/developer.apple.com\/documentation\/coremediaio\/creating-a-camera-extension-with-core-media-i-o\ncrawled: 2025-12-05T15:24:46Z\n---\n\n# Creating a camera extension with Core Media I\/O\n\n**Article**\n\nBuild high-performance camera drivers that are secure and simple to deploy.\n\n## Overview\n\nCamera extensions are a new type of system extension available in macOS 12.3 and later. They provide a simple, secure model for building high-performance camera drivers for macOS. You package and install them with your app, which makes them simple to deploy, including through the App Store.\n\n\n\nThe following illustration shows a high-level view of a camera extension.\n\n\n\nA camera extension consists of three primary components:\n\n- A [doc:\/\/com.apple.coremediaio\/documentation\/CoreMediaIO\/CMIOExtensionProvider] represents the primary interface to the extension. The provider and its source manage the extension’s device and client connections, and also define properties common to the extension such as its name and manufacturer.\n- A [doc:\/\/com.apple.coremediaio\/documentation\/CoreMediaIO\/CMIOExtensionDevice] represents a hardware or software device that the extension publishes as a selectable camera in apps like FaceTime. A device and its source configure supporting resources like buffer pools that it uses when streaming data. A device also defines properties for values such as its model name and transport type.\n- A [doc:\/\/com.apple.coremediaio\/documentation\/CoreMediaIO\/CMIOExtensionStream] represents a stream of data to send to clients. A stream and its source specify the stream’s format, minimum and maximum frame rates, and direction. A stream’s source object is responsible for starting and stopping the stream’s flow of data.\n\nTo simplify creating your own extensions, Xcode provides a Camera Extension template that provides a fully functional extension implementation. It creates a virtual camera device that renders a horizontal white line that moves up and down the display. This article shows how to configure the template’s output to build your own camera extension.\n\n\n\n### Add entitlements to your host app\n\nYou package your camera extension as part of your app bundle. To allow your app to install and communicate with the extension, your app target requires two additional capabilities. Select the target in Xcode, and click the Signing & Capabilities pane. Add the following capabilities to the target:\n\n- System Extension. This capability enables the app to install system extensions.\n- App Groups. This capability enables the app to define a common group container for the app and the extension to share, which allows them to communicate.\n\nAdding the capabilities to the target writes the values to an entitlements file. For example, an app with a bundle identifier of `com.example.CustomCamera` would have an entitlements file similar to the following:\n\n```objc\n<plist version=\"1.0\">\n    <dict>\n        <key>com.apple.security.app-sandbox<\/key>\n        <true\/>\n        <key>com.apple.developer.system-extension.install<\/key>\n        <true\/>\n        <key>com.apple.security.application-groups<\/key>\n        <array>\n            <string>$(TeamIdentifierPrefix)com.example.CustomCamera<\/string>\n        <\/array>\n    <\/dict>\n<\/plist>\n```\n\n### Create a camera extension target\n\nAdd a new target to your app using the Camera Extension template. In Xcode, go to the File menu and choose File > New and select the Target menu item. In the dialog that appears, select the macOS pane and find the Camera Extension template as shown below.\n\n\n\nClick the Next button. On the screen that follows, give the extension an appropriate name and leave the other values set to their defaults, and then click the Finish button.\n\nThe template creates a new target and folder with the name you specified. The folder contains the following files:\n\n- A `[CameraExtensionName]Provider.swift` file that provides the complete extension implementation.\n- A `main.swift` file that provides the minimal code for the system to initialize the extension.\n- An `Info.plist` that defines the `CMIOExtensionMachServiceName` for the extension and a [doc:\/\/com.apple.documentation\/documentation\/SystemExtensions\/NSSystemExtensionUsageDescriptionKey] that describes the extension’s purpose to the user.\n- A `[CameraExtensionName].entitlements` file that defines a default app group.\n\n### Configure the extension\n\nSo that your app and extension can communicate, open the `[CameraExtensionName].entitlements` file and update it to use the same app group name that you defined in your app, as in the example below.\n\n```swift\n<plist version=\"1.0\">\n    <dict>\n        <key>com.apple.security.app-sandbox<\/key>\n        <true\/>\n        <key>com.apple.security.application-groups<\/key>\n        <array>\n            <string>(TeamIdentifierPrefix)com.example.CustomCamera<\/string>\n        <\/array>\n    <\/dict>\n<\/plist>\n```\n\nNext, open the `[CameraExtensionName]Provider.swift` file. This file provides a complete implementation for all components of a camera extension. Look through the file and familiarize yourself with the code.\n\nYou can quickly find essential user-customizable strings by searching the file for the string, `SampleCapture`, and replacing the values as appropriate. A particularly important string to customize is the [doc:\/\/com.apple.coremediaio\/documentation\/CoreMediaIO\/CMIOExtensionDevice\/localizedName] that you specify for the [doc:\/\/com.apple.coremediaio\/documentation\/CoreMediaIO\/CMIOExtensionDevice], because it’s the string that apps display in their camera selection UI.\n\n### Activate the extension\n\nThe system automatically installs a camera extension when a user installs your app. However, before your extension is available for the system to use, your app needs to activate it by performing an activation request like shown below.\n\n```swift\n\/\/ The bundle identifier of your extension.\nlet identifier = \"com.example.apple-samplecode.CustomCamera.CameraExtension\"\n\n\/\/ Submit an activation request.\nlet activationRequest = OSSystemExtensionRequest.activationRequest(forExtensionWithIdentifier: identifier, queue: .main)\nactivationRequest.delegate = self\nOSSystemExtensionManager.shared.submitRequest(activationRequest)\n```\n\nOnly apps that reside in the `\/Applications` directory can activate an extension. To test your extension, move your app from Xcode’s build results to the `\/Applications` folder. Launch your app from its new location to test its activation request. When it attempts to activate the extension, the system prompts the user with a dialog like shown below.\n\n\n\nBefore the extension is available to the system, a person with Admin privileges for the Mac must explicitly allow access to it in the Systems & Privacy screen of System Settings.\n\n\n\n\n\n### Access the custom camera\n\nAfter you’ve allowed the system to use your custom extension, it’s automatically available as a selectable camera in system apps like FaceTime and PhotoBooth. Camera extensions are also fully compatible with [doc:\/\/com.apple.documentation\/documentation\/AVFoundation] capture APIs, which means you can access your extension as an [doc:\/\/com.apple.documentation\/documentation\/AVFoundation\/AVCaptureDevice] object and use it like any other device. For example, to retrieve your custom camera extension (as well as any others on the system), retrieve it as an [doc:\/\/com.apple.documentation\/documentation\/AVFoundation\/AVCaptureDevice\/DeviceType-swift.struct\/externalUnknown] device type as shown below.\n\n```swift\n\/\/ Discover devices with a device type of `externalUnknown`.\nlet discoverySession = AVCaptureDevice.DiscoverySession(deviceTypes: [.externalUnknown],\n                                                        mediaType: .video,\n                                                        position: .unspecified)\n\/\/ Access the external devices.\nlet externalDevices = discoverySession.devices\n```\n\n## Providers\n\n- **Overriding the default USB video class extension**: Create a simple DriverKit extension to override the default driver-matching behavior for USB devices.\n- **CMIOExtensionProvider**: An object that manages device connections for a provider.\n- **CMIOExtensionProviderSource**: A protocol for objects that act as provider sources.\n- **CMIOExtensionProviderProperties**: An object that manages the properties of an extension provider.\n\n",
  "sections" : [
    {
      "content" : "",
      "items" : [
        {
          "description" : "Create a simple DriverKit extension to override the default driver-matching behavior for USB devices.",
          "name" : "Overriding the default USB video class extension",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreMediaIO\/overriding-the-default-usb-video-class-extension"
        },
        {
          "description" : "An object that manages device connections for a provider.",
          "name" : "CMIOExtensionProvider",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreMediaIO\/CMIOExtensionProvider"
        },
        {
          "description" : "A protocol for objects that act as provider sources.",
          "name" : "CMIOExtensionProviderSource",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreMediaIO\/CMIOExtensionProviderSource"
        },
        {
          "description" : "An object that manages the properties of an extension provider.",
          "name" : "CMIOExtensionProviderProperties",
          "url" : "https:\/\/developer.apple.com\/documentation\/CoreMediaIO\/CMIOExtensionProviderProperties"
        }
      ],
      "title" : "Providers"
    }
  ],
  "source" : "appleJSON",
  "title" : "Creating a camera extension with Core Media I\/O",
  "url" : "https:\/\/developer.apple.com\/documentation\/coremediaio\/creating-a-camera-extension-with-core-media-i-o"
}